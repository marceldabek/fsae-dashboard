const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CMjZw2V-.js","assets/index-BPnaI25c.css"])))=>i.map(i=>d[i]);
import{g as Z,r as l,u as q,f as G,a as J,b as K,h as X,c as Y,_ as ee,j as e,L as se}from"./index-CMjZw2V-.js";import{L as te}from"./LinkButton-CsrUX8nd.js";function re(){const{id:d}=Z(),[r,F]=l.useState(null),[L,T]=l.useState([]),[E,$]=l.useState([]),[g,A]=l.useState([]),[v,C]=l.useState([]),[j,I]=l.useState(null),[w,h]=l.useState([]),[y,M]=l.useState([]),[_,H]=l.useState(0),[p]=q();if(l.useEffect(()=>{(async()=>{const[s,a,n,c,i]=await Promise.all([G(),J(),K(),X(),Y()]);$(s);const o=s.find(t=>t.id===d)||null;if(F(o),T(a),C(n),A(n.filter(t=>t.assignee_id===d)),I(c),M(i),d&&p)try{const t=await ee(()=>import("./index-CMjZw2V-.js").then(u=>u.P),__vite__mapDeps([0,1]));t&&typeof t.fetchLogsForPerson=="function"?h(await t.fetchLogsForPerson(d)):h([])}catch{h([])}else h([])})()},[d,p]),l.useEffect(()=>{if(!r)return;const s=new Set([2,4,6]),a=new Set(y.filter(i=>i.person_id===r.id).map(i=>i.date));let n=0;const c=new Date;for(let i=0;i<120;i++){const o=c.getDay(),t=c.toISOString().slice(0,10);if(s.has(o))if(a.has(t))n++;else break;c.setDate(c.getDate()-1)}H(n)},[y,r]),!r)return e.jsx("div",{className:"text-sm",children:"Loading…"});const S=L.filter(s=>s.owner_ids?.includes(d)?!0:v.filter(n=>n.project_id===s.id&&n.assignee_id===d).some(n=>n.status!=="Complete")),R=S.length,U=g.length,B=g.filter(s=>s.status!=="Complete").length,O=s=>s===1?.5:s===3?1:s===6?2:s===10?3:s===15?5:s===40?10:s===65?15:s===98?20:s===150?25:s===200?30:Math.max(0,Math.round(s/4)),z=Math.round(g.filter(s=>s.status==="Complete").reduce((s,a)=>s+(typeof a.ranked_points=="number"?O(a.ranked_points):2),0));function N(s){const a="/fsae-dashboard/",n=(s||"Bronze").toLowerCase();return`${a}icons/rank-${n}.png`}const D=(r.rank_history||[]).slice().sort((s,a)=>a.ts-s.ts);function Q(s){return s===1||s===21||s===31?"st":s===2||s===22?"nd":s===3||s===23?"rd":"th"}function b(s){const a=s instanceof Date?s:new Date(s),n=a.toLocaleString("en-US",{month:"short"}),c=a.getDate();return`${n} ${c}${Q(c)}`}function V(s){return s.replace(/(\d{4})-(\d{2})-(\d{2})/,(a,n,c,i)=>{const o=new Date(Number(n),Number(c)-1,Number(i));return b(o)})}function W(s){const a=s.note?V(s.note):s.type;return s.type==="attendance"?a.replace(/Attendance\s+\d+\s*pts?\s+on\s+/i,"Attendance "):a}return e.jsxs("div",{className:"max-w-2xl mx-auto mt-6 space-y-6",children:[e.jsxs("div",{className:"rounded-2xl bg-white/5 border border-white/10 p-4 flex flex-col gap-1.5 relative",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xl font-semibold leading-tight truncate flex items-center gap-2",children:e.jsx("span",{className:"truncate",children:r.name})}),r.discord&&e.jsxs("div",{className:"text-xs text-muted leading-snug truncate uppercase tracking-caps",children:["@",r.discord.replace(/^@/,"")]}),e.jsx("div",{className:"text-xs text-muted leading-snug uppercase tracking-caps",children:r.year||r.role})]}),p&&r.rank&&e.jsx("img",{src:N(r.rank),alt:r.rank,className:"shrink-0 h-20 w-20 md:h-24 md:w-24 object-contain -mt-2"})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-5 text-center",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-lg font-semibold",children:R}),e.jsx("div",{className:"text-xs text-muted uppercase tracking-caps",children:"Projects"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-lg font-semibold",children:U}),e.jsx("div",{className:"text-xs text-muted uppercase tracking-caps",children:"Tasks"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-lg font-semibold",children:B}),e.jsx("div",{className:"text-xs text-muted uppercase tracking-caps",children:"To Do"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"text-lg font-semibold flex items-center gap-1",children:[_,_>0&&e.jsx("svg",{className:"h-4 w-4 text-orange-400",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{d:"M12 2c.7 2.4 2.1 4.2 4.2 5.5 2 .3 3.3 1.5 3.8 3.6.5 2.1-.2 4-2.1 5.7-.6-1.6-1.5-2.8-2.9-3.6.3 2.2-.5 4-2.4 5.4-1.9 1.4-3.9 1.5-6 .4-2.1-1.1-3.1-2.9-3.1-5.3 0-1.5.5-2.8 1.6-3.9 1.1-1.1 2.4-1.7 3.9-1.7-.4 1.3-.2 2.4.5 3.5.7 1 1.6 1.4 2.7 1.2 1.1-.2 1.8-.9 2-2 .2-1.1-.2-2.1-1.1-3-.9-.9-1.5-2-1.6-3.2-.1-1.2.3-2.4 1.1-3.7Z"})})]}),e.jsx("div",{className:"text-xs text-muted uppercase tracking-caps",children:"Streak"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-lg font-semibold",children:z}),e.jsx("div",{className:"text-xs text-muted uppercase tracking-caps",children:"Hrs"})]})]})]}),e.jsxs("div",{className:"rounded-2xl bg-white/5 border border-white/10 p-4",children:[e.jsx("h2",{className:"font-semibold mb-2",children:"Quick Links"}),e.jsxs("ul",{className:"list-disc pl-5 text-sm",children:[(()=>{const s=j?.sharepoint_url||"https://uconn-my.sharepoint.com/shared?id=%2Fsites%2FUConnFormulaSAE%2FShared%20Documents&listurl=https%3A%2F%2Fuconn%2Esharepoint%2Ecom%2Fsites%2FUConnFormulaSAE%2FShared%20Documents";return e.jsx("li",{children:e.jsx("a",{className:"underline",href:s,target:"_blank",children:"SharePoint"})})})(),j?.rulebook_url&&e.jsx("li",{children:e.jsx("a",{className:"underline",href:j.rulebook_url,target:"_blank",children:"Rulebook (PDF)"})})]})]}),e.jsxs("div",{className:"rounded-2xl bg-white/5 border border-white/10 p-4",children:[e.jsx("h2",{className:"font-semibold mb-2",children:"Projects"}),e.jsx("ul",{className:"space-y-3",children:S.map(s=>{const a=v.filter(t=>t.project_id===s.id),n=a.length,c=a.filter(t=>t.status==="Complete").length,i=n?Math.round(c/n*100):0,o=(()=>{const t=s.due_date||"",u=t.match(/(\d{4})[\/-]?(\d{2})[\/-]?(\d{2})/);let m=null;if(u){const[,k,f,P]=u;m=new Date(Number(k),Number(f)-1,Number(P))}else isNaN(Date.parse(t))||(m=new Date(t));if(m){const k=m.toLocaleString("en-US",{month:"long"}),f=m.getDate();return`${k} ${f}${(x=>x===1||x===21||x===31?"st":x===2||x===22?"nd":x===3||x===23?"rd":"th")(f)}`}return t})();return e.jsxs("li",{className:"rounded-xl bg-white/10 border border-white/10 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2 min-w-0",children:e.jsx(se,{className:"text-base md:text-lg font-semibold truncate",to:`/project/${s.id}`,children:s.name})}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsxs("div",{className:"text-sm text-muted",children:[c,"/",n," · ",i,"%"]}),s.design_link&&e.jsx(te,{href:s.design_link,children:"Design Docs"})]})]}),e.jsx("div",{className:"text-xs text-muted uppercase tracking-caps",children:s.description?s.description:null}),s.due_date&&e.jsxs("div",{className:"text-xs text-muted mt-1 uppercase tracking-caps",children:["Due ",o]}),a.filter(t=>t.status!=="Complete").length>0&&e.jsx("ul",{className:"mt-3 grid grid-cols-1 md:grid-cols-2 gap-3",children:a.filter(t=>t.status!=="Complete").map(t=>{const u=t.status==="In Progress"?"bg-yellow-400":"bg-red-500";return e.jsxs("li",{className:"relative flex flex-col justify-between gap-2 rounded bg-surface border border-border p-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-medium text-sm truncate",title:t.description,children:t.description}),e.jsxs("div",{className:"text-tick text-muted flex gap-2 items-center mt-0.5",children:[e.jsx("span",{className:"capitalize",children:t.status}),e.jsx("span",{children:"·"}),e.jsx("span",{children:t.assignee_id?`@${E.find(m=>m.id===t.assignee_id)?.name||"Assignee"}`:"Unassigned"})]})]}),e.jsx("span",{className:`absolute top-3 right-3 w-3.5 h-3.5 rounded-full ${u} shadow`,"aria-hidden":!0})]},t.id)})})]},s.id)})})]}),e.jsxs("div",{className:"rounded-2xl bg-white/5 border border-white/10 p-4",children:[e.jsx("h2",{className:"font-semibold mb-2",children:"Badges"}),r.skills&&r.skills.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:r.skills.map((s,a)=>e.jsx("span",{className:"text-xs px-3 py-1 rounded bg-accent/10 border border-accent/30 text-accent font-medium uppercase tracking-caps",children:s},a))}):e.jsx("div",{className:"text-xs text-muted uppercase tracking-caps",children:"No badges yet."})]}),p?e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"rounded-2xl bg-white/5 border border-white/10 p-4",children:[e.jsx("h2",{className:"font-semibold mb-2",children:"Ranked History"}),D.length===0?e.jsx("div",{className:"text-xs text-muted uppercase tracking-caps",children:"No rank changes yet."}):e.jsx("ul",{className:"space-y-2 text-sm",children:D.map((s,a)=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted w-24 uppercase tracking-caps",children:b(s.ts)}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("img",{src:N(s.from),alt:s.from,className:"h-4 w-4 object-contain"}),e.jsx("span",{children:s.from})]}),e.jsx("span",{className:"text-muted",children:"→"}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("img",{src:N(s.to),alt:s.to,className:"h-4 w-4 object-contain"}),e.jsx("span",{children:s.to})]})]},a))})]}),e.jsxs("div",{className:"rounded-2xl bg-white/5 border border-white/10 p-4",children:[e.jsx("h2",{className:"font-semibold mb-2",children:"Points History"}),w.length===0?e.jsx("div",{className:"text-xs text-muted uppercase tracking-caps",children:"No point events yet."}):e.jsx("ul",{className:"space-y-2 text-sm max-h-72 overflow-auto pr-1",children:w.filter(s=>s.type==="attendance"||s.type==="task_points").slice(0,100).map((s,a)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-xs text-muted w-24 shrink-0 uppercase tracking-caps",children:b(s.ts)}),e.jsxs("span",{className:"flex-1",children:[e.jsx("span",{className:"text-white/90",children:W(s)})," ",typeof s.points=="number"&&e.jsxs("span",{className:"text-accent font-semibold",children:["(+",s.points,")"]})]})]},s.id||a))})]})]}):null]})}export{re as default};
