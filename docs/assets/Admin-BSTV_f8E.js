const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CDBOaIZ2.js","assets/index-Dsd85Upp.css"])))=>i.map(i=>d[i]);
import{d as ds,e as ms,r,f as V,a as Y,i as ze,s as ps,t as se,v as M,j as e,w as us,x as xs,y as hs,_ as G,z as Ve,g as Ye,A as gs,B as te,C as bs,D as fs,E as js,F as ys}from"./index-CDBOaIZ2.js";import{P as Ge}from"./PersonSelectPopover-DQiTiOZK.js";import{T as vs}from"./TaskCreateCard-DQj0vPl4.js";function Ys(){const b=ds()?.uid||null,{isLead:I}=ms(),[x,m]=r.useState([]),[h,p]=r.useState([]),[C,P]=r.useState(null),[R,c]=r.useState(null),[w,f]=r.useState(""),[N,q]=r.useState(""),[E,ne]=r.useState(""),[Ns,Ss]=r.useState("Senior"),[ks,Cs]=r.useState(""),[Ps,_s]=r.useState(""),[re,oe]=r.useState(""),[_,le]=r.useState(""),[O,ie]=r.useState([]),[ce,de]=r.useState(""),[me,pe]=r.useState(""),[ue,xe]=r.useState(""),[he,ge]=r.useState(""),[As,Ds]=r.useState(""),[Rs,Es]=r.useState(""),[Ls,Ts]=r.useState(""),[Ms,Is]=r.useState("In Progress"),[Os,Fs]=r.useState(""),[Bs,$s]=r.useState(""),[j,W]=r.useState([]),[be,qe]=r.useState(""),[Q,We]=r.useState(""),[fe,Qe]=r.useState(20),[L,je]=r.useState([]),[k,Xe]=r.useState("subsystem"),[X,He]=r.useState("asc"),[ye,F]=r.useState(!1),[ve,T]=r.useState(!1),[g,we]=r.useState("people"),[Je,B]=r.useState(!1),[H,Ne]=r.useState(""),[Se,Ke]=r.useState(!1),[ke,Ce]=r.useState(!1),[Pe,$]=r.useState([]),[_e,Ae]=r.useState(()=>new Date().toISOString().slice(0,10)),[J,De]=r.useState({}),[K,Re]=r.useState({}),[Ze,U]=r.useState(!1),[es,z]=r.useState(!1),[Z,Ee]=r.useState(""),[S,ee]=r.useState(null),[ss,Le]=r.useState(!1),[Te,A]=r.useState("");r.useEffect(()=>{(async()=>{const[s,n,a,t,o]=await Promise.all([V(),Y(),ze(),ps(),se(50)]);m(s),p(n),P(a),c(t),$(o),f(a?.rulebook_url||""),q(a?.sharepoint_url||""),De({...t?.promotion_pct||{}}),Re({...t?.demotion_pct||{}}),U(!1)})()},[]),r.useEffect(()=>{f(C?.rulebook_url||""),q(C?.sharepoint_url||"")},[C]);const Me=s=>ie(n=>n.includes(s)?n.filter(a=>a!==s):[...n,s]),[Ie,Oe]=r.useState("");function i(s){Oe(s),setTimeout(()=>Oe(""),3e3)}async function ts(){try{await js({rulebook_url:w.trim()||void 0,sharepoint_url:N.trim()||void 0}),P(await ze()),i("Settings saved")}catch(s){console.error(s),i("Save failed")}}async function as(){try{const[s,n]=await Promise.all([V(),Y()]);m(s),p(n)}catch(s){console.error("Reload failed",s)}}async function ns(){try{await ys(),m([]),p([]),i("System reset complete")}catch(s){console.error(s),i("Reset failed")}}async function rs(){try{const s=await Ve({name:E.trim(),discord:re.trim()||void 0});m(await V()),ne(""),oe(""),i("Person saved")}catch(s){console.error(s),i("Save failed")}}async function os(){if(!_.trim())return alert("Give the project a name");try{const s=await Ye({name:_.trim(),owner_ids:O,design_link:ce.trim()||void 0,description:me.trim()||void 0,due_date:ue||void 0,subsystem:he||void 0});p(await Y()),le(""),ie([]),de(""),pe(""),xe(""),ge(""),i("Project saved")}catch(s){console.error(s),i("Save failed")}}const Fe=r.useMemo(()=>{const s=new Set;for(const n of h)n.subsystem&&s.add(n.subsystem);return Array.from(s).sort()},[h]),ls=r.useMemo(()=>{const s=new Map;for(const n of h)n.subsystem&&s.set(n.subsystem,(s.get(n.subsystem)||0)+1);return s},[h]),Be=L.length?h.filter(s=>s.subsystem&&L.includes(s.subsystem)):h,is=r.useMemo(()=>{const s=Q.toLowerCase();return[...Be.filter(t=>s?t.name.toLowerCase().includes(s)||(t.description||"").toLowerCase().includes(s):!0)].sort((t,o)=>{let l=0;return k==="name"?l=t.name.localeCompare(o.name):k==="due"?l=(t.due_date||"").localeCompare(o.due_date||""):l=(t.subsystem||"").localeCompare(o.subsystem||"")||t.name.localeCompare(o.name),X==="asc"?l:-l})},[Be,Q,k,X]),$e=s=>s==="name"?"Name":s==="due"?"Due date":"Subsystem",Ue=X==="asc"?"↑":"↓";return r.useEffect(()=>{const s=n=>{n.key==="Escape"&&(F(!1),T(!1))};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[]),r.useEffect(()=>{M(b,g)||we("people")},[b,g]),I?e.jsxs("div",{className:"max-w-6xl mx-auto px-3 sm:px-4 overflow-x-hidden admin-typography",children:[e.jsx("h1",{className:"text-2xl font-semibold mb-1",children:"Admin"}),Ie&&e.jsx("div",{className:"fixed bottom-4 left-4 z-50 px-4 py-2 rounded shadow-lg animate-fade-in bg-accent/90 border border-accent-weak/60 font-medium text-[13px] leading-snug text-bg",children:Ie}),e.jsx("div",{className:"sticky top-0 z-30 px-3 sm:px-4 pt-1 bg-bg/70 backdrop-blur border-b border-border/60 overflow-x-auto h-scroll-tabs no-fade",children:e.jsx("nav",{className:"flex gap-2 sm:gap-3 h-11 items-end min-w-max whitespace-nowrap",role:"tablist",children:["people","projects","settings","ranked"].filter(s=>M(b,s)).map(s=>{const n=s==="people"?"People":s==="projects"?"Projects & Tasks":s==="settings"?"Global Settings":"Ranked Settings";return e.jsx("button",{role:"tab","aria-selected":g===s,onClick:()=>we(s),className:`px-3 pb-2 pt-2 border-b-2 ${g===s?"border-accent text-white":"border-transparent text-muted hover:text-white"}`,children:n},s)})})}),!M(b,g)&&e.jsxs("div",{className:"mt-4 text-xs text-red-300",children:["You no longer have access to the ",g," tab. Showing People tab."]}),g==="people"&&e.jsx("div",{role:"tabpanel",className:"mt-4",children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("section",{className:"space-y-2",children:[e.jsxs("div",{className:"form-section p-4 space-y-3",children:[e.jsx("div",{className:"text-sm font-semibold text-white",children:"Create profile"}),e.jsx("input",{className:"px-3 py-2 rounded w-full",placeholder:"Name",value:E,onChange:s=>ne(s.target.value)}),e.jsx("input",{className:"px-3 py-2 rounded w-full",placeholder:"Discord (e.g., username)",value:re,onChange:s=>oe(s.target.value)}),e.jsx("button",{onClick:async()=>{if(!E.trim()){i("Enter a name");return}await rs()},disabled:!E.trim(),className:`px-3 py-2 rounded w-full border border-border text-sm text-center ${E.trim()?"bg-overlay-6":"bg-overlay-6 opacity-50 cursor-not-allowed"}`,children:"Create profile"})]}),e.jsxs("div",{className:"form-section p-4 space-y-3",children:[e.jsx("div",{className:"text-sm font-semibold text-white",children:"Quick attendance"}),e.jsx("input",{type:"date",className:"px-2.5 py-1.5 rounded text-sm bg-white/5 border border-white/10 w-full",value:_e,onChange:s=>Ae(s.target.value)}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 items-stretch",children:[e.jsx("div",{children:e.jsx(Ge,{people:x,mode:"multi",selectedIds:j,onAdd:s=>W(n=>n.includes(s)?n:[...n,s]),onRemove:s=>W(n=>n.filter(a=>a!==s)),triggerLabel:j.length?`${j.length} selected`:"Select person…",buttonClassName:"w-full px-2.5 py-1.5 rounded dark-select text-sm",maxItems:50,allowScroll:!0})}),e.jsx("div",{children:e.jsx("button",{className:`w-full px-2.5 py-1.5 rounded border border-border text-sm text-center ${j.length?"bg-overlay-6":"bg-overlay-6 opacity-50 cursor-not-allowed"}`,disabled:j.length===0,onClick:async()=>{if(!j||j.length===0){i("Select at least one person");return}const s=_e||new Date().toISOString().slice(0,10);try{const n=await Promise.allSettled(j.map(l=>us({person_id:l,date:s,points:10}))),a=[],t=[],o=[];n.forEach((l,u)=>{const y=j[u],v=x.find(D=>D.id===y)?.name||y;if(l.status==="fulfilled")a.push(v);else{const D=l.reason;D?.code==="DUPLICATE_ATTENDANCE"||D?.message==="DUPLICATE_ATTENDANCE"?t.push(v):o.push(v)}}),a.length>0&&i(`${a.length} marked present (+10 pts)`),t.length>0&&i(`${t.join(", ")} already marked for ${s}`),o.length>0&&i(`Failed for: ${o.join(", ")}`),setTimeout(()=>{W([]),Ae(new Date().toISOString().slice(0,10))},0)}catch(n){console.error(n),i("Attendance failed")}},children:"Give 10 pts"})})]})]})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h2",{className:"font-semibold truncate",children:"Edit profiles"}),e.jsx("div",{className:"ml-4",children:e.jsx("input",{className:"px-3 py-2 rounded text-sm w-44 sm:w-56",placeholder:"Search people…",value:be,onChange:s=>qe(s.target.value)})})]}),e.jsx("div",{className:"space-y-4",children:x.filter(s=>{const n=be.toLowerCase();return n?s.name.toLowerCase().includes(n)||(s.skills||[]).some(a=>a.toLowerCase().includes(n))||(s.role||"").toLowerCase().includes(n):!0}).sort((s,n)=>s.name.localeCompare(n.name)).map(s=>e.jsxs("details",{className:"rounded-xl bg-white/5 border border-white/10",children:[e.jsxs("summary",{className:"cursor-pointer font-medium px-3 py-2 flex items-center justify-between gap-2",children:[e.jsx("span",{className:"truncate",children:s.name}),e.jsx("span",{className:"text-xs text-muted ml-2 max-w-[8rem] md:max-w-[10rem] min-w-0 truncate uppercase tracking-caps",children:s.role||s.year||""})]}),e.jsxs("div",{className:"px-3 pb-3 mt-1 grid sm:grid-cols-2 gap-4",children:[e.jsx("input",{className:"px-3 py-2 rounded",value:s.name,onChange:n=>m(a=>a.map(t=>t.id===s.id?{...t,name:n.target.value}:t))}),e.jsxs("select",{className:"px-3 py-2 rounded dark-select",value:s.year||"Senior",onChange:n=>m(a=>a.map(t=>t.id===s.id?{...t,year:n.target.value}:t)),children:[e.jsx("option",{children:"Freshman"}),e.jsx("option",{children:"Sophomore"}),e.jsx("option",{children:"Junior"}),e.jsx("option",{children:"Senior"}),e.jsx("option",{children:"Graduate"})]}),e.jsx("input",{className:"px-3 py-2 rounded",placeholder:"Role",value:s.role||"",onChange:n=>m(a=>a.map(t=>t.id===s.id?{...t,role:n.target.value}:t))}),e.jsx("input",{className:"px-3 py-2 rounded",placeholder:"Discord",value:s.discord||"",onChange:n=>m(a=>a.map(t=>t.id===s.id?{...t,discord:n.target.value}:t))}),e.jsx("input",{className:"px-3 py-2 rounded sm:col-span-2",placeholder:"Skills (comma-separated)",value:(s.skills||[]).join(", "),onChange:n=>m(a=>a.map(t=>t.id===s.id?{...t,skills:n.target.value.split(",").map(o=>o.trim()).filter(Boolean)}:t))}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 sm:col-span-2 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-muted uppercase tracking-caps",children:"Rank"}),e.jsxs("select",{className:"mt-1 px-3 py-2 rounded w-full dark-select",value:s.rank||"Bronze",onChange:n=>m(a=>a.map(t=>t.id===s.id?{...t,rank:n.target.value}:t)),children:[e.jsx("option",{children:"Bronze"}),e.jsx("option",{children:"Silver"}),e.jsx("option",{children:"Gold"}),e.jsx("option",{children:"Platinum"}),e.jsx("option",{children:"Diamond"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-muted uppercase tracking-caps",children:"Ranked pool"}),e.jsxs("label",{className:"mt-1 flex items-center gap-3 select-none",children:[e.jsx("input",{type:"checkbox",className:"peer sr-only",checked:!!s.ranked_opt_in,onChange:n=>m(a=>a.map(t=>t.id===s.id?{...t,ranked_opt_in:n.target.checked}:t))}),e.jsx("span",{className:`relative inline-block h-6 w-11 rounded-full bg-white/15 transition-colors peer-checked:bg-accent/70 
                                after:content-[''] after:absolute after:left-0.5 after:top-0.5 after:h-5 after:w-5 after:rounded-full after:bg-white after:shadow after:transition-transform after:duration-200 peer-checked:after:translate-x-5`}),e.jsx("span",{className:"text-xs text-white/90",children:"Opted in"})]})]})]}),e.jsx("button",{className:"px-3 py-2 rounded bg-accent text-black border border-accent hover:bg-accent/90 sm:col-span-2",onClick:async()=>{await xs(s.id,s),i("Person updated")},children:"Save Changes"})]})]},s.id))})]})]})}),g==="projects"&&e.jsxs("div",{role:"tabpanel",className:"mt-4 space-y-6",children:[e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsxs("section",{className:"space-y-2",children:[e.jsx("h2",{className:"font-semibold",children:"Create Project & Assign Owners"}),e.jsxs("div",{className:"form-section p-4 space-y-3",children:[e.jsx("input",{className:"px-3 py-2 rounded w-full",placeholder:"Project name",value:_,onChange:s=>le(s.target.value)}),e.jsx("input",{className:"px-3 py-2 rounded w-full",placeholder:"Design link (optional)",value:ce,onChange:s=>de(s.target.value)}),e.jsx("textarea",{className:"px-3 py-2 rounded w-full",placeholder:"Project description (optional)",value:me,onChange:s=>pe(s.target.value)}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("select",{className:"px-3 py-2 rounded w-full dark-select",value:he,onChange:s=>ge(s.target.value),children:[e.jsx("option",{value:"",children:"Select subsystem…"}),e.jsx("option",{children:"Aero"}),e.jsx("option",{children:"Business"}),e.jsx("option",{children:"Composites"}),e.jsx("option",{children:"Controls"}),e.jsx("option",{children:"Data Acquisition"}),e.jsx("option",{children:"Electrical IC"}),e.jsx("option",{children:"Electrical EV"}),e.jsx("option",{children:"Finance"}),e.jsx("option",{children:"Frame"}),e.jsx("option",{children:"Manufacturing"}),e.jsx("option",{children:"Powertrain EV"}),e.jsx("option",{children:"Powertrain IC"}),e.jsx("option",{children:"Suspension"})]}),e.jsx("input",{type:"date",className:"px-3 py-2 rounded w-full",value:ue,onChange:s=>xe(s.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-sm text-muted uppercase tracking-caps",children:"Owners"}),e.jsx(Ge,{mode:"multi",people:x,selectedIds:O,onAdd:s=>Me(s),onRemove:s=>Me(s),triggerLabel:O.length?`${O.length} selected`:"Add/Remove",buttonClassName:"ml-auto text-[11px] px-2 py-1 rounded bg-white/10 border border-white/20",maxItems:5})]}),e.jsx("button",{onClick:async()=>{if(!_.trim()){i("Give the project a name");return}await os()},disabled:!_.trim(),className:`w-full px-3 py-2 rounded border border-border text-sm text-center ${_.trim()?"bg-overlay-6":"bg-overlay-6 opacity-50 cursor-not-allowed"}`,children:"Save Project"})]})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsx("h2",{className:"font-semibold",children:"Create Task"}),e.jsx(vs,{people:x,projects:h,onCreated:as})]})]}),e.jsxs("section",{className:"mt-2",children:[e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold",children:"Projects"}),e.jsx("input",{className:"toolbar-input px-3 py-1.5 rounded-md text-xs font-medium border border-overlay-10 bg-overlay-6 w-28 sm:w-44 placeholder:text-muted focus:outline-none focus-visible:outline-none",placeholder:"Search projects…",value:Q,onChange:s=>We(s.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-2",children:[e.jsx("div",{className:"",children:e.jsxs("div",{className:"relative w-full",children:[e.jsxs("button",{onClick:()=>{F(s=>!s),T(!1)},className:"toolbar-btn px-3 py-1.5 rounded-md text-xs font-medium border border-white/10 bg-white/5 hover:bg-white/10 w-full text-left",children:["Subsystems: ",e.jsx("span",{className:"font-semibold",children:L.length?`${L.length} selected`:"All"})]}),e.jsxs("div",{className:`absolute left-0 z-20 mt-1 w-64 rounded-md border border-overlay-10 bg-bg/95 shadow-xl overflow-hidden transition transform origin-top ${ye?"opacity-100 scale-100":"opacity-0 scale-95 pointer-events-none"}`,children:[e.jsx("div",{className:"px-3 py-2 border-b border-white/10",children:e.jsx("button",{className:"w-full px-3 py-2 rounded-md text-xs sm:text-sm font-semibold bg-red-500/15 hover:bg-red-500/25 text-red-200 focus:outline-none focus-visible:outline-none",onClick:()=>je([]),children:"Clear selection"})}),e.jsxs("div",{className:"max-h-60 overflow-auto p-1",children:[Fe.length===0&&e.jsx("div",{className:"px-3 py-2 text-xs text-muted uppercase tracking-caps",children:"No subsystems"}),Fe.map(s=>{const n=L.includes(s),a=ls.get(s)??0;return e.jsxs("label",{className:"flex items-center gap-2 px-2 py-1.5 text-xs rounded hover:bg-white/10 cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"accent-accent",checked:n,onChange:()=>je(t=>n?t.filter(o=>o!==s):[...t,s])}),e.jsx("span",{className:"truncate",children:s}),e.jsx("span",{className:"ml-auto inline-flex items-center justify-center rounded-full bg-white/10 px-2 py-0.5 text-[10px]",children:a})]},s)})]})]})]})}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsxs("div",{className:"relative w-full",children:[e.jsxs("button",{onClick:()=>{T(s=>!s),F(!1)},className:"toolbar-btn px-3 py-1.5 rounded-md text-xs font-medium border border-white/10 bg-white/5 hover:bg-white/10 w-full text-left",children:["Sort: ",e.jsxs("span",{className:"font-semibold",children:[$e(k)," ",Ue]})]}),e.jsx("div",{className:`absolute right-0 z-20 mt-1 w-48 rounded-md border border-overlay-10 bg-bg/95 shadow-xl overflow-hidden transition transform origin-top ${ve?"opacity-100 scale-100":"opacity-0 scale-95 pointer-events-none"}`,children:["subsystem","name","due"].map(s=>e.jsxs("button",{className:`w-full text-left px-3 py-2 text-xs hover:bg-white/10 ${k===s?"bg-white/10":""}`,onClick:()=>{k===s?He(n=>n==="asc"?"desc":"asc"):Xe(s),T(!1)},children:[$e(s)," ",k===s?Ue:""]},s))})]})})]}),(ye||ve)&&e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>{F(!1),T(!1)}})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-2",children:is.map(s=>e.jsxs("details",{className:"form-section p-3",children:[e.jsx("summary",{className:"cursor-pointer font-medium",children:s.name}),e.jsxs("div",{className:"mt-2 space-y-3",children:[e.jsx("input",{className:"px-3 py-2 rounded w-full",value:s.name,onChange:n=>p(a=>a.map(t=>t.id===s.id?{...t,name:n.target.value}:t))}),e.jsx("input",{className:"px-3 py-2 rounded w-full",placeholder:"Design link",value:s.design_link||"",onChange:n=>p(a=>a.map(t=>t.id===s.id?{...t,design_link:n.target.value}:t))}),e.jsx("textarea",{className:"px-3 py-2 rounded w-full",placeholder:"Description",value:s.description||"",onChange:n=>p(a=>a.map(t=>t.id===s.id?{...t,description:n.target.value}:t))}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("select",{className:"px-3 py-2 rounded w-full dark-select",value:s.subsystem||"",onChange:n=>p(a=>a.map(t=>t.id===s.id?{...t,subsystem:n.target.value||void 0}:t)),children:[e.jsx("option",{value:"",children:"Subsystem…"}),e.jsx("option",{children:"Aero"}),e.jsx("option",{children:"Business"}),e.jsx("option",{children:"Composites"}),e.jsx("option",{children:"Controls"}),e.jsx("option",{children:"Data Acquisition"}),e.jsx("option",{children:"Electrical IC"}),e.jsx("option",{children:"Electrical EV"}),e.jsx("option",{children:"Finance"}),e.jsx("option",{children:"Frame"}),e.jsx("option",{children:"Manufacturing"}),e.jsx("option",{children:"Powertrain EV"}),e.jsx("option",{children:"Powertrain IC"}),e.jsx("option",{children:"Suspension"})]}),e.jsx("input",{type:"date",className:"px-3 py-2 rounded w-full",value:s.due_date||"",onChange:n=>p(a=>a.map(t=>t.id===s.id?{...t,due_date:n.target.value}:t))})]}),e.jsx("button",{className:"px-3 py-2 rounded bg-accent text-black border border-accent hover:bg-accent/90 w-full",onClick:async()=>{await hs(s.id,s),i("Project updated")},children:"Save Changes"})]})]},s.id))})]})]}),g==="settings"&&M(b,"settings")&&e.jsxs("div",{role:"tabpanel",className:"mt-4",children:[e.jsxs("section",{className:"space-y-2",children:[e.jsx("h2",{className:"font-semibold",children:"Global Settings"}),e.jsxs("div",{className:"form-section wide p-4 space-y-2",children:[e.jsx("label",{className:"text-sm block",children:"Rulebook PDF URL"}),e.jsx("input",{className:"px-3 py-2 rounded w-full",placeholder:"https://…/rulebook.pdf",value:w,onChange:s=>f(s.target.value)}),e.jsx("label",{className:"text-sm block",children:"Team SharePoint URL"}),e.jsx("input",{className:"px-3 py-2 rounded w-full",placeholder:"https://…sharepoint.com/sites/FSAE/…",value:N,onChange:s=>q(s.target.value)}),e.jsx("button",{onClick:ts,className:"mt-2 px-3 py-2 rounded bg-accent text-black border border-accent hover:bg-accent/90",children:"Save Settings"})]}),e.jsx(ws,{}),e.jsxs("div",{className:"form-section wide p-4 mt-4 border border-red-500/30 bg-red-500/10 rounded-xl",children:[e.jsx("h3",{className:"font-semibold text-red-200",children:"Danger zone"}),e.jsx("p",{className:"text-sm text-red-200/80",children:"This will permanently delete ALL people, projects, and tasks. This action cannot be undone."}),e.jsxs("button",{onClick:()=>{Ne(""),B(!0)},className:"mt-3 inline-flex items-center gap-2 px-3 py-2 rounded border border-red-500/50 bg-red-600/20 hover:bg-red-600/30 text-red-100",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]}),"Full system reset"]})]})]}),e.jsxs("section",{className:"space-y-2 mt-6",children:[e.jsx("h2",{className:"font-semibold",children:"Seed data (Excel)"}),e.jsxs("div",{className:"form-section wide p-4 space-y-3",children:[e.jsxs("p",{className:"text-sm text-muted",children:['Provide an Excel file with sheets named "People", "Projects", and "Tasks". Columns:',e.jsx("br",{}),"People: Name, Year, Role, Skills, Discord",e.jsx("br",{}),"Projects: Name, Subsystem, Due Date (YYYY-MM-DD), Description, Design Link, Owners (comma-separated names)",e.jsx("br",{}),"Tasks: Project, Description, Status (Todo|In Progress|Complete), Assignee (name)"]}),e.jsx("input",{type:"file",accept:".xlsx,.xls,.csv",onChange:async s=>{const n=s.target.files?.[0];if(n){ee(null),A("");try{const a=await n.arrayBuffer(),t=await G(()=>import("./xlsx-DGuHH-KN.js"),[]),o=t.read(a,{type:"array"}),l=o.Sheets.People,u=o.Sheets.Projects,y=o.Sheets.Tasks,v=l?t.utils.sheet_to_json(l):[],D=u?t.utils.sheet_to_json(u):[],cs=y?t.utils.sheet_to_json(y):[];ee({people:v.map(d=>({name:d.Name?.toString()||"",year:d.Year?.toString(),role:d.Role?.toString(),skills:d.Skills?.toString(),discord:d.Discord?.toString()})),projects:D.map(d=>({name:d.Name?.toString()||"",subsystem:d.Subsystem?.toString(),due_date:d["Due Date"]?.toString(),description:d.Description?.toString(),design_link:d["Design Link"]?.toString(),owners:d.Owners?.toString()})),tasks:cs.map(d=>({project:d.Project?.toString()||"",description:d.Description?.toString()||"",status:d.Status?.toString()||"Todo",assignee:d.Assignee?.toString()}))})}catch(a){console.error(a),A("Failed to read file")}}}}),S&&e.jsxs("div",{className:"text-sm",children:["Preview: ",S.people.length," people, ",S.projects.length," projects, ",S.tasks.length," tasks",e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx("button",{disabled:ss,className:"px-3 py-2 rounded border border-border bg-overlay-6 disabled:opacity-50",onClick:async()=>{if(S){Le(!0),A("Importing…");try{const s=new Map;for(const a of x)s.set(a.name.trim(),a.id);for(const a of S.people){const t=a.name?.trim();if(t&&!s.has(t)){const o=await Ve({name:t,year:a.year||void 0,role:a.role||void 0,skills:(a.skills||"").split(",").map(l=>l.trim()).filter(Boolean),discord:a.discord||void 0});s.set(t,o)}}const n=new Map;for(const a of S.projects){const t=a.name?.trim();if(t&&!n.has(t)){const o=(a.owners||"").split(",").map(u=>u.trim()).filter(Boolean).map(u=>s.get(u)).filter(Boolean),l=await Ye({name:t,subsystem:a.subsystem||void 0,due_date:a.due_date||void 0,description:a.description||void 0,design_link:a.design_link||void 0,owner_ids:o});n.set(t,l)}}for(const a of S.tasks){const t=n.get((a.project||"").trim());if(!t)continue;const o=a.assignee?s.get(a.assignee.trim()):void 0,l=a.status==="Todo"||a.status==="In Progress"||a.status==="Complete"?a.status:"Todo";await gs({project_id:t,description:a.description||"",status:l,assignee_id:o})}m(await V()),p(await Y()),A("Import complete")}catch(s){console.error(s),A("Import failed")}finally{Le(!1)}}},children:"Import"}),e.jsx("button",{className:"px-3 py-2 rounded border border-border bg-overlay-6",onClick:()=>{ee(null),A("")},children:"Clear"})]}),Te&&e.jsx("div",{className:"mt-2 text-xs text-muted uppercase tracking-caps",children:Te})]})]})]}),Je&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/70",onClick:()=>B(!1)}),e.jsxs("div",{className:"relative w-[95vw] max-w-md rounded-xl border border-overlay-10 bg-bg/95 shadow-2xl p-5",children:[e.jsx("h4",{className:"text-lg font-semibold mb-2",children:"Confirm full system reset"}),e.jsx("p",{className:"text-sm text-muted",children:"Enter the reset password to proceed. Contact the team lead if you don’t know it."}),e.jsxs("div",{className:"mt-3 relative",children:[e.jsx("input",{autoFocus:!0,type:Se?"text":"password",className:"w-full px-3 py-2 pr-10 rounded border border-white/10 bg-black/20",placeholder:"Reset password",value:H,onChange:s=>Ne(s.target.value)}),e.jsx("button",{"aria-label":"Toggle password visibility",onClick:()=>Ke(s=>!s),className:"absolute right-1 top-1.5 h-7 w-7 inline-flex items-center justify-center rounded hover:bg-white/10",children:Se?e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"#E5E7EB",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M17.94 17.94A10.94 10.94 0 0 1 12 20C7 20 2.73 16.11 1 12c.6-1.36 1.5-2.59 2.57-3.61M10.58 5.06A10.94 10.94 0 0 1 12 4c5 0 9.27 3.89 11 8-."})}):e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"#E5E7EB",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),e.jsx("circle",{cx:"12",cy:"12",r:"3"})]})})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>B(!1),className:"px-3 py-2 rounded border border-border bg-overlay-6",children:"Cancel"}),e.jsx("button",{onClick:async()=>{await ns(),B(!1)},disabled:H!=="UCONN FORMULA SAE",className:`px-3 py-2 rounded border ${H==="UCONN FORMULA SAE"?"border-danger bg-danger/30 hover:bg-danger/40 text-danger/90":"border-overlay-10 bg-overlay-6 text-muted cursor-not-allowed"}`,children:"Permanently delete everything"})]})]})]})]}),g==="ranked"&&M(b,"ranked")&&e.jsx("div",{role:"tabpanel",className:"mt-4",children:e.jsxs("section",{className:"space-y-2",children:[e.jsx("h2",{className:"font-semibold mb-2",children:"Ranked Settings"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid sm:grid-cols-2 gap-3",children:e.jsxs("div",{className:"form-section p-3 bg-surface/80 border border-border/40 rounded mb-2 flex flex-col gap-2",children:[e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",className:"accent-accent",checked:!!R?.enabled,onChange:async s=>{const n=s.target.checked;c(a=>a?{...a,enabled:n}:{enabled:n}),await te({enabled:n})}}),"Enable ranked mode"]}),e.jsx("p",{className:"text-xs text-muted uppercase tracking-caps mt-1",children:"When on, the app reveals the Ranked page and point indicators. Turning it off hides ranked UI and points, but nothing is deleted."}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm mt-2",children:[e.jsx("input",{type:"checkbox",className:"accent-accent",checked:!!R?.autoApply,onChange:async s=>{const n=s.target.checked;c(a=>a?{...a,autoApply:n}:{autoApply:n}),await te({autoApply:n})}}),"Auto apply weekly"]}),e.jsx("p",{className:"text-xs text-muted uppercase tracking-caps mt-1",children:"When on, promotions/relegations are automatically applied each week for all users. Disable to require manual action only."})]})}),e.jsx("div",{className:"grid sm:grid-cols-2 gap-3 -mt-2"}),e.jsx("div",{className:"mt-2",children:e.jsx("div",{className:"form-section wide p-4 overflow-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-white/5",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-2 py-2 font-medium text-sm",children:"Rank"}),e.jsx("th",{className:"text-left px-2 py-2 font-medium text-sm",children:"Promote %"}),e.jsx("th",{className:"text-left px-2 py-2 font-medium text-sm",children:"Relegate %"})]})}),e.jsx("tbody",{children:["Bronze","Silver","Gold","Platinum","Diamond"].map(s=>{const n=s.toLowerCase(),a=J[n]??0,t=K[n]??0,o=s==="Diamond",l=s==="Bronze";return e.jsxs("tr",{className:"border-t border-white/10",children:[e.jsx("td",{className:"px-2 py-2 text-sm",children:s}),e.jsx("td",{className:"px-2 py-2",children:o?e.jsx("span",{className:"text-sm text-muted uppercase tracking-caps",children:"N/A"}):e.jsx("input",{type:"number",min:0,max:100,value:a,onChange:async u=>{const y=Math.max(0,Math.min(100,Number(u.target.value)));De(v=>({...v||{},[n]:y})),U(!0)},className:"px-2 py-1 rounded w-16 max-w-[64px] text-center bg-white/5 border border-white/10 text-base font-semibold"})}),e.jsx("td",{className:"px-2 py-2",children:l?e.jsx("span",{className:"text-sm text-muted uppercase tracking-caps",children:"N/A"}):e.jsx("input",{type:"number",min:0,max:100,value:t,onChange:async u=>{const y=Math.max(0,Math.min(100,Number(u.target.value)));Re(v=>({...v||{},[n]:y})),U(!0)},className:"px-2 py-1 rounded w-16 max-w-[64px] text-center bg-white/5 border border-white/10 text-base font-semibold"})})]},s)})})]})})}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx("button",{disabled:!Ze,onClick:async()=>{try{await te({promotion_pct:J,demotion_pct:K}),c(s=>({...s||{},promotion_pct:{...J},demotion_pct:{...K}})),U(!1),i("Ranked settings saved")}catch(s){console.error(s),i("Save failed")}},className:"mt-2 px-3 py-2 rounded bg-overlay-6 border border-border text-sm disabled:opacity-50",children:"Save changes"})}),e.jsx("div",{className:"pt-4 mt-2 border-t border-white/10",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3 justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:"Manual override"}),e.jsx("p",{className:"text-xs text-muted uppercase tracking-caps",children:"Apply promotions and relegations immediately using the current week’s points."})]}),e.jsx("button",{disabled:ke,onClick:()=>{Ee(""),z(!0)},className:"px-3 py-2 rounded bg-accent/40 hover:bg-accent/60 border border-border text-sm font-medium disabled:opacity-50",children:"Apply now"})]})})]}),e.jsxs("div",{className:"form-section wide p-5 mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Recent ranked activity"}),e.jsx("button",{className:"text-xs px-2 py-1 rounded border border-border bg-overlay-6 uppercase tracking-caps",onClick:async()=>{$(await se(20))},children:"Refresh"})]}),e.jsxs("ul",{className:"text-sm divide-y divide-white/10 rounded border border-white/10",children:[Pe.length===0&&e.jsx("li",{className:"px-3 py-2 text-muted uppercase tracking-caps",children:"No activity yet"}),Pe.slice(0,fe).map((s,n)=>e.jsxs("li",{className:"px-3 py-2 flex flex-col sm:flex-row sm:items-start gap-1 sm:gap-3 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted leading-snug uppercase tracking-caps",children:[e.jsx("span",{className:"shrink-0 sm:w-40 sm:inline block",children:new Date(s.ts||0).toLocaleString()}),e.jsx("span",{className:"font-mono text-[10px] sm:text-xs uppercase tracking-wide px-1.5 py-0.5 rounded bg-white/10 border border-white/10",children:s.type})]}),e.jsxs("span",{className:"text-sm break-words whitespace-pre-wrap leading-snug",children:[s.type==="attendance"&&e.jsxs(e.Fragment,{children:["Attendance · ",s.points," pts ",s.person_id?`→ ${x.find(a=>a.id===s.person_id)?.name||s.person_id}`:""]}),s.type==="rank_change"&&e.jsxs(e.Fragment,{children:["Rank · ",x.find(a=>a.id===s.person_id)?.name||s.person_id," ",s.from_rank," → ",s.to_rank]}),s.type==="task_points"&&(()=>{let a=s.note;if(a){if(a.length%2===0){const t=a.length/2,o=a.slice(0,t),l=a.slice(t);o===l&&(a=o)}if((a.match(/Task complete:/g)||[]).length>1){const t=a.split("Task complete:").filter(Boolean).map(o=>o.trim());t.length>=2&&t.every(o=>o===t[0]),a="Task complete: "+t[0]}}return e.jsxs(e.Fragment,{children:["Task · ",s.points," pts ",s.person_id?`→ ${x.find(t=>t.id===s.person_id)?.name||s.person_id}`:"",a?` · ${a}`:""]})})(),s.type!=="attendance"&&s.type!=="rank_change"&&(s.note||"")]})]},s.id||n))]}),e.jsx("div",{className:"flex items-center justify-center mt-2",children:e.jsx("button",{className:"text-xs px-3 py-1 rounded border border-border bg-overlay-6 uppercase tracking-caps",onClick:async()=>{const s=fe+20;$(await se(s)),Qe(s)},children:"Load More"})})]})]})}),es&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/70",onClick:()=>z(!1)}),e.jsxs("div",{className:"relative w-[95vw] max-w-md rounded-xl border border-overlay-10 bg-bg/95 shadow-2xl p-5",children:[e.jsx("h4",{className:"text-lg font-semibold mb-2",children:"Confirm ranked apply"}),e.jsx("p",{className:"text-sm text-muted",children:"Enter the confirmation phrase to proceed."}),e.jsx("input",{autoFocus:!0,className:"mt-3 w-full px-3 py-2 rounded border border-white/10 bg-black/20",placeholder:"Enter confirmation phrase",value:Z,onChange:s=>Ee(s.target.value)}),e.jsxs("div",{className:"mt-4 flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>z(!1),className:"px-3 py-2 rounded border border-border bg-overlay-6",children:"Cancel"}),e.jsx("button",{disabled:Z!=="UCONN FORMULA SAE"||ke,className:`px-3 py-2 rounded border ${Z==="UCONN FORMULA SAE"?"border-accent bg-accent/30 hover:bg-accent/40 text-black":"border-overlay-10 bg-overlay-6 text-muted cursor-not-allowed"}`,onClick:async()=>{try{Ce(!0);const a=(await bs(fs,"applyRankedChanges")())?.data?.applied??0;i(`${a} updates applied`);const{fetchRecentLogs:t}=await G(async()=>{const{fetchRecentLogs:o}=await import("./index-CDBOaIZ2.js").then(l=>l.P);return{fetchRecentLogs:o}},__vite__mapDeps([0,1]));$(await t(50)),z(!1)}catch(s){console.error(s),i("Apply failed")}finally{Ce(!1)}},children:"Apply"})]})]})]})]}):e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold uppercase tracking-caps",children:"Admin"}),e.jsx("p",{className:"text-sm text-muted mt-2",children:"You must be signed in as an admin or lead to access this page."})]})}function ws(){const[ae,b]=r.useState([]),[I,x]=r.useState(""),[m,h]=r.useState(!1),[p,C]=r.useState(null);r.useEffect(()=>{(async()=>{try{h(!0);const{fetchProjects:c}=await G(async()=>{const{fetchProjects:w}=await import("./index-CDBOaIZ2.js").then(f=>f.P);return{fetchProjects:w}},__vite__mapDeps([0,1]));b(await c())}finally{h(!1)}})()},[]);const P=ae.filter(c=>c.archived),R=P.filter(c=>c.name.toLowerCase().includes(I.toLowerCase()));return e.jsxs("div",{className:"form-section wide p-4 mt-6 space-y-3",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Retrieve archived project"}),e.jsx("p",{className:"text-xs text-muted uppercase tracking-caps",children:"Restore a previously archived project (brings it back into lists)."}),P.length===0?e.jsx("p",{className:"text-xs text-muted italic uppercase tracking-caps",children:"No archived projects yet."}):e.jsx("input",{className:"px-3 py-2 rounded w-full",placeholder:"Search archived projects…",value:I,onChange:c=>x(c.target.value)}),m&&e.jsx("div",{className:"text-xs text-muted uppercase tracking-caps",children:"Loading…"}),P.length>0&&e.jsxs("ul",{className:"space-y-2 max-h-64 overflow-auto pr-1",children:[R.slice(0,25).map(c=>e.jsxs("li",{className:"flex items-center gap-3 text-sm px-2 py-2 rounded bg-white/5 border border-white/10",children:[e.jsx("span",{className:"truncate flex-1",children:c.name}),e.jsx("button",{disabled:p===c.id,onClick:async()=>{try{C(c.id);const{updateProject:w}=await G(async()=>{const{updateProject:f}=await import("./index-CDBOaIZ2.js").then(N=>N.P);return{updateProject:f}},__vite__mapDeps([0,1]));await w(c.id,{archived:!1}),b(f=>f.map(N=>N.id===c.id?{...N,archived:!1}:N)),window.alert?.("Project restored")}catch(w){console.error(w),window.alert?.("Restore failed")}finally{C(null)}},className:"px-3 py-1.5 rounded text-xs font-medium border border-accent/50 bg-accent/20 hover:bg-accent/30 disabled:opacity-50",children:"Restore"})]},c.id)),R.length===0&&!m&&e.jsx("li",{className:"text-xs text-muted px-2 py-1 uppercase tracking-caps",children:"No archived projects match."})]})]})}export{Ys as default};
