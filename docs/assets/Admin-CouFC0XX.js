const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Dc-RWuvD.js","assets/index-C0lIRZzO.css"])))=>i.map(i=>d[i]);
import{e as pt,r as o,q as xt,f as Y,a as q,h as qe,s as ht,t as oe,v as G,j as e,R as bt,w as gt,x as ft,y as jt,z as yt,A as vt,_ as W,B as Ge,C as We,D as wt,E as ne,F as Nt,G as kt,H as St,I as Ct}from"./index-Dc-RWuvD.js";import{P as He}from"./PersonSelectPopover-QnI2PRvl.js";import{T as Pt}from"./TaskCreateCard-B82Yttbr.js";function Xt(){pt()?.uid;const[x,m]=o.useState([]),[j,p]=o.useState([]),[A,I]=o.useState(null),[L,N]=o.useState(null),[E,c]=o.useState(""),[k,y]=o.useState(""),[g,le]=o.useState(""),[At,Rt]=o.useState("Senior"),[Dt,Lt]=o.useState(""),[Et,Tt]=o.useState(""),[ce,ie]=o.useState(""),[R,me]=o.useState(""),[$,ue]=o.useState([]),[pe,xe]=o.useState(""),[he,be]=o.useState(""),[ge,fe]=o.useState(""),[je,ye]=o.useState(""),[Mt,It]=o.useState(""),[$t,Ot]=o.useState(""),[Ft,Bt]=o.useState(""),[Ut,zt]=o.useState("In Progress"),[Vt,Yt]=o.useState(""),[qt,Gt]=o.useState(""),[v,H]=o.useState([]),[ve,Qe]=o.useState(""),[Q,Xe]=o.useState(""),[we,Je]=o.useState(20),[T,Ne]=o.useState([]),[C,Ke]=o.useState("subsystem"),[X,Ze]=o.useState("asc"),[ke,O]=o.useState(!1),[Se,M]=o.useState(!1),[u,J]=o.useState("people"),{role:P,ready:h}=xt(),[K,Z]=o.useState(null),F=t=>{h&&(G({role:P??void 0},t)?(Z(null),J(t)):(Z(t),J("people")))},[et,B]=o.useState(!1),[ee,Ce]=o.useState(""),[Pe,tt]=o.useState(!1),[_e,Ae]=o.useState(!1),[Re,U]=o.useState([]),[De,Le]=o.useState(()=>new Date().toISOString().slice(0,10)),[te,Ee]=o.useState({}),[se,Te]=o.useState({}),[st,z]=o.useState(!1),[rt,V]=o.useState(!1),[re,Me]=o.useState(""),[S,ae]=o.useState(null),[at,Ie]=o.useState(!1),[$e,D]=o.useState("");o.useEffect(()=>{(async()=>{const[t,a,r,s,n]=await Promise.all([Y(),q(),qe(),ht(),oe(50)]);m(t),p(a),I(r),N(s),U(n),c(r?.rulebook_url||""),y(r?.sharepoint_url||""),Ee({...s?.promotion_pct||{}}),Te({...s?.demotion_pct||{}}),z(!1)})()},[]),o.useEffect(()=>{c(A?.rulebook_url||""),y(A?.sharepoint_url||"")},[A]);const Oe=t=>ue(a=>a.includes(t)?a.filter(r=>r!==t):[...a,t]),[Fe,Be]=o.useState("");function l(t){Be(t),setTimeout(()=>Be(""),3e3)}async function ot(){try{await St({rulebook_url:E.trim()||void 0,sharepoint_url:k.trim()||void 0}),I(await qe()),l("Settings saved")}catch(t){console.error(t),l("Save failed")}}async function nt(){try{const[t,a]=await Promise.all([Y(),q()]);m(t),p(a)}catch(t){console.error("Reload failed",t)}}async function dt(){try{await Ct(),m([]),p([]),l("System reset complete")}catch(t){console.error(t),l("Reset failed")}}async function lt(){try{const t=await Ge({name:g.trim(),discord:ce.trim()||void 0});m(await Y()),le(""),ie(""),l("Person saved")}catch(t){console.error(t),l("Save failed")}}async function ct(){if(!R.trim())return alert("Give the project a name");try{const t=await We({name:R.trim(),owner_ids:$,design_link:pe.trim()||void 0,description:he.trim()||void 0,due_date:ge||void 0,subsystem:je||void 0});p(await q()),me(""),ue([]),xe(""),be(""),fe(""),ye(""),l("Project saved")}catch(t){console.error(t),l("Save failed")}}const Ue=o.useMemo(()=>{const t=new Set;for(const a of j)a.subsystem&&t.add(a.subsystem);return Array.from(t).sort()},[j]),it=o.useMemo(()=>{const t=new Map;for(const a of j)a.subsystem&&t.set(a.subsystem,(t.get(a.subsystem)||0)+1);return t},[j]),ze=T.length?j.filter(t=>t.subsystem&&T.includes(t.subsystem)):j,mt=o.useMemo(()=>{const t=Q.toLowerCase();return[...ze.filter(s=>t?s.name.toLowerCase().includes(t)||(s.description||"").toLowerCase().includes(t):!0)].sort((s,n)=>{let d=0;return C==="name"?d=s.name.localeCompare(n.name):C==="due"?d=(s.due_date||"").localeCompare(n.due_date||""):d=(s.subsystem||"").localeCompare(n.subsystem||"")||s.name.localeCompare(n.name),X==="asc"?d:-d})},[ze,Q,C,X]),Ve=t=>t==="name"?"Name":t==="due"?"Due date":"Subsystem",Ye=X==="asc"?"↑":"↓";return o.useEffect(()=>{const t=a=>{a.key==="Escape"&&(O(!1),M(!1))};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[]),o.useEffect(()=>{if(!h)return;const t=P??void 0;G({role:t},u)||(Z(u),J(G({role:t},"projects")?"projects":"people"))},[h,P,u]),e.jsx(bt,{children:e.jsxs("div",{className:"max-w-6xl mx-auto px-3 sm:px-4 overflow-x-hidden admin-typography",children:[e.jsx("h1",{className:"text-2xl font-semibold mb-1",children:"Admin"}),Fe&&e.jsx("div",{className:"fixed bottom-4 left-4 z-50 px-4 py-2 rounded shadow-lg animate-fade-in bg-accent/90 border border-accent-weak/60 font-medium text-[13px] leading-snug text-foreground",children:Fe}),e.jsx("div",{className:"sticky top-0 z-30 px-3 sm:px-4 pt-1 bg-bg/70 backdrop-blur border-b border-border/60 overflow-x-auto h-scroll-tabs no-fade",children:e.jsxs("nav",{className:"flex gap-2 sm:gap-3 h-11 items-end min-w-max whitespace-nowrap",role:"tablist",children:[e.jsx("button",{className:`px-3 py-2 rounded-t font-medium text-sm transition border-b-2 ${u==="people"?"border-accent text-accent":"border-transparent text-muted hover:text-accent/80"}`,onClick:()=>F("people"),role:"tab","aria-selected":u==="people",disabled:!h,children:"People"}),e.jsx("button",{className:`px-3 py-2 rounded-t font-medium text-sm transition border-b-2 ${u==="projects"?"border-accent text-accent":"border-transparent text-muted hover:text-accent/80"}`,onClick:()=>F("projects"),role:"tab","aria-selected":u==="projects",disabled:!h,children:"Projects & Tasks"}),e.jsxs(gt,{children:[e.jsx("button",{className:`px-3 py-2 rounded-t font-medium text-sm transition border-b-2 ${u==="settings"?"border-accent text-accent":"border-transparent text-muted hover:text-accent/80"}`,onClick:()=>F("settings"),role:"tab","aria-selected":u==="settings",disabled:!h,children:"Global Settings"}),e.jsx("button",{className:`px-3 py-2 rounded-t font-medium text-sm transition border-b-2 ${u==="ranked"?"border-accent text-accent":"border-transparent text-muted hover:text-accent/80"}`,onClick:()=>F("ranked"),role:"tab","aria-selected":u==="ranked",disabled:!h,children:"Ranked Settings"})]})]})}),h&&K&&!G({role:P??void 0},K)&&e.jsxs("div",{className:"mt-4 text-xs text-red-300",children:["You don’t have access to the ",K," tab. Showing People."]}),u==="people"&&e.jsx("div",{role:"tabpanel",className:"mt-4",children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("section",{className:"space-y-2",children:[e.jsxs("div",{className:"form-section rounded-2xl bg-card border border-border p-4 space-y-3",children:[e.jsx("div",{className:"text-sm font-semibold text-foreground",children:"Create profile"}),e.jsx("input",{className:"px-3 py-2 rounded w-full bg-surface text-foreground border border-border placeholder:text-muted-foreground text-sm",placeholder:"Name",value:g,onChange:t=>le(t.target.value)}),e.jsx("input",{className:"px-3 py-2 rounded w-full bg-surface text-foreground border border-border placeholder:text-muted-foreground text-sm",placeholder:"Discord (e.g., username)",value:ce,onChange:t=>ie(t.target.value)}),e.jsx("button",{onClick:async()=>{if(!g.trim()){l("Enter a name");return}await lt()},disabled:!g.trim(),className:`px-3 py-2 rounded w-full border border-border text-sm text-center ${g.trim()?"bg-surface":"bg-surface opacity-50 cursor-not-allowed"}`,children:"Create profile"})]}),e.jsxs("div",{className:"form-section rounded-2xl bg-card border border-border p-4 space-y-3",children:[e.jsx("div",{className:"text-sm font-semibold text-foreground",children:"Quick attendance"}),e.jsx("input",{type:"date",className:"px-2.5 py-1.5 rounded text-sm bg-surface text-foreground border border-border w-full max-w-xs mx-auto block placeholder:text-muted-foreground",value:De,onChange:t=>Le(t.target.value)}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 items-stretch",children:[e.jsx("div",{children:e.jsx(He,{people:x,mode:"multi",selectedIds:v,onAdd:t=>H(a=>a.includes(t)?a:[...a,t]),onRemove:t=>H(a=>a.filter(r=>r!==t)),triggerLabel:v.length?`${v.length} selected`:"Select person…",buttonClassName:"w-full px-2.5 py-1.5 rounded dark-select text-sm",maxItems:50,allowScroll:!0})}),e.jsx("div",{children:e.jsx("button",{className:`w-full px-2.5 py-1.5 rounded border border-border text-sm text-center ${v.length?"bg-overlay-6":"bg-overlay-6 opacity-50 cursor-not-allowed"}`,disabled:v.length===0,onClick:async()=>{if(console.log("Role check:",{role:P,roleReady:h}),!h){l("Loading user permissions...");return}if(P!=="admin"){l(`Only admins can mark attendance. Your role: ${P||"none"}`);return}if(!v||v.length===0){l("Select at least one person");return}const t=De||new Date().toISOString().slice(0,10);try{const a=await Promise.allSettled(v.map(d=>ft({person_id:d,date:t,points:10}))),r=[],s=[],n=[];a.forEach((d,b)=>{const w=v[b],f=x.find(_=>_.id===w)?.name||w;if(d.status==="fulfilled")r.push(f);else{const _=d.reason;console.error(`Attendance failed for ${f}:`,_),_?.code==="DUPLICATE_ATTENDANCE"||_?.message==="DUPLICATE_ATTENDANCE"?s.push(f):n.push(f)}}),r.length>0&&l(`${r.length} marked present (+10 pts)`),s.length>0&&l(`${s.join(", ")} already marked for ${t}`),n.length>0&&l(`Failed for: ${n.join(", ")}`),setTimeout(()=>{H([]),Le(new Date().toISOString().slice(0,10))},0)}catch(a){console.error(a),l("Attendance failed")}},children:"Give 10 pts"})})]})]})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h2",{className:"font-semibold truncate",children:"Edit profiles"}),e.jsx("div",{className:"ml-4",children:e.jsx("input",{className:"px-3 py-2 rounded text-sm w-44 sm:w-56 bg-surface text-foreground border border-border placeholder:text-muted-foreground",placeholder:"Search people…",value:ve,onChange:t=>Qe(t.target.value)})})]}),e.jsx("div",{className:"space-y-2",children:x.filter(t=>{const a=ve.toLowerCase();return a?t.name.toLowerCase().includes(a)||(t.skills||[]).some(r=>r.toLowerCase().includes(a))||(t.role||"").toLowerCase().includes(a):!0}).sort((t,a)=>t.name.localeCompare(a.name)).map(t=>e.jsxs("details",{className:"rounded-xl bg-card border border-border",children:[e.jsxs("summary",{className:"cursor-pointer font-medium px-3 py-2 flex items-center justify-between gap-2",children:[e.jsx("span",{className:"truncate",children:t.name}),e.jsx("span",{className:"text-xs text-muted-foreground ml-2 max-w-[8rem] md:max-w-[10rem] min-w-0 truncate uppercase tracking-caps",children:t.role||t.year||""})]}),e.jsxs("div",{className:"px-2 pb-2 mt-0.5 grid sm:grid-cols-2 gap-2",children:[e.jsx("input",{className:"px-3 py-2 rounded bg-surface text-foreground border border-border placeholder:text-muted-foreground",value:t.name,onChange:a=>m(r=>r.map(s=>s.id===t.id?{...s,name:a.target.value}:s))}),e.jsxs("select",{className:"px-3 py-2 rounded dark-select bg-surface text-foreground border border-border",value:t.year||"Senior",onChange:a=>m(r=>r.map(s=>s.id===t.id?{...s,year:a.target.value}:s)),children:[e.jsx("option",{children:"Freshman"}),e.jsx("option",{children:"Sophomore"}),e.jsx("option",{children:"Junior"}),e.jsx("option",{children:"Senior"}),e.jsx("option",{children:"Graduate"})]}),e.jsx("input",{className:"px-3 py-2 rounded bg-surface text-foreground border border-border placeholder:text-muted-foreground",placeholder:"Role",value:t.role||"",onChange:a=>m(r=>r.map(s=>s.id===t.id?{...s,role:a.target.value}:s))}),e.jsx("input",{className:"px-3 py-2 rounded bg-surface text-foreground border border-border placeholder:text-muted-foreground",placeholder:"Discord",value:t.discord||"",onChange:a=>m(r=>r.map(s=>s.id===t.id?{...s,discord:a.target.value}:s))}),e.jsx("input",{className:"px-3 py-2 rounded sm:col-span-2 bg-surface text-foreground border border-border placeholder:text-muted-foreground",placeholder:"Skills (comma-separated)",value:(t.skills||[]).join(", "),onChange:a=>m(r=>r.map(s=>s.id===t.id?{...s,skills:a.target.value.split(",").map(n=>n.trim()).filter(Boolean)}:s))}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:col-span-2 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-muted uppercase tracking-caps",children:"Rank"}),e.jsxs("select",{className:"mt-1 px-3 py-2 rounded w-full dark-select bg-surface text-foreground border border-border",value:t.rank||"Bronze",onChange:a=>m(r=>r.map(s=>s.id===t.id?{...s,rank:a.target.value}:s)),children:[e.jsx("option",{children:"Bronze"}),e.jsx("option",{children:"Silver"}),e.jsx("option",{children:"Gold"}),e.jsx("option",{children:"Platinum"}),e.jsx("option",{children:"Diamond"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-muted uppercase tracking-caps",children:"Ranked pool"}),e.jsxs("label",{className:"mt-1 flex items-center gap-3 select-none",children:[e.jsx("input",{type:"checkbox",className:"peer sr-only",checked:!!t.ranked_opt_in,onChange:a=>m(r=>r.map(s=>s.id===t.id?{...s,ranked_opt_in:a.target.checked}:s))}),e.jsx("span",{className:`relative inline-block h-6 w-11 rounded-full bg-white/15 transition-colors peer-checked:bg-accent/70 
                                  after:content-[''] after:absolute after:left-0.5 after:top-0.5 after:h-5 after:w-5 after:rounded-full after:bg-white after:shadow after:transition-transform after:duration-200 peer-checked:after:translate-x-5`}),e.jsx("span",{className:"text-xs text-white/90",children:"Opted in"})]})]})]}),e.jsxs("div",{className:"flex gap-2 sm:col-span-2",children:[e.jsx("button",{className:"flex-1 px-3 py-2 rounded bg-accent text-foreground border border-accent hover:bg-accent/90",onClick:async()=>{await jt(t.id,t),l("Person updated")},children:"Save Changes"}),e.jsx("button",{className:"px-3 py-2 rounded bg-danger text-white border border-danger hover:bg-danger/90",onClick:async()=>{confirm(`Are you sure you want to delete ${t.name}? This will also delete all their attendance records and logs.`)&&(await yt(t.id),m(a=>a.filter(r=>r.id!==t.id)),l("Person deleted"))},children:"Delete"})]})]})]},t.id))})]})]})}),u==="projects"&&e.jsxs("div",{role:"tabpanel",className:"mt-4 space-y-6",children:[e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsxs("section",{className:"space-y-2",children:[e.jsx("h2",{className:"font-semibold",children:"Create Project & Assign Owners"}),e.jsxs("div",{className:"form-section rounded-2xl bg-card border border-border p-4 space-y-3",children:[e.jsx("input",{className:"px-3 py-2 rounded w-full bg-surface text-foreground border border-border text-xs placeholder:text-muted-foreground placeholder:text-xs",placeholder:"Project name",value:R,onChange:t=>me(t.target.value)}),e.jsx("input",{className:"px-3 py-2 rounded w-full bg-surface text-foreground border border-border text-xs placeholder:text-muted-foreground placeholder:text-xs",placeholder:"Design link (optional)",value:pe,onChange:t=>xe(t.target.value)}),e.jsx("textarea",{className:"px-3 py-2 rounded w-full bg-surface text-foreground border border-border text-xs placeholder:text-muted-foreground placeholder:text-xs",placeholder:"Project description (optional)",value:he,onChange:t=>be(t.target.value)}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("select",{className:"px-3 py-2 rounded w-full dark-select bg-surface text-foreground border border-border text-xs",value:je,onChange:t=>ye(t.target.value),children:[e.jsx("option",{value:"",children:"Select subsystem…"}),e.jsx("option",{children:"Aero"}),e.jsx("option",{children:"Business"}),e.jsx("option",{children:"Composites"}),e.jsx("option",{children:"Controls"}),e.jsx("option",{children:"Data Acquisition"}),e.jsx("option",{children:"Electrical IC"}),e.jsx("option",{children:"Electrical EV"}),e.jsx("option",{children:"Finance"}),e.jsx("option",{children:"Frame"}),e.jsx("option",{children:"Manufacturing"}),e.jsx("option",{children:"Powertrain EV"}),e.jsx("option",{children:"Powertrain IC"}),e.jsx("option",{children:"Suspension"})]}),e.jsx("input",{type:"date",className:"px-3 py-2 rounded w-full bg-surface text-foreground border border-border text-xs placeholder:text-muted-foreground placeholder:text-xs",value:ge,onChange:t=>fe(t.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-xs text-muted-foreground uppercase tracking-caps",children:"Owners"}),e.jsx(He,{mode:"multi",people:x,selectedIds:$,onAdd:t=>Oe(t),onRemove:t=>Oe(t),triggerLabel:$.length?`${$.length} selected`:"Add/Remove",buttonClassName:"ml-auto text-[10px] px-2 py-1 rounded bg-surface border border-border",maxItems:5})]}),e.jsx("button",{onClick:async()=>{if(!R.trim()){l("Give the project a name");return}await ct()},disabled:!R.trim(),className:`w-full px-3 py-2 rounded border border-border text-xs text-center ${R.trim()?"bg-surface":"bg-surface opacity-50 cursor-not-allowed"}`,children:"Save Project"})]})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsx("h2",{className:"font-semibold",children:"Create Task"}),e.jsx(Pt,{people:x,projects:j,onCreated:nt})]})]}),e.jsxs("section",{className:"mt-2",children:[e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold",children:"Projects"}),e.jsx("input",{className:"toolbar-input px-3 py-1.5 rounded-md text-xs font-medium border border-border bg-surface w-28 sm:w-44 placeholder:text-muted-foreground focus:outline-none focus-visible:outline-none",placeholder:"Search projects…",value:Q,onChange:t=>Xe(t.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-2",children:[e.jsx("div",{className:"",children:e.jsxs("div",{className:"relative w-full",children:[e.jsxs("button",{onClick:()=>{O(t=>!t),M(!1)},className:"toolbar-btn px-3 py-1.5 rounded-md text-xs font-medium border border-border bg-surface hover:bg-surface/80 w-full text-left",children:["Subsystems: ",e.jsx("span",{className:"font-semibold",children:T.length?`${T.length} selected`:"All"})]}),e.jsxs("div",{className:`absolute left-0 z-20 mt-1 w-64 rounded-md border border-overlay-10 bg-bg/95 shadow-xl overflow-hidden transition transform origin-top ${ke?"opacity-100 scale-100":"opacity-0 scale-95 pointer-events-none"}`,children:[e.jsx("div",{className:"px-3 py-2 border-b border-border",children:e.jsx("button",{className:"w-full px-3 py-2 rounded-md text-xs sm:text-sm font-semibold bg-red-500/15 hover:bg-red-500/25 text-red-200 focus:outline-none focus-visible:outline-none",onClick:()=>Ne([]),children:"Clear selection"})}),e.jsxs("div",{className:"max-h-60 overflow-auto p-1",children:[Ue.length===0&&e.jsx("div",{className:"px-3 py-2 text-xs text-muted-foreground uppercase tracking-caps",children:"No subsystems"}),Ue.map(t=>{const a=T.includes(t),r=it.get(t)??0;return e.jsxs("label",{className:"flex items-center gap-2 px-2 py-1.5 text-xs rounded hover:bg-surface/80 cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"accent-accent",checked:a,onChange:()=>Ne(s=>a?s.filter(n=>n!==t):[...s,t])}),e.jsx("span",{className:"truncate",children:t}),e.jsx("span",{className:"ml-auto inline-flex items-center justify-center rounded-full bg-surface/60 px-2 py-0.5 text-[10px]",children:r})]},t)})]})]})]})}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsxs("div",{className:"relative w-full",children:[e.jsxs("button",{onClick:()=>{M(t=>!t),O(!1)},className:"toolbar-btn px-3 py-1.5 rounded-md text-xs font-medium border border-border bg-surface hover:bg-surface/80 w-full text-left",children:["Sort: ",e.jsxs("span",{className:"font-semibold",children:[Ve(C)," ",Ye]})]}),e.jsx("div",{className:`absolute right-0 z-20 mt-1 w-48 rounded-md border border-overlay-10 bg-bg/95 shadow-xl overflow-hidden transition transform origin-top ${Se?"opacity-100 scale-100":"opacity-0 scale-95 pointer-events-none"}`,children:["subsystem","name","due"].map(t=>e.jsxs("button",{className:`w-full text-left px-3 py-2 text-xs hover:bg-surface/80 ${C===t?"bg-surface/60":""}`,onClick:()=>{C===t?Ze(a=>a==="asc"?"desc":"asc"):Ke(t),M(!1)},children:[Ve(t)," ",C===t?Ye:""]},t))})]})})]}),(ke||Se)&&e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>{O(!1),M(!1)}})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-2",children:mt.map(t=>e.jsxs("details",{className:"form-section rounded-2xl bg-card border border-border p-3",children:[e.jsx("summary",{className:"cursor-pointer font-medium",children:t.name}),e.jsxs("div",{className:"mt-2 space-y-3",children:[e.jsx("input",{className:"px-3 py-2 rounded w-full bg-surface text-foreground border border-border placeholder:text-muted-foreground text-xs",value:t.name,onChange:a=>p(r=>r.map(s=>s.id===t.id?{...s,name:a.target.value}:s))}),e.jsx("input",{className:"px-3 py-2 rounded w-full bg-surface text-foreground border border-border placeholder:text-muted-foreground text-xs",placeholder:"Design link",value:t.design_link||"",onChange:a=>p(r=>r.map(s=>s.id===t.id?{...s,design_link:a.target.value}:s))}),e.jsx("textarea",{className:"px-3 py-2 rounded w-full bg-surface text-foreground border border-border placeholder:text-muted-foreground text-xs",placeholder:"Description",value:t.description||"",onChange:a=>p(r=>r.map(s=>s.id===t.id?{...s,description:a.target.value}:s))}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("select",{className:"px-3 py-2 rounded w-full dark-select bg-surface text-foreground border border-border text-xs",value:t.subsystem||"",onChange:a=>p(r=>r.map(s=>s.id===t.id?{...s,subsystem:a.target.value||void 0}:s)),children:[e.jsx("option",{value:"",children:"Subsystem…"}),e.jsx("option",{children:"Aero"}),e.jsx("option",{children:"Business"}),e.jsx("option",{children:"Composites"}),e.jsx("option",{children:"Controls"}),e.jsx("option",{children:"Data Acquisition"}),e.jsx("option",{children:"Electrical IC"}),e.jsx("option",{children:"Electrical EV"}),e.jsx("option",{children:"Finance"}),e.jsx("option",{children:"Frame"}),e.jsx("option",{children:"Manufacturing"}),e.jsx("option",{children:"Powertrain EV"}),e.jsx("option",{children:"Powertrain IC"}),e.jsx("option",{children:"Suspension"})]}),e.jsx("input",{type:"date",className:"px-3 py-2 rounded w-full bg-surface text-foreground border border-border placeholder:text-muted-foreground text-xs",value:t.due_date||"",onChange:a=>p(r=>r.map(s=>s.id===t.id?{...s,due_date:a.target.value}:s))})]}),e.jsx("button",{className:"px-3 py-2 rounded bg-accent text-foreground border border-accent hover:bg-accent/90 w-full text-xs",onClick:async()=>{await vt(t.id,t),l("Project updated")},children:"Save Changes"})]})]},t.id))})]})]}),u==="settings"&&h&&e.jsxs("div",{role:"tabpanel",className:"mt-4",children:[e.jsxs("section",{className:"space-y-2",children:[e.jsx("h2",{className:"font-semibold",children:"Global Settings"}),e.jsxs("div",{className:"form-section rounded-2xl bg-card border border-border p-4 space-y-2",children:[e.jsx("label",{className:"text-sm block",children:"Rulebook PDF URL"}),e.jsx("input",{className:"px-3 py-2 rounded w-full bg-surface text-foreground border border-border placeholder:text-muted-foreground",placeholder:"https://…/rulebook.pdf",value:E,onChange:t=>c(t.target.value)}),e.jsx("label",{className:"text-sm block",children:"Team SharePoint URL"}),e.jsx("input",{className:"px-3 py-2 rounded w-full bg-surface text-foreground border border-border placeholder:text-muted-foreground",placeholder:"https://…sharepoint.com/sites/FSAE/…",value:k,onChange:t=>y(t.target.value)}),e.jsx("button",{onClick:ot,className:"mt-2 px-3 py-2 rounded bg-accent text-foreground border border-accent hover:bg-accent/90",children:"Save Settings"})]}),e.jsx(_t,{}),e.jsxs("div",{className:"form-section wide p-4 mt-4 border border-destructive/30 bg-destructive/10 rounded-xl",children:[e.jsx("h3",{className:"font-semibold text-foreground",children:"Danger zone"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"This will permanently delete ALL people, projects, and tasks. This action cannot be undone."}),e.jsxs("button",{onClick:()=>{Ce(""),B(!0)},className:"mt-3 inline-flex items-center gap-2 px-3 py-2 rounded border border-border bg-card hover:bg-card/80 text-foreground",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]}),"Full system reset"]})]})]}),e.jsxs("section",{className:"space-y-2 mt-6",children:[e.jsx("h2",{className:"font-semibold",children:"Seed data (Excel)"}),e.jsxs("div",{className:"form-section rounded-2xl bg-card border border-border p-4 space-y-3",children:[e.jsxs("p",{className:"text-sm text-muted",children:['Provide an Excel file with sheets named "People", "Projects", and "Tasks". Columns:',e.jsx("br",{}),"People: Name, Year, Role, Skills, Discord",e.jsx("br",{}),"Projects: Name, Subsystem, Due Date (YYYY-MM-DD), Description, Design Link, Owners (comma-separated names)",e.jsx("br",{}),"Tasks: Project, Description, Status (Todo|In Progress|Complete), Assignee (name)"]}),e.jsx("input",{type:"file",accept:".xlsx,.xls,.csv",onChange:async t=>{const a=t.target.files?.[0];if(a){ae(null),D("");try{const r=await a.arrayBuffer(),s=await W(()=>import("./xlsx-DGuHH-KN.js"),[]),n=s.read(r,{type:"array"}),d=n.Sheets.People,b=n.Sheets.Projects,w=n.Sheets.Tasks,f=d?s.utils.sheet_to_json(d):[],_=b?s.utils.sheet_to_json(b):[],ut=w?s.utils.sheet_to_json(w):[];ae({people:f.map(i=>({name:i.Name?.toString()||"",year:i.Year?.toString(),role:i.Role?.toString(),skills:i.Skills?.toString(),discord:i.Discord?.toString()})),projects:_.map(i=>({name:i.Name?.toString()||"",subsystem:i.Subsystem?.toString(),due_date:i["Due Date"]?.toString(),description:i.Description?.toString(),design_link:i["Design Link"]?.toString(),owners:i.Owners?.toString()})),tasks:ut.map(i=>({project:i.Project?.toString()||"",description:i.Description?.toString()||"",status:i.Status?.toString()||"Todo",assignee:i.Assignee?.toString()}))})}catch(r){console.error(r),D("Failed to read file")}}}}),S&&e.jsxs("div",{className:"text-sm",children:["Preview: ",S.people.length," people, ",S.projects.length," projects, ",S.tasks.length," tasks",e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx("button",{disabled:at,className:"px-3 py-2 rounded border border-border bg-overlay-6 disabled:opacity-50",onClick:async()=>{if(S){Ie(!0),D("Importing…");try{const t=new Map;for(const r of x)t.set(r.name.trim(),r.id);for(const r of S.people){const s=r.name?.trim();if(s&&!t.has(s)){const n=await Ge({name:s,year:r.year||void 0,role:r.role||void 0,skills:(r.skills||"").split(",").map(d=>d.trim()).filter(Boolean),discord:r.discord||void 0});t.set(s,n)}}const a=new Map;for(const r of S.projects){const s=r.name?.trim();if(s&&!a.has(s)){const n=(r.owners||"").split(",").map(b=>b.trim()).filter(Boolean).map(b=>t.get(b)).filter(Boolean),d=await We({name:s,subsystem:r.subsystem||void 0,due_date:r.due_date||void 0,description:r.description||void 0,design_link:r.design_link||void 0,owner_ids:n});a.set(s,d)}}for(const r of S.tasks){const s=a.get((r.project||"").trim());if(!s)continue;const n=r.assignee?t.get(r.assignee.trim()):void 0,d=r.status==="Todo"||r.status==="In Progress"||r.status==="Complete"?r.status:"Todo";await wt({project_id:s,description:r.description||"",status:d,assignee_id:n})}m(await Y()),p(await q()),D("Import complete")}catch(t){console.error(t),D("Import failed")}finally{Ie(!1)}}},children:"Import"}),e.jsx("button",{className:"px-3 py-2 rounded border border-border bg-overlay-6",onClick:()=>{ae(null),D("")},children:"Clear"})]}),$e&&e.jsx("div",{className:"mt-2 text-xs text-muted uppercase tracking-caps",children:$e})]})]})]}),et&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/70",onClick:()=>B(!1)}),e.jsxs("div",{className:"relative w-[95vw] max-w-md rounded-xl border border-overlay-10 bg-bg/95 shadow-2xl p-5",children:[e.jsx("h4",{className:"text-lg font-semibold mb-2",children:"Confirm full system reset"}),e.jsx("p",{className:"text-sm text-muted",children:"Enter the reset password to proceed. Contact the team lead if you don’t know it."}),e.jsxs("div",{className:"mt-3 relative",children:[e.jsx("input",{autoFocus:!0,type:Pe?"text":"password",className:"w-full px-3 py-2 pr-10 rounded border border-white/10 bg-black/20",placeholder:"Reset password",value:ee,onChange:t=>Ce(t.target.value)}),e.jsx("button",{"aria-label":"Toggle password visibility",onClick:()=>tt(t=>!t),className:"absolute right-1 top-1.5 h-7 w-7 inline-flex items-center justify-center rounded hover:bg-white/10",children:Pe?e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"#E5E7EB",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M17.94 17.94A10.94 10.94 0 0 1 12 20C7 20 2.73 16.11 1 12c.6-1.36 1.5-2.59 2.57-3.61M10.58 5.06A10.94 10.94 0 0 1 12 4c5 0 9.27 3.89 11 8-."})}):e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"#E5E7EB",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),e.jsx("circle",{cx:"12",cy:"12",r:"3"})]})})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>B(!1),className:"px-3 py-2 rounded border border-border bg-overlay-6",children:"Cancel"}),e.jsx("button",{onClick:async()=>{await dt(),B(!1)},disabled:ee!=="UCONN FORMULA SAE",className:`px-3 py-2 rounded border ${ee==="UCONN FORMULA SAE"?"border-danger bg-danger/30 hover:bg-danger/40 text-danger/90":"border-overlay-10 bg-overlay-6 text-muted cursor-not-allowed"}`,children:"Permanently delete everything"})]})]})]})]}),u==="ranked"&&h&&e.jsx("div",{role:"tabpanel",className:"mt-4",children:e.jsxs("section",{className:"space-y-2",children:[e.jsx("h2",{className:"font-semibold mb-2",children:"Ranked Settings"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid sm:grid-cols-2 gap-3",children:e.jsxs("div",{className:"form-section p-3 bg-surface/80 border border-border/40 rounded mb-2 flex flex-col gap-2",children:[e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",className:"accent-accent",checked:!!L?.enabled,onChange:async t=>{const a=t.target.checked;N(r=>r?{...r,enabled:a}:{enabled:a}),await ne({enabled:a})}}),"Enable ranked mode"]}),e.jsx("p",{className:"text-xs text-muted uppercase tracking-caps mt-1",children:"When on, the app reveals the Ranked page and point indicators. Turning it off hides ranked UI and points, but nothing is deleted."}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm mt-2",children:[e.jsx("input",{type:"checkbox",className:"accent-accent",checked:!!L?.autoApply,onChange:async t=>{const a=t.target.checked;N(r=>r?{...r,autoApply:a}:{autoApply:a}),await ne({autoApply:a})}}),"Auto apply weekly"]}),e.jsx("p",{className:"text-xs text-muted uppercase tracking-caps mt-1",children:"When on, promotions/relegations are automatically applied each week for all users. Disable to require manual action only."})]})}),e.jsx("div",{className:"grid sm:grid-cols-2 gap-3 -mt-2"}),e.jsx("div",{className:"mt-2",children:e.jsx("div",{className:"form-section wide p-4 overflow-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-white/5",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-2 py-2 font-medium text-sm",children:"Rank"}),e.jsx("th",{className:"text-left px-2 py-2 font-medium text-sm",children:"Promote %"}),e.jsx("th",{className:"text-left px-2 py-2 font-medium text-sm",children:"Relegate %"})]})}),e.jsx("tbody",{children:["Bronze","Silver","Gold","Platinum","Diamond"].map(t=>{const a=t.toLowerCase(),r=te[a]??0,s=se[a]??0,n=t==="Diamond",d=t==="Bronze";return e.jsxs("tr",{className:"border-t border-white/10",children:[e.jsx("td",{className:"px-2 py-2 text-sm",children:t}),e.jsx("td",{className:"px-2 py-2",children:n?e.jsx("span",{className:"text-sm text-muted uppercase tracking-caps",children:"N/A"}):e.jsx("input",{type:"number",min:0,max:100,value:r,onChange:async b=>{const w=Math.max(0,Math.min(100,Number(b.target.value)));Ee(f=>({...f||{},[a]:w})),z(!0)},className:"px-2 py-1 rounded w-16 max-w-[64px] text-center bg-white/5 border border-white/10 text-base font-semibold"})}),e.jsx("td",{className:"px-2 py-2",children:d?e.jsx("span",{className:"text-sm text-muted uppercase tracking-caps",children:"N/A"}):e.jsx("input",{type:"number",min:0,max:100,value:s,onChange:async b=>{const w=Math.max(0,Math.min(100,Number(b.target.value)));Te(f=>({...f||{},[a]:w})),z(!0)},className:"px-2 py-1 rounded w-16 max-w-[64px] text-center bg-white/5 border border-white/10 text-base font-semibold"})})]},t)})})]})})}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx("button",{disabled:!st,onClick:async()=>{try{await ne({promotion_pct:te,demotion_pct:se}),N(t=>({...t||{},promotion_pct:{...te},demotion_pct:{...se}})),z(!1),l("Ranked settings saved")}catch(t){console.error(t),l("Save failed")}},className:"mt-2 px-3 py-2 rounded bg-overlay-6 border border-border text-sm disabled:opacity-50",children:"Save changes"})}),e.jsx("div",{className:"pt-4 mt-2 border-t border-white/10",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3 justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:"Manual override"}),e.jsx("p",{className:"text-xs text-muted uppercase tracking-caps",children:"Apply promotions and relegations immediately using the current week’s points."})]}),e.jsx("button",{disabled:_e,onClick:()=>{Me(""),V(!0)},className:"px-3 py-2 rounded bg-accent/40 hover:bg-accent/60 border border-border text-sm font-medium disabled:opacity-50",children:"Apply now"})]})})]}),e.jsxs("div",{className:"form-section wide p-5 mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Recent ranked activity"}),e.jsx("button",{className:"text-xs px-2 py-1 rounded border border-border bg-overlay-6 uppercase tracking-caps",onClick:async()=>{U(await oe(20))},children:"Refresh"})]}),e.jsxs("ul",{className:"text-sm divide-y divide-white/10 rounded border border-white/10",children:[Re.length===0&&e.jsx("li",{className:"px-3 py-2 text-muted uppercase tracking-caps",children:"No activity yet"}),Re.slice(0,we).map((t,a)=>e.jsxs("li",{className:"px-3 py-2 flex flex-col sm:flex-row sm:items-start gap-1 sm:gap-3 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted leading-snug uppercase tracking-caps",children:[e.jsx("span",{className:"shrink-0 sm:w-40 sm:inline block",children:new Date(t.ts||0).toLocaleString()}),e.jsx("span",{className:"font-mono text-[10px] sm:text-xs uppercase tracking-wide px-1.5 py-0.5 rounded bg-white/10 border border-white/10",children:t.type})]}),e.jsxs("span",{className:"text-sm break-words whitespace-pre-wrap leading-snug",children:[t.type==="attendance"&&e.jsxs(e.Fragment,{children:["Attendance · ",t.points," pts ",t.person_id?`→ ${x.find(r=>r.id===t.person_id)?.name||t.person_id}`:""]}),t.type==="rank_change"&&e.jsxs(e.Fragment,{children:["Rank · ",x.find(r=>r.id===t.person_id)?.name||t.person_id," ",t.from_rank," → ",t.to_rank]}),t.type==="task_points"&&(()=>{let r=t.note;if(r){if(r.length%2===0){const s=r.length/2,n=r.slice(0,s),d=r.slice(s);n===d&&(r=n)}if((r.match(/Task complete:/g)||[]).length>1){const s=r.split("Task complete:").filter(Boolean).map(n=>n.trim());s.length>=2&&s.every(n=>n===s[0]),r="Task complete: "+s[0]}}return e.jsxs(e.Fragment,{children:["Task · ",t.points," pts ",t.person_id?`→ ${x.find(s=>s.id===t.person_id)?.name||t.person_id}`:"",r?` · ${r}`:""]})})(),t.type!=="attendance"&&t.type!=="rank_change"&&(t.note||"")]})]},t.id||a))]}),e.jsx("div",{className:"flex items-center justify-center mt-2",children:e.jsx("button",{className:"text-xs px-3 py-1 rounded border border-border bg-overlay-6 uppercase tracking-caps",onClick:async()=>{const t=we+20;U(await oe(t)),Je(t)},children:"Load More"})})]})]})}),rt&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/70",onClick:()=>V(!1)}),e.jsxs("div",{className:"relative w-[95vw] max-w-md rounded-xl border border-overlay-10 bg-bg/95 shadow-2xl p-5",children:[e.jsx("h4",{className:"text-lg font-semibold mb-2",children:"Confirm ranked apply"}),e.jsx("p",{className:"text-sm text-muted",children:"Enter the confirmation phrase to proceed."}),e.jsx("input",{autoFocus:!0,className:"mt-3 w-full px-3 py-2 rounded border border-white/10 bg-black/20",placeholder:"Enter confirmation phrase",value:re,onChange:t=>Me(t.target.value)}),e.jsxs("div",{className:"mt-4 flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>V(!1),className:"px-3 py-2 rounded border border-border bg-overlay-6",children:"Cancel"}),e.jsx("button",{disabled:re!=="UCONN FORMULA SAE"||_e,className:`px-3 py-2 rounded border ${re==="UCONN FORMULA SAE"?"border-accent bg-accent/30 hover:bg-accent/40 text-black":"border-overlay-10 bg-overlay-6 text-muted cursor-not-allowed"}`,onClick:async()=>{try{Ae(!0);const r=(await Nt(kt,"applyRankedChanges")())?.data?.applied??0;l(`${r} updates applied`);const{fetchRecentLogs:s}=await W(async()=>{const{fetchRecentLogs:n}=await import("./index-Dc-RWuvD.js").then(d=>d.W);return{fetchRecentLogs:n}},__vite__mapDeps([0,1]));U(await s(50)),V(!1)}catch(t){console.error(t),l("Apply failed")}finally{Ae(!1)}},children:"Apply"})]})]})]})]})})}function _t(){const[de,x]=o.useState([]),[m,j]=o.useState(""),[p,A]=o.useState(!1),[I,L]=o.useState(null);o.useEffect(()=>{(async()=>{try{A(!0);const{fetchProjects:c}=await W(async()=>{const{fetchProjects:k}=await import("./index-Dc-RWuvD.js").then(y=>y.W);return{fetchProjects:k}},__vite__mapDeps([0,1]));x(await c())}finally{A(!1)}})()},[]);const N=de.filter(c=>c.archived),E=N.filter(c=>c.name.toLowerCase().includes(m.toLowerCase()));return e.jsxs("div",{className:"form-section rounded-2xl bg-card border border-border p-4 mt-6 space-y-3",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Retrieve archived project"}),e.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-caps",children:"Restore a previously archived project (brings it back into lists)."}),N.length===0?e.jsx("p",{className:"text-xs text-muted-foreground italic uppercase tracking-caps",children:"No archived projects yet."}):e.jsx("input",{className:"px-3 py-2 rounded w-full bg-surface text-foreground border border-border placeholder:text-muted-foreground",placeholder:"Search archived projects…",value:m,onChange:c=>j(c.target.value)}),p&&e.jsx("div",{className:"text-xs text-muted-foreground uppercase tracking-caps",children:"Loading…"}),N.length>0&&e.jsxs("ul",{className:"space-y-2 max-h-64 overflow-auto pr-1",children:[E.slice(0,25).map(c=>e.jsxs("li",{className:"flex items-center gap-3 text-sm px-2 py-2 rounded bg-surface border border-border",children:[e.jsx("span",{className:"truncate flex-1",children:c.name}),e.jsx("button",{disabled:I===c.id,onClick:async()=>{try{L(c.id);const{updateProject:k}=await W(async()=>{const{updateProject:y}=await import("./index-Dc-RWuvD.js").then(g=>g.W);return{updateProject:y}},__vite__mapDeps([0,1]));await k(c.id,{archived:!1}),x(y=>y.map(g=>g.id===c.id?{...g,archived:!1}:g)),window.alert?.("Project restored")}catch(k){console.error(k),window.alert?.("Restore failed")}finally{L(null)}},className:"px-3 py-1.5 rounded text-xs font-medium border border-accent bg-accent text-foreground hover:bg-accent/90 disabled:opacity-50",children:"Restore"})]},c.id)),E.length===0&&!p&&e.jsx("li",{className:"text-xs text-muted-foreground px-2 py-1 uppercase tracking-caps",children:"No archived projects match."})]})]})}export{Xt as default};
