const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-B-YBCRUe.js","assets/index-wiVTbe03.css"])))=>i.map(i=>d[i]);
import{d as Rs,r,_ as b,f as Q,a as re,g as rs,q as $,s as Es,j as e,t as Ds,v as Ls,w as Ts,x as is,y as ls,o as cs,b as Is,z as Ms,A as Os,B as Fs,C as Bs}from"./index-B-YBCRUe.js";import{P as ds}from"./PersonSelectPopover-BE2U_AbU.js";function Ys(){var ns;const M=Rs(),g=(M==null?void 0:M.uid)||null,[h,x]=r.useState([]),[f,j]=r.useState([]),[y,O]=r.useState(null),[w,R]=r.useState(null),[m,N]=r.useState(""),[E,D]=r.useState(""),[T,S]=r.useState(""),[ie,le]=r.useState("Senior"),[ce,de]=r.useState(""),[me,pe]=r.useState(""),[ue,he]=r.useState(""),[X,xe]=r.useState(""),[z,je]=r.useState([]),[be,ge]=r.useState(""),[fe,we]=r.useState(""),[ve,ye]=r.useState(""),[Ne,Se]=r.useState(""),[Vs,$s]=r.useState(""),[H,ke]=r.useState(""),[Ce,_e]=r.useState(""),[Pe,Ae]=r.useState("In Progress"),[J,Re]=r.useState(""),[Ee,De]=r.useState(""),[F,Le]=r.useState(""),[Te,ms]=r.useState(""),[K,ps]=r.useState(""),[B,Ie]=r.useState([]),[L,us]=r.useState("subsystem"),[Z,hs]=r.useState("asc"),[Me,Y]=r.useState(!1),[Oe,U]=r.useState(!1),[v,Fe]=r.useState("people"),[xs,G]=r.useState(!1),[ee,Be]=r.useState(""),[Ue,js]=r.useState(!1),[Ve,$e]=r.useState(!1),[ze,se]=r.useState([]),[Je,Ye]=r.useState(()=>new Date().toISOString().slice(0,10)),[te,Ge]=r.useState({}),[ae,qe]=r.useState({}),[bs,q]=r.useState(!1),[gs,W]=r.useState(!1),[ne,We]=r.useState(""),[k,oe]=r.useState(null),[fs,Qe]=r.useState(!1),[Xe,I]=r.useState("");r.useEffect(()=>{(async()=>{const{fetchRankedSettings:s}=await b(async()=>{const{fetchRankedSettings:c}=await import("./index-B-YBCRUe.js").then(u=>u.J);return{fetchRankedSettings:c}},__vite__mapDeps([0,1])),{fetchRecentLogs:a}=await b(async()=>{const{fetchRecentLogs:c}=await import("./index-B-YBCRUe.js").then(u=>u.J);return{fetchRecentLogs:c}},__vite__mapDeps([0,1])),[o,t,n,i,l]=await Promise.all([Q(),re(),rs(),s(),a(50)]);x(o),j(t),O(n),R(i),se(l),N((n==null?void 0:n.rulebook_url)||""),D((n==null?void 0:n.sharepoint_url)||""),Ge({...(i==null?void 0:i.promotion_pct)||{}}),qe({...(i==null?void 0:i.demotion_pct)||{}}),q(!1)})()},[]),r.useEffect(()=>{N((y==null?void 0:y.rulebook_url)||""),D((y==null?void 0:y.sharepoint_url)||"")},[y]);const He=s=>je(a=>a.includes(s)?a.filter(o=>o!==s):[...a,s]),[Ke,Ze]=r.useState("");function d(s){Ze(s),setTimeout(()=>Ze(""),3e3)}async function ws(){try{await Fs({rulebook_url:m.trim()||void 0,sharepoint_url:E.trim()||void 0}),O(await rs()),d("Settings saved")}catch(s){console.error(s),d("Save failed")}}async function vs(){try{await Bs(),x([]),j([]),d("System reset complete")}catch(s){console.error(s),d("Reset failed")}}async function ys(){try{const s=await is({name:T.trim(),year:ie,role:me.trim()||void 0,skills:ce.split(",").map(a=>a.trim()).filter(Boolean),discord:ue.trim()||void 0});x(await Q()),S(""),le("Senior"),pe(""),de(""),he(""),d("Person saved")}catch(s){console.error(s),d("Save failed")}}async function Ns(){if(!X.trim())return alert("Give the project a name");try{const s=await ls({name:X.trim(),owner_ids:z,design_link:be.trim()||void 0,description:fe.trim()||void 0,due_date:ve||void 0,subsystem:Ne||void 0});j(await re()),xe(""),je([]),ge(""),we(""),ye(""),Se(""),d("Project saved")}catch(s){console.error(s),d("Save failed")}}async function Ss(){if(!H)return alert("Choose a project");try{const s=await cs({project_id:H,description:Ce.trim(),status:Pe,assignee_id:J||void 0,ranked_points:Ee||void 0});ke(""),_e(""),Ae("In Progress"),Re(""),De(""),d("Task saved")}catch(s){console.error(s),d("Save failed")}}const es=r.useMemo(()=>{const s=new Set;for(const a of f)a.subsystem&&s.add(a.subsystem);return Array.from(s).sort()},[f]),ks=r.useMemo(()=>{const s=new Map;for(const a of f)a.subsystem&&s.set(a.subsystem,(s.get(a.subsystem)||0)+1);return s},[f]),ss=B.length?f.filter(s=>s.subsystem&&B.includes(s.subsystem)):f,Cs=r.useMemo(()=>{const s=K.toLowerCase();return[...ss.filter(t=>s?t.name.toLowerCase().includes(s)||(t.description||"").toLowerCase().includes(s):!0)].sort((t,n)=>{let i=0;return L==="name"?i=t.name.localeCompare(n.name):L==="due"?i=(t.due_date||"").localeCompare(n.due_date||""):i=(t.subsystem||"").localeCompare(n.subsystem||"")||t.name.localeCompare(n.name),Z==="asc"?i:-i})},[ss,K,L,Z]),ts=s=>s==="name"?"Name":s==="due"?"Due date":"Subsystem",as=Z==="asc"?"↑":"↓";return r.useEffect(()=>{const s=a=>{a.key==="Escape"&&(Y(!1),U(!1))};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[]),r.useEffect(()=>{$(g,v)||Fe("people")},[g,v]),Es(g)?e.jsxs("div",{className:"max-w-6xl mx-auto px-3 sm:px-4 overflow-x-hidden",children:[e.jsx("h1",{className:"text-2xl font-semibold mb-1",children:"Admin"}),Ke&&e.jsx("div",{className:"fixed bottom-4 right-4 z-50 px-4 py-2 rounded bg-brand-teal text-black shadow-lg text-sm font-medium animate-fade-in",children:Ke}),e.jsx("div",{className:"sticky top-0 z-30 px-3 sm:px-4 pt-1 bg-uconn-blue/70 backdrop-blur border-b border-uconn-border/60 overflow-x-auto h-scroll-tabs no-fade",children:e.jsx("nav",{className:"flex gap-2 sm:gap-3 h-11 items-end min-w-max whitespace-nowrap",role:"tablist",children:["people","projects","settings","ranked"].filter(s=>$(g,s)).map(s=>{const a=s==="people"?"People":s==="projects"?"Projects & Tasks":s==="settings"?"Global Settings":"Ranked Settings";return e.jsx("button",{role:"tab","aria-selected":v===s,onClick:()=>Fe(s),className:`px-3 pb-2 pt-2 border-b-2 ${v===s?"border-brand-teal text-white":"border-transparent text-uconn-muted hover:text-white"}`,children:a},s)})})}),!$(g,v)&&e.jsxs("div",{className:"mt-4 text-xs text-red-300",children:["You no longer have access to the ",v," tab. Showing People tab."]}),v==="people"&&e.jsx("div",{role:"tabpanel",className:"mt-4",children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("section",{className:"space-y-2",children:[e.jsx("h2",{className:"font-semibold",children:"Create Person"}),e.jsxs("div",{className:"form-section p-4 space-y-3",children:[e.jsx("input",{className:"px-3 py-2 rounded w-full",placeholder:"Name",value:T,onChange:s=>S(s.target.value)}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("select",{className:"px-3 py-2 rounded dark-select",value:ie,onChange:s=>le(s.target.value),children:[e.jsx("option",{children:"Freshman"}),e.jsx("option",{children:"Sophomore"}),e.jsx("option",{children:"Junior"}),e.jsx("option",{children:"Senior"}),e.jsx("option",{children:"Graduate"})]}),e.jsx("input",{className:"px-3 py-2 rounded flex-1",placeholder:"Role (optional)",value:me,onChange:s=>pe(s.target.value)})]}),e.jsx("input",{className:"px-3 py-2 rounded w-full",placeholder:"Skills (comma-separated)",value:ce,onChange:s=>de(s.target.value)}),e.jsx("input",{className:"px-3 py-2 rounded w-full",placeholder:"Discord (e.g., username)",value:ue,onChange:s=>he(s.target.value)}),e.jsx("button",{onClick:ys,className:"px-3 py-2 rounded bg-white/10 border border-uconn-border",children:"Save Person"}),e.jsxs("div",{className:"pt-3 border-t border-white/10 mt-3",children:[e.jsx("div",{className:"text-xs text-uconn-muted mb-1",children:"Quick attendance"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2",children:[e.jsx("input",{type:"date",className:"px-2.5 py-1.5 rounded text-sm bg-white/5 border border-white/10",value:Je,onChange:s=>Ye(s.target.value)}),e.jsxs("select",{className:"px-2.5 py-1.5 rounded dark-select text-sm flex-1",value:F,onChange:s=>Le(s.target.value),children:[e.jsx("option",{value:"",children:"Select person…"}),h.slice().sort((s,a)=>s.name.localeCompare(a.name)).map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx("button",{className:"px-2.5 py-1.5 rounded border border-uconn-border bg-white/10 text-xs whitespace-nowrap",onClick:async()=>{var a,o;if(!F){d("Select a person");return}const s=Je||new Date().toISOString().slice(0,10);try{const t=((a=h.find(n=>n.id===F))==null?void 0:a.name)||"Attendance";await Ds({person_id:F,date:s,points:10}),d(`${t} marked present (+10 pts)`),setTimeout(()=>{Le(""),Ye(new Date().toISOString().slice(0,10))},0)}catch(t){if((t==null?void 0:t.code)==="DUPLICATE_ATTENDANCE"||(t==null?void 0:t.message)==="DUPLICATE_ATTENDANCE"){const n=((o=h.find(i=>i.id===F))==null?void 0:o.name)||"Person";d(`${n} already marked for ${s}`)}else console.error(t),d("Attendance failed")}},children:"Give 10 pts"})]})]})]})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h2",{className:"font-semibold",children:"People"}),e.jsx("input",{className:"px-3 py-2 rounded text-sm w-56",placeholder:"Search people…",value:Te,onChange:s=>ms(s.target.value)})]}),e.jsx("div",{className:"space-y-4",children:h.filter(s=>{const a=Te.toLowerCase();return a?s.name.toLowerCase().includes(a)||(s.skills||[]).some(o=>o.toLowerCase().includes(a))||(s.role||"").toLowerCase().includes(a):!0}).sort((s,a)=>s.name.localeCompare(a.name)).map(s=>e.jsxs("details",{className:"rounded-xl bg-white/5 border border-white/10",children:[e.jsxs("summary",{className:"cursor-pointer font-medium px-3 py-2 flex items-center justify-between",children:[e.jsx("span",{className:"truncate",children:s.name}),e.jsx("span",{className:"text-xs text-uconn-muted ml-2 truncate",children:s.role||s.year||""})]}),e.jsxs("div",{className:"px-3 pb-3 mt-1 grid sm:grid-cols-2 gap-4",children:[e.jsx("input",{className:"px-3 py-2 rounded",value:s.name,onChange:a=>x(o=>o.map(t=>t.id===s.id?{...t,name:a.target.value}:t))}),e.jsxs("select",{className:"px-3 py-2 rounded dark-select",value:s.year||"Senior",onChange:a=>x(o=>o.map(t=>t.id===s.id?{...t,year:a.target.value}:t)),children:[e.jsx("option",{children:"Freshman"}),e.jsx("option",{children:"Sophomore"}),e.jsx("option",{children:"Junior"}),e.jsx("option",{children:"Senior"}),e.jsx("option",{children:"Graduate"})]}),e.jsx("input",{className:"px-3 py-2 rounded",placeholder:"Role",value:s.role||"",onChange:a=>x(o=>o.map(t=>t.id===s.id?{...t,role:a.target.value}:t))}),e.jsx("input",{className:"px-3 py-2 rounded",placeholder:"Discord",value:s.discord||"",onChange:a=>x(o=>o.map(t=>t.id===s.id?{...t,discord:a.target.value}:t))}),e.jsx("input",{className:"px-3 py-2 rounded sm:col-span-2",placeholder:"Skills (comma-separated)",value:(s.skills||[]).join(", "),onChange:a=>x(o=>o.map(t=>t.id===s.id?{...t,skills:a.target.value.split(",").map(n=>n.trim()).filter(Boolean)}:t))}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 sm:col-span-2 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-uconn-muted",children:"Rank"}),e.jsxs("select",{className:"mt-1 px-3 py-2 rounded w-full dark-select",value:s.rank||"Bronze",onChange:a=>x(o=>o.map(t=>t.id===s.id?{...t,rank:a.target.value}:t)),children:[e.jsx("option",{children:"Bronze"}),e.jsx("option",{children:"Silver"}),e.jsx("option",{children:"Gold"}),e.jsx("option",{children:"Platinum"}),e.jsx("option",{children:"Diamond"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-uconn-muted",children:"Ranked pool"}),e.jsxs("label",{className:"mt-1 flex items-center gap-3 select-none",children:[e.jsx("input",{type:"checkbox",className:"peer sr-only",checked:!!s.ranked_opt_in,onChange:a=>x(o=>o.map(t=>t.id===s.id?{...t,ranked_opt_in:a.target.checked}:t))}),e.jsx("span",{className:`relative inline-block h-6 w-11 rounded-full bg-white/15 transition-colors peer-checked:bg-brand-teal/70 \r
                                after:content-[''] after:absolute after:left-0.5 after:top-0.5 after:h-5 after:w-5 after:rounded-full after:bg-white after:shadow after:transition-transform after:duration-200 peer-checked:after:translate-x-5`}),e.jsx("span",{className:"text-xs text-white/90",children:"Opted in"})]})]})]}),e.jsx("button",{className:"px-3 py-2 rounded bg-white/10 border border-uconn-border sm:col-span-2",onClick:async()=>{await Ls(s.id,s),d("Person updated")},children:"Save Changes"})]})]},s.id))})]})]})}),v==="projects"&&e.jsxs("div",{role:"tabpanel",className:"mt-4 space-y-6",children:[e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsxs("section",{className:"space-y-2",children:[e.jsx("h2",{className:"font-semibold",children:"Create Project & Assign Owners"}),e.jsxs("div",{className:"form-section p-4 space-y-3",children:[e.jsx("input",{className:"px-3 py-2 rounded w-full",placeholder:"Project name",value:X,onChange:s=>xe(s.target.value)}),e.jsx("input",{className:"px-3 py-2 rounded w-full",placeholder:"Design link (optional)",value:be,onChange:s=>ge(s.target.value)}),e.jsx("textarea",{className:"px-3 py-2 rounded w-full",placeholder:"Project description (optional)",value:fe,onChange:s=>we(s.target.value)}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("select",{className:"px-3 py-2 rounded w-full dark-select",value:Ne,onChange:s=>Se(s.target.value),children:[e.jsx("option",{value:"",children:"Select subsystem…"}),e.jsx("option",{children:"Aero"}),e.jsx("option",{children:"Business"}),e.jsx("option",{children:"Composites"}),e.jsx("option",{children:"Controls"}),e.jsx("option",{children:"Data Acquisition"}),e.jsx("option",{children:"Electrical IC"}),e.jsx("option",{children:"Electrical EV"}),e.jsx("option",{children:"Finance"}),e.jsx("option",{children:"Frame"}),e.jsx("option",{children:"Manufacturing"}),e.jsx("option",{children:"Powertrain EV"}),e.jsx("option",{children:"Powertrain IC"}),e.jsx("option",{children:"Suspension"})]}),e.jsx("input",{type:"date",className:"px-3 py-2 rounded w-full",value:ve,onChange:s=>ye(s.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-sm text-uconn-muted",children:"Owners"}),e.jsx(ds,{mode:"multi",people:h,selectedIds:z,onAdd:s=>He(s),onRemove:s=>He(s),triggerLabel:z.length?`${z.length} selected`:"Add/Remove",buttonClassName:"ml-auto text-[11px] px-2 py-1 rounded bg-white/10 border border-white/20",maxItems:8})]}),e.jsx("button",{onClick:Ns,className:"px-3 py-2 rounded bg-white/10 border border-uconn-border",children:"Save Project"})]})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsx("h2",{className:"font-semibold",children:"Create Task"}),e.jsxs("div",{className:"form-section p-4 space-y-3",children:[e.jsxs("select",{className:"px-3 py-2 rounded w-full dark-select",value:H,onChange:s=>ke(s.target.value),children:[e.jsx("option",{value:"",children:"Select project…"}),f.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx("input",{className:"px-3 py-2 rounded w-full",placeholder:"Task description",value:Ce,onChange:s=>_e(s.target.value)}),e.jsx(ds,{mode:"single",people:h,selectedId:J||null,onSelect:s=>Re(s||""),triggerLabel:J?((ns=h.find(s=>s.id===J))==null?void 0:ns.name)||"Assignee":"Assign to…",buttonClassName:"px-3 py-2 rounded bg-white/10 border border-white/20 text-sm",maxItems:8}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:flex-wrap items-stretch gap-3",children:[e.jsxs("select",{className:"px-3 py-2 rounded dark-select h-11 sm:w-auto sm:min-w-[160px]",value:Pe,onChange:s=>Ae(s.target.value),children:[e.jsx("option",{children:"Todo"}),e.jsx("option",{children:"In Progress"}),e.jsx("option",{children:"Complete"})]}),e.jsxs("select",{className:"px-3 py-2 rounded dark-select h-11 sm:w-auto sm:min-w-[200px]",value:Ee,onChange:s=>De(s.target.value?Number(s.target.value):""),children:[e.jsx("option",{value:"",children:"Points (by estimated hours)"}),e.jsx("option",{value:"1",children:"1 pt ~ 30 mins"}),e.jsx("option",{value:"3",children:"3 pts ~ 1 hour"}),e.jsx("option",{value:"6",children:"6 pts ~ 2 hours"}),e.jsx("option",{value:"15",children:"15 pts ~ 5 hours"}),e.jsx("option",{value:"40",children:"40 pts ~ 10 hours"}),e.jsx("option",{value:"65",children:"65 pts ~ 15 hours"}),e.jsx("option",{value:"98",children:"98 pts ~ 20 hours"}),e.jsx("option",{value:"150",children:"150 pts ~ 25 hours"}),e.jsx("option",{value:"200",children:"200 pts ~ 30 hours"})]}),e.jsx("button",{onClick:Ss,className:"px-4 rounded bg-white/10 border border-uconn-border h-11 whitespace-nowrap sm:max-w-full",children:"Save Task"})]})]})]})]}),e.jsxs("section",{className:"mt-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-2 relative",children:[e.jsx("h2",{className:"font-semibold mr-auto",children:"Projects"}),e.jsx("input",{className:"px-3 py-1.5 rounded-md text-xs font-medium border border-white/10 bg-white/5 w-56 placeholder:text-uconn-muted focus:outline-none focus-visible:outline-none",placeholder:"Search projects…",value:K,onChange:s=>ps(s.target.value)}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>{Y(s=>!s),U(!1)},className:"px-3 py-1.5 rounded-md text-xs font-medium border border-white/10 bg-white/5 hover:bg-white/10",children:["Subsystems: ",e.jsx("span",{className:"font-semibold",children:B.length?`${B.length} selected`:"All"})]}),e.jsxs("div",{className:`absolute right-0 z-20 mt-1 w-64 rounded-md border border-white/10 bg-uconn-blue/95 shadow-xl overflow-hidden transition transform origin-top ${Me?"opacity-100 scale-100":"opacity-0 scale-95 pointer-events-none"}`,children:[e.jsx("div",{className:"px-3 py-2 border-b border-white/10",children:e.jsx("button",{className:"w-full px-3 py-2 rounded-md text-xs sm:text-sm font-semibold bg-red-500/15 hover:bg-red-500/25 text-red-200 focus:outline-none focus-visible:outline-none",onClick:()=>Ie([]),children:"Clear selection"})}),e.jsxs("div",{className:"max-h-60 overflow-auto p-1",children:[es.length===0&&e.jsx("div",{className:"px-3 py-2 text-xs text-uconn-muted",children:"No subsystems"}),es.map(s=>{const a=B.includes(s),o=ks.get(s)??0;return e.jsxs("label",{className:"flex items-center gap-2 px-2 py-1.5 text-xs rounded hover:bg-white/10 cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"accent-brand-teal",checked:a,onChange:()=>Ie(t=>a?t.filter(n=>n!==s):[...t,s])}),e.jsx("span",{className:"truncate",children:s}),e.jsx("span",{className:"ml-auto inline-flex items-center justify-center rounded-full bg-white/10 px-2 py-0.5 text-[10px]",children:o})]},s)})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>{U(s=>!s),Y(!1)},className:"px-3 py-1.5 rounded-md text-xs font-medium border border-white/10 bg-white/5 hover:bg-white/10",children:["Sort: ",e.jsxs("span",{className:"font-semibold",children:[ts(L)," ",as]})]}),e.jsx("div",{className:`absolute right-0 z-20 mt-1 w-48 rounded-md border border-white/10 bg-uconn-blue/95 shadow-xl overflow-hidden transition transform origin-top ${Oe?"opacity-100 scale-100":"opacity-0 scale-95 pointer-events-none"}`,children:["subsystem","name","due"].map(s=>e.jsxs("button",{className:`w-full text-left px-3 py-2 text-xs hover:bg-white/10 ${L===s?"bg-white/10":""}`,onClick:()=>{L===s?hs(a=>a==="asc"?"desc":"asc"):us(s),U(!1)},children:[ts(s)," ",L===s?as:""]},s))})]}),(Me||Oe)&&e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>{Y(!1),U(!1)}})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-2",children:Cs.map(s=>e.jsxs("details",{className:"form-section p-3",children:[e.jsx("summary",{className:"cursor-pointer font-medium",children:s.name}),e.jsxs("div",{className:"mt-2 space-y-3",children:[e.jsx("input",{className:"px-3 py-2 rounded w-full",value:s.name,onChange:a=>j(o=>o.map(t=>t.id===s.id?{...t,name:a.target.value}:t))}),e.jsx("input",{className:"px-3 py-2 rounded w-full",placeholder:"Design link",value:s.design_link||"",onChange:a=>j(o=>o.map(t=>t.id===s.id?{...t,design_link:a.target.value}:t))}),e.jsx("textarea",{className:"px-3 py-2 rounded w-full",placeholder:"Description",value:s.description||"",onChange:a=>j(o=>o.map(t=>t.id===s.id?{...t,description:a.target.value}:t))}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("select",{className:"px-3 py-2 rounded w-full dark-select",value:s.subsystem||"",onChange:a=>j(o=>o.map(t=>t.id===s.id?{...t,subsystem:a.target.value||void 0}:t)),children:[e.jsx("option",{value:"",children:"Subsystem…"}),e.jsx("option",{children:"Aero"}),e.jsx("option",{children:"Business"}),e.jsx("option",{children:"Composites"}),e.jsx("option",{children:"Controls"}),e.jsx("option",{children:"Data Acquisition"}),e.jsx("option",{children:"Electrical IC"}),e.jsx("option",{children:"Electrical EV"}),e.jsx("option",{children:"Finance"}),e.jsx("option",{children:"Frame"}),e.jsx("option",{children:"Manufacturing"}),e.jsx("option",{children:"Powertrain EV"}),e.jsx("option",{children:"Powertrain IC"}),e.jsx("option",{children:"Suspension"})]}),e.jsx("input",{type:"date",className:"px-3 py-2 rounded w-full",value:s.due_date||"",onChange:a=>j(o=>o.map(t=>t.id===s.id?{...t,due_date:a.target.value}:t))})]}),e.jsx("button",{className:"px-3 py-2 rounded bg-white/10 border border-uconn-border w-full",onClick:async()=>{await Ts(s.id,s),d("Project updated")},children:"Save Changes"})]})]},s.id))})]})]}),v==="settings"&&$(g,"settings")&&e.jsxs("div",{role:"tabpanel",className:"mt-4",children:[e.jsxs("section",{className:"space-y-2",children:[e.jsx("h2",{className:"font-semibold",children:"Global Settings"}),e.jsxs("div",{className:"form-section wide p-4 space-y-2",children:[e.jsx("label",{className:"text-sm block",children:"Rulebook PDF URL"}),e.jsx("input",{className:"px-3 py-2 rounded w-full",placeholder:"https://…/rulebook.pdf",value:m,onChange:s=>N(s.target.value)}),e.jsx("label",{className:"text-sm block",children:"Team SharePoint URL"}),e.jsx("input",{className:"px-3 py-2 rounded w-full",placeholder:"https://…sharepoint.com/sites/FSAE/…",value:E,onChange:s=>D(s.target.value)}),e.jsx("button",{onClick:ws,className:"mt-2 px-3 py-2 rounded bg-white/10 border border-uconn-border",children:"Save Settings"})]}),e.jsx(Us,{}),e.jsxs("div",{className:"form-section wide p-4 mt-4 border border-red-500/30 bg-red-500/10 rounded-xl",children:[e.jsx("h3",{className:"font-semibold text-red-200",children:"Danger zone"}),e.jsx("p",{className:"text-sm text-red-200/80",children:"This will permanently delete ALL people, projects, and tasks. This action cannot be undone."}),e.jsxs("button",{onClick:()=>{Be(""),G(!0)},className:"mt-3 inline-flex items-center gap-2 px-3 py-2 rounded border border-red-500/50 bg-red-600/20 hover:bg-red-600/30 text-red-100",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]}),"Full system reset"]})]})]}),e.jsxs("section",{className:"space-y-2 mt-6",children:[e.jsx("h2",{className:"font-semibold",children:"Seed data (Excel)"}),e.jsxs("div",{className:"form-section wide p-4 space-y-3",children:[e.jsxs("p",{className:"text-sm text-uconn-muted",children:['Provide an Excel file with sheets named "People", "Projects", and "Tasks". Columns:',e.jsx("br",{}),"People: Name, Year, Role, Skills, Discord",e.jsx("br",{}),"Projects: Name, Subsystem, Due Date (YYYY-MM-DD), Description, Design Link, Owners (comma-separated names)",e.jsx("br",{}),"Tasks: Project, Description, Status (Todo|In Progress|Complete), Assignee (name)"]}),e.jsx("input",{type:"file",accept:".xlsx,.xls,.csv",onChange:async s=>{var o;const a=(o=s.target.files)==null?void 0:o[0];if(a){oe(null),I("");try{const t=await a.arrayBuffer(),n=await b(()=>import("./xlsx-D_0l8YDs.js"),[]),i=n.read(t,{type:"array"}),l=i.Sheets.People,c=i.Sheets.Projects,u=i.Sheets.Tasks,_s=l?n.utils.sheet_to_json(l):[],Ps=c?n.utils.sheet_to_json(c):[],As=u?n.utils.sheet_to_json(u):[];oe({people:_s.map(p=>{var C,_,P,A,V;return{name:((C=p.Name)==null?void 0:C.toString())||"",year:(_=p.Year)==null?void 0:_.toString(),role:(P=p.Role)==null?void 0:P.toString(),skills:(A=p.Skills)==null?void 0:A.toString(),discord:(V=p.Discord)==null?void 0:V.toString()}}),projects:Ps.map(p=>{var C,_,P,A,V,os;return{name:((C=p.Name)==null?void 0:C.toString())||"",subsystem:(_=p.Subsystem)==null?void 0:_.toString(),due_date:(P=p["Due Date"])==null?void 0:P.toString(),description:(A=p.Description)==null?void 0:A.toString(),design_link:(V=p["Design Link"])==null?void 0:V.toString(),owners:(os=p.Owners)==null?void 0:os.toString()}}),tasks:As.map(p=>{var C,_,P,A;return{project:((C=p.Project)==null?void 0:C.toString())||"",description:((_=p.Description)==null?void 0:_.toString())||"",status:((P=p.Status)==null?void 0:P.toString())||"Todo",assignee:(A=p.Assignee)==null?void 0:A.toString()}})})}catch(t){console.error(t),I("Failed to read file")}}}}),k&&e.jsxs("div",{className:"text-sm",children:["Preview: ",k.people.length," people, ",k.projects.length," projects, ",k.tasks.length," tasks",e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx("button",{disabled:fs,className:"px-3 py-2 rounded border border-uconn-border bg-white/10 disabled:opacity-50",onClick:async()=>{var s,a;if(k){Qe(!0),I("Importing…");try{const o=new Map;for(const n of h)o.set(n.name.trim(),n.id);for(const n of k.people){const i=(s=n.name)==null?void 0:s.trim();if(i&&!o.has(i)){const l=await is({name:i,year:n.year||void 0,role:n.role||void 0,skills:(n.skills||"").split(",").map(c=>c.trim()).filter(Boolean),discord:n.discord||void 0});o.set(i,l)}}const t=new Map;for(const n of k.projects){const i=(a=n.name)==null?void 0:a.trim();if(i&&!t.has(i)){const l=(n.owners||"").split(",").map(u=>u.trim()).filter(Boolean).map(u=>o.get(u)).filter(Boolean),c=await ls({name:i,subsystem:n.subsystem||void 0,due_date:n.due_date||void 0,description:n.description||void 0,design_link:n.design_link||void 0,owner_ids:l});t.set(i,c)}}for(const n of k.tasks){const i=t.get((n.project||"").trim());if(!i)continue;const l=n.assignee?o.get(n.assignee.trim()):void 0,c=n.status==="Todo"||n.status==="In Progress"||n.status==="Complete"?n.status:"Todo";await cs({project_id:i,description:n.description||"",status:c,assignee_id:l})}x(await Q()),j(await re()),I("Import complete")}catch(o){console.error(o),I("Import failed")}finally{Qe(!1)}}},children:"Import"}),e.jsx("button",{className:"px-3 py-2 rounded border border-uconn-border bg-white/10",onClick:()=>{oe(null),I("")},children:"Clear"})]}),Xe&&e.jsx("div",{className:"mt-2 text-xs text-uconn-muted",children:Xe})]})]})]}),xs&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/70",onClick:()=>G(!1)}),e.jsxs("div",{className:"relative w-[95vw] max-w-md rounded-xl border border-white/15 bg-uconn-blue/95 shadow-2xl p-5",children:[e.jsx("h4",{className:"text-lg font-semibold mb-2",children:"Confirm full system reset"}),e.jsx("p",{className:"text-sm text-uconn-muted",children:"Enter the reset password to proceed. Contact the team lead if you don’t know it."}),e.jsxs("div",{className:"mt-3 relative",children:[e.jsx("input",{autoFocus:!0,type:Ue?"text":"password",className:"w-full px-3 py-2 pr-10 rounded border border-white/10 bg-black/20",placeholder:"Reset password",value:ee,onChange:s=>Be(s.target.value)}),e.jsx("button",{"aria-label":"Toggle password visibility",onClick:()=>js(s=>!s),className:"absolute right-1 top-1.5 h-7 w-7 inline-flex items-center justify-center rounded hover:bg-white/10",children:Ue?e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"#E5E7EB",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M17.94 17.94A10.94 10.94 0 0 1 12 20C7 20 2.73 16.11 1 12c.6-1.36 1.5-2.59 2.57-3.61M10.58 5.06A10.94 10.94 0 0 1 12 4c5 0 9.27 3.89 11 8-."})}):e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"#E5E7EB",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),e.jsx("circle",{cx:"12",cy:"12",r:"3"})]})})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>G(!1),className:"px-3 py-2 rounded border border-uconn-border bg-white/10",children:"Cancel"}),e.jsx("button",{onClick:async()=>{await vs(),G(!1)},disabled:ee!=="UCONN FORMULA SAE",className:`px-3 py-2 rounded border ${ee==="UCONN FORMULA SAE"?"border-red-500 bg-red-600/30 hover:bg-red-600/40 text-red-100":"border-white/10 bg-white/5 text-uconn-muted cursor-not-allowed"}`,children:"Permanently delete everything"})]})]})]})]}),v==="ranked"&&$(g,"ranked")&&e.jsx("div",{role:"tabpanel",className:"mt-4",children:e.jsxs("section",{className:"space-y-2",children:[e.jsx("h2",{className:"font-semibold",children:"Ranked Settings"}),e.jsxs("div",{className:"form-section wide p-5 space-y-4",children:[e.jsxs("div",{className:"grid sm:grid-cols-2 gap-3",children:[e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",className:"accent-brand-teal",checked:!!(w!=null&&w.enabled),onChange:async s=>{const a=s.target.checked;R(t=>t?{...t,enabled:a}:{enabled:a});const{setRankedSettings:o}=await b(async()=>{const{setRankedSettings:t}=await import("./index-B-YBCRUe.js").then(n=>n.J);return{setRankedSettings:t}},__vite__mapDeps([0,1]));await o({enabled:a})}}),"Enable ranked mode"]}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",className:"accent-brand-teal",checked:!!(w!=null&&w.autoApply),onChange:async s=>{const a=s.target.checked;R(t=>t?{...t,autoApply:a}:{autoApply:a});const{setRankedSettings:o}=await b(async()=>{const{setRankedSettings:t}=await import("./index-B-YBCRUe.js").then(n=>n.J);return{setRankedSettings:t}},__vite__mapDeps([0,1]));await o({autoApply:a})}}),"Auto apply hourly"]})]}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-3 -mt-2",children:[e.jsx("p",{className:"text-xs text-uconn-muted",children:"When on, the app reveals the Ranked page and point indicators. Turning it off hides ranked UI and points, but nothing is deleted."}),e.jsx("p",{className:"text-xs text-uconn-muted",children:"When on, promotions/relegations can be applied on a schedule. In this client-only build it’s a manual action or conceptual; see note below."})]}),e.jsx("div",{className:"mt-2 overflow-auto rounded border border-white/10",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-white/5",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-3 py-2 font-medium",children:"Rank"}),e.jsx("th",{className:"text-left px-3 py-2 font-medium",children:"Promote %"}),e.jsx("th",{className:"text-left px-3 py-2 font-medium",children:"Relegate %"})]})}),e.jsx("tbody",{children:["Bronze","Silver","Gold","Platinum","Diamond"].map(s=>{const a=s.toLowerCase(),o=te[a]??0,t=ae[a]??0,n=s==="Diamond",i=s==="Bronze";return e.jsxs("tr",{className:"border-t border-white/10",children:[e.jsx("td",{className:"px-3 py-2 text-xs",children:s}),e.jsx("td",{className:"px-3 py-2",children:n?e.jsx("span",{className:"text-xs text-uconn-muted",children:"N/A"}):e.jsx("input",{type:"number",min:0,max:100,value:o,onChange:async l=>{const c=Math.max(0,Math.min(100,Number(l.target.value)));Ge(u=>({...u||{},[a]:c})),q(!0)},className:"px-2 py-1 rounded w-24 bg-white/5 border border-white/10"})}),e.jsx("td",{className:"px-3 py-2",children:i?e.jsx("span",{className:"text-xs text-uconn-muted",children:"N/A"}):e.jsx("input",{type:"number",min:0,max:100,value:t,onChange:async l=>{const c=Math.max(0,Math.min(100,Number(l.target.value)));qe(u=>({...u||{},[a]:c})),q(!0)},className:"px-2 py-1 rounded w-24 bg-white/5 border border-white/10"})})]},s)})})]})}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx("button",{disabled:!bs,onClick:async()=>{try{const{setRankedSettings:s}=await b(async()=>{const{setRankedSettings:a}=await import("./index-B-YBCRUe.js").then(o=>o.J);return{setRankedSettings:a}},__vite__mapDeps([0,1]));await s({promotion_pct:te,demotion_pct:ae}),R(a=>({...a||{},promotion_pct:{...te},demotion_pct:{...ae}})),q(!1),d("Ranked settings saved")}catch(s){console.error(s),d("Save failed")}},className:"mt-2 px-3 py-2 rounded bg-white/10 border border-uconn-border text-sm disabled:opacity-50",children:"Save changes"})}),e.jsx("div",{className:"pt-4 mt-2 border-t border-white/10",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3 justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:"Manual override"}),e.jsx("p",{className:"text-xs text-uconn-muted",children:"Apply promotions and relegations immediately using the current week’s points."})]}),e.jsx("button",{disabled:Ve,onClick:()=>{We(""),W(!0)},className:"px-3 py-2 rounded bg-brand-teal/40 hover:bg-brand-teal/60 border border-uconn-border text-sm font-medium disabled:opacity-50",children:"Apply now"})]})}),e.jsxs("div",{className:"pt-4 mt-4 border-t border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Recent ranked activity"}),e.jsx("button",{className:"text-xs px-2 py-1 rounded border border-uconn-border bg-white/5",onClick:async()=>{const{fetchRecentLogs:s}=await b(async()=>{const{fetchRecentLogs:a}=await import("./index-B-YBCRUe.js").then(o=>o.J);return{fetchRecentLogs:a}},__vite__mapDeps([0,1]));se(await s(50))},children:"Refresh"})]}),e.jsxs("ul",{className:"text-sm divide-y divide-white/10 rounded border border-white/10",children:[ze.length===0&&e.jsx("li",{className:"px-3 py-2 text-uconn-muted",children:"No activity yet"}),ze.map((s,a)=>{var o,t;return e.jsxs("li",{className:"px-3 py-2 flex flex-col sm:flex-row sm:items-start gap-1 sm:gap-3 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-uconn-muted leading-snug",children:[e.jsx("span",{className:"shrink-0 sm:w-40 sm:inline block",children:new Date(s.ts||0).toLocaleString()}),e.jsx("span",{className:"font-mono text-[10px] sm:text-xs uppercase tracking-wide px-1.5 py-0.5 rounded bg-white/10 border border-white/10",children:s.type})]}),e.jsxs("span",{className:"text-sm break-words whitespace-pre-wrap leading-snug",children:[s.type==="attendance"&&e.jsxs(e.Fragment,{children:["Attendance · ",s.points," pts ",s.person_id?`→ ${((o=h.find(n=>n.id===s.person_id))==null?void 0:o.name)||s.person_id}`:""]}),s.type==="rank_change"&&e.jsxs(e.Fragment,{children:["Rank · ",((t=h.find(n=>n.id===s.person_id))==null?void 0:t.name)||s.person_id," ",s.from_rank," → ",s.to_rank]}),s.type==="task_points"&&(()=>{var i;let n=s.note;if(n){if(n.length%2===0){const l=n.length/2,c=n.slice(0,l),u=n.slice(l);c===u&&(n=c)}if((n.match(/Task complete:/g)||[]).length>1){const l=n.split("Task complete:").filter(Boolean).map(c=>c.trim());l.length>=2&&l.every(c=>c===l[0]),n="Task complete: "+l[0]}}return e.jsxs(e.Fragment,{children:["Task · ",s.points," pts ",s.person_id?`→ ${((i=h.find(l=>l.id===s.person_id))==null?void 0:i.name)||s.person_id}`:"",n?` · ${n}`:""]})})(),s.type!=="attendance"&&s.type!=="rank_change"&&(s.note||"")]})]},s.id||a)})]})]})]})]})}),gs&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/70",onClick:()=>W(!1)}),e.jsxs("div",{className:"relative w-[95vw] max-w-md rounded-xl border border-white/15 bg-uconn-blue/95 shadow-2xl p-5",children:[e.jsx("h4",{className:"text-lg font-semibold mb-2",children:"Confirm ranked apply"}),e.jsx("p",{className:"text-sm text-uconn-muted",children:"Enter the confirmation phrase to proceed."}),e.jsx("input",{autoFocus:!0,className:"mt-3 w-full px-3 py-2 rounded border border-white/10 bg-black/20",placeholder:"Enter confirmation phrase",value:ne,onChange:s=>We(s.target.value)}),e.jsxs("div",{className:"mt-4 flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>W(!1),className:"px-3 py-2 rounded border border-uconn-border bg-white/10",children:"Cancel"}),e.jsx("button",{disabled:ne!=="UCONN FORMULA SAE"||Ve,className:`px-3 py-2 rounded border ${ne==="UCONN FORMULA SAE"?"border-brand-teal bg-brand-teal/30 hover:bg-brand-teal/40 text-white":"border-white/10 bg-white/5 text-uconn-muted cursor-not-allowed"}`,onClick:async()=>{try{$e(!0);const[s,a,o,t]=await Promise.all([Q(),Is(),Ms(),(await b(async()=>{const{fetchAttendance:l}=await import("./index-B-YBCRUe.js").then(c=>c.J);return{fetchAttendance:l}},__vite__mapDeps([0,1]))).fetchAttendance()]),n=await Os(s,a,o,t);d(`${n} updates applied`);const{fetchRecentLogs:i}=await b(async()=>{const{fetchRecentLogs:l}=await import("./index-B-YBCRUe.js").then(c=>c.J);return{fetchRecentLogs:l}},__vite__mapDeps([0,1]));se(await i(50)),W(!1)}catch(s){console.error(s),d("Apply failed")}finally{$e(!1)}},children:"Apply"})]})]})]})]}):e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Admin"}),e.jsx("p",{className:"text-sm text-uconn-muted mt-2",children:"You must be signed in as an admin or lead to access this page."})]})}function Us(){const[M,g]=r.useState([]),[h,x]=r.useState(""),[f,j]=r.useState(!1),[y,O]=r.useState(null);r.useEffect(()=>{(async()=>{try{j(!0);const{fetchProjects:m}=await b(async()=>{const{fetchProjects:N}=await import("./index-B-YBCRUe.js").then(E=>E.J);return{fetchProjects:N}},__vite__mapDeps([0,1]));g(await m())}finally{j(!1)}})()},[]);const w=M.filter(m=>m.archived),R=w.filter(m=>m.name.toLowerCase().includes(h.toLowerCase()));return e.jsxs("div",{className:"form-section wide p-4 mt-6 space-y-3",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Retrieve archived project"}),e.jsx("p",{className:"text-xs text-uconn-muted",children:"Restore a previously archived project (brings it back into lists)."}),w.length===0?e.jsx("p",{className:"text-xs text-uconn-muted italic",children:"No archived projects yet."}):e.jsx("input",{className:"px-3 py-2 rounded w-full",placeholder:"Search archived projects…",value:h,onChange:m=>x(m.target.value)}),f&&e.jsx("div",{className:"text-xs text-uconn-muted",children:"Loading…"}),w.length>0&&e.jsxs("ul",{className:"space-y-2 max-h-64 overflow-auto pr-1",children:[R.slice(0,25).map(m=>e.jsxs("li",{className:"flex items-center gap-3 text-sm px-2 py-2 rounded bg-white/5 border border-white/10",children:[e.jsx("span",{className:"truncate flex-1",children:m.name}),e.jsx("button",{disabled:y===m.id,onClick:async()=>{var N,E;try{O(m.id);const{updateProject:D}=await b(async()=>{const{updateProject:T}=await import("./index-B-YBCRUe.js").then(S=>S.J);return{updateProject:T}},__vite__mapDeps([0,1]));await D(m.id,{archived:!1}),g(T=>T.map(S=>S.id===m.id?{...S,archived:!1}:S)),(N=window.alert)==null||N.call(window,"Project restored")}catch(D){console.error(D),(E=window.alert)==null||E.call(window,"Restore failed")}finally{O(null)}},className:"px-3 py-1.5 rounded text-xs font-medium border border-brand-teal/50 bg-brand-teal/20 hover:bg-brand-teal/30 disabled:opacity-50",children:"Restore"})]},m.id)),R.length===0&&!f&&e.jsx("li",{className:"text-xs text-uconn-muted px-2 py-1",children:"No archived projects match."})]})]})}export{Ys as default};
