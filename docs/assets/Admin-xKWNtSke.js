import{u as ie,A as ce,r as o,j as e}from"./index-DOL89XtO.js";import{fetchPeople as X,fetchProjects as Z,fetchSettings as $,updatePerson as de,updateProject as ue,setSettings as pe,addPerson as me,addProject as he,addTask as xe}from"./firestore-CBdVKXmS.js";function ve(){const d=ie(),ee=(d==null?void 0:d.uid)===ce,[u,r]=o.useState([]),[g,i]=o.useState([]),[c,v]=o.useState(null),[f,p]=o.useState(""),[N,m]=o.useState(""),[b,y]=o.useState(""),[S,w]=o.useState("Senior"),[C,P]=o.useState(""),[k,D]=o.useState(""),[A,_]=o.useState(""),[h,T]=o.useState(""),[E,F]=o.useState([]),[I,R]=o.useState(""),[U,O]=o.useState(""),[L,B]=o.useState(""),[G,V]=o.useState(""),[x,se]=o.useState(""),[j,q]=o.useState(""),[M,Y]=o.useState(""),[J,z]=o.useState("In Progress"),[H,K]=o.useState("");o.useEffect(()=>{(async()=>{const[s,n,t]=await Promise.all([X(),Z(),$()]);r(s),i(n),v(t),p((t==null?void 0:t.rulebook_url)||""),m((t==null?void 0:t.sharepoint_url)||"")})()},[]),o.useEffect(()=>{p((c==null?void 0:c.rulebook_url)||""),m((c==null?void 0:c.sharepoint_url)||"")},[c]);const ae=s=>F(n=>n.includes(s)?n.filter(t=>t!==s):[...n,s]),[Q,W]=o.useState("");function l(s){W(s),setTimeout(()=>W(""),3e3)}async function te(){try{await pe({rulebook_url:f.trim()||void 0,sharepoint_url:N.trim()||void 0}),v(await $()),l("Settings saved")}catch(s){console.error(s),l("Save failed")}}async function ne(){try{const s=await me({name:b.trim(),year:S,role:k.trim()||void 0,skills:C.split(",").map(n=>n.trim()).filter(Boolean),discord:A.trim()||void 0});r(await X()),y(""),w("Senior"),D(""),P(""),_(""),l("Person saved")}catch(s){console.error(s),l("Save failed")}}async function oe(){if(!h.trim())return alert("Give the project a name");try{const s=await he({name:h.trim(),owner_ids:E,design_link:I.trim()||void 0,description:U.trim()||void 0,due_date:L||void 0,subsystem:G||void 0});i(await Z()),T(""),F([]),R(""),O(""),B(""),V(""),l("Project saved")}catch(s){console.error(s),l("Save failed")}}async function le(){if(!j)return alert("Choose a project");try{const s=await xe({project_id:j,description:M.trim(),status:J,assignee_id:H||void 0});q(""),Y(""),z("In Progress"),K(""),l("Task saved")}catch(s){console.error(s),l("Save failed")}}return ee?e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-2xl font-semibold mb-4",children:"Admin"}),Q&&e.jsx("div",{className:"fixed bottom-4 right-4 z-50 px-4 py-2 rounded bg-brand-teal text-black shadow-lg text-sm font-medium animate-fade-in",children:Q}),e.jsxs("section",{className:"mb-6 space-y-2",children:[e.jsx("h2",{className:"font-semibold",children:"Global Settings"}),e.jsxs("div",{className:"form-section p-4 space-y-2",children:[e.jsx("label",{className:"text-sm block",children:"Rulebook PDF URL"}),e.jsx("input",{className:"px-3 py-2 rounded w-full",placeholder:"https://…/rulebook.pdf",value:f,onChange:s=>p(s.target.value)}),e.jsx("label",{className:"text-sm block mt-2",children:"Team SharePoint URL"}),e.jsx("input",{className:"px-3 py-2 rounded w-full",placeholder:"https://…sharepoint.com/sites/FSAE/…",value:N,onChange:s=>m(s.target.value)}),e.jsx("button",{onClick:te,className:"mt-2 px-3 py-2 rounded bg-white/10 border border-uconn-border",children:"Save Settings"})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsxs("section",{className:"space-y-2",children:[e.jsx("h2",{className:"font-semibold",children:"Create Person"}),e.jsxs("div",{className:"form-section p-4 space-y-2",children:[e.jsx("input",{className:"px-3 py-2 rounded w-full",placeholder:"Name",value:b,onChange:s=>y(s.target.value)}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{className:"px-3 py-2 rounded dark-select",value:S,onChange:s=>w(s.target.value),children:[e.jsx("option",{children:"Freshman"}),e.jsx("option",{children:"Sophomore"}),e.jsx("option",{children:"Junior"}),e.jsx("option",{children:"Senior"}),e.jsx("option",{children:"Graduate"})]}),e.jsx("input",{className:"px-3 py-2 rounded flex-1",placeholder:"Role (optional)",value:k,onChange:s=>D(s.target.value)})]}),e.jsx("input",{className:"px-3 py-2 rounded w-full",placeholder:"Skills (comma-separated)",value:C,onChange:s=>P(s.target.value)}),e.jsx("input",{className:"px-3 py-2 rounded w-full",placeholder:"Discord (e.g., username)",value:A,onChange:s=>_(s.target.value)}),e.jsx("button",{onClick:ne,className:"px-3 py-2 rounded bg-white/10 border border-uconn-border",children:"Save Person"})]}),e.jsx("h2",{className:"font-semibold mt-6",children:"Create Task"}),e.jsxs("div",{className:"form-section p-4 space-y-2",children:[e.jsxs("select",{className:"px-3 py-2 rounded w-full dark-select",value:j,onChange:s=>q(s.target.value),children:[e.jsx("option",{value:"",children:"Select project…"}),g.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx("input",{className:"px-3 py-2 rounded w-full",placeholder:"Task description",value:M,onChange:s=>Y(s.target.value)}),e.jsxs("select",{className:"px-3 py-2 rounded w-full dark-select",value:H,onChange:s=>K(s.target.value),children:[e.jsx("option",{value:"",children:"Assign to…"}),u.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsxs("select",{className:"px-3 py-2 rounded dark-select",value:J,onChange:s=>z(s.target.value),children:[e.jsx("option",{children:"Todo"}),e.jsx("option",{children:"In Progress"}),e.jsx("option",{children:"Complete"})]}),e.jsx("button",{onClick:le,className:"px-3 py-2 rounded bg-white/10 border border-uconn-border",children:"Save Task"})]})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsx("h2",{className:"font-semibold",children:"Create Project & Assign Owners"}),e.jsxs("div",{className:"form-section p-4 space-y-2",children:[e.jsx("input",{className:"px-3 py-2 rounded w-full",placeholder:"Project name",value:h,onChange:s=>T(s.target.value)}),e.jsx("input",{className:"px-3 py-2 rounded w-full",placeholder:"Design link (optional)",value:I,onChange:s=>R(s.target.value)}),e.jsx("textarea",{className:"px-3 py-2 rounded w-full",placeholder:"Project description (optional)",value:U,onChange:s=>O(s.target.value)}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("select",{className:"px-3 py-2 rounded w-full dark-select",value:G,onChange:s=>V(s.target.value),children:[e.jsx("option",{value:"",children:"Select subsystem…"}),e.jsx("option",{children:"Aero"}),e.jsx("option",{children:"Business"}),e.jsx("option",{children:"Composites"}),e.jsx("option",{children:"Controls"}),e.jsx("option",{children:"Data Acquisition"}),e.jsx("option",{children:"Electrical IC"}),e.jsx("option",{children:"Electrical EV"}),e.jsx("option",{children:"Finance"}),e.jsx("option",{children:"Frame"}),e.jsx("option",{children:"Manufacturing"}),e.jsx("option",{children:"Powertrain EV"}),e.jsx("option",{children:"Powertrain IC"}),e.jsx("option",{children:"Suspension"})]}),e.jsx("input",{type:"date",className:"px-3 py-2 rounded w-full",value:L,onChange:s=>B(s.target.value)})]}),e.jsx("div",{className:"text-sm text-uconn-muted",children:"Owners"}),e.jsx("input",{className:"px-3 py-2 rounded w-full mb-1",placeholder:"Search people…",value:x,onChange:s=>se(s.target.value)}),e.jsx("div",{className:"grid sm:grid-cols-2 gap-2 max-h-48 overflow-auto border border-uconn-border rounded p-2",children:u.filter(s=>{if(!x.trim())return!0;const n=x.toLowerCase();return s.name.toLowerCase().includes(n)||(s.skills||[]).some(t=>t.toLowerCase().includes(n))}).map(s=>{var t;const n=E.includes(s.id);return e.jsxs("button",{onClick:()=>ae(s.id),className:"text-left px-2 py-1 rounded border "+(n?"bg-white/20":""),children:[e.jsx("div",{className:"font-medium text-sm",children:s.name}),e.jsx("div",{className:"text-xs text-uconn-muted",children:(t=s.skills)==null?void 0:t.join(", ")})]},s.id)})}),e.jsx("button",{onClick:oe,className:"px-3 py-2 rounded bg-white/10 border border-uconn-border",children:"Save Project"})]})]}),e.jsxs("section",{className:"mt-8",children:[e.jsx("h2",{className:"font-semibold mb-2",children:"People (click to edit)"}),e.jsx("div",{className:"space-y-2",children:u.map(s=>e.jsxs("details",{className:"form-section p-3",children:[e.jsx("summary",{className:"cursor-pointer font-medium",children:s.name}),e.jsxs("div",{className:"mt-2 grid sm:grid-cols-2 gap-2",children:[e.jsx("input",{className:"px-3 py-2 rounded",value:s.name,onChange:n=>r(t=>t.map(a=>a.id===s.id?{...a,name:n.target.value}:a))}),e.jsxs("select",{className:"px-3 py-2 rounded dark-select",value:s.year||"Senior",onChange:n=>r(t=>t.map(a=>a.id===s.id?{...a,year:n.target.value}:a)),children:[e.jsx("option",{children:"Freshman"}),e.jsx("option",{children:"Sophomore"}),e.jsx("option",{children:"Junior"}),e.jsx("option",{children:"Senior"}),e.jsx("option",{children:"Graduate"})]}),e.jsx("input",{className:"px-3 py-2 rounded",placeholder:"Role",value:s.role||"",onChange:n=>r(t=>t.map(a=>a.id===s.id?{...a,role:n.target.value}:a))}),e.jsx("input",{className:"px-3 py-2 rounded",placeholder:"Discord",value:s.discord||"",onChange:n=>r(t=>t.map(a=>a.id===s.id?{...a,discord:n.target.value}:a))}),e.jsx("input",{className:"px-3 py-2 rounded sm:col-span-2",placeholder:"Skills (comma-separated)",value:(s.skills||[]).join(", "),onChange:n=>r(t=>t.map(a=>a.id===s.id?{...a,skills:n.target.value.split(",").map(re=>re.trim()).filter(Boolean)}:a))}),e.jsx("button",{className:"px-3 py-2 rounded bg-white/10 border border-uconn-border sm:col-span-2",onClick:async()=>{await de(s.id,s),l("Person updated")},children:"Save Changes"})]})]},s.id))})]}),e.jsxs("section",{className:"mt-8",children:[e.jsx("h2",{className:"font-semibold mb-2",children:"Projects (click to edit)"}),e.jsx("div",{className:"space-y-2",children:g.map(s=>e.jsxs("details",{className:"form-section p-3",children:[e.jsx("summary",{className:"cursor-pointer font-medium",children:s.name}),e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsx("input",{className:"px-3 py-2 rounded w-full",value:s.name,onChange:n=>i(t=>t.map(a=>a.id===s.id?{...a,name:n.target.value}:a))}),e.jsx("input",{className:"px-3 py-2 rounded w-full",placeholder:"Design link",value:s.design_link||"",onChange:n=>i(t=>t.map(a=>a.id===s.id?{...a,design_link:n.target.value}:a))}),e.jsx("textarea",{className:"px-3 py-2 rounded w-full",placeholder:"Description",value:s.description||"",onChange:n=>i(t=>t.map(a=>a.id===s.id?{...a,description:n.target.value}:a))}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("select",{className:"px-3 py-2 rounded w-full dark-select",value:s.subsystem||"",onChange:n=>i(t=>t.map(a=>a.id===s.id?{...a,subsystem:n.target.value||void 0}:a)),children:[e.jsx("option",{value:"",children:"Subsystem…"}),e.jsx("option",{children:"Aero"}),e.jsx("option",{children:"Business"}),e.jsx("option",{children:"Composites"}),e.jsx("option",{children:"Controls"}),e.jsx("option",{children:"Data Acquisition"}),e.jsx("option",{children:"Electrical IC"}),e.jsx("option",{children:"Electrical EV"}),e.jsx("option",{children:"Finance"}),e.jsx("option",{children:"Frame"}),e.jsx("option",{children:"Manufacturing"}),e.jsx("option",{children:"Powertrain EV"}),e.jsx("option",{children:"Powertrain IC"}),e.jsx("option",{children:"Suspension"})]}),e.jsx("input",{type:"date",className:"px-3 py-2 rounded w-full",value:s.due_date||"",onChange:n=>i(t=>t.map(a=>a.id===s.id?{...a,due_date:n.target.value}:a))})]}),e.jsx("button",{className:"px-3 py-2 rounded bg-white/10 border border-uconn-border w-full",onClick:async()=>{await ue(s.id,s),l("Project updated")},children:"Save Changes"})]})]},s.id))})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Admin"}),e.jsx("p",{className:"text-sm text-uconn-muted mt-2",children:"You must be signed in as admin to access this page."})]})}export{ve as default};
