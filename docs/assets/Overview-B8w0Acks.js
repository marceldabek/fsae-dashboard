import{j as e,r as o}from"./vendor-react-pWhzumim.js";import{u as A,f as H,a as V,b as I,c as R}from"./index-DnDrctQO.js";import{L as U}from"./vendor-react-router-vBeDBGet.js";import{P as B}from"./ProgressBar-B8WOlXHs.js";import"./vendor-9xdiniD5.js";import"./vendor-firebase-DtYdhfHX.js";function F({href:l,children:p}){return l?e.jsx("a",{href:l,target:"_blank",rel:"noreferrer",className:"inline-flex items-center px-3 py-1.5 rounded bg-white/10 hover:bg-white/20 transition",children:p}):null}function K({project:l,owners:p,tasks:a,compact:h=!1}){const[f]=A(),x=a.length,d=a.filter(r=>r.status==="Complete").length,N=x>0?d/x*100:0,u=`${Math.round(N)}%`,v=x===0?"none":d===0?"todo":d===x?"done":"progress",y=v==="done"?"bg-green-500":v==="progress"?"bg-yellow-400":x===0?"bg-white/30":"bg-red-500",M=a.reduce((r,m)=>r+(m.ranked_points??(m.status==="Complete"?35:10)),0),k=h?"rounded-xl bg-white/5 border border-white/10 p-2.5 space-y-2":"rounded-2xl bg-white/5 border border-white/10 p-3 space-y-2.5",b=h?"text-base font-semibold hover:underline":"text-lg font-semibold hover:underline",S=h?"h-2":"h-2.5";return e.jsxs("div",{className:k,children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${y}`,"aria-hidden":!0}),e.jsx(U,{to:`/project/${l.id}`,className:`${b} truncate`,title:l.name,children:l.name})]}),l.design_link&&e.jsx("div",{className:"flex gap-2 shrink-0",children:h?e.jsx("a",{href:l.design_link,target:"_blank",rel:"noreferrer",className:"inline-flex items-center h-7 px-2 rounded bg-brand-blue/40 hover:bg-brand-blue/60 text-[11px] font-medium",children:"Docs"}):e.jsx(F,{href:l.design_link,children:"Design Docs"})})]}),l.subsystem&&e.jsx("div",{className:"text-[10px] uppercase tracking-wide font-medium text-brand-teal/70",children:l.subsystem}),e.jsxs("div",{className:"flex items-center justify-between gap-2 text-[11px] text-uconn-muted",children:[e.jsxs("span",{className:"truncate",children:["Owners: ",p.map(r=>r.name).join(", ")||"—"]}),l.due_date&&(()=>{let r=null;const m=l.due_date,C=m.match(/(\d{4})[\/-]?(\d{2})[\/-]?(\d{2})/);if(C){const[,g,P,j]=C;r=new Date(Number(g),Number(P)-1,Number(j))}else isNaN(Date.parse(m))||(r=new Date(m));if(r){const g=r.toLocaleString("en-US",{weekday:h?"short":"long"}),P=r.toLocaleString("en-US",{month:h?"short":"long"}),j=r.getDate(),_=i=>i===1||i===21||i===31?"st":i===2||i===22?"nd":i===3||i===23?"rd":"th";return e.jsxs("span",{className:"whitespace-nowrap ml-2",children:["Due ",g," ",P," ",j,_(j)]})}return null})()]}),e.jsxs("div",{className:"flex items-center justify-between gap-2 mt-1",children:[e.jsx("div",{className:"text-[11px] font-semibold",children:u}),e.jsxs("div",{className:"text-[10px] text-uconn-muted flex items-center gap-2",children:[e.jsx("span",{children:x>0?`${d}/${x} tasks`:"No tasks"}),f&&e.jsx("span",{className:"opacity-80",children:"·"}),f&&e.jsxs("span",{className:"font-semibold text-[10px]",children:["Σ +",M]})]})]}),e.jsx(B,{value:N,heightClass:S})]})}function q({className:l="w-5 h-5 text-yellow-500 inline ml-1"}){return e.jsx("svg",{className:l,fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M6 2a1 1 0 00-1 1v2a1 1 0 001 1h8a1 1 0 001-1V3a1 1 0 00-1-1H6zm8 4H6v1a6 6 0 005 5.92V15H9a1 1 0 000 2h2a1 1 0 000-2h-2v-2.08A6 6 0 0014 7V6z"})})}function T({label:l,value:p}){return e.jsxs("div",{className:"rounded-xl bg-white/5 border border-white/10 p-3 text-center flex flex-col items-center justify-center min-w-0",children:[e.jsx("div",{className:"text-xl font-semibold leading-tight",children:p}),e.jsx("div",{className:"text-[10px] sm:text-[11px] mt-1 tracking-wide text-uconn-muted uppercase whitespace-nowrap overflow-hidden text-ellipsis leading-snug",title:l,children:l})]})}function ee(){const[l,p]=o.useState([]),[a,h]=o.useState([]),[f,x]=o.useState([]),[d,N]=o.useState([]),[u,v]=o.useState("subsystem"),[y,M]=o.useState("asc"),[k,b]=o.useState(!1),[S,r]=o.useState(!1);o.useEffect(()=>{(async()=>{const[s,t,n]=await Promise.all([H(),V(),I()]);p(s),h(t),x(n)})()},[]);const m=f.length,C=f.filter(s=>s.status==="Complete").length,g=m?Math.round(C/m*100):0;[...o.useMemo(()=>{const s=new Map;for(const t of a)for(const n of t.owner_ids||[])s.set(n,(s.get(n)||0)+1);return s},[a]).entries()].sort((s,t)=>t[1]-s[1]).slice(0,5).map(([s,t])=>{var n;return{name:((n=l.find(c=>c.id===s))==null?void 0:n.name)||s,count:t}});const j=l.map(s=>{const t=f.filter(n=>n.assignee_id===s.id&&n.status==="Complete").length;return{...s,completed:t}}).sort((s,t)=>t.completed-s.completed).slice(0,3),_=new Map(l.map(s=>[s.id,s])),i=new Map;for(const s of f){const t=i.get(s.project_id)??[];t.push(s),i.set(s.project_id,t)}const D=s=>{const t=i.get(s.id)??[];return t.length?t.filter(c=>c.status==="Complete").length/t.length:0};R();const L=o.useMemo(()=>{const s=new Set;for(const t of a)t.subsystem&&s.add(t.subsystem);return Array.from(s).sort()},[a]),z=o.useMemo(()=>{const s=new Map;for(const t of a)t.subsystem&&s.set(t.subsystem,(s.get(t.subsystem)||0)+1);return s},[a]),O=[...d.length?a.filter(s=>s.subsystem&&d.includes(s.subsystem)):a].sort((s,t)=>{let n=0;if(u==="name")n=s.name.localeCompare(t.name);else if(u==="due"){const c=s.due_date,w=t.due_date;c&&w?n=c.localeCompare(w):c&&!w?n=-1:!c&&w?n=1:n=0}else u==="progress"?n=D(s)-D(t):n=(s.subsystem||"").localeCompare(t.subsystem||"")||s.name.localeCompare(t.name);return y==="asc"?n:-n}),$=s=>s==="name"?"Name":s==="due"?"Due date":s==="progress"?"Progress":"Subsystem",E=y==="asc"?"↑":"↓";return o.useEffect(()=>{const s=t=>{t.key==="Escape"&&(b(!1),r(!1))};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[]),e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-2xl font-semibold mb-4",children:"Team Overview"}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2 mb-8",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-4",children:[e.jsx(T,{label:"Total People",value:l.length}),e.jsx(T,{label:"Total Projects",value:a.length}),e.jsx(T,{label:"Total Tasks",value:m})]}),e.jsxs("div",{className:"rounded-xl bg-white/5 border border-white/10 p-4 pb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-[10px] sm:text-[11px] tracking-wide text-uconn-muted uppercase",children:"Total Task Completion"}),e.jsxs("div",{className:"text-xl font-semibold leading-tight",children:[g,"%"]})]}),e.jsx(B,{value:g,heightClass:"h-3"})]})]}),e.jsx("div",{className:"min-w-0",children:e.jsxs("div",{className:"rounded-2xl bg-white/5 border border-white/10 p-4",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Leaderboard"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-[320px] w-full text-xs sm:text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-10 py-2 px-2 text-center text-uconn-muted font-semibold",children:"#"}),e.jsx("th",{className:"py-2 px-2 text-left text-uconn-muted font-semibold",children:"Name"}),e.jsx("th",{className:"w-28 py-2 px-2 text-center text-uconn-muted font-semibold",children:"Completed"})]})}),e.jsx("tbody",{children:j.map((s,t)=>e.jsxs("tr",{className:t===0?"bg-yellow-100/40":"",children:[e.jsx("td",{className:"py-2 px-2 text-center",children:t+1}),e.jsx("td",{className:"py-2 px-2",children:e.jsxs("div",{className:"truncate max-w-[180px] sm:max-w-[260px] flex items-center gap-1",children:[s.name,t===0&&e.jsx(q,{})]})}),e.jsx("td",{className:"py-2 px-2 text-center",children:s.completed})]},s.id))})]})})]})})]}),e.jsx("h2",{className:"text-lg font-semibold mt-6 mb-2",children:"Projects"}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-uconn-muted mb-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-red-500"})," Todo"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-yellow-400"})," In Progress"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500"})," Complete"]})]}),e.jsxs("div",{className:"relative flex flex-wrap items-center gap-2 mb-3",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>{b(s=>!s),r(!1)},className:"px-3 py-1.5 rounded-md text-xs font-medium border border-white/10 bg-white/5 hover:bg-white/10",children:["Subsystems: ",e.jsx("span",{className:"font-semibold",children:d.length?`${d.length} selected`:"All"})]}),e.jsxs("div",{className:`absolute z-20 mt-1 w-64 rounded-md border border-white/10 bg-uconn-blue/95 shadow-xl overflow-hidden transition transform origin-top ${k?"opacity-100 scale-100":"opacity-0 scale-95 pointer-events-none"}`,children:[e.jsx("div",{className:"px-3 py-2 border-b border-white/10",children:e.jsx("button",{className:"w-full px-3 py-2 rounded-md text-xs sm:text-sm font-semibold bg-red-500/15 hover:bg-red-500/25 text-red-200 focus:outline-none focus-visible:outline-none",onClick:()=>N([]),children:"Clear selection"})}),e.jsxs("div",{className:"max-h-60 overflow-auto p-1",children:[L.length===0&&e.jsx("div",{className:"px-3 py-2 text-xs text-uconn-muted",children:"No subsystems"}),L.map(s=>{const t=d.includes(s),n=z.get(s)??0;return e.jsxs("label",{className:"flex items-center gap-2 px-2 py-1.5 text-xs rounded hover:bg-white/10 cursor-pointer focus:outline-none focus-visible:outline-none",children:[e.jsx("input",{type:"checkbox",className:"accent-brand-teal focus:outline-none focus:ring-0 focus-visible:outline-none focus-visible:ring-0",checked:t,onChange:()=>{N(c=>t?c.filter(w=>w!==s):[...c,s])}}),e.jsx("span",{className:"truncate",children:s}),e.jsx("span",{className:"ml-auto inline-flex items-center justify-center rounded-full bg-white/10 px-2 py-0.5 text-[10px]",children:n})]},s)})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>{r(s=>!s),b(!1)},className:"px-3 py-1.5 rounded-md text-xs font-medium border border-white/10 bg-white/5 hover:bg-white/10",children:["Sort: ",e.jsxs("span",{className:"font-semibold",children:[$(u)," ",E]})]}),e.jsx("div",{className:`absolute z-20 mt-1 w-48 rounded-md border border-white/10 bg-uconn-blue/95 shadow-xl overflow-hidden transition transform origin-top ${S?"opacity-100 scale-100":"opacity-0 scale-95 pointer-events-none"}`,children:["subsystem","name","due","progress"].map(s=>e.jsxs("button",{className:`w-full text-left px-3 py-2 text-xs hover:bg-white/10 ${u===s?"bg-white/10":""}`,onClick:()=>{u===s?M(t=>t==="asc"?"desc":"asc"):v(s),r(!1)},children:[$(s)," ",u===s?E:""]},s))})]}),(k||S)&&e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>{b(!1),r(!1)}})]}),e.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-2",children:O.map(s=>{var t;return e.jsx(K,{project:s,owners:((t=s.owner_ids)==null?void 0:t.map(n=>_.get(n)).filter(Boolean))??[],tasks:i.get(s.id)??[],compact:!0},s.id)})})]})}export{ee as default};
