import{j as e,r as c,u as Te,L as _e,f as Ae,a as ne,b as $e,c as Pe,d as Ee,e as Fe,R as We}from"./index-B3EZ4WWh.js";import{P as he}from"./ProgressBar-CqBaRjKV.js";import{c as $}from"./cx-EEdd6MRH.js";import{R as re,A as ae,X as oe,Y as ie,C as le,T as ce,a as de}from"./AreaChart-DsmMzEAA.js";import{P as Re}from"./ProjectCreateModal-BHdUK1l9.js";import"./clsx-B-dksMZM.js";import"./bundle-mjs-0JNfDbnS.js";import"./PersonSelectPopover-DIl-1gOa.js";function Ie({href:n,children:r}){return n?e.jsx("a",{href:n,target:"_blank",rel:"noreferrer",className:"inline-flex items-center px-3 py-1.5 rounded bg-card/80 hover:bg-card transition",children:r}):null}function Oe(...n){return n.filter(Boolean).join(" ")}function Be({className:n,...r}){return e.jsx("div",{className:Oe("animate-pulse rounded-md bg-muted",n),...r})}const pe=({size:n=24,color:r="currentColor",...a})=>c.createElement("svg",{viewBox:"0 0 24 24",width:n,height:n,stroke:r,strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",...a},c.createElement("path",{d:"M20 21c0-1.396 0-2.093-.172-2.661a4 4 0 0 0-2.667-2.667c-.568-.172-1.265-.172-2.661-.172h-5c-1.396 0-2.093 0-2.661.172a4 4 0 0 0-2.667 2.667C4 18.907 4 19.604 4 21M16.5 7.5a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0Z"}));pe.displayName="User01";const Xe={xs:"size-1.5",sm:"size-2",md:"size-2.5",lg:"size-3",xl:"size-3.5","2xl":"size-4","3xl":"size-4.5","4xl":"size-5"},Ge=({size:n,status:r,className:a})=>e.jsx("span",{className:$("absolute right-0 bottom-0 rounded-full ring-[1.5px] ring-bg-primary",r==="online"?"bg-fg-success-secondary":"bg-fg-disabled_subtle",Xe[n],a)}),He={xs:{root:"size-2.5",tick:"size-[4.38px"},sm:{root:"size-3",tick:"size-[5.25px]"},md:{root:"size-3.5",tick:"size-[6.13px]"},lg:{root:"size-4",tick:"size-[7px]"},xl:{root:"size-4.5",tick:"size-[7.88px]"},"2xl":{root:"size-5",tick:"size-[8.75px]"},"3xl":{root:"size-6",tick:"size-[10.5px]"},"4xl":{root:"size-8",tick:"size-[14px]"}},qe=({size:n,className:r})=>e.jsxs("svg",{"data-verified":!0,className:$("z-10 text-utility-blue-500",He[n].root,r),viewBox:"0 0 10 10",fill:"none",children:[e.jsx("path",{d:"M7.72237 1.77098C7.81734 2.00068 7.99965 2.18326 8.2292 2.27858L9.03413 2.61199C9.26384 2.70714 9.44635 2.88965 9.5415 3.11936C9.63665 3.34908 9.63665 3.60718 9.5415 3.83689L9.20833 4.64125C9.11313 4.87106 9.113 5.12943 9.20863 5.35913L9.54122 6.16325C9.58839 6.27702 9.61268 6.39897 9.6127 6.52214C9.61272 6.6453 9.58847 6.76726 9.54134 6.88105C9.4942 6.99484 9.42511 7.09823 9.33801 7.18531C9.2509 7.27238 9.14749 7.34144 9.03369 7.38854L8.22934 7.72171C7.99964 7.81669 7.81706 7.99899 7.72174 8.22855L7.38833 9.03348C7.29318 9.26319 7.11067 9.4457 6.88096 9.54085C6.65124 9.636 6.39314 9.636 6.16343 9.54085L5.35907 9.20767C5.12935 9.11276 4.87134 9.11295 4.64177 9.20821L3.83684 9.54115C3.60725 9.63608 3.34937 9.636 3.11984 9.54092C2.89032 9.44585 2.70791 9.26356 2.6127 9.03409L2.27918 8.22892C2.18421 7.99923 2.0019 7.81665 1.77235 7.72133L0.967421 7.38792C0.737807 7.29281 0.555355 7.11041 0.460169 6.88083C0.364983 6.65125 0.364854 6.39327 0.45981 6.16359L0.792984 5.35924C0.8879 5.12952 0.887707 4.87151 0.792445 4.64193L0.459749 3.83642C0.41258 3.72265 0.388291 3.60069 0.388272 3.47753C0.388252 3.35436 0.412501 3.2324 0.459634 3.11861C0.506767 3.00482 0.57586 2.90144 0.662965 2.81436C0.75007 2.72728 0.853479 2.65822 0.967283 2.61113L1.77164 2.27795C2.00113 2.18306 2.1836 2.00099 2.27899 1.7717L2.6124 0.966768C2.70755 0.737054 2.89006 0.554547 3.11978 0.459397C3.34949 0.364246 3.60759 0.364246 3.83731 0.459397L4.64166 0.792571C4.87138 0.887487 5.12939 0.887293 5.35897 0.792031L6.16424 0.459913C6.39392 0.364816 6.65197 0.364836 6.88164 0.459968C7.11131 0.555099 7.29379 0.737554 7.38895 0.967208L7.72247 1.77238L7.72237 1.77098Z",className:"fill-current"}),e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.95829 3.68932C7.02509 3.58439 7.04747 3.45723 7.02051 3.3358C6.99356 3.21437 6.91946 3.10862 6.81454 3.04182C6.70961 2.97502 6.58245 2.95264 6.46102 2.97959C6.33959 3.00655 6.23384 3.08064 6.16704 3.18557L4.33141 6.06995L3.49141 5.01995C3.41375 4.92281 3.30069 4.8605 3.17709 4.84673C3.05349 4.83296 2.92949 4.86885 2.83235 4.94651C2.73522 5.02417 2.67291 5.13723 2.65914 5.26083C2.64536 5.38443 2.68125 5.50843 2.75891 5.60557L4.00891 7.16807C4.0555 7.22638 4.11533 7.27271 4.18344 7.30323C4.25154 7.33375 4.32595 7.34757 4.40047 7.34353C4.47499 7.3395 4.54747 7.31773 4.61188 7.28004C4.67629 7.24234 4.73077 7.18981 4.77079 7.12682L6.95829 3.68932Z",fill:"white"})]}),O={xxs:{root:"size-4 outline-[0.5px] -outline-offset-[0.5px]",initials:"text-xs font-semibold",icon:"size-3"},xs:{root:"size-6 outline-[0.5px] -outline-offset-[0.5px]",initials:"text-xs font-semibold",icon:"size-4"},sm:{root:"size-8 outline-[0.75px] -outline-offset-[0.75px]",initials:"text-sm font-semibold",icon:"size-5"},md:{root:"size-10 outline-1 -outline-offset-1",initials:"text-md font-semibold",icon:"size-6"},lg:{root:"size-12 outline-1 -outline-offset-1",initials:"text-lg font-semibold",icon:"size-7"},xl:{root:"size-14 outline-1 -outline-offset-1",initials:"text-xl font-semibold",icon:"size-8"},"2xl":{root:"size-16 outline-1 -outline-offset-1",initials:"text-display-xs font-semibold",icon:"size-8"}},ue=({contrastBorder:n=!0,size:r="md",src:a,alt:g,initials:b,placeholder:k,placeholderIcon:m,badge:j,status:y,verified:v,focusable:u=!1,className:x})=>{const[h,D]=c.useState(!1),L=()=>a&&!h?e.jsx("img",{"data-avatar-img":!0,className:"size-full rounded-full object-cover",src:a,alt:g,onError:()=>D(!0)}):b?e.jsx("span",{className:$("text-quaternary",O[r].initials),children:b}):m?e.jsx(m,{className:$("text-fg-quaternary",O[r].icon)}):k||e.jsx(pe,{className:$("text-fg-quaternary",O[r].icon)}),l=()=>y?e.jsx(Ge,{status:y,size:r==="xxs"?"xs":r}):v?e.jsx(qe,{size:r==="xxs"?"xs":r,className:$("absolute right-0 bottom-0",(r==="xxs"||r==="xs")&&"-right-px -bottom-px")}):j;return e.jsxs("div",{"data-avatar":!0,className:$("relative inline-flex shrink-0 items-center justify-center rounded-full bg-avatar-bg outline-transparent",u&&"group-outline-focus-ring group-focus-visible:outline-2 group-focus-visible:outline-offset-2",n&&"outline outline-avatar-contrast-border",O[r].root,x),children:[L(),l()]})};function Ue({project:n,owners:r,tasks:a,compact:g=!1}){function b(l){return l===1?.5:l===3?1:l===10?3:l===6?2:l===15?5:l===40?10:l===65?15:l===98?20:l===150?25:l===200?30:Math.max(0,Math.round(l/4))}const k=Math.round(a.reduce((l,w)=>l+(typeof w.ranked_points=="number"?b(w.ranked_points):2),0)),[m]=Te(),j=a.length,y=a.filter(l=>l.status==="Complete").length,v=j>0?y/j*100:0,u=`${Math.round(v)}%`,x=a.reduce((l,w)=>l+(w.ranked_points??(w.status==="Complete"?35:10)),0),h=g?"rounded-xl bg-card dark:bg-surface border border-white/10 p-2.5":"rounded-2xl bg-card dark:bg-surface border border-white/10 p-3",D=g?"text-base font-semibold hover:underline mb-0":"text-lg font-semibold hover:underline mb-0",L=g?"h-2":"h-2.5";return e.jsxs("div",{className:h,children:[e.jsxs("div",{className:"flex items-start justify-between gap-0",children:[e.jsx("div",{className:"flex items-center min-w-0",children:e.jsx(_e,{to:`/project/${n.id}`,className:`${D} truncate`,title:n.name,children:n.name})}),n.design_link&&e.jsx("div",{className:"flex gap-2 shrink-0",children:g?e.jsx("a",{href:n.design_link,target:"_blank",rel:"noreferrer",className:"inline-flex items-center px-1.5 py-0 rounded bg-card dark:bg-surface text-xs border border-[#24304F] transition outline outline-2 outline-[#24304F] font-normal",style:{background:"rgba(255,255,255,0.10)",borderColor:"#24304F",color:"#FFFFFF",fontWeight:"400"},children:"Link"}):e.jsx(Ie,{href:n.design_link,children:"Design Docs"})})]}),e.jsx("div",{className:"min-h-4 h-4 flex items-center mb-2",children:n.subsystem?e.jsx("div",{className:"text-xs uppercase tracking-caps font-normal text-muted leading-none",children:n.subsystem}):e.jsx(Be,{className:"h-3 w-16 invisible"})}),e.jsx("div",{className:"flex items-center justify-between gap-2 text-tick text-muted leading-none",children:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] uppercase tracking-wide opacity-80",children:"OWNERS"}),r.length>0?e.jsxs("div",{className:"flex -space-x-1 h-6 items-center",children:[r.slice(0,6).map(l=>{const w=l.name?l.name.split(/\s+/).filter(Boolean).slice(0,2).map(S=>S[0]?.toUpperCase()).join(""):void 0;return e.jsx(ue,{size:"xs",alt:l.name,src:l.avatar_url||void 0,initials:l.avatar_url?void 0:w,className:"ring-[1px] ring-bg-primary"},l.id)}),r.length>6&&e.jsx(ue,{size:"xs",className:"ring-[1px] ring-bg-primary",placeholder:e.jsxs("span",{className:"flex items-center justify-center text-[10px] font-semibold text-quaternary",children:["+",r.length-6]})})]}):e.jsx("div",{className:"h-6 flex items-center px-1.5 rounded bg-white/10 whitespace-normal break-words",children:e.jsx("span",{className:"text-[10px] leading-none",children:"N/A"})})]})}),n.due_date&&(()=>{let l=null;const w=n.due_date,S=w.match(/(\d{4})[\/\-]?(\d{2})[\/\-]?(\d{2})/);if(S){const[,T,M,_]=S;l=new Date(Number(T),Number(M)-1,Number(_))}else isNaN(Date.parse(w))||(l=new Date(w));if(l){const T=l.toLocaleString("en-US",{weekday:g?"short":"long"}),M=l.toLocaleString("en-US",{month:g?"short":"long"}),_=l.getDate(),P=o=>o===1||o===21||o===31?"st":o===2||o===22?"nd":o===3||o===23?"rd":"th";return e.jsxs("span",{className:"text-[10px] uppercase tracking-wide opacity-80 whitespace-nowrap ml-2 shrink-0 leading-none",children:[T," ",M," ",_,P(_)]})}return null})()]})}),e.jsxs("div",{className:"flex items-center justify-between gap-2 leading-none",children:[e.jsx("div",{className:"text-[11px] text-muted font-normal",children:u}),e.jsxs("div",{className:"text-muted flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] uppercase tracking-wide opacity-80",children:j>0?`${y}/${j} tasks`:"No tasks"}),e.jsx("span",{className:"opacity-80",children:"·"}),e.jsxs("span",{className:"text-[10px] font-normal opacity-80",children:[k," hours"]}),m&&e.jsx("span",{className:"opacity-80",children:"·"}),m&&e.jsx("span",{className:"text-[10px] font-normal",style:{color:"#94a3b8"},children:`Σ +${x}`})]})]}),e.jsx("div",{className:"mt-1",children:e.jsx(he,{value:v,heightClass:L,color:v===100?"linear-gradient(90deg,#22c55e,#16a34a)":void 0})})]})}function Ve({className:n="w-5 h-5 text-yellow-500 inline ml-1"}){return e.jsx("svg",{className:n,fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M6 2a1 1 0 00-1 1v2a1 1 0 001 1h8a1 1 0 001-1V3a1 1 0 00-1-1H6zm8 4H6v1a6 6 0 005 5.92V15H9a1 1 0 000 2h2a1 1 0 000-2h-2v-2.08A6 6 0 0014 7V6z"})})}function Ye({children:n,slideIndexInitial:r=0,onIndexChange:a,dots:g=!0,frameClassName:b}){const k=Array.isArray(n)?n:[n],[m,j]=c.useState(r),y=c.useRef(null),v=c.useRef(null),u=c.useRef({startX:0,currentX:0,dragging:!1,width:0});c.useEffect(()=>{a?.(m)},[m]);const x=(o,p=!0)=>{const C=v.current,F=y.current;if(!C||!F)return;const E=C.clientWidth;u.current.width=E,F.style.transition=p?"transform 320ms cubic-bezier(0.22, 1, 0.36, 1)":"none",F.style.transform=`translateX(${-o*E}px)`},h=o=>{const p=v.current;p&&(u.current={startX:o,currentX:o,dragging:!0,width:p.clientWidth})},D=o=>{if(!u.current.dragging)return;u.current.currentX=o;const p=o-u.current.startX,C=y.current;C&&(C.style.transition="none",C.style.transform=`translateX(${p-m*u.current.width}px)`)},L=()=>{if(!u.current.dragging)return;const o=u.current.currentX-u.current.startX,p=Math.max(40,u.current.width*.2);let C=m;o>p?C=Math.max(0,m-1):o<-p&&(C=Math.min(k.length-1,m+1)),x(C,!0),j(C),u.current.dragging=!1},l=o=>h(o.touches[0].clientX),w=o=>D(o.touches[0].clientX),S=()=>L(),T=o=>{o.preventDefault(),h(o.clientX)},M=o=>D(o.clientX),_=()=>L(),P=()=>L();return c.useEffect(()=>{const o=()=>{x(m,!1)};return window.addEventListener("resize",o),o(),()=>window.removeEventListener("resize",o)},[m]),c.useEffect(()=>{x(m,!0)},[m]),e.jsx("div",{className:"w-full select-none",children:e.jsxs("div",{ref:v,className:`relative overflow-hidden rounded-2xl ${b||""}`,onTouchStart:l,onTouchMove:w,onTouchEnd:S,onMouseDown:T,onMouseMove:M,onMouseUp:_,onMouseLeave:P,children:[e.jsx("div",{ref:y,className:"flex",style:{willChange:"transform"},children:k.map((o,p)=>e.jsx("div",{className:"w-full shrink-0 px-1",children:o},p))}),g&&e.jsx("div",{className:"mt-3 mb-2 flex items-center justify-center gap-2",children:k.map((o,p)=>e.jsx("button",{"aria-label":`Show slide ${p+1}`,className:`w-2.5 h-2.5 rounded-full border border-border transition ${m===p?"bg-foreground":"bg-muted-foreground/40 hover:bg-foreground/70"}`,onClick:()=>j(p)},p))})]})})}function xe({show:n,children:r}){const a=c.useRef(null);return c.useEffect(()=>{a.current&&(n?(a.current.style.opacity="1",a.current.style.transform="translateY(0)",a.current.style.pointerEvents="auto"):(a.current.style.opacity="0",a.current.style.transform="translateY(20px)",a.current.style.pointerEvents="none"))},[n]),e.jsx("div",{ref:a,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",transition:"opacity 0.4s, transform 0.4s",opacity:n?1:0,transform:n?"translateY(0)":"translateY(20px)",pointerEvents:n?"auto":"none"},children:r})}const Ke=[{label:"Mon",present:4},{label:"Tue",present:6},{label:"Wed",present:5},{label:"Thu",present:9},{label:"Fri",present:8},{label:"Sat",present:12},{label:"Sun",present:16}],Ze=Array.from({length:30}).map((n,r)=>({label:`${r+1}`,present:Math.max(0,Math.round(5+6*Math.sin(r/4)))})),B={line:["accent"],card:["surface"],border:["border"],text:["text"]},z={accent:"#64C7C9",surface:"#0F1B3A",border:"#24304F",text:"#FFFFFF",overlay:"rgba(255,255,255,0.06)"};function X(n,r){for(const a of n)if(a in z)return z[a];return r}function me(n,r){if(n.startsWith("#")){const a=parseInt(n.slice(1),16),g=a>>16&255,b=a>>8&255,k=a&255;return`rgba(${g},${b},${k},${r})`}return n.startsWith("rgb")?n.replace(/rgb\(([^)]+)\)/,`rgba($1,${r})`):n}function fe({active:n,payload:r}){if(!n||!r?.length)return null;const a=r[0].payload;return e.jsxs("div",{className:"rounded-xl px-3 py-2 text-sm shadow-lg border",style:{background:z.surface,borderColor:z.border,color:z.text},children:[e.jsx("div",{className:"opacity-70",children:a.label}),e.jsxs("div",{className:"font-semibold",children:[a.present," present"]})]})}function Je(n){const{weekData:r=Ke,monthData:a=Ze,className:g,title:b="Attendance"}=n,k=new Date,m=[2,4,6].includes(k.getDay()),[j,y]=c.useState("month"),v=j==="week"?r:a,u=c.useMemo(()=>v.length?v[v.length-1].present:0,[v]),x={line:X(B.line,z.accent),card:X(B.card,z.surface),border:X(B.border,z.border),text:X(B.text,z.text)};return e.jsxs("div",{className:`relative max-w-[390px] w-full mx-auto rounded-2xl p-5 md:p-6 border bg-card dark:bg-surface text-foreground border-border overflow-hidden h-full flex flex-col ${g??""}`,style:{background:x.card,borderColor:x.border,color:x.text},children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 min-w-0",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-widest opacity-70",children:b}),e.jsx("div",{className:"mt-1 text-xl font-bold leading-tight",children:u}),e.jsx("div",{className:"mt-1 text-[11px] opacity-70",children:m?"Today":"Last meeting"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>y("week"),className:`px-1 py-0.5 rounded bg-card/80 text-foreground border transition text-[11px] ${j==="week"?"opacity-100":"opacity-70 hover:opacity-100"}`,style:{borderColor:x.border},children:"Week"}),e.jsx("button",{onClick:()=>y("month"),className:`px-1 py-0.5 rounded bg-card/80 text-foreground border transition text-[11px] ${j==="month"?"opacity-100":"opacity-70 hover:opacity-100"}`,style:{borderColor:x.border},children:"Month"})]})]}),e.jsxs("div",{className:"mt-3 rounded-xl overflow-hidden flex-1 min-h-0 min-w-0 relative",children:[e.jsx(xe,{show:j==="week",children:e.jsx(re,{width:"100%",height:"100%",className:"block",children:e.jsxs(ae,{data:r,margin:{top:8,right:16,bottom:8,left:12},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"attnGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:x.line,stopOpacity:.45}),e.jsx("stop",{offset:"100%",stopColor:x.line,stopOpacity:.1})]})}),e.jsx(oe,{dataKey:"label",hide:!0}),e.jsx(ie,{hide:!0,domain:[0,h=>Math.max(10,h*1.15)]}),e.jsx(le,{horizontal:!1,vertical:!1}),e.jsx(ce,{content:e.jsx(fe,{}),cursor:{stroke:me(x.text,.06),strokeWidth:20}}),e.jsx(de,{type:"monotone",dataKey:"present",stroke:x.line,strokeWidth:3,fill:"url(#attnGradient)"})]})})}),e.jsx(xe,{show:j==="month",children:e.jsx(re,{width:"100%",height:"100%",className:"block",children:e.jsxs(ae,{data:a,margin:{top:8,right:16,bottom:8,left:12},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"attnGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:x.line,stopOpacity:.45}),e.jsx("stop",{offset:"100%",stopColor:x.line,stopOpacity:.1})]})}),e.jsx(oe,{dataKey:"label",hide:!0}),e.jsx(ie,{hide:!0,domain:[0,h=>Math.max(10,h*1.15)]}),e.jsx(le,{horizontal:!1,vertical:!1}),e.jsx(ce,{content:e.jsx(fe,{}),cursor:{stroke:me(x.text,.06),strokeWidth:20}}),e.jsx(de,{type:"monotone",dataKey:"present",stroke:x.line,strokeWidth:3,fill:"url(#attnGradient)"})]})})})]})]})}function K({label:n,value:r}){return e.jsxs("div",{className:"rounded-xl bg-card dark:bg-surface border border-white/10 p-3 text-center flex flex-col items-center justify-center min-w-0",children:[e.jsx("div",{className:"text-xl font-semibold leading-tight",children:r}),e.jsx("div",{className:"mt-1 text-xs tracking-caps text-muted uppercase opacity-80 whitespace-nowrap overflow-hidden text-ellipsis leading-snug",title:n,children:n})]})}function ct(){const[n,r]=c.useState([]),[a,g]=c.useState([]),[b,k]=c.useState([]),[m,j]=c.useState([]),[y,v]=c.useState([]),[u,x]=c.useState([]),[h,D]=c.useState("name"),[L,l]=c.useState("asc"),[w,S]=c.useState(!1),[T,M]=c.useState(!1),[_,P]=c.useState(!1),[o,p]=c.useState(""),C=c.useRef(null),F=t=>p(t.target.value);c.useEffect(()=>{(async()=>{const[t,s,i,d,f]=await Promise.all([Ae(),ne(),$e(),Pe(),Ee()]);r(t),g(s),k(i),j(d),v(f)})()},[]);const E=b.length,ge=b.filter(t=>t.status==="Complete").length,G=E?Math.round(ge/E*100):0;[...c.useMemo(()=>{const t=new Map;for(const s of a)for(const i of s.owner_ids||[])t.set(i,(t.get(i)||0)+1);return t},[a]).entries()].sort((t,s)=>s[1]-t[1]).slice(0,5).map(([t,s])=>({name:n.find(i=>i.id===t)?.name||t,count:s}));const be=n.map(t=>{const s=b.filter(i=>i.assignee_id===t.id&&i.status==="Complete").length;return{...t,completed:s}}).sort((t,s)=>s.completed-t.completed).slice(0,5),je=new Map(n.map(t=>[t.id,t])),I=new Map;for(const t of b){const s=I.get(t.project_id)??[];s.push(t),I.set(t.project_id,s)}const H=t=>{const s=I.get(t.id)??[];return s.length?s.filter(d=>d.status==="Complete").length/s.length:0},ye=Fe(),ve=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];function we(t){const s=new Date,i=[];let d=0,f=new Date(s);for(;i.length<3&&d<14;){const N=f.getDay();if([2,4,6].includes(N)){const U=f.toISOString().slice(0,10),V=t.filter(R=>new Date(R.date).toISOString().slice(0,10)===U).reduce((R,se)=>R+se.present,0);i.unshift({label:ve[N],present:V})}f.setDate(f.getDate()-1),d++}return i}function Ne(t){const s=new Date,i=30;return Array.from({length:i}).map((d,f)=>{const N=new Date(s);N.setDate(s.getDate()-(i-1-f));const U=N.getDay();if(![2,4,6].includes(U))return null;const V=N.toISOString().slice(0,10),R=t.filter(Y=>new Date(Y.date).toISOString().slice(0,10)===V).reduce((Y,De)=>Y+De.present,0);return{label:`${N.toLocaleString(void 0,{month:"short"})} ${N.getDate()}`,present:R}}).filter(Boolean)}const Z=m.map(t=>({date:t.date,present:1})),ke=we(Z),Ce=Ne(Z).filter(t=>t!==null),W=c.useMemo(()=>a.filter(t=>!t.archived),[a]),J=c.useMemo(()=>{if(!y?.length)return new Set;const t=new Map;for(const d of y)!d.from_id||!d.to_id||(t.has(d.to_id)||t.set(d.to_id,[]),t.get(d.to_id).push(d.from_id));const s=new Set;for(const d of W){const f=b.filter(N=>N.project_id===d.id);f.length&&f.every(N=>N.status==="Complete")&&s.add(d.id)}const i=new Set;for(const d of W){const f=t.get(d.id)||[];f.length&&f.some(N=>!s.has(N))&&i.add(d.id)}return i},[W,b,y]),A=c.useMemo(()=>W.filter(t=>!J.has(t.id)),[W,J]),Q=c.useMemo(()=>{const t=new Set;for(const s of A)s.subsystem&&t.add(s.subsystem);return Array.from(t).sort()},[A]),Se=c.useMemo(()=>{const t=new Map;for(const s of A)s.subsystem&&t.set(s.subsystem,(t.get(s.subsystem)||0)+1);return t},[A]),[q,Me]=c.useState(!1),Le=[...c.useMemo(()=>{let t=u.length?A.filter(s=>s.subsystem&&u.includes(s.subsystem)):A;if(o.trim()){const s=o.trim().toLowerCase();t=t.filter(i=>i.name.toLowerCase().includes(s)||i.description&&i.description.toLowerCase().includes(s)||i.subsystem&&i.subsystem.toLowerCase().includes(s))}return q&&(t=t.filter(s=>H(s)<1)),t},[A,u,o,q])].sort((t,s)=>{let i=0;if(h==="name")i=t.name.localeCompare(s.name);else if(h==="due"){const d=t.due_date,f=s.due_date;d&&f?i=d.localeCompare(f):d&&!f?i=-1:!d&&f?i=1:i=0}else h==="progress"?i=H(t)-H(s):i=(t.subsystem||"").localeCompare(s.subsystem||"")||t.name.localeCompare(s.name);return L==="asc"?i:-i}),ee=t=>t==="name"?"Name":t==="due"?"Due date":t==="progress"?"Progress":"Subsystem",te=L==="asc"?"↑":"↓";c.useEffect(()=>{const t=s=>{s.key==="Escape"&&(S(!1),M(!1))};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[]),ye?.uid;async function ze(){const[t]=await Promise.all([ne()]);g(t)}return e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-2xl font-semibold mb-4",children:"Team Overview"}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 mb-6",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-4",children:[e.jsx(K,{label:"Members",value:n.length}),e.jsx(K,{label:"Projects",value:A.length}),e.jsx(K,{label:"Tasks",value:E})]}),e.jsxs("div",{className:"rounded-xl bg-card dark:bg-surface border border-border p-2 pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-xs tracking-caps text-muted uppercase opacity-80",children:"Total Task Completion"}),e.jsxs("div",{className:"text-xl font-semibold leading-tight",children:[G,"%"]})]}),e.jsx(he,{value:G,heightClass:"h-3",color:G===100?"linear-gradient(90deg,#22c55e,#16a34a)":void 0})]})]}),e.jsx("div",{className:"min-w-0",children:e.jsxs(Ye,{slideIndexInitial:0,onIndexChange:()=>{},dots:!0,children:[e.jsx(Je,{title:"Attendance",weekData:ke,monthData:Ce,className:"h-56"}),e.jsxs("div",{className:"relative max-w-[390px] w-full mx-auto rounded-2xl p-5 md:p-6 border bg-card dark:bg-surface text-foreground border-white/10 overflow-hidden h-56 flex flex-col",children:[e.jsx("h2",{className:"text-xs md:text-sm mb-2 text-muted uppercase tracking-caps",style:{fontWeight:400},children:"All-Time Leaderboard"}),e.jsx("div",{className:"h-full overflow-hidden",children:e.jsxs("table",{className:"mx-auto w-full table-fixed text-xs sm:text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-8 py-1 px-2 text-center text-muted uppercase tracking-caps",style:{fontWeight:400},children:"#"}),e.jsx("th",{className:"py-1 px-2 text-left text-muted uppercase tracking-caps",style:{fontWeight:400},children:"Name"}),e.jsx("th",{className:"w-24 md:w-28 py-1 px-2 text-center text-muted uppercase tracking-caps",style:{fontWeight:400},children:"Tasks"})]})}),e.jsx("tbody",{className:"align-middle",children:be.slice(0,7).map((t,s)=>e.jsxs("tr",{className:s===0?"bg-yellow-100/40":"",children:[e.jsx("td",{className:"py-1 px-2 text-center",children:s+1}),e.jsx("td",{className:"py-1 px-2",children:e.jsxs("div",{className:"truncate flex items-center gap-1 mb-0.5",children:[t.name,s===0&&e.jsx(Ve,{})]})}),e.jsx("td",{className:"py-1 px-2 text-center",children:t.completed})]},t.id))})]})})]})]})})]}),e.jsxs("div",{className:"mt-6 mb-2 flex items-center w-full",style:{display:"flex"},children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Projects"}),e.jsx(We,{children:e.jsxs("button",{"aria-label":"Create project",onClick:()=>P(!0),className:"group inline-flex items-center justify-center h-7 w-7 rounded-md border border-accent/40 bg-accent/15 hover:bg-accent/25 text-accent transition shadow-sm hover:shadow-accent/20 focus:outline-none focus-visible:ring-2 focus-visible:ring-accent/60 ml-2",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.1",strokeLinecap:"round",strokeLinejoin:"round",className:"drop-shadow-sm",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),e.jsx("span",{className:"sr-only",children:"Add project"})]})}),e.jsx("div",{className:"flex-1"}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer select-none outline-none focus:outline-none",style:{marginLeft:8},children:[e.jsxs("span",{className:"relative inline-flex h-6 w-11 select-none ml-auto",children:[e.jsx("input",{type:"checkbox",checked:q,onChange:t=>Me(t.target.checked),className:"peer sr-only",onMouseUp:t=>t.currentTarget.blur()}),e.jsx("span",{className:`
                pointer-events-none block h-6 w-11 rounded-full border border-border
                bg-black/15 dark:bg-white/15
                transition-colors
                peer-checked:bg-[#64C7C9]
                peer-focus-visible:ring-2 peer-focus-visible:ring-[#64C7C9]/60 peer-focus-visible:ring-offset-2 peer-focus-visible:ring-offset-background
              `}),e.jsx("span",{className:`
                pointer-events-none absolute left-0.5 top-0.5 h-5 w-5 rounded-full
                bg-white dark:bg-background shadow
                transition-transform
                peer-checked:translate-x-5
              `})]}),e.jsx("span",{className:"sr-only",children:"Hide completed projects"})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-[10px] text-muted mb-1 uppercase tracking-caps",children:[e.jsxs("div",{className:"flex items-center gap-1",title:"Grey = To-do / Not started",children:[e.jsx("span",{className:"w-2 h-2 rounded-full",style:{background:"#BDC0C3"}})," To-do / Not started"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full",style:{background:"#64C7C9"}})," In Progress"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full",style:{background:"#34D399"}})," Complete"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 w-full",children:[e.jsxs("div",{className:"relative min-w-0",children:[e.jsxs("button",{onClick:()=>{S(t=>!t),M(!1)},className:"px-3 py-1.5 rounded-md text-xs font-medium border border-border bg-card dark:bg-surface hover:bg-card/80 w-full",children:["Subsystems: ",e.jsx("span",{className:"font-semibold",children:u.length?`${u.length} selected`:"All"})]}),e.jsxs("div",{className:`absolute z-20 mt-1 w-64 rounded-md border border-border bg-card dark:bg-surface shadow-xl overflow-hidden transition transform origin-top ${w?"opacity-100 scale-100":"opacity-0 scale-95 pointer-events-none"}`,children:[e.jsx("div",{className:"px-3 py-2 border-b border-white/10",children:e.jsx("button",{className:"w-full px-3 py-2 rounded-md text-xs sm:text-sm font-semibold bg-red-500/15 hover:bg-red-500/25 text-red-200 focus:outline-none focus-visible:outline-none",onClick:()=>x([]),children:"Clear selection"})}),e.jsxs("div",{className:"max-h-60 overflow-auto p-1",children:[Q.length===0&&e.jsx("div",{className:"px-3 py-2 text-xs text-muted uppercase tracking-caps",children:"No subsystems"}),Q.map(t=>{const s=u.includes(t),i=Se.get(t)??0;return e.jsxs("label",{className:"flex items-center gap-2 px-2 py-1.5 text-xs rounded hover:bg-card/80 cursor-pointer focus:outline-none focus-visible:outline-none",children:[e.jsx("input",{type:"checkbox",className:"accent-accent focus:outline-none focus:ring-0 focus-visible:outline-none focus-visible:ring-0",checked:s,onChange:()=>{x(d=>s?d.filter(f=>f!==t):[...d,t])}}),e.jsx("span",{className:"truncate",children:t}),e.jsx("span",{className:"ml-auto inline-flex items-center justify-center rounded-full bg-surface/80 px-2 py-0.5 text-[10px]",children:i})]},t)})]})]})]}),e.jsxs("div",{className:"relative min-w-0",children:[e.jsxs("button",{onClick:()=>{M(t=>!t),S(!1)},className:"px-3 py-1.5 rounded-md text-xs font-medium border border-border bg-card dark:bg-surface hover:bg-card/80 w-full",children:["Sort: ",e.jsxs("span",{className:"font-semibold",children:[ee(h)," ",te]})]}),e.jsx("div",{className:`absolute z-20 mt-1 w-48 rounded-md border border-border bg-card dark:bg-surface shadow-xl overflow-hidden transition transform origin-top ${T?"opacity-100 scale-100":"opacity-0 scale-95 pointer-events-none"}`,children:["name","subsystem","due","progress"].map(t=>e.jsxs("button",{className:`w-full text-left px-3 py-2 text-xs hover:bg-surface/80 ${h===t?"bg-surface/80":""}`,onClick:()=>{h===t?l(s=>s==="asc"?"desc":"asc"):D(t),M(!1)},children:[ee(t)," ",h===t?te:""]},t))})]}),(w||T)&&e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>{S(!1),M(!1)}})]}),e.jsx("div",{className:"w-full mt-2 mb-4",children:e.jsx("input",{ref:C,type:"text",value:o,onChange:F,placeholder:"Search projects...",className:"px-3 py-1.5 rounded-md text-xs font-medium border border-border bg-card dark:bg-surface focus:bg-card/80 w-full focus:outline-none"})}),e.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-2",children:Le.map(t=>e.jsx(Ue,{project:t,owners:t.owner_ids?.map(s=>je.get(s)).filter(Boolean)??[],tasks:I.get(t.id)??[],compact:!0},t.id))}),e.jsx(Re,{open:_,onClose:()=>P(!1),people:n,onCreated:async()=>{await ze()}})]})}export{ct as default};
