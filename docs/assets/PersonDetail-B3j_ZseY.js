import{e as O,r as l,u as Q,f as W,a as Z,b as q,g as G,c as J,h as K,j as e,L as V}from"./index-B-YBCRUe.js";function Y(){const{id:o}=O(),[a,_]=l.useState(null),[P,F]=l.useState([]),[T,C]=l.useState([]),[p,E]=l.useState([]),[N,L]=l.useState([]),[m,$]=l.useState(null),[b,A]=l.useState([]),[w,U]=l.useState([]),[k,M]=l.useState(0),[v]=Q();if(l.useEffect(()=>{(async()=>{const[s,n,r,i,c]=await Promise.all([W(),Z(),q(),G(),J()]);C(s);const u=s.find(t=>t.id===o)||null;if(_(u),F(n),L(r),E(r.filter(t=>t.assignee_id===o)),$(i),U(c),o)try{A(await K(o))}catch{}})()},[o]),l.useEffect(()=>{if(!a)return;const s=new Set([2,4,6]),n=new Set(w.filter(c=>c.person_id===a.id).map(c=>c.date));let r=0;const i=new Date;for(let c=0;c<120;c++){const u=i.getDay(),t=i.toISOString().slice(0,10);if(s.has(u))if(n.has(t))r++;else break;i.setDate(i.getDate()-1)}M(r)},[w,a]),!a)return e.jsx("div",{className:"text-sm",children:"Loading…"});const y=P.filter(s=>{var n;return((n=s.owner_ids)==null?void 0:n.includes(o))||N.some(r=>r.project_id===s.id&&r.assignee_id===o)}),H=y.length,R=p.length,B=p.filter(s=>s.status!=="Complete").length,I=s=>s===1?.5:s===3?1:s===6?2:s===10?3:s===15?5:s===40?10:s===65?15:s===98?20:s===150?25:s===200?30:Math.max(0,Math.round(s/4)),z=Math.round(p.filter(s=>s.status==="Complete").reduce((s,n)=>s+(typeof n.ranked_points=="number"?I(n.ranked_points):2),0));function g(s){const n="/fsae-dashboard/",r=(s||"Bronze").toLowerCase();return`${n}icons/rank-${r}.png`}const S=(a.rank_history||[]).slice().sort((s,n)=>n.ts-s.ts);return e.jsxs("div",{className:"max-w-2xl mx-auto mt-6 space-y-6",children:[e.jsxs("div",{className:"rounded-2xl bg-white/5 border border-white/10 p-4 flex flex-col gap-1.5 relative",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xl font-semibold leading-tight truncate flex items-center gap-2",children:e.jsx("span",{className:"truncate",children:a.name})}),a.discord&&e.jsxs("div",{className:"text-xs text-uconn-muted leading-snug truncate",children:["@",a.discord.replace(/^@/,"")]}),e.jsx("div",{className:"text-xs text-uconn-muted leading-snug",children:a.year||a.role})]}),v&&a.rank&&e.jsx("img",{src:g(a.rank),alt:a.rank,className:"shrink-0 h-20 w-20 md:h-24 md:w-24 object-contain -mt-2"})]}),e.jsxs("div",{className:"flex gap-4 mt-1",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold",children:H}),e.jsx("div",{className:"text-xs text-uconn-muted",children:"Projects"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold",children:R}),e.jsx("div",{className:"text-xs text-uconn-muted",children:"Tasks"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold",children:B}),e.jsx("div",{className:"text-xs text-uconn-muted",children:"To Do"})]}),e.jsxs("div",{className:"text-center flex flex-col items-center",children:[e.jsxs("div",{className:"text-lg font-semibold flex items-center gap-1",children:[k,k>0&&e.jsx("svg",{className:"h-4 w-4 text-orange-400",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{d:"M12 2c.7 2.4 2.1 4.2 4.2 5.5 2 .3 3.3 1.5 3.8 3.6.5 2.1-.2 4-2.1 5.7-.6-1.6-1.5-2.8-2.9-3.6.3 2.2-.5 4-2.4 5.4-1.9 1.4-3.9 1.5-6 .4-2.1-1.1-3.1-2.9-3.1-5.3 0-1.5.5-2.8 1.6-3.9 1.1-1.1 2.4-1.7 3.9-1.7-.4 1.3-.2 2.4.5 3.5.7 1 1.6 1.4 2.7 1.2 1.1-.2 1.8-.9 2-2 .2-1.1-.2-2.1-1.1-3-.9-.9-1.5-2-1.6-3.2-.1-1.2.3-2.4 1.1-3.7Z"})})]}),e.jsx("div",{className:"text-xs text-uconn-muted",children:"Streak"})]})]}),e.jsxs("span",{className:"absolute bottom-4 right-6 text-sm text-uconn-muted/90 tracking-wide",children:[z,"hrs"]})]}),e.jsxs("div",{className:"rounded-2xl bg-white/5 border border-white/10 p-4",children:[e.jsx("h2",{className:"font-semibold mb-2",children:"Quick Links"}),e.jsxs("ul",{className:"list-disc pl-5 text-sm",children:[(()=>{const s=(m==null?void 0:m.sharepoint_url)||"https://uconn-my.sharepoint.com/shared?id=%2Fsites%2FUConnFormulaSAE%2FShared%20Documents&listurl=https%3A%2F%2Fuconn%2Esharepoint%2Ecom%2Fsites%2FUConnFormulaSAE%2FShared%20Documents";return e.jsx("li",{children:e.jsx("a",{className:"underline",href:s,target:"_blank",children:"SharePoint"})})})(),(m==null?void 0:m.rulebook_url)&&e.jsx("li",{children:e.jsx("a",{className:"underline",href:m.rulebook_url,target:"_blank",children:"Rulebook (PDF)"})})]})]}),e.jsxs("div",{className:"rounded-2xl bg-white/5 border border-white/10 p-4",children:[e.jsx("h2",{className:"font-semibold mb-2",children:"Projects"}),e.jsx("ul",{className:"space-y-3",children:y.map(s=>{const n=N.filter(t=>t.project_id===s.id),r=n.length,i=n.filter(t=>t.status==="Complete").length,c=r?Math.round(i/r*100):0,u=(()=>{const t=s.due_date||"",f=t.match(/(\d{4})[\/-]?(\d{2})[\/-]?(\d{2})/);let d=null;if(f){const[,h,j,D]=f;d=new Date(Number(h),Number(j)-1,Number(D))}else isNaN(Date.parse(t))||(d=new Date(t));if(d){const h=d.toLocaleString("en-US",{month:"long"}),j=d.getDate();return`${h} ${j}${(x=>x===1||x===21||x===31?"st":x===2||x===22?"nd":x===3||x===23?"rd":"th")(j)}`}return t})();return e.jsxs("li",{className:"rounded-xl bg-white/10 border border-white/10 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(V,{className:"underline font-semibold",to:`/project/${s.id}`,children:s.name}),e.jsxs("div",{className:"text-xs text-uconn-muted",children:[i,"/",r," · ",c,"%"]})]}),e.jsxs("div",{className:"text-xs text-uconn-muted",children:[s.description||"—",s.due_date&&e.jsxs(e.Fragment,{children:[" · Due ",u]})]}),n.filter(t=>t.status!=="Complete").length>0&&e.jsx("ul",{className:"mt-3 grid grid-cols-1 md:grid-cols-2 gap-3",children:n.filter(t=>t.status!=="Complete").map(t=>{var d;const f=t.status==="In Progress"?"bg-yellow-400":"bg-red-500";return e.jsxs("li",{className:"relative flex flex-col justify-between gap-2 rounded bg-uconn-surface border border-uconn-border p-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-medium text-sm truncate",title:t.description,children:t.description}),e.jsxs("div",{className:"text-[10px] text-uconn-muted flex gap-2 items-center mt-0.5",children:[e.jsx("span",{className:"capitalize",children:t.status}),e.jsx("span",{children:"·"}),e.jsx("span",{children:t.assignee_id?`@${((d=T.find(h=>h.id===t.assignee_id))==null?void 0:d.name)||"Assignee"}`:"Unassigned"})]})]}),e.jsx("span",{className:`absolute top-3 right-3 w-3.5 h-3.5 rounded-full ${f} shadow`,"aria-hidden":!0})]},t.id)})})]},s.id)})})]}),e.jsxs("div",{className:"rounded-2xl bg-white/5 border border-white/10 p-4",children:[e.jsx("h2",{className:"font-semibold mb-2",children:"Badges"}),a.skills&&a.skills.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:a.skills.map((s,n)=>e.jsx("span",{className:"text-xs px-3 py-1 rounded bg-brand-teal/10 border border-brand-teal/20 text-brand-teal font-medium",children:s},n))}):e.jsx("div",{className:"text-xs text-uconn-muted",children:"No badges yet."})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[v&&e.jsxs("div",{className:"rounded-2xl bg-white/5 border border-white/10 p-4",children:[e.jsx("h2",{className:"font-semibold mb-2",children:"Ranked History"}),S.length===0?e.jsx("div",{className:"text-xs text-uconn-muted",children:"No rank changes yet."}):e.jsx("ul",{className:"space-y-2 text-sm",children:S.map((s,n)=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-uconn-muted w-28",children:new Date(s.ts).toLocaleDateString("en-US")}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("img",{src:g(s.from),alt:s.from,className:"h-4 w-4 object-contain"}),e.jsx("span",{children:s.from})]}),e.jsx("span",{className:"text-uconn-muted",children:"→"}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("img",{src:g(s.to),alt:s.to,className:"h-4 w-4 object-contain"}),e.jsx("span",{children:s.to})]})]},n))})]}),e.jsxs("div",{className:"rounded-2xl bg-white/5 border border-white/10 p-4",children:[e.jsx("h2",{className:"font-semibold mb-2",children:"Points History"}),b.length===0?e.jsx("div",{className:"text-xs text-uconn-muted",children:"No point events yet."}):e.jsx("ul",{className:"space-y-2 text-sm max-h-72 overflow-auto pr-1",children:b.filter(s=>s.type==="attendance"||s.type==="task_points").slice(0,100).map((s,n)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-[11px] text-uconn-muted w-24 shrink-0",children:new Date(s.ts).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.jsxs("span",{className:"flex-1",children:[e.jsx("span",{className:"text-white/90",children:s.note||s.type})," ",typeof s.points=="number"&&e.jsxs("span",{className:"text-brand-teal font-semibold",children:["(+",s.points,")"]})]})]},s.id||n))})]})]})]})}export{Y as default};
