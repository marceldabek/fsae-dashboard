const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DMjV8ZZ2.js","assets/index-Da_xB0hm.css"])))=>i.map(i=>d[i]);
import{r as i,h as ie,u as le,g as ce,f as de,a as pe,b as he,c as ge,_ as me,l as ye,j as e,L as ue,i as fe,k as xe}from"./index-DMjV8ZZ2.js";import{g as V,e as be,M as je,a as ve,D as Se,I as we,S as ke,b as Ne,d as ze,f as Ce,h as De}from"./modal-Bee9i2Th.js";import"./clsx-B-dksMZM.js";const Y=({size:p=24,color:s="currentColor",...u})=>i.createElement("svg",{viewBox:"0 0 24 24",width:p,height:p,stroke:s,strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",...u},i.createElement("path",{d:"M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"}),i.createElement("path",{d:"M18.727 14.727a1.5 1.5 0 0 0 .3 1.655l.055.054a1.816 1.816 0 0 1 0 2.573 1.818 1.818 0 0 1-2.573 0l-.055-.055a1.5 1.5 0 0 0-1.654-.3 1.5 1.5 0 0 0-.91 1.373v.155a1.818 1.818 0 1 1-3.636 0V20.1a1.5 1.5 0 0 0-.981-1.373 1.5 1.5 0 0 0-1.655.3l-.054.055a1.818 1.818 0 0 1-3.106-1.287 1.818 1.818 0 0 1 .533-1.286l.054-.055a1.5 1.5 0 0 0 .3-1.654 1.5 1.5 0 0 0-1.372-.91h-.155a1.818 1.818 0 1 1 0-3.636H3.9a1.5 1.5 0 0 0 1.373-.981 1.5 1.5 0 0 0-.3-1.655l-.055-.054A1.818 1.818 0 1 1 7.491 4.99l.054.054a1.5 1.5 0 0 0 1.655.3h.073a1.5 1.5 0 0 0 .909-1.372v-.155a1.818 1.818 0 0 1 3.636 0V3.9a1.499 1.499 0 0 0 .91 1.373 1.5 1.5 0 0 0 1.654-.3l.054-.055a1.817 1.817 0 0 1 2.573 0 1.819 1.819 0 0 1 0 2.573l-.055.054a1.5 1.5 0 0 0-.3 1.655v.073a1.5 1.5 0 0 0 1.373.909h.155a1.818 1.818 0 0 1 0 3.636H20.1a1.499 1.499 0 0 0-1.373.91Z"}));Y.displayName="Settings01";const Fe={light:{color:{bg:"#FFFFFF",surface:"#F8F9FA",border:"#E9ECEF",text:"#212529",muted:"#6C757D",accent:"#0066CC","accent-weak":"#66B3FF","accent-soft":"#64C7C9","accent-hover":"#203363",success:"#198754",warning:"#FFC107",danger:"#DC3545","overlay-06":"rgba(0,0,0,0.06)","overlay-10":"rgba(0,0,0,0.10)",primary_hover:"#EEF2FF",secondary_alt:"#E5E7EB","profile-border":"#E9ECEF"}},dark:{color:{bg:"#000E2F",surface:"#0F1B3A",border:"#24304F",text:"#FFFFFF",muted:"#BDC0C3",accent:"#64C7C9","accent-weak":"#98D7D8","accent-soft":"#64C7C9","accent-hover":"#203363",success:"#34D399",warning:"#FACC15",danger:"#BE2D2D","overlay-06":"rgba(255,255,255,0.06)","overlay-10":"rgba(255,255,255,0.10)",primary_hover:"#182852",secondary_alt:"#2A3656","profile-border":"#24304F"}}},_e={size:{display:"24px",heading:"20px",section:"18px",body:"14px",meta:"12px",caption:"11px",tiny:"10px"},weight:{bold:700,semibold:600,medium:500,regular:400},family:{sans:"Inter, ui-sans-serif, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, 'Noto Sans'",mono:"ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace"}},Ee={xs:"4px",sm:"8px",md:"16px",lg:"24px",xl:"32px","2xl":"48px"},Te={primary:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",secondary:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",success:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",warning:"linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)"},Be={sm:"4px",md:"6px",lg:"8px",xl:"12px",full:"9999px"},b={themes:Fe,typography:_e,spacing:Ee,gradients:Te,radii:Be};function Ae(){const[p,s]=i.useState("light");i.useEffect(()=>{const g=localStorage.getItem("theme"),j=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";s(g||j)},[]);const u=()=>{const g=p==="light"?"dark":"light";s(g),localStorage.setItem("theme",g)},c={color:b.themes[p].color,typography:b.typography,spacing:b.spacing,gradients:b.gradients,radii:b.radii};return{theme:p,toggleTheme:u,tokens:c}}function Ie(){const{id:p}=ie(),{tokens:s,theme:u}=Ae(),[c,g]=i.useState(null),[j,Z]=i.useState([]),[P,q]=i.useState([]),[z,G]=i.useState([]),[h,v]=i.useState([]),[L,J]=i.useState([]),[K,Q]=i.useState(0),[M,X]=i.useState(s.gradients.primary),[S]=le(),{role:ee}=ce(),[C,f]=i.useState(!1),[I,D]=i.useState(null),[F,W]=i.useState(!1),[x,R]=i.useState(""),[w,_]=i.useState(""),[E,$]=i.useState(!1);i.useEffect(()=>{(async()=>{const[t,n,r,a]=await Promise.all([de(),pe(),he(),ge()]),l=t.find(o=>o.id===p)||null;if(g(l),Z(n),G(r),q(r.filter(o=>o.assignee_id===p)),J(a),l){const o=V(l),d=await be(o);X(d)}if(p&&S)try{const o=await me(()=>import("./index-DMjV8ZZ2.js").then(d=>d.ab),__vite__mapDeps([0,1]));typeof o.fetchLogsForPerson=="function"?v(await o.fetchLogsForPerson(p)):v([])}catch{v([])}else v([])})()},[p,S]),i.useEffect(()=>{const t=ye(()=>{try{const n=xe();if(!n){D(null);return}const r=n.uid||"",a=r.match(/^discord:(\d+)/);D(a?a[1]:r)}catch{D(null)}});return()=>{try{t&&t()}catch{}}},[]),i.useEffect(()=>{C&&c&&(R(c.name||""),_(c.year||""),$(!!c.ranked_opt_in))},[C,c]),i.useEffect(()=>{if(!c)return;const t=new Set([2,4,6]),n=new Set(L.filter(l=>l.person_id===c.id).map(l=>l.date));let r=0;const a=new Date;for(let l=0;l<120;l++){const o=a.getDay(),d=a.toISOString().slice(0,10);if(t.has(o))if(n.has(d))r++;else break;a.setDate(a.getDate()-1)}Q(r)},[L,c]);const T=i.useMemo(()=>p?j.filter(t=>t.owner_ids?.includes(p)?!0:z.filter(r=>r.project_id===t.id&&r.assignee_id===p).some(r=>r.status!=="Complete")):[],[j,z,p]),te=T.length,se=P.length,oe=P.filter(t=>t.status!=="Complete").length,H=i.useMemo(()=>!Array.isArray(h)||h.length===0?[]:h.filter(n=>{const r=n?.type==="ranked_pool_top"||n?.type==="ranked_top",a=typeof n?.note=="string"?n.note:"",l=/(finished|placed)\s*1st|top\s*of\s*(the\s*)?pool/i.test(a),d=((n&&n.position)??(n&&n.rank)??null)===1;return!!(r||l||d)}).map((n,r)=>({id:n?.id??String(r),ts:n?.ts})),[h]),O=i.useMemo(()=>{if(!Array.isArray(h)||h.length===0)return[];const t=a=>{if(typeof a?.delta=="number")return a.delta;if(typeof a?.change=="number")return a.change;const l=typeof a?.note=="string"?a.note:"",o=l.match(/\b(up|down)\b\s*(\d+)?/i);if(o){const k=o[1].toLowerCase(),y=o[2]?parseInt(o[2],10):1;return k==="up"?y:-y}const d=l.match(/([+-]\d+)/);return d?parseInt(d[1],10):null},r=h.filter(a=>{const l=/rank(_|-)?(change|move|movement)/i.test(String(a?.type||"")),o=String(a?.note||""),d=/(moved|rank)/i.test(o);return l||d||typeof a?.delta=="number"||typeof a?.change=="number"}).map((a,l)=>({id:a?.id??String(l),ts:a?.ts,delta:t(a)??0,note:typeof a?.note=="string"?a.note:void 0}));return r.sort((a,l)=>{const o=a.ts instanceof Date?a.ts.getTime():Number(a.ts||0);return(l.ts instanceof Date?l.ts.getTime():Number(l.ts||0))-o}),r.slice(0,10)},[h]);function ne(t){return t===1||t===21||t===31?"st":t===2||t===22?"nd":t===3||t===23?"rd":"th"}function B(t){const n=t instanceof Date?t:new Date(t),r=n.toLocaleString("en-US",{month:"short"}),a=n.getDate();return`${r} ${a}${ne(a)}`}if(!c)return e.jsx("div",{className:"text-sm",children:"Loadingâ€¦"});const U=!!(c&&I&&c.id===I);async function ae(){if(c)try{W(!0),await fe(c.id,{name:x?.trim()||c.name,year:w||void 0,ranked_opt_in:!!E}),g(t=>t&&{...t,name:x?.trim()||t.name,year:w||void 0,ranked_opt_in:!!E}),f(!1)}finally{W(!1)}}return e.jsxs("div",{className:"w-full",style:{color:s.color.text,fontFamily:s.typography.family.sans},children:[e.jsxs("div",{className:"relative",style:{paddingLeft:6,paddingRight:6,marginTop:-8},children:[e.jsx("div",{"aria-hidden":!0,className:"w-full",style:{height:90,background:M,borderRadius:s.radii.xl}}),e.jsx("div",{className:"mx-auto",style:{position:"relative",maxWidth:1120,padding:6},children:e.jsx("img",{src:V(c),alt:c.name,className:"absolute rounded-full object-cover",style:{width:84,height:84,left:8,top:-44,border:`4px solid ${u==="light"?s.color.border:s.color.bg}`,zIndex:2}})})]}),e.jsxs("div",{className:"mx-auto w-full",style:{maxWidth:1120,padding:12},children:[e.jsxs("div",{className:"flex flex-col",style:{gap:0,marginTop:20,marginBottom:s.spacing.md},children:[e.jsxs("div",{className:"relative flex items-center gap-2 w-full pr-10",children:[e.jsx("h1",{className:"truncate",style:{fontSize:s.typography.size.heading,fontWeight:s.typography.weight.semibold,lineHeight:1.1,margin:0},children:c.name}),U&&e.jsx("button",{type:"button",onClick:()=>f(!0),"aria-label":"Open profile settings",className:"absolute right-0 top-1/2 -translate-y-1/2 inline-flex items-center justify-center size-7 rounded-md text-fg-quaternary hover:bg-foreground/10",title:"Profile settings",children:e.jsx(Y,{className:"size-5"})})]}),c.discord&&e.jsxs("span",{className:"truncate",style:{fontSize:s.typography.size.body,opacity:.9,lineHeight:1,color:s.color.muted,marginTop:0},children:["@",c.discord.replace(/^@/,"")]}),e.jsx("span",{style:{fontSize:s.typography.size.body,opacity:.9,lineHeight:1.1},children:c.year||c.role})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, minmax(0,1fr))",width:"100%",marginTop:0,marginBottom:s.spacing.md,fontSize:s.typography.size.body},children:[{label:"Projects",value:te},{label:"Tasks",value:se},{label:"To Do",value:oe},{label:"Streak",value:K}].map((t,n)=>e.jsxs("div",{className:"flex flex-col items-center",style:{padding:"0 8px",borderLeft:n===0?"none":`1px solid ${s.color.border}`},children:[e.jsx("span",{style:{opacity:.85,fontSize:s.typography.size.meta},children:t.label}),e.jsx("span",{style:{fontWeight:s.typography.weight.semibold},children:t.value})]},t.label))}),e.jsxs("div",{style:{marginBottom:s.spacing.lg},children:[e.jsx("h2",{style:{fontSize:s.typography.size.section,fontWeight:s.typography.weight.semibold,marginBottom:6},children:"Projects"}),T.length===0?e.jsx("p",{style:{opacity:.9,color:s.color.text},children:"No active projects yet."}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:s.spacing.md},children:T.map(t=>{const n=z.filter(o=>o.project_id===t.id),r=n.length,a=n.filter(o=>o.status==="Complete").length,l=r?Math.round(a/r*100):0;return e.jsxs("div",{style:{backgroundColor:s.color.surface,border:`1px solid ${s.color.border}`,borderRadius:s.radii.lg,padding:s.spacing.md},children:[e.jsx("div",{className:"flex items-start justify-between",style:{marginBottom:8},children:e.jsxs("div",{children:[e.jsx(ue,{to:`/project/${t.id}`,style:{fontSize:s.typography.size.section,fontWeight:s.typography.weight.semibold,color:s.color.text,textDecoration:"none"},children:t.name}),t.subsystem&&e.jsx("p",{style:{fontSize:s.typography.size.meta,color:s.color.muted,opacity:.8,marginTop:2},children:t.subsystem})]})}),t.due_date&&(()=>{let o=null;const d=t.due_date,k=d.match(/(\d{4})[\/-]?(\d{2})[\/-]?(\d{2})/);if(k){const[,y,A,N]=k;o=new Date(Number(y),Number(A)-1,Number(N))}else isNaN(Date.parse(d))||(o=new Date(d));if(o){const y=o.toLocaleString("en-US",{weekday:"long"}),A=o.toLocaleString("en-US",{month:"long"}),N=o.getDate(),re=m=>m===1||m===21||m===31?"st":m===2||m===22?"nd":m===3||m===23?"rd":"th";return e.jsxs("p",{style:{color:s.color.muted,fontSize:s.typography.size.meta,marginBottom:6},children:["Due: ",y,", ",A," ",N,re(N)]})}return null})(),e.jsx("div",{className:"w-full",style:{background:s.color["overlay-10"],borderRadius:9999,height:8,marginBottom:8},children:e.jsx("div",{style:{width:`${l}%`,height:8,borderRadius:9999,background:M}})}),n.filter(o=>o.status!=="Complete").length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",style:{marginBottom:6},children:[e.jsx("h4",{style:{fontSize:s.typography.size.body,fontWeight:s.typography.weight.medium},children:"Active Tasks"}),e.jsxs("span",{style:{fontWeight:s.typography.weight.medium},children:[a,"/",r]})]}),e.jsxs("div",{style:{display:"grid",gap:4},children:[n.filter(o=>o.status!=="Complete").slice(0,3).map(o=>e.jsxs("div",{className:"flex items-start justify-between",style:{fontSize:s.typography.size.meta,lineHeight:1.2},children:[e.jsx("p",{style:{color:s.color.muted},children:o.description}),e.jsx("span",{style:{padding:"2px 6px",borderRadius:6,fontSize:s.typography.size.tiny,background:o.status==="In Progress"?"rgba(255,193,7,0.15)":"rgba(220,53,69,0.15)",color:s.color.text},children:o.status})]},o.id)),n.filter(o=>o.status!=="Complete").length>3&&e.jsxs("p",{style:{fontSize:s.typography.size.meta,opacity:.9},children:["+",n.filter(o=>o.status!=="Complete").length-3," more tasks"]})]})]})]},t.id)})})]}),S&&e.jsxs("div",{style:{marginBottom:s.spacing.lg},children:[e.jsx("h2",{style:{fontSize:s.typography.size.section,fontWeight:s.typography.weight.semibold,marginBottom:6},children:"Ranked"}),H.length===0?e.jsx("p",{style:{opacity:.9,fontSize:s.typography.size.body,marginBottom:8},children:"No trophies yet."}):e.jsx("div",{className:"flex items-center flex-wrap",style:{gap:6,marginBottom:8},children:Array.from({length:H.length}).map((t,n)=>e.jsx("span",{"aria-label":"trophy",title:"Top of pool",style:{fontSize:18},children:"ðŸ†"},n))}),O.length===0?e.jsx("p",{style:{opacity:.9,fontSize:s.typography.size.body},children:"No movement yet."}):e.jsx("div",{style:{display:"grid",gap:6},children:O.map(t=>{const n=t.delta>0?s.color.success:t.delta<0?s.color.danger:s.color.muted,r=t.delta>0?"+":(t.delta<0,"");return e.jsxs("div",{className:"flex items-center justify-between",style:{borderBottom:`1px solid ${s.color["overlay-10"]}`,paddingBottom:4},children:[e.jsx("span",{style:{fontSize:s.typography.size.meta,opacity:.9,width:64},children:B(t.ts)}),e.jsxs("span",{style:{color:n,fontWeight:s.typography.weight.medium},children:[r,t.delta]}),e.jsx("span",{style:{fontSize:s.typography.size.meta,opacity:.85,textAlign:"right",flex:1,marginLeft:8},children:t.note||"Rank movement"})]},t.id)})})]}),S&&ee==="admin"&&e.jsxs("div",{className:"grid md:grid-cols-2",style:{gap:16},children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-between",style:{marginBottom:8},children:e.jsx("h3",{style:{fontSize:s.typography.size.section,fontWeight:s.typography.weight.semibold},children:"Ranked History"})}),h.length===0?e.jsx("p",{style:{opacity:.9,fontSize:s.typography.size.body},children:"No point events yet."}):e.jsx("div",{style:{display:"grid",gap:6,maxHeight:256,overflow:"auto"},children:h.filter(t=>t.type==="attendance"||t.type==="task_points").slice(0,10).map((t,n)=>e.jsxs("div",{className:"flex items-start gap-3",style:{padding:6,borderBottom:`1px solid ${s.color["overlay-10"]}`},children:[e.jsx("span",{style:{fontSize:s.typography.size.meta,opacity:.9,width:64},children:B(t.ts)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{style:{fontSize:s.typography.size.body},children:t.note||t.type}),typeof t.points=="number"&&e.jsxs("span",{style:{marginLeft:6,color:s.color.success,fontWeight:s.typography.weight.medium,fontSize:s.typography.size.meta},children:["(+",t.points,")"]})]})]},t.id||n))})]}),e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:s.typography.size.section,fontWeight:s.typography.weight.semibold,marginBottom:8},children:"Points History"}),h.length===0?e.jsx("p",{style:{opacity:.9,fontSize:s.typography.size.body},children:"No point events yet."}):e.jsx("div",{style:{display:"grid",gap:6,maxHeight:256,overflow:"auto"},children:h.filter(t=>t.type==="attendance"||t.type==="task_points").slice(0,10).map((t,n)=>e.jsxs("div",{className:"flex items-start gap-3",style:{padding:6,borderBottom:`1px solid ${s.color["overlay-10"]}`},children:[e.jsx("span",{style:{fontSize:s.typography.size.meta,opacity:.9,width:64},children:B(t.ts)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{style:{fontSize:s.typography.size.body},children:t.note||t.type}),typeof t.points=="number"&&e.jsxs("span",{style:{marginLeft:6,color:s.color.success,fontWeight:s.typography.weight.medium,fontSize:s.typography.size.meta},children:["(+",t.points,")"]})]})]},t.id||n))})]})]}),U&&e.jsx(je,{isOpen:C,onOpenChange:t=>f(!!t),className:"items-center",children:e.jsx(ve,{children:e.jsx(Se,{className:"w-full max-w-lg",children:e.jsxs("div",{className:"rounded-xl border border-input bg-card text-card-foreground shadow-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-input",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Profile Settings"}),e.jsx("button",{onClick:()=>f(!1),"aria-label":"Close",className:"h-8 w-8 inline-flex items-center justify-center rounded hover:bg-foreground/10",children:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm text-muted-foreground",children:"Full name"}),e.jsx(we,{value:x,onChange:t=>R(t.target.value),placeholder:"Your full name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm text-muted-foreground",children:"Academic year"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ke,{value:w,onValueChange:_,children:[e.jsx(Ne,{children:e.jsx(ze,{placeholder:"Select yearâ€¦"})}),e.jsx(Ce,{children:["Freshman","Sophomore","Junior","Senior","Graduate","Alumni"].map(t=>e.jsx(De,{value:t,children:t},t))})]}),w&&e.jsx("button",{type:"button",className:"px-2 text-xs rounded border border-input",onClick:()=>_(""),children:"Clear"})]})]}),e.jsxs("div",{className:"pt-2 flex items-center justify-between gap-3",children:[e.jsx("span",{className:"text-sm",style:{color:s.color.text,fontWeight:s.typography.weight.medium},children:"Participate in ranked pool"}),e.jsx("label",{className:"relative inline-flex items-center cursor-pointer select-none outline-none focus:outline-none",children:e.jsxs("span",{className:"relative inline-flex h-6 w-11 select-none ml-auto",children:[e.jsx("input",{type:"checkbox",checked:!!E,onChange:t=>$(t.target.checked),className:"peer sr-only","aria-label":"Participate in ranked pool"}),e.jsx("span",{className:"pointer-events-none block h-6 w-11 rounded-full border border-border bg-black/15 dark:bg-white/15 transition-colors peer-checked:bg-[#64C7C9] peer-focus-visible:ring-2 peer-focus-visible:ring-[#64C7C9]/60 peer-focus-visible:ring-offset-2 peer-focus-visible:ring-offset-background"}),e.jsx("span",{className:"pointer-events-none absolute left-0.5 top-0.5 h-5 w-5 rounded-full bg-white dark:bg-background shadow transition-transform peer-checked:translate-x-5"})]})})]})]}),e.jsxs("div",{className:"p-4 flex gap-2 border-t border-input",children:[e.jsx("button",{onClick:()=>f(!1),className:"px-3 py-2 rounded border border-input text-sm",children:"Cancel"}),e.jsx("button",{onClick:ae,disabled:F||!x.trim(),className:`px-3 py-2 rounded border text-sm border-input ml-auto ${!x.trim()||F?"opacity-50 cursor-not-allowed":"hover:bg-card/80"}`,children:F?"Savingâ€¦":"Save changes"})]})]})})})})]})]})}export{Ie as default};
