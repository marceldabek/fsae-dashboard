import{a as L,r as c,j as e,L as R}from"./index-DOL89XtO.js";import{fetchPeople as $,fetchProjects as U,fetchTasks as M,fetchSettings as B}from"./firestore-CBdVKXmS.js";function q(){const{id:a}=L(),[l,w]=c.useState(null),[y,S]=c.useState([]),[N,_]=c.useState([]),[j,P]=c.useState([]),[d,F]=c.useState(null);if(c.useEffect(()=>{(async()=>{const[s,n,i,u]=await Promise.all([$(),U(),M(),B()]),f=s.find(o=>o.id===a)||null;w(f),S(n),P(i),_(i.filter(o=>o.assignee_id===a)),F(u)})()},[a]),!l)return e.jsx("div",{className:"text-sm",children:"Loading…"});const g=y.filter(s=>{var n;return((n=s.owner_ids)==null?void 0:n.includes(a))||j.some(i=>i.project_id===s.id&&i.assignee_id===a)}),T=g.length,D=N.length,E=N.filter(s=>s.status!=="Complete").length,x=new Map;for(const s of j)s.status==="Complete"&&s.assignee_id&&x.set(s.assignee_id,(x.get(s.assignee_id)||0)+1);const C=[...x.entries()].sort((s,n)=>n[1]-s[1]),b=a?C.findIndex(([s])=>s===a)+1:void 0,A=x.get(a||"")||0;return e.jsxs("div",{className:"max-w-2xl mx-auto mt-6 space-y-6",children:[e.jsxs("div",{className:"rounded-2xl bg-white/5 border border-white/10 p-4 flex flex-col gap-1.5 relative",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xl font-semibold leading-tight truncate",children:l.name}),l.discord&&e.jsxs("div",{className:"text-xs text-uconn-muted leading-snug truncate",children:["@",l.discord.replace(/^@/,"")]}),e.jsx("div",{className:"text-xs text-uconn-muted leading-snug",children:l.year||l.role})]}),b?e.jsxs("div",{className:"shrink-0 flex flex-col items-end text-right",children:[e.jsx("div",{className:"text-[10px] tracking-wide text-uconn-muted uppercase",children:"Rank"}),e.jsxs("div",{className:"mt-0.5 px-2 py-1 rounded-md bg-gradient-to-r from-brand-teal/30 to-brand-lightTeal/30 border border-brand-teal/40 text-xs font-semibold",children:["#",b]}),e.jsxs("div",{className:"mt-1 text-[10px] text-uconn-muted",children:[A," done"]})]}):e.jsx("div",{className:"shrink-0 text-[10px] text-uconn-muted mt-1",children:"No rank yet"})]}),l.skills&&l.skills.length>0&&e.jsxs("div",{className:"text-sm",children:["Skills: ",l.skills.join(", ")]}),e.jsxs("div",{className:"flex gap-4 mt-1",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold",children:T}),e.jsx("div",{className:"text-xs text-uconn-muted",children:"Projects"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold",children:D}),e.jsx("div",{className:"text-xs text-uconn-muted",children:"Tasks"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold",children:E}),e.jsx("div",{className:"text-xs text-uconn-muted",children:"To Do"})]})]})]}),e.jsxs("div",{className:"rounded-2xl bg-white/5 border border-white/10 p-4",children:[e.jsx("h2",{className:"font-semibold mb-2",children:"Quick Links"}),e.jsxs("ul",{className:"list-disc pl-5 text-sm",children:[(()=>{const s=(d==null?void 0:d.sharepoint_url)||"https://uconn-my.sharepoint.com/shared?id=%2Fsites%2FUConnFormulaSAE%2FShared%20Documents&listurl=https%3A%2F%2Fuconn%2Esharepoint%2Ecom%2Fsites%2FUConnFormulaSAE%2FShared%20Documents";return e.jsx("li",{children:e.jsx("a",{className:"underline",href:s,target:"_blank",children:"SharePoint"})})})(),(d==null?void 0:d.rulebook_url)&&e.jsx("li",{children:e.jsx("a",{className:"underline",href:d.rulebook_url,target:"_blank",children:"Rulebook (PDF)"})})]})]}),e.jsxs("div",{className:"rounded-2xl bg-white/5 border border-white/10 p-4",children:[e.jsx("h2",{className:"font-semibold mb-2",children:"Projects"}),e.jsx("ul",{className:"space-y-3",children:g.map(s=>{const n=j.filter(t=>t.project_id===s.id),i=n.length,u=n.filter(t=>t.status==="Complete").length,f=i?Math.round(u/i*100):0,o=(()=>{const t=s.due_date||"",v=t.match(/(\d{4})[\/-]?(\d{2})[\/-]?(\d{2})/);let m=null;if(v){const[,p,h,k]=v;m=new Date(Number(p),Number(h)-1,Number(k))}else isNaN(Date.parse(t))||(m=new Date(t));if(m){const p=m.toLocaleString("en-US",{month:"long"}),h=m.getDate();return`${p} ${h}${(r=>r===1||r===21||r===31?"st":r===2||r===22?"nd":r===3||r===23?"rd":"th")(h)}`}return t})();return e.jsxs("li",{className:"rounded-xl bg-white/10 border border-white/10 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(R,{className:"underline font-semibold",to:`/project/${s.id}`,children:s.name}),e.jsxs("div",{className:"text-xs text-uconn-muted",children:[u,"/",i," · ",f,"%"]})]}),e.jsxs("div",{className:"text-xs text-uconn-muted",children:[s.description||"—",s.due_date&&e.jsxs(e.Fragment,{children:[" · Due ",o]})]}),n.length>0&&e.jsx("ul",{className:"mt-2 list-disc pl-5 text-sm",children:n.map(t=>e.jsxs("li",{children:[t.description," ",e.jsxs("span",{className:"text-uconn-muted",children:["(",t.status,")"]})]},t.id))})]},s.id)})})]})]})}export{q as default};
