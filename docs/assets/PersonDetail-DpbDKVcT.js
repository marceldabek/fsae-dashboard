const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BzkRah2L.js","assets/index-C0lIRZzO.css"])))=>i.map(i=>d[i]);
import{g as V,r as o,u as Y,f as Z,a as q,b as G,h as J,c as K,_ as X,j as e,L as ee}from"./index-BzkRah2L.js";function te(){const{id:u}=V(),[c,P]=o.useState(null),[T,F]=o.useState([]),[L,C]=o.useState([]),[j,E]=o.useState([]),[v,$]=o.useState([]),[b,A]=o.useState(null),[y,p]=o.useState([]),[w,U]=o.useState([]),[S,I]=o.useState(0),[g]=Y();if(o.useEffect(()=>{(async()=>{const[s,a,n,i,t]=await Promise.all([Z(),q(),G(),J(),K()]);C(s);const l=s.find(r=>r.id===u)||null;if(P(l),F(a),$(n),E(n.filter(r=>r.assignee_id===u)),A(i),U(t),u&&g)try{const r=await X(()=>import("./index-BzkRah2L.js").then(d=>d.W),__vite__mapDeps([0,1]));r&&typeof r.fetchLogsForPerson=="function"?p(await r.fetchLogsForPerson(u)):p([])}catch{p([])}else p([])})()},[u,g]),o.useEffect(()=>{if(!c)return;const s=new Set([2,4,6]),a=new Set(w.filter(t=>t.person_id===c.id).map(t=>t.date));let n=0;const i=new Date;for(let t=0;t<120;t++){const l=i.getDay(),r=i.toISOString().slice(0,10);if(s.has(l))if(a.has(r))n++;else break;i.setDate(i.getDate()-1)}I(n)},[w,c]),!c)return e.jsx("div",{className:"text-sm",children:"Loading…"});const _=T.filter(s=>s.owner_ids?.includes(u)?!0:v.filter(n=>n.project_id===s.id&&n.assignee_id===u).some(n=>n.status!=="Complete")),H=_.length,M=j.length,R=j.filter(s=>s.status!=="Complete").length,B=s=>s===1?.5:s===3?1:s===6?2:s===10?3:s===15?5:s===40?10:s===65?15:s===98?20:s===150?25:s===200?30:Math.max(0,Math.round(s/4)),O=Math.round(j.filter(s=>s.status==="Complete").reduce((s,a)=>s+(typeof a.ranked_points=="number"?B(a.ranked_points):2),0));function N(s){const a="/fsae-dashboard/",n=(s||"Bronze").toLowerCase();return`${a}icons/rank-${n}.png`}const D=(c.rank_history||[]).slice().sort((s,a)=>a.ts-s.ts);function z(s){return s===1||s===21||s===31?"st":s===2||s===22?"nd":s===3||s===23?"rd":"th"}function k(s){const a=s instanceof Date?s:new Date(s),n=a.toLocaleString("en-US",{month:"short"}),i=a.getDate();return`${n} ${i}${z(i)}`}function W(s){return s.replace(/(\d{4})-(\d{2})-(\d{2})/,(a,n,i,t)=>{const l=new Date(Number(n),Number(i)-1,Number(t));return k(l)})}function Q(s){const a=s.note?W(s.note):s.type;return s.type==="attendance"?a.replace(/Attendance\s+\d+\s*pts?\s+on\s+/i,"Attendance "):a}return e.jsxs("div",{className:"max-w-2xl mx-auto mt-6 space-y-6",children:[e.jsxs("div",{className:"rounded-2xl bg-card border border-border p-4 flex flex-col gap-1.5 relative",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xl font-semibold leading-tight truncate flex items-center gap-2",children:e.jsx("span",{className:"truncate",children:c.name})}),c.discord&&e.jsxs("div",{className:"text-xs text-muted-foreground leading-snug truncate uppercase tracking-caps",children:["@",c.discord.replace(/^@/,"")]}),e.jsx("div",{className:"text-xs text-muted-foreground leading-snug uppercase tracking-caps",children:c.year||c.role})]}),g&&c.rank&&e.jsx("img",{src:N(c.rank),alt:c.rank,className:"shrink-0 h-20 w-20 md:h-24 md:w-24 object-contain -mt-2"})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-5 text-center",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-lg font-semibold",children:H}),e.jsx("div",{className:"text-xs text-muted-foreground uppercase tracking-caps",children:"Projects"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-lg font-semibold",children:M}),e.jsx("div",{className:"text-xs text-muted-foreground uppercase tracking-caps",children:"Tasks"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-lg font-semibold",children:R}),e.jsx("div",{className:"text-xs text-muted-foreground uppercase tracking-caps",children:"To Do"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"text-lg font-semibold flex items-center gap-1",children:[S,S>0&&e.jsx("svg",{className:"h-4 w-4 text-orange-400",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{d:"M12 2c.7 2.4 2.1 4.2 4.2 5.5 2 .3 3.3 1.5 3.8 3.6.5 2.1-.2 4-2.1 5.7-.6-1.6-1.5-2.8-2.9-3.6.3 2.2-.5 4-2.4 5.4-1.9 1.4-3.9 1.5-6 .4-2.1-1.1-3.1-2.9-3.1-5.3 0-1.5.5-2.8 1.6-3.9 1.1-1.1 2.4-1.7 3.9-1.7-.4 1.3-.2 2.4.5 3.5.7 1 1.6 1.4 2.7 1.2 1.1-.2 1.8-.9 2-2 .2-1.1-.2-2.1-1.1-3-.9-.9-1.5-2-1.6-3.2-.1-1.2.3-2.4 1.1-3.7Z"})})]}),e.jsx("div",{className:"text-xs text-muted-foreground uppercase tracking-caps",children:"Streak"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-lg font-semibold",children:O}),e.jsx("div",{className:"text-xs text-muted-foreground uppercase tracking-caps",children:"Hrs"})]})]})]}),e.jsxs("div",{className:"rounded-2xl bg-card border border-border p-4",children:[e.jsx("h2",{className:"font-semibold mb-2",children:"Quick Links"}),e.jsxs("ul",{className:"list-disc pl-5 text-sm",children:[(()=>{const s=b?.sharepoint_url||"https://uconn-my.sharepoint.com/shared?id=%2Fsites%2FUConnFormulaSAE%2FShared%20Documents&listurl=https%3A%2F%2Fuconn%2Esharepoint%2Ecom%2Fsites%2FUConnFormulaSAE%2FShared%20Documents";return e.jsx("li",{children:e.jsx("a",{className:"underline",href:s,target:"_blank",children:"SharePoint"})})})(),b?.rulebook_url&&e.jsx("li",{children:e.jsx("a",{className:"underline",href:b.rulebook_url,target:"_blank",children:"Rulebook (PDF)"})})]})]}),e.jsxs("div",{className:"rounded-2xl bg-card border border-border p-4",children:[e.jsx("h2",{className:"font-semibold mb-2",children:"Projects"}),e.jsx("ul",{className:"space-y-3",children:_.map(s=>{const a=v.filter(t=>t.project_id===s.id),n=a.length,i=a.filter(t=>t.status==="Complete").length;return(()=>{const t=s.due_date||"",l=t.match(/(\d{4})[\/-]?(\d{2})[\/-]?(\d{2})/);let r=null;if(l){const[,d,x,f]=l;r=new Date(Number(d),Number(x)-1,Number(f))}else isNaN(Date.parse(t))||(r=new Date(t));if(r){const d=r.toLocaleString("en-US",{month:"long"}),x=r.getDate();return`${d} ${x}${(m=>m===1||m===21||m===31?"st":m===2||m===22?"nd":m===3||m===23?"rd":"th")(x)}`}return t})(),e.jsxs("li",{className:"rounded-xl bg-surface border border-border p-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-0 min-w-0",children:[e.jsx(ee,{className:"text-base md:text-lg font-normal truncate",to:`/project/${s.id}`,children:s.name}),s.subsystem&&e.jsx("div",{className:"text-xs uppercase tracking-caps text-muted-foreground leading-tight truncate mb-2",style:{marginBottom:"8px"},children:s.subsystem})]}),e.jsx("div",{className:"flex items-center gap-2 shrink-0",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:[i,"/",n]})})]}),s.due_date&&(()=>{let t=null;const l=s.due_date,r=l.match(/(\d{4})[\/-]?(\d{2})[\/-]?(\d{2})/);if(r){const[,d,x,f]=r;t=new Date(Number(d),Number(x)-1,Number(f))}else isNaN(Date.parse(l))||(t=new Date(l));if(t){const d=t.toLocaleString("en-US",{weekday:"long"}),x=t.toLocaleString("en-US",{month:"long"}),f=t.getDate(),m=h=>h===1||h===21||h===31?"st":h===2||h===22?"nd":h===3||h===23?"rd":"th";return e.jsxs("div",{className:"text-xs text-muted-foreground uppercase tracking-caps",style:{marginTop:0},children:[d,", ",x," ",f,m(f)]})}return null})(),a.filter(t=>t.status!=="Complete").length>0&&e.jsx("ul",{className:"mt-3 grid grid-cols-1 md:grid-cols-2 gap-1",children:a.filter(t=>t.status!=="Complete").map(t=>{const l=t.status==="In Progress"?"bg-warning":"bg-destructive";return e.jsxs("li",{className:"relative flex flex-col justify-between gap-2 rounded bg-surface border border-border p-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-medium text-sm truncate",title:t.description,children:t.description}),e.jsxs("div",{className:"text-tick text-muted-foreground flex gap-2 items-center mt-0.5",children:[e.jsx("span",{className:"capitalize",children:t.status}),e.jsx("span",{children:"·"}),e.jsx("span",{children:t.assignee_id?`@${L.find(r=>r.id===t.assignee_id)?.name||"Assignee"}`:"Unassigned"})]})]}),e.jsx("span",{className:`absolute right-3 top-1/2 -translate-y-1/2 w-3.5 h-3.5 rounded-full ${l} shadow`,style:{transform:"translateY(-50%)"},"aria-hidden":!0})]},t.id)})})]},s.id)})})]}),e.jsxs("div",{className:"rounded-2xl bg-card border border-border p-4",children:[e.jsx("h2",{className:"font-semibold mb-2",children:"Badges"}),c.skills&&c.skills.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:c.skills.map((s,a)=>e.jsx("span",{className:"text-xs px-3 py-1 rounded bg-accent/10 border border-accent/30 text-accent font-medium uppercase tracking-caps",children:s},a))}):e.jsx("div",{className:"text-xs text-muted-foreground uppercase tracking-caps",children:"No badges yet."})]}),g?e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"rounded-2xl bg-card border border-border p-4 relative",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("h2",{className:"font-semibold flex-1",children:"Ranked History"}),e.jsx("button",{className:"px-3 py-0.5 rounded bg-accent/10 border border-accent/30 text-accent font-medium uppercase tracking-caps text-xs hover:bg-accent/20 transition",type:"button",onClick:()=>alert("Trophy cabinet coming soon!"),children:"Trophies"})]}),D.length===0?e.jsx("div",{className:"text-xs text-muted-foreground uppercase tracking-caps",children:"No rank changes yet."}):e.jsx("ul",{className:"space-y-2 text-sm",children:D.map((s,a)=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground w-24 uppercase tracking-caps",children:k(s.ts)}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("img",{src:N(s.from),alt:s.from,className:"h-4 w-4 object-contain"}),e.jsx("span",{children:s.from})]}),e.jsx("span",{className:"text-muted-foreground",children:"→"}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("img",{src:N(s.to),alt:s.to,className:"h-4 w-4 object-contain"}),e.jsx("span",{children:s.to})]})]},a))})]}),e.jsxs("div",{className:"rounded-2xl bg-card border border-border p-4",children:[e.jsx("h2",{className:"font-semibold mb-2",children:"Points History"}),y.length===0?e.jsx("div",{className:"text-xs text-muted-foreground uppercase tracking-caps",children:"No point events yet."}):e.jsx("ul",{className:"space-y-2 text-sm max-h-72 overflow-auto pr-1",children:y.filter(s=>s.type==="attendance"||s.type==="task_points").slice(0,100).map((s,a)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground w-24 shrink-0 uppercase tracking-caps",children:k(s.ts)}),e.jsxs("span",{className:"flex-1",children:[e.jsx("span",{className:"text-foreground",children:Q(s)})," ",typeof s.points=="number"&&e.jsxs("span",{className:"text-accent font-semibold",children:["(+",s.points,")"]})]})]},s.id||a))})]})]}):null]})}export{te as default};
