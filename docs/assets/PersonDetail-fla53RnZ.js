import{e as H,r as o,u as M,f as R,a as z,b as B,g as I,h as Q,j as e,L as q}from"./index-BuVp9-lB.js";function J(){const{id:l}=H(),[n,S]=o.useState(null),[_,P]=o.useState([]),[h,D]=o.useState([]),[N,F]=o.useState([]),[i,T]=o.useState(null),[g,L]=o.useState([]),[b]=M();if(o.useEffect(()=>{(async()=>{const[s,t,r,d]=await Promise.all([R(),z(),B(),I()]),f=s.find(m=>m.id===l)||null;if(S(f),P(t),F(r),D(r.filter(m=>m.assignee_id===l)),T(d),l)try{L(await Q(l))}catch{}})()},[l]),!n)return e.jsx("div",{className:"text-sm",children:"Loading…"});const k=_.filter(s=>{var t;return((t=s.owner_ids)==null?void 0:t.includes(l))||N.some(r=>r.project_id===s.id&&r.assignee_id===l)}),E=k.length,$=h.length,C=h.filter(s=>s.status!=="Complete").length,A=s=>s===1?.5:s===3?1:s===6?2:s===10?3:s===15?5:s===40?10:s===65?15:s===98?20:s===150?25:s===200?30:Math.max(0,Math.round(s/4)),U=Math.round(h.filter(s=>s.status==="Complete").reduce((s,t)=>s+(typeof t.ranked_points=="number"?A(t.ranked_points):2),0));function j(s){const t="/fsae-dashboard/",r=(s||"Bronze").toLowerCase();return`${t}icons/rank-${r}.png`}const w=(n.rank_history||[]).slice().sort((s,t)=>t.ts-s.ts);return e.jsxs("div",{className:"max-w-2xl mx-auto mt-6 space-y-6",children:[e.jsxs("div",{className:"rounded-2xl bg-white/5 border border-white/10 p-4 flex flex-col gap-1.5 relative",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xl font-semibold leading-tight truncate flex items-center gap-2",children:e.jsx("span",{className:"truncate",children:n.name})}),n.discord&&e.jsxs("div",{className:"text-xs text-uconn-muted leading-snug truncate",children:["@",n.discord.replace(/^@/,"")]}),e.jsx("div",{className:"text-xs text-uconn-muted leading-snug",children:n.year||n.role})]}),b&&n.rank&&e.jsx("img",{src:j(n.rank),alt:n.rank,className:"shrink-0 h-20 w-20 md:h-24 md:w-24 object-contain -mt-2"})]}),n.skills&&n.skills.length>0&&e.jsxs("div",{className:"text-sm",children:["Skills: ",n.skills.join(", ")]}),e.jsxs("div",{className:"flex gap-4 mt-1",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold",children:E}),e.jsx("div",{className:"text-xs text-uconn-muted",children:"Projects"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold",children:$}),e.jsx("div",{className:"text-xs text-uconn-muted",children:"Tasks"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold",children:C}),e.jsx("div",{className:"text-xs text-uconn-muted",children:"To Do"})]})]}),e.jsxs("span",{className:"absolute bottom-4 right-6 text-sm text-uconn-muted/90 tracking-wide",children:[U,"hrs"]})]}),e.jsxs("div",{className:"rounded-2xl bg-white/5 border border-white/10 p-4",children:[e.jsx("h2",{className:"font-semibold mb-2",children:"Quick Links"}),e.jsxs("ul",{className:"list-disc pl-5 text-sm",children:[(()=>{const s=(i==null?void 0:i.sharepoint_url)||"https://uconn-my.sharepoint.com/shared?id=%2Fsites%2FUConnFormulaSAE%2FShared%20Documents&listurl=https%3A%2F%2Fuconn%2Esharepoint%2Ecom%2Fsites%2FUConnFormulaSAE%2FShared%20Documents";return e.jsx("li",{children:e.jsx("a",{className:"underline",href:s,target:"_blank",children:"SharePoint"})})})(),(i==null?void 0:i.rulebook_url)&&e.jsx("li",{children:e.jsx("a",{className:"underline",href:i.rulebook_url,target:"_blank",children:"Rulebook (PDF)"})})]})]}),e.jsxs("div",{className:"rounded-2xl bg-white/5 border border-white/10 p-4",children:[e.jsx("h2",{className:"font-semibold mb-2",children:"Projects"}),e.jsx("ul",{className:"space-y-3",children:k.map(s=>{const t=N.filter(a=>a.project_id===s.id),r=t.length,d=t.filter(a=>a.status==="Complete").length,f=r?Math.round(d/r*100):0,m=(()=>{const a=s.due_date||"",v=a.match(/(\d{4})[\/-]?(\d{2})[\/-]?(\d{2})/);let x=null;if(v){const[,p,u,y]=v;x=new Date(Number(p),Number(u)-1,Number(y))}else isNaN(Date.parse(a))||(x=new Date(a));if(x){const p=x.toLocaleString("en-US",{month:"long"}),u=x.getDate();return`${p} ${u}${(c=>c===1||c===21||c===31?"st":c===2||c===22?"nd":c===3||c===23?"rd":"th")(u)}`}return a})();return e.jsxs("li",{className:"rounded-xl bg-white/10 border border-white/10 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(q,{className:"underline font-semibold",to:`/project/${s.id}`,children:s.name}),e.jsxs("div",{className:"text-xs text-uconn-muted",children:[d,"/",r," · ",f,"%"]})]}),e.jsxs("div",{className:"text-xs text-uconn-muted",children:[s.description||"—",s.due_date&&e.jsxs(e.Fragment,{children:[" · Due ",m]})]}),t.length>0&&e.jsx("ul",{className:"mt-2 list-disc pl-5 text-sm",children:t.map(a=>e.jsxs("li",{children:[a.description," ",e.jsxs("span",{className:"text-uconn-muted",children:["(",a.status,")"]})]},a.id))})]},s.id)})})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[b&&e.jsxs("div",{className:"rounded-2xl bg-white/5 border border-white/10 p-4",children:[e.jsx("h2",{className:"font-semibold mb-2",children:"Ranked History"}),w.length===0?e.jsx("div",{className:"text-xs text-uconn-muted",children:"No rank changes yet."}):e.jsx("ul",{className:"space-y-2 text-sm",children:w.map((s,t)=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-uconn-muted w-28",children:new Date(s.ts).toLocaleDateString("en-US")}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("img",{src:j(s.from),alt:s.from,className:"h-4 w-4 object-contain"}),e.jsx("span",{children:s.from})]}),e.jsx("span",{className:"text-uconn-muted",children:"→"}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("img",{src:j(s.to),alt:s.to,className:"h-4 w-4 object-contain"}),e.jsx("span",{children:s.to})]})]},t))})]}),e.jsxs("div",{className:"rounded-2xl bg-white/5 border border-white/10 p-4",children:[e.jsx("h2",{className:"font-semibold mb-2",children:"Points History"}),g.length===0?e.jsx("div",{className:"text-xs text-uconn-muted",children:"No point events yet."}):e.jsx("ul",{className:"space-y-2 text-sm max-h-72 overflow-auto pr-1",children:g.filter(s=>s.type==="attendance"||s.type==="task_points").slice(0,100).map((s,t)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-[11px] text-uconn-muted w-24 shrink-0",children:new Date(s.ts).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.jsxs("span",{className:"flex-1",children:[e.jsx("span",{className:"text-white/90",children:s.note||s.type})," ",typeof s.points=="number"&&e.jsxs("span",{className:"text-brand-teal font-semibold",children:["(+",s.points,")"]})]})]},s.id||t))})]})]})]})}export{J as default};
