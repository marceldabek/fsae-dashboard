const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DXTGS8wg.js","assets/index-CYK5SDyI.css"])))=>i.map(i=>d[i]);
import{h as V,r as o,u as W,g as Y,f as Z,a as q,b as G,i as J,c as K,_ as X,j as e,L as ee}from"./index-DXTGS8wg.js";function te(){const{id:u}=V(),[c,T]=o.useState(null),[F,L]=o.useState([]),[E,$]=o.useState([]),[v,A]=o.useState([]),[y,C]=o.useState([]),[j,U]=o.useState(null),[w,g]=o.useState([]),[S,I]=o.useState([]),[_,R]=o.useState(0),[f]=W(),{role:D}=Y();if(o.useEffect(()=>{(async()=>{const[s,a,n,l,t]=await Promise.all([Z(),q(),G(),J(),K()]);$(s);const i=s.find(r=>r.id===u)||null;if(T(i),L(a),C(n),A(n.filter(r=>r.assignee_id===u)),U(l),I(t),u&&f)try{const r=await X(()=>import("./index-DXTGS8wg.js").then(d=>d.a3),__vite__mapDeps([0,1]));r&&typeof r.fetchLogsForPerson=="function"?g(await r.fetchLogsForPerson(u)):g([])}catch{g([])}else g([])})()},[u,f]),o.useEffect(()=>{if(!c)return;const s=new Set([2,4,6]),a=new Set(S.filter(t=>t.person_id===c.id).map(t=>t.date));let n=0;const l=new Date;for(let t=0;t<120;t++){const i=l.getDay(),r=l.toISOString().slice(0,10);if(s.has(i))if(a.has(r))n++;else break;l.setDate(l.getDate()-1)}R(n)},[S,c]),!c)return e.jsx("div",{className:"text-sm",children:"Loading…"});const N=F.filter(s=>s.owner_ids?.includes(u)?!0:y.filter(n=>n.project_id===s.id&&n.assignee_id===u).some(n=>n.status!=="Complete")),B=N.length,O=v.length,z=v.filter(s=>s.status!=="Complete").length;function b(s){const a="/fsae-dashboard/",n=(s||"Bronze").toLowerCase();return`${a}icons/rank-${n}.png`}const P=(c.rank_history||[]).slice().sort((s,a)=>a.ts-s.ts);function H(s){return s===1||s===21||s===31?"st":s===2||s===22?"nd":s===3||s===23?"rd":"th"}function k(s){const a=s instanceof Date?s:new Date(s),n=a.toLocaleString("en-US",{month:"short"}),l=a.getDate();return`${n} ${l}${H(l)}`}function M(s){return s.replace(/(\d{4})-(\d{2})-(\d{2})/,(a,n,l,t)=>{const i=new Date(Number(n),Number(l)-1,Number(t));return k(i)})}function Q(s){const a=s.note?M(s.note):s.type;return s.type==="attendance"?a.replace(/Attendance\s+\d+\s*pts?\s+on\s+/i,"Attendance "):a}return e.jsxs("div",{className:"max-w-2xl mx-auto mt-6 space-y-6",children:[e.jsxs("div",{className:"rounded-2xl bg-card border border-border p-4 flex flex-col gap-1.5 relative",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xl font-semibold leading-tight truncate flex items-center gap-2",children:e.jsx("span",{className:"truncate",children:c.name})}),c.discord&&e.jsxs("div",{className:"text-xs text-muted-foreground leading-snug truncate uppercase tracking-caps",children:["@",c.discord.replace(/^@/,"")]}),e.jsx("div",{className:"text-xs text-muted-foreground leading-snug uppercase tracking-caps",children:c.year||c.role})]}),f&&D==="admin"&&c.rank&&e.jsx("img",{src:b(c.rank),alt:c.rank,className:"shrink-0 h-20 w-20 md:h-24 md:w-24 object-contain -mt-2"})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-4 text-center",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-lg font-semibold",children:B}),e.jsx("div",{className:"text-xs text-muted-foreground uppercase tracking-caps",children:"Projects"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-lg font-semibold",children:O}),e.jsx("div",{className:"text-xs text-muted-foreground uppercase tracking-caps",children:"Tasks"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-lg font-semibold",children:z}),e.jsx("div",{className:"text-xs text-muted-foreground uppercase tracking-caps",children:"To Do"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"text-lg font-semibold flex items-center gap-1",children:[_,_>0&&e.jsx("svg",{className:"h-4 w-4 text-orange-400",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{d:"M12 2c.7 2.4 2.1 4.2 4.2 5.5 2 .3 3.3 1.5 3.8 3.6.5 2.1-.2 4-2.1 5.7-.6-1.6-1.5-2.8-2.9-3.6.3 2.2-.5 4-2.4 5.4-1.9 1.4-3.9 1.5-6 .4-2.1-1.1-3.1-2.9-3.1-5.3 0-1.5.5-2.8 1.6-3.9 1.1-1.1 2.4-1.7 3.9-1.7-.4 1.3-.2 2.4.5 3.5.7 1 1.6 1.4 2.7 1.2 1.1-.2 1.8-.9 2-2 .2-1.1-.2-2.1-1.1-3-.9-.9-1.5-2-1.6-3.2-.1-1.2.3-2.4 1.1-3.7Z"})})]}),e.jsx("div",{className:"text-xs text-muted-foreground uppercase tracking-caps",children:"Streak"})]})]})]}),e.jsxs("div",{className:"rounded-2xl bg-card border border-border p-4",children:[e.jsx("h2",{className:"font-semibold mb-2",children:"Quick Links"}),e.jsxs("ul",{className:"list-disc pl-5 text-sm",children:[(()=>{const s=j?.sharepoint_url||"https://uconn-my.sharepoint.com/shared?id=%2Fsites%2FUConnFormulaSAE%2FShared%20Documents&listurl=https%3A%2F%2Fuconn%2Esharepoint%2Ecom%2Fsites%2FUConnFormulaSAE%2FShared%20Documents";return e.jsx("li",{children:e.jsx("a",{className:"underline",href:s,target:"_blank",children:"SharePoint"})})})(),j?.rulebook_url&&e.jsx("li",{children:e.jsx("a",{className:"underline",href:j.rulebook_url,target:"_blank",children:"Rulebook (PDF)"})})]})]}),e.jsxs("div",{className:"rounded-2xl bg-card border border-border p-4",children:[e.jsx("h2",{className:"font-semibold mb-2",children:"Projects"}),N.length===0?e.jsx("div",{className:"text-xs text-muted-foreground uppercase tracking-caps",children:"No projects yet."}):e.jsx("ul",{className:"space-y-3",children:N.map(s=>{const a=y.filter(t=>t.project_id===s.id),n=a.length,l=a.filter(t=>t.status==="Complete").length;return(()=>{const t=s.due_date||"",i=t.match(/(\d{4})[\/-]?(\d{2})[\/-]?(\d{2})/);let r=null;if(i){const[,d,x,p]=i;r=new Date(Number(d),Number(x)-1,Number(p))}else isNaN(Date.parse(t))||(r=new Date(t));if(r){const d=r.toLocaleString("en-US",{month:"long"}),x=r.getDate();return`${d} ${x}${(m=>m===1||m===21||m===31?"st":m===2||m===22?"nd":m===3||m===23?"rd":"th")(x)}`}return t})(),e.jsxs("li",{className:"rounded-xl bg-surface border border-border p-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-0 min-w-0",children:[e.jsx(ee,{className:"text-base md:text-lg font-normal truncate",to:`/project/${s.id}`,children:s.name}),s.subsystem&&e.jsx("div",{className:"text-xs uppercase tracking-caps text-muted-foreground leading-tight truncate mb-2",style:{marginBottom:"8px"},children:s.subsystem})]}),e.jsx("div",{className:"flex items-center gap-2 shrink-0",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:[l,"/",n]})})]}),s.due_date&&(()=>{let t=null;const i=s.due_date,r=i.match(/(\d{4})[\/-]?(\d{2})[\/-]?(\d{2})/);if(r){const[,d,x,p]=r;t=new Date(Number(d),Number(x)-1,Number(p))}else isNaN(Date.parse(i))||(t=new Date(i));if(t){const d=t.toLocaleString("en-US",{weekday:"long"}),x=t.toLocaleString("en-US",{month:"long"}),p=t.getDate(),m=h=>h===1||h===21||h===31?"st":h===2||h===22?"nd":h===3||h===23?"rd":"th";return e.jsxs("div",{className:"text-xs text-muted-foreground uppercase tracking-caps",style:{marginTop:0},children:[d,", ",x," ",p,m(p)]})}return null})(),a.filter(t=>t.status!=="Complete").length>0&&e.jsx("ul",{className:"mt-3 grid grid-cols-1 md:grid-cols-2 gap-1",children:a.filter(t=>t.status!=="Complete").map(t=>{const i=t.status==="In Progress"?"bg-warning":"bg-destructive";return e.jsxs("li",{className:"relative flex flex-col justify-between gap-2 rounded bg-surface border border-border p-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-medium text-sm truncate",title:t.description,children:t.description}),e.jsxs("div",{className:"text-tick text-muted-foreground flex gap-2 items-center mt-0.5",children:[e.jsx("span",{className:"capitalize",children:t.status}),e.jsx("span",{children:"·"}),e.jsx("span",{children:t.assignee_id?`@${E.find(r=>r.id===t.assignee_id)?.name||"Assignee"}`:"Unassigned"})]})]}),e.jsx("span",{className:`absolute right-3 top-1/2 -translate-y-1/2 w-3.5 h-3.5 rounded-full ${i} shadow`,style:{transform:"translateY(-50%)"},"aria-hidden":!0})]},t.id)})})]},s.id)})})]}),e.jsxs("div",{className:"rounded-2xl bg-card border border-border p-4",children:[e.jsx("h2",{className:"font-semibold mb-2",children:"Badges"}),c.skills&&c.skills.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:c.skills.map((s,a)=>e.jsx("span",{className:"text-xs px-3 py-1 rounded bg-accent/10 border border-accent/30 text-accent font-medium uppercase tracking-caps",children:s},a))}):e.jsx("div",{className:"text-xs text-muted-foreground uppercase tracking-caps",children:"No badges yet."})]}),f&&D==="admin"?e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"rounded-2xl bg-card border border-border p-4 relative",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("h2",{className:"font-semibold flex-1",children:"Ranked History"}),e.jsx("button",{className:"px-3 py-0.5 rounded bg-accent/10 border border-accent/30 text-accent font-medium uppercase tracking-caps text-xs hover:bg-accent/20 transition",type:"button",onClick:()=>alert("Trophy cabinet coming soon!"),children:"Trophies"})]}),P.length===0?e.jsx("div",{className:"text-xs text-muted-foreground uppercase tracking-caps",children:"No rank changes yet."}):e.jsx("ul",{className:"space-y-2 text-sm",children:P.map((s,a)=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground w-24 uppercase tracking-caps",children:k(s.ts)}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("img",{src:b(s.from),alt:s.from,className:"h-4 w-4 object-contain"}),e.jsx("span",{children:s.from})]}),e.jsx("span",{className:"text-muted-foreground",children:"→"}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("img",{src:b(s.to),alt:s.to,className:"h-4 w-4 object-contain"}),e.jsx("span",{children:s.to})]})]},a))})]}),e.jsxs("div",{className:"rounded-2xl bg-card border border-border p-4",children:[e.jsx("h2",{className:"font-semibold mb-2",children:"Points History"}),w.length===0?e.jsx("div",{className:"text-xs text-muted-foreground uppercase tracking-caps",children:"No point events yet."}):e.jsx("ul",{className:"space-y-2 text-sm max-h-72 overflow-auto pr-1",children:w.filter(s=>s.type==="attendance"||s.type==="task_points").slice(0,100).map((s,a)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground w-24 shrink-0 uppercase tracking-caps",children:k(s.ts)}),e.jsxs("span",{className:"flex-1",children:[e.jsx("span",{className:"text-foreground",children:Q(s)})," ",typeof s.points=="number"&&e.jsxs("span",{className:"text-accent font-semibold",children:["(+",s.points,")"]})]})]},s.id||a))})]})]}):null]})}export{te as default};
