const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Bf8EZJGZ.js","assets/index-D1urMubx.css"])))=>i.map(i=>d[i]);
import{g as J,r as a,u as K,d as Q,_ as X,f as Z,j as e,k as ee,l as se,i as te,m as ne,n as k,o as re,p as E,q as ae}from"./index-Bf8EZJGZ.js";import{P as ie}from"./ProgressBar-DTbBSMY1.js";import{P as I}from"./PersonSelectPopover-_Pj7svpb.js";import{T as le}from"./TaskCreateCard-Bh2HK0Fw.js";function Ne(){const{id:h}=J(),[n,y]=a.useState(null),[B,C]=a.useState([]),[c,O]=a.useState([]),[p,$]=a.useState([]),[R]=K(),[P,S]=a.useState(""),[U,w]=a.useState(!1),A=Q()?.uid||null,u=se(A)||te(A),[x,v]=a.useState([]),f=a.useRef(0),[W,b]=a.useState(!1);a.useEffect(()=>{(async()=>{const[s,r]=await Promise.all([(await X(async()=>{const{fetchProjects:d}=await import("./index-Bf8EZJGZ.js").then(t=>t.P);return{fetchProjects:d}},__vite__mapDeps([0,1]))).fetchProjects(),Z()]),i=s.find(d=>d.id===h)||null;y(i||null),O(r);const l=i?.owner_ids||[];v(l),C(l.map(d=>r.find(t=>t.id===d)).filter(Boolean)||[])})()},[h]),a.useEffect(()=>{C(x.map(s=>c.find(r=>r.id===s)).filter(Boolean))},[x,c]);async function m(){h&&$(await re(h))}a.useEffect(()=>{m()},[h]);const g=p.length,_=p.filter(s=>s.status==="Complete").length,T=g>0?_/g*100:0,[oe,ce]=a.useState(""),[ue,xe]=a.useState(""),[me,he]=a.useState("");async function V(s){if(!n||x.includes(s))return;const r=++f.current,i=[...x,s];v(i),b(!0);try{await E(n.id,i)}finally{f.current===r&&b(!1)}}async function z(s){if(!n)return;const r=++f.current,i=x.filter(l=>l!==s);v(i),b(!0);try{await E(n.id,i)}finally{f.current===r&&b(!1)}}const[pe,fe]=a.useState("In Progress");async function N(s,r){await k(s.id,{status:r}),await m()}async function H(s,r){await k(s.id,{assignee_id:r||void 0}),await m()}async function M(s){await ae(s.id),await m()}const[L,F]=a.useState(!1),[q,j]=a.useState(!1);if(!n)return e.jsx("div",{className:"text-sm",children:"Loading…"});const D=(()=>{if(!n.due_date)return null;let s=null;const r=n.due_date,i=r.match(/(\d{4})[\/-]?(\d{2})[\/-]?(\d{2})/);if(i){const[,o,Y,G]=i;s=new Date(Number(o),Number(Y)-1,Number(G))}else isNaN(Date.parse(r))||(s=new Date(r));if(!s)return null;const l=s.toLocaleString("en-US",{weekday:"short"}),d=s.toLocaleString("en-US",{month:"short"}),t=s.getDate();return`Due ${l} ${d} ${t}${(o=>o===1||o===21||o===31?"st":o===2||o===22?"nd":o===3||o===23?"rd":"th")(t)}`})();return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"min-w-0 space-y-1",children:[e.jsx("h1",{className:"text-2xl font-semibold leading-tight tracking-tight break-words pr-40 sm:pr-0",children:n.name}),n.subsystem&&e.jsx("div",{className:"text-[11px] font-medium text-accent/80 uppercase tracking-caps mt-0.5",children:n.subsystem})]}),e.jsxs("div",{className:"absolute top-0 right-0 flex gap-2 items-start",children:[n.design_link&&e.jsx("a",{className:"inline-flex items-center justify-center h-7 px-3 rounded-md border border-brand-blue/40 bg-brand-blue/20 hover:bg-brand-blue/30 text-[11px] font-medium whitespace-nowrap transition",href:n.design_link,target:"_blank",rel:"noreferrer",title:"Design link",children:"Link"}),u&&!n.archived&&e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>w(!0),className:"inline-flex items-center justify-center h-7 px-3 rounded-md border border-red-500/50 bg-red-500/15 hover:bg-red-500/25 text-red-200 text-[11px] font-medium whitespace-nowrap transition",children:"Archive"}),U&&e.jsxs("div",{className:"absolute right-0 mt-2 w-72 rounded bg-surface border border-border p-3 shadow-lg z-20",children:[e.jsx("div",{className:"text-sm",children:"Archive this project? You can re-enable it from the Admin page."}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx("button",{className:"px-3 py-1 rounded bg-red-600 text-white",onClick:async()=>{n&&(await ne(n.id),y(s=>s&&{...s,archived:!0}),w(!1),S("Project archived — re-enable from Admin"),setTimeout(()=>S(""),3e3))},children:"Confirm"}),e.jsx("button",{className:"px-3 py-1 rounded bg-overlay-6 border border-border",onClick:()=>w(!1),children:"Cancel"})]})]})]}),u&&n.archived&&e.jsx("span",{className:"inline-flex items-center h-9 px-3 rounded border border-yellow-400/40 bg-yellow-400/10 text-xs text-yellow-300 font-semibold uppercase tracking-wide",children:"Archived"})]}),e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"text-muted/70 uppercase tracking-caps text-[11px]",children:"Owners"}),D&&e.jsx("span",{className:"text-[11px] text-muted/70 uppercase tracking-caps whitespace-nowrap ml-auto text-right",children:D})]}),e.jsxs("div",{className:"flex flex-wrap items-start gap-2 text-[13px] leading-snug",children:[e.jsx("span",{className:"font-medium text-white/90 whitespace-normal break-words pr-1",children:B.map(s=>s.name).join(", ")||"—"}),u&&!n.archived&&e.jsx(I,{mode:"multi",people:c,selectedIds:x,onAdd:V,onRemove:z,triggerLabel:"Add/Remove",triggerContent:e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),buttonClassName:"inline-flex items-center justify-center h-6 w-6 rounded-md border border-accent/40 bg-accent/15 hover:bg-accent/25 text-accent transition",disabled:W,maxItems:5})]})]})]}),P&&e.jsx("div",{className:"fixed bottom-6 right-6 px-4 py-2 rounded shadow bg-surface/95 border border-accent/40 text-[13px] leading-snug text-white font-medium backdrop-blur-sm",children:P}),e.jsx("div",{className:"mt-2",children:e.jsx(ie,{value:T,color:T===100?"linear-gradient(90deg,#22c55e,#16a34a)":void 0})}),e.jsx("div",{className:"text-[11px] text-muted text-center uppercase tracking-caps font-medium tracking-wide mt-1 mb-1",children:g>0?`${_}/${g} complete`:"No tasks yet"}),e.jsxs("section",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center w-full max-w-xs mx-auto mb-2",style:{minWidth:"250px",maxWidth:"390px"},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-gray-400 inline-block","aria-hidden":!0}),e.jsx("span",{className:"text-[11px] text-muted uppercase tracking-caps font-medium",children:"To-do / Not started"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-yellow-400 inline-block","aria-hidden":!0}),e.jsx("span",{className:"text-[11px] text-muted uppercase tracking-caps font-medium",children:"In Progress"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500 inline-block","aria-hidden":!0}),e.jsx("span",{className:"text-[11px] text-muted uppercase tracking-caps font-medium",children:"Complete"})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"font-semibold text-base leading-tight",children:"Tasks"}),u&&!n.archived&&e.jsxs("button",{"aria-label":"Add task",onClick:()=>j(!0),className:"group inline-flex items-center justify-center h-7 w-7 rounded-md border border-accent/40 bg-accent/15 hover:bg-accent/25 text-accent transition shadow-sm hover:shadow-accent/20 focus:outline-none focus-visible:ring-2 focus-visible:ring-accent/60",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.1",strokeLinecap:"round",strokeLinejoin:"round",className:"drop-shadow-sm",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),e.jsx("span",{className:"sr-only",children:"Add task"})]})]}),e.jsxs("label",{className:"flex items-center gap-2 select-none cursor-pointer group",children:[e.jsx("span",{className:"text-[11px] font-medium text-muted uppercase tracking-caps",children:"Hide completed"}),e.jsxs("span",{className:"relative inline-block w-10 h-6 align-middle select-none",children:[e.jsx("input",{type:"checkbox",checked:L,onChange:s=>F(s.target.checked),className:"peer absolute w-10 h-6 opacity-0 cursor-pointer z-10"}),e.jsx("span",{className:"block w-10 h-6 rounded-full transition bg-surface border border-border peer-checked:bg-accent/70"}),e.jsx("span",{className:"absolute left-1 top-1 w-4 h-4 rounded-full bg-muted transition-all duration-200 peer-checked:translate-x-4 peer-checked:bg-accent shadow"})]})]})]}),e.jsx("ul",{className:u?"flex flex-wrap gap-3":"space-y-2",children:(L?p.filter(s=>s.status!=="Complete"):p).map(s=>{const r=s.status==="Complete"?"bg-green-500":s.status==="In Progress"?"bg-yellow-400":"bg-red-500",i=c.find(t=>t.id===s.assignee_id),l=s.ranked_points??(s.status==="Complete"?35:10),d=t=>t===1?.5:t===3?1:t===10?3:t===6?2:t===15?5:t===40?10:t===65?15:t===98?20:t===150?25:t===200?30:Math.max(0,Math.round(t/4));return e.jsxs("li",{className:"relative flex flex-col justify-between gap-2 rounded bg-surface border border-border p-3 pr-10 flex-1 min-w-[280px] md:w-[calc(50%-0.75rem)] xl:w-[calc(33.333%-0.75rem)]",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-medium text-sm truncate",title:s.description,children:s.description}),e.jsxs("div",{className:"text-tick text-muted flex gap-2 items-center mt-0.5",children:[e.jsx("span",{children:s.status}),e.jsx("span",{children:"·"}),u?e.jsx(I,{mode:"single",people:c,selectedId:s.assignee_id||null,onSelect:t=>H(s,t||""),triggerLabel:s.assignee_id?c.find(t=>t.id===s.assignee_id)?.name||"Assignee":"Unassigned",buttonClassName:"px-2 py-0.5 rounded bg-surface/60 border border-border text-tick text-sm whitespace-nowrap",maxItems:5}):e.jsx("span",{className:"px-2 py-0.5 rounded bg-transparent",children:i?`@${i.name}`:"Unassigned"})]})]}),R&&e.jsxs("span",{className:"absolute top-2 right-3 text-tick text-muted font-semibold",children:["+",l," · ",d(l),"h"]}),u&&e.jsxs("div",{className:"w-full flex flex-col gap-1 text-xs",children:[e.jsxs("div",{className:"flex items-center justify-between w-full gap-2 flex-wrap",children:[e.jsxs("div",{className:"flex w-full gap-1.5 flex-wrap",children:[e.jsxs("button",{onClick:()=>N(s,"Todo"),className:"inline-flex items-center gap-1 px-2.5 h-7 rounded border text-[11px] font-medium border-white/15 bg-white/5 hover:bg-white/10 transition justify-center flex-1 sm:flex-none sm:justify-start",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-red-400"})," Todo"]}),e.jsxs("button",{onClick:()=>N(s,"In Progress"),className:"inline-flex items-center gap-1 px-2.5 h-7 rounded border text-[11px] font-medium border-white/15 bg-white/5 hover:bg-white/10 transition whitespace-nowrap justify-center flex-1 sm:flex-none sm:justify-start",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-yellow-300"})," In Progress"]}),e.jsxs("button",{onClick:()=>N(s,"Complete"),className:"inline-flex items-center gap-1 px-2.5 h-7 rounded border text-[11px] font-medium border-white/15 bg-white/5 hover:bg-white/10 transition justify-center flex-1 sm:flex-none sm:justify-start",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-green-400"})," Complete"]})]}),e.jsx("div",{})]}),e.jsxs("div",{className:"flex items-center justify-between w-full gap-2 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 w-full",children:[e.jsxs("select",{className:"h-7 px-2.5 rounded bg-surface/60 border border-border text-xs text-text dark-select flex-[2] w-full sm:flex-none sm:w-auto",value:s.ranked_points||"",onChange:t=>k(s.id,{ranked_points:t.target.value?Number(t.target.value):void 0}).then(m),children:[e.jsx("option",{value:"",children:"Points…"}),e.jsx("option",{value:"1",children:"1 pt ~ 0.5 hr"}),e.jsx("option",{value:"3",children:"3 pts ~ 1 hr"}),e.jsx("option",{value:"10",children:"10 pts ~ 3 hrs"}),e.jsx("option",{value:"6",children:"6 pts ~ 2 hrs"}),e.jsx("option",{value:"15",children:"15 pts ~ 5 hrs"}),e.jsx("option",{value:"40",children:"40 pts ~ 10 hrs"}),e.jsx("option",{value:"65",children:"65 pts ~ 15 hrs"}),e.jsx("option",{value:"98",children:"98 pts ~ 20 hrs"}),e.jsx("option",{value:"150",children:"150 pts ~ 25 hrs"}),e.jsx("option",{value:"200",children:"200 pts ~ 30 hrs"})]}),e.jsx("button",{onClick:()=>M(s),className:"inline-flex items-center gap-1 px-2.5 h-7 rounded border text-[11px] font-medium border-red-500/60 text-red-200 bg-red-500/10 hover:bg-red-500/20 transition flex-1 sm:flex-none",children:"Delete"})]}),e.jsx("div",{})]})]}),e.jsx("span",{className:`absolute top-1/2 -translate-y-1/2 right-3 w-3.5 h-3.5 rounded-full ${r} shadow`,"aria-hidden":!0})]},s.id)})})]}),q&&ee.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[120] flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/55 backdrop-blur-sm",onClick:()=>j(!1)}),e.jsxs("div",{className:"relative w-[95vw] max-w-md rounded-2xl border border-white/10 bg-bg/95 backdrop-blur-sm shadow-2xl p-5 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Add Task"}),e.jsx("button",{onClick:()=>j(!1),"aria-label":"Close",className:"h-8 w-8 inline-flex items-center justify-center rounded hover:bg-white/10",children:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"#E5E7EB",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),e.jsx(le,{people:c,fixedProjectId:n.id,onCreated:()=>{m(),j(!1)},hideTitle:!0,unstyled:!0})]})]}),document.body)]})})}export{Ne as default};
