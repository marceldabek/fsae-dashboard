const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-D3k_KiqT.js","assets/index-C7Pwn_nw.css"])))=>i.map(i=>d[i]);
import{r as a,b as me,u as pe,c as he,a as fe,_ as be,f as ge,j as e,R as b,d as je,e as we,g as _,h as ve,i as ke,k as F,l as H,m as V,n as Ne,o as q,p as ye,q as Ce,s as Pe}from"./index-D3k_KiqT.js";import{P as Se}from"./ProgressBar-BTvKeuFa.js";import{P as z}from"./card-mTLGtmKA.js";import{T as _e}from"./TaskCreateModal-AzIZt_ge.js";import"./modal-nQA6oMK7.js";import"./clsx-B-dksMZM.js";function Ve(){const[A,K]=a.useState(!0),[Y,D]=a.useState(!1),G=async()=>{r&&(await ve(r.id),window.location.href="https://marceldabek.github.io/fsae-dashboard/")},{id:l}=me(),[r,f]=a.useState(null),[T,N]=a.useState([]),[m,J]=a.useState([]),[g,Q]=a.useState([]),[X]=pe(),[I,L]=a.useState(""),[Z,y]=a.useState(!1),c=he()?.uid||null,{role:B}=fe(),C=B==="lead"||B==="admin",P=a.useMemo(()=>{if(!r||!c)return!1;const s=c.startsWith("discord:")?c.slice(8):c;return Array.isArray(r.owner_ids)&&r.owner_ids.includes(s)},[r,c]),ee=C||P,[p,j]=a.useState([]),w=a.useRef(0),[se,v]=a.useState(!1);a.useEffect(()=>{(async()=>{const[s,t]=await Promise.all([(await be(async()=>{const{fetchProjects:d}=await import("./index-D3k_KiqT.js").then(u=>u.ab);return{fetchProjects:d}},__vite__mapDeps([0,1]))).fetchProjects(),ge()]),n=s.find(d=>d.id===l)||null;f(n||null),J(t);const o=n?.owner_ids||[];j(o),N(o.map(d=>t.find(u=>u.id===d)).filter(Boolean)||[])})()},[l]),a.useEffect(()=>{N(p.map(s=>m.find(t=>t.id===s)).filter(Boolean))},[p,m]);async function E(){if(!l)return;const s=async()=>{const t=await ye(Ce(Pe,"projects",l));return t.exists()?{id:l,...t.data()}:null};try{let t=await s();if(t||(await new Promise(n=>setTimeout(n,120)),t=await s()),t){f(t);const n=t.owner_ids||[];j(n),N(n.map(o=>m.find(d=>d.id===o)).filter(Boolean))}}catch{}}async function h(){l&&Q(await ke(l))}a.useEffect(()=>{h()},[l]);async function te(){if(!l||!c)return;f(t=>{if(!t)return t;const n=c.startsWith("discord:")?c.slice(8):c,o=Array.from(new Set([...t.owner_ids||[],n]));return{...t,owner_ids:o}});const s=F(q,"claimProject");try{await s({projectId:l})}finally{H(),await E()}}async function re(){if(!l||!c)return;f(t=>{if(!t)return t;const n=c.startsWith("discord:")?c.slice(8):c,o=(t.owner_ids||[]).filter(d=>d!==n);return{...t,owner_ids:o}});const s=F(q,"unclaimProject");try{await s({projectId:l})}finally{H(),await E()}}const k=g.length,R=g.filter(s=>s.status==="Complete").length,M=k>0?R/k*100:0,[De,Te]=a.useState(""),[Ie,Le]=a.useState(""),[Be,Ee]=a.useState("");async function ne(s){if(!r||p.includes(s))return;const t=++w.current,n=[...p,s];j(n),v(!0);try{await V(r.id,n)}finally{w.current===t&&v(!1)}}async function ae(s){if(!r)return;const t=++w.current,n=p.filter(o=>o!==s);j(n),v(!0);try{await V(r.id,n)}finally{w.current===t&&v(!1)}}const[Re,Me]=a.useState("In Progress");async function S(s,t){await _(s.id,{status:t}),await h()}async function ie(s,t){await _(s.id,{assignee_id:t||void 0}),await h()}async function oe(s){await Ne(s.id),await h()}const[O,ce]=a.useState(!1),[de,W]=a.useState(!1),[le,U]=a.useState(null);if(!r)return e.jsx("div",{className:"text-sm",children:"Loading…"});const $=(()=>{if(!r.due_date)return null;let s=null;const t=r.due_date,n=t.match(/(\d{4})[\/\-]?(\d{2})[\/\-]?(\d{2})/);if(n){const[,x,ue,xe]=n;s=new Date(Number(x),Number(ue)-1,Number(xe))}else isNaN(Date.parse(t))||(s=new Date(t));if(!s)return null;const o=s.toLocaleString("en-US",{weekday:"short"}),d=s.toLocaleString("en-US",{month:"short"}),u=s.getDate();return`${o} ${d} ${u}${(x=>x===1||x===21||x===31?"st":x===2||x===22?"nd":x===3||x===23?"rd":"th")(u)}`})();return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"min-w-0 space-y-1",children:[e.jsx("h1",{className:"text-lg font-semibold leading-tight tracking-tight break-words pr-0 max-w-[calc(100%-110px)]",children:r.name}),r.subsystem&&e.jsx("div",{className:"text-[11px] font-medium text-muted/70 uppercase tracking-caps mt-0.5",children:r.subsystem})]}),e.jsxs("div",{className:"absolute top-0 right-0 flex flex-col gap-2 items-end sm:flex-row sm:items-start sm:gap-2",style:{width:"auto"},children:[e.jsxs("div",{className:"flex flex-col space-y-1 sm:flex-row sm:gap-2",children:[r.design_link&&e.jsx("a",{className:"w-[68px] inline-flex items-center justify-center h-6 rounded-md border border-brand-blue/40 bg-brand-blue/20 hover:bg-brand-blue/30 text-[11px] font-medium whitespace-nowrap transition",href:r.design_link,target:"_blank",rel:"noreferrer",title:"Design link",children:"Link"}),e.jsxs(b,{children:[!r.archived&&e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>y(!0),className:"w-[68px] inline-flex items-center justify-center h-6 rounded-md border border-accent/40 bg-accent/10 hover:bg-accent/20 text-accent text-[11px] font-medium whitespace-nowrap transition",children:"Archive"}),Z&&e.jsxs("div",{className:"absolute right-0 mt-2 w-72 rounded bg-surface border border-border p-3 shadow-lg z-20",children:[e.jsx("div",{className:"text-sm",children:"Archive this project? You can re-enable it from the Admin page."}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx("button",{className:"px-3 py-1 rounded bg-destructive text-destructive-foreground",onClick:async()=>{r&&(await je(r.id),f(s=>s&&{...s,archived:!0}),y(!1),L("Project archived — re-enable from Admin"),setTimeout(()=>L(""),3e3))},children:"Confirm"}),e.jsx("button",{className:"px-3 py-1 rounded bg-card dark:bg-surface border border-border",onClick:()=>y(!1),children:"Cancel"})]})]})]}),!r.archived&&e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>D(!0),className:"w-[68px] inline-flex items-center justify-center h-6 rounded-md border border-destructive/40 bg-destructive/10 hover:bg-destructive/20 text-destructive text-[11px] font-medium whitespace-nowrap transition",title:"Delete project",children:"Delete"}),Y&&e.jsxs("div",{className:"absolute right-0 mt-2 w-72 rounded bg-surface border border-border p-3 shadow-lg z-30",children:[e.jsx("div",{className:"text-sm",children:"Delete this project permanently? This cannot be undone."}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx("button",{className:"px-3 py-1 rounded bg-destructive text-destructive-foreground",onClick:G,children:"Confirm Delete"}),e.jsx("button",{className:"px-3 py-1 rounded bg-card dark:bg-surface border border-border",onClick:()=>D(!1),children:"Cancel"})]})]})]})]})]}),e.jsx(b,{children:r.archived&&e.jsx("span",{className:"inline-flex items-center h-7 w-[68px] justify-center rounded border border-accent/40 bg-accent/10 text-xs text-accent font-semibold uppercase tracking-wide",children:"Archived"})})]}),e.jsxs("div",{className:"mb-0",style:{marginTop:"24px"},children:[e.jsxs("button",{className:"text-muted-foreground uppercase tracking-caps text-xs block w-full text-left focus:outline-none",style:{marginBottom:"4px"},onClick:()=>K(s=>!s),children:["Description",e.jsx("span",{className:"ml-2 inline-block align-middle",children:A?"▲":"▼"})]}),A&&e.jsx("div",{className:"rounded-lg border border-border bg-card dark:bg-surface p-3 text-xs text-muted-foreground mb-0",style:{minHeight:"32px"},children:r.description?r.description:e.jsx("span",{className:"text-muted-foreground/40",children:"No description provided."})})]}),e.jsxs("div",{style:{marginTop:"16px"},children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground uppercase tracking-caps text-xs",children:"Owners"}),e.jsx(we,{children:!r.archived&&c&&!C&&(P?e.jsx("button",{onClick:re,className:"inline-flex items-center justify-center h-6 px-2 rounded-md border border-accent/40 bg-accent/10 hover:bg-accent/20 text-accent text-[11px] font-medium",children:"Unclaim"}):e.jsx("button",{onClick:te,className:"inline-flex items-center justify-center h-6 px-2 rounded-md border border-accent/40 bg-accent/10 hover:bg-accent/20 text-accent text-[11px] font-medium",children:"Claim"}))}),e.jsx(b,{children:!r.archived&&e.jsx(z,{mode:"multi",people:m,selectedIds:p,onAdd:ne,onRemove:ae,triggerLabel:"Add/Remove",triggerContent:e.jsxs("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),buttonClassName:"inline-flex items-center justify-center h-4 w-4 rounded-md border border-accent/40 bg-accent/15 hover:bg-accent/25 text-accent transition",disabled:se,maxItems:5})})]}),$&&e.jsx("span",{className:"text-muted-foreground uppercase tracking-caps text-xs ml-auto text-right",children:$})]}),e.jsx("div",{className:"flex flex-wrap items-start gap-2 text-[13px] leading-snug",children:T.length>0?T.map(s=>e.jsx("span",{className:"px-2 py-0.5 rounded bg-surface/80 border border-border text-tick text-sm whitespace-nowrap font-medium",children:s.name},s.id)):e.jsx("span",{className:"px-2 py-0.5 rounded bg-surface/80 border border-border text-tick text-sm whitespace-nowrap font-medium",children:"N/A"})})]})]}),I&&e.jsx("div",{className:"fixed bottom-6 right-6 px-4 py-2 rounded shadow bg-surface/95 border border-accent/40 text-[13px] leading-snug text-white font-medium backdrop-blur-sm",children:I}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(Se,{value:M,color:M===100?"linear-gradient(90deg,#22c55e,#16a34a)":void 0}),e.jsx("div",{style:{marginTop:"4px"},className:"text-[11px] text-muted text-center uppercase tracking-caps font-medium tracking-wide",children:k>0?`${R}/${k} complete`:"No tasks yet"})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"font-semibold text-xs uppercase tracking-caps text-muted-foreground leading-tight",children:"TASKS"}),!r.archived&&(C||P)&&e.jsxs("button",{"aria-label":"Add task",onClick:()=>W(!0),className:"group inline-flex items-center justify-center h-7 w-7 rounded-md border border-accent/40 bg-accent/15 hover:bg-accent/25 text-accent transition shadow-sm hover:shadow-accent/20 focus:outline-none focus-visible:ring-2 focus-visible:ring-accent/60",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.1",strokeLinecap:"round",strokeLinejoin:"round",className:"drop-shadow-sm",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),e.jsx("span",{className:"sr-only",children:"Add task"})]})]}),e.jsxs("label",{className:"flex items-center gap-2 select-none cursor-pointer group",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground uppercase tracking-caps",children:"Hide completed"}),e.jsxs("span",{className:"relative inline-flex h-6 w-11 select-none ml-auto",children:[e.jsx("input",{type:"checkbox",checked:O,onChange:s=>ce(s.target.checked),className:"peer sr-only",onMouseUp:s=>s.currentTarget.blur()}),e.jsx("span",{className:`
                      pointer-events-none block h-6 w-11 rounded-full border border-border
                      bg-black/15 dark:bg-white/15
                      transition-colors
                      peer-checked:bg-[#64C7C9]
                      peer-focus-visible:ring-2 peer-focus-visible:ring-[#64C7C9]/60 peer-focus-visible:ring-offset-2 peer-focus-visible:ring-offset-background
                    `}),e.jsx("span",{className:`
                      pointer-events-none absolute left-0.5 top-0.5 h-5 w-5 rounded-full
                      bg-white dark:bg-background shadow
                      transition-transform
                      peer-checked:translate-x-5
                    `})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center w-full max-w-xs mx-auto mb-2",style:{minWidth:"250px",maxWidth:"390px"},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full inline-block","aria-hidden":!0,style:{background:"#BDC0C3"}}),e.jsx("span",{className:"text-[11px] uppercase tracking-caps font-medium",children:"To-do / Not started"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full inline-block","aria-hidden":!0,style:{background:"#FACC15"}}),e.jsx("span",{className:"text-[11px] uppercase tracking-caps font-medium",children:"In Progress"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full inline-block","aria-hidden":!0,style:{background:"#34D399"}}),e.jsx("span",{className:"text-[11px] uppercase tracking-caps font-medium",children:"Complete"})]})]}),e.jsx("ul",{className:ee?"flex flex-wrap gap-3":"space-y-2",children:(O?g.filter(s=>s.status!=="Complete"):g).map(s=>{const t=s.status==="Complete"?"bg-green-500":s.status==="In Progress"?"bg-yellow-400":"bg-red-500",n=m.find(i=>i.id===s.assignee_id),o=s.ranked_points??(s.status==="Complete"?35:10),d=i=>i===1?.5:i===3?1:i===10?3:i===6?2:i===15?5:i===40?10:i===65?15:i===98?20:i===150?25:i===200?30:Math.max(0,Math.round(i/4)),u=le===s.id;return e.jsxs("li",{className:"relative flex flex-col justify-between gap-2 rounded bg-card dark:bg-surface border border-border p-3 pr-10 flex-1 min-w-[280px] md:w-[calc(50%-0.75rem)] xl:w-[calc(33.333%-0.75rem)]",children:[e.jsx("div",{className:"min-w-0 flex flex-wrap items-center gap-2",children:e.jsx("div",{className:"font-medium text-sm break-words flex-1",title:s.description,children:s.description})}),e.jsxs("div",{className:"text-tick text-muted-foreground flex gap-2 items-center mt-0.5",children:[!u&&e.jsx("span",{className:"text-tiny",children:n?n.name:"Unassigned"}),e.jsxs(b,{children:[!u&&e.jsx("button",{className:"p-1 rounded hover:bg-card/80",title:"Edit task",onClick:()=>U(s.id),children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M12 20h9"}),e.jsx("path",{d:"M16.5 3.5a2.121 2.121 0 1 1 3 3L7 19l-4 1 1-4 12.5-12.5z"})]})}),u&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(z,{mode:"single",people:m,selectedId:s.assignee_id||null,onSelect:i=>ie(s,i||""),triggerLabel:s.assignee_id?m.find(i=>i.id===s.assignee_id)?.name||"Assignee":"Unassigned",buttonClassName:"px-2 py-0.5 rounded bg-surface/80 border border-border text-tick text-sm whitespace-nowrap",maxItems:5}),e.jsx("button",{className:"p-1 rounded hover:bg-white/10",title:"Close edit",onClick:()=>U(null),children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]})]})]}),X&&e.jsxs("span",{className:"absolute top-2 right-3 text-tick text-muted font-semibold text-[8px] opacity-80",children:["+",o," · ",d(o),"h"]}),e.jsx(b,{children:u&&e.jsxs("div",{className:"w-full flex flex-col gap-1 text-xs mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between w-full gap-2 flex-wrap",children:[e.jsxs("div",{className:"flex w-full gap-1.5 flex-wrap",children:[e.jsxs("button",{onClick:()=>S(s,"Todo"),className:"inline-flex items-center gap-1 px-2.5 h-7 rounded border text-[11px] font-medium border-border bg-card dark:bg-surface hover:bg-card/80 transition justify-center flex-1 sm:flex-none sm:justify-start",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-red-400"})," Todo"]}),e.jsxs("button",{onClick:()=>S(s,"In Progress"),className:"inline-flex items-center gap-1 px-2.5 h-7 rounded border text-[11px] font-medium border-border bg-card dark:bg-surface hover:bg-card/80 transition whitespace-nowrap justify-center flex-1 sm:flex-none sm:justify-start",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-accent"})," In Progress"]}),e.jsxs("button",{onClick:()=>S(s,"Complete"),className:"inline-flex items-center gap-1 px-2.5 h-7 rounded border text-[11px] font-medium border-border bg-card dark:bg-surface hover:bg-card/80 transition justify-center flex-1 sm:flex-none sm:justify-start",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-success"})," Complete"]})]}),e.jsx("div",{})]}),e.jsxs("div",{className:"flex items-center justify-between w-full gap-2 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 w-full",children:[e.jsxs("select",{className:"h-7 px-2.5 rounded bg-surface/60 border border-border text-xs text-foreground dark-select flex-[2] w-full sm:flex-none sm:w-auto",value:s.ranked_points||"",onChange:i=>_(s.id,{ranked_points:i.target.value?Number(i.target.value):void 0}).then(h),children:[e.jsx("option",{value:"",children:"Points…"}),e.jsx("option",{value:"1",children:"1 pt ~ 0.5 hr"}),e.jsx("option",{value:"3",children:"3 pts ~ 1 hr"}),e.jsx("option",{value:"6",children:"6 pts ~ 2 hrs"}),e.jsx("option",{value:"10",children:"10 pts ~ 3 hrs"}),e.jsx("option",{value:"15",children:"15 pts ~ 5 hrs"}),e.jsx("option",{value:"40",children:"40 pts ~ 10 hrs"}),e.jsx("option",{value:"65",children:"65 pts ~ 15 hrs"}),e.jsx("option",{value:"98",children:"98 pts ~ 20 hrs"}),e.jsx("option",{value:"150",children:"150 pts ~ 25 hrs"}),e.jsx("option",{value:"200",children:"200 pts ~ 30 hrs"})]}),e.jsx("button",{onClick:()=>oe(s),className:"inline-flex items-center gap-1 px-2.5 h-7 rounded border text-[11px] font-medium border-red-500/60 text-red-200 bg-red-500/10 hover:bg-red-500/20 transition flex-1 sm:flex-none",children:"Delete"})]}),e.jsx("div",{})]})]})}),e.jsx("span",{className:`absolute top-1/2 -translate-y-1/2 right-3 w-3.5 h-3.5 rounded-full ${t} shadow`,"aria-hidden":!0})]},s.id)})})]}),e.jsx(_e,{open:de,onClose:()=>W(!1),people:m,fixedProjectId:r.id,onCreated:()=>{h()}})]})})}export{Ve as default};
