const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/firestore-CBdVKXmS.js","assets/index-DOL89XtO.js","assets/index-BQZr3sNq.css"])))=>i.map(i=>d[i]);
import{r as i,j as e,a as Q,u as V,A as G,_ as J}from"./index-DOL89XtO.js";import{P as K}from"./ProgressBar-DZE7LDNC.js";import{fetchPeople as E,fetchTasksForProject as W,updateProjectOwners as L,addTask as X,updateTask as U,deleteTaskById as Y}from"./firestore-CBdVKXmS.js";function Z({people:l,selectedIds:n,onAdd:N,onRemove:v}){const[m,h]=i.useState(""),g=i.useMemo(()=>{const d=m.toLowerCase();return l.filter(c=>c.name.toLowerCase().includes(d)||(c.skills||[]).join(" ").toLowerCase().includes(d))},[l,m]),p=new Set(n);return e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{className:"px-3 py-2 rounded bg-white text-black text-sm w-full",placeholder:"Search by name or skill…",value:m,onChange:d=>h(d.target.value)}),e.jsxs("ul",{className:"max-h-56 overflow-auto rounded border border-white/10 divide-y divide-white/10",children:[g.map(d=>{var u;const c=p.has(d.id);return e.jsxs("li",{className:"p-2 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:d.name}),e.jsx("div",{className:"text-xs text-uconn-muted",children:(u=d.skills)==null?void 0:u.join(", ")})]}),c?e.jsx("button",{onClick:()=>v(d.id),className:"text-xs px-2 py-1 rounded border border-red-400 text-red-300",children:"Remove"}):e.jsx("button",{onClick:()=>N(d.id),className:"text-xs px-2 py-1 rounded border",children:"Add"})]},d.id)}),g.length===0&&e.jsx("li",{className:"p-2 text-xs text-uconn-muted",children:"No matches"})]})]})}function ne(){const{id:l}=Q(),[n,N]=i.useState(null),[v,m]=i.useState([]),[h,g]=i.useState([]),[p,d]=i.useState([]),c=V(),u=(c==null?void 0:c.uid)===G,[b,y]=i.useState([]);i.useEffect(()=>{(async()=>{const[s,t]=await Promise.all([(await J(async()=>{const{fetchProjects:o}=await import("./firestore-CBdVKXmS.js");return{fetchProjects:o}},__vite__mapDeps([0,1,2]))).fetchProjects(),E()]),a=s.find(o=>o.id===l)||null;N(a||null),g(t);const r=(a==null?void 0:a.owner_ids)||[];y(r),m(r.map(o=>t.find(f=>f.id===o)).filter(Boolean)||[])})()},[l]);async function P(){if(!n)return;const s=await E();m(b.map(t=>s.find(a=>a.id===t)).filter(Boolean))}async function j(){l&&d(await W(l))}i.useEffect(()=>{j()},[l]);const w=p.length,_=p.filter(s=>s.status==="Complete").length,R=w>0?_/w*100:0,[k,S]=i.useState(""),[D,A]=i.useState("");async function B(s){if(!n||b.includes(s))return;const t=[...b,s];y(t),await L(n.id,t),await P()}async function $(s){if(!n)return;const t=b.filter(a=>a!==s);y(t),await L(n.id,t),await P()}const[I,T]=i.useState("In Progress");async function q(){!l||!k.trim()||(await X({project_id:l,description:k.trim(),status:I,assignee_id:D||void 0}),S(""),T("In Progress"),A(""),await j())}async function C(s,t){await U(s.id,{status:t}),await j()}async function M(s,t){await U(s.id,{assignee_id:t||void 0}),await j()}async function F(s){await Y(s.id),await j()}const[O,H]=i.useState(!1);return n?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:n.name}),n.subsystem&&e.jsx("div",{className:"text-xs font-semibold text-brand-teal/80 mt-1 uppercase tracking-wide",children:n.subsystem})]}),n.design_link&&e.jsx("a",{className:"inline-flex items-center h-9 px-4 rounded bg-brand-blue/40 hover:bg-brand-blue/60 transition text-sm font-medium",href:n.design_link,target:"_blank",rel:"noreferrer",children:"Design Docs"})]}),e.jsxs("div",{className:"text-sm text-uconn-muted",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"min-w-0",children:["Owners: ",v.map(s=>s.name).join(", ")||"—"]}),n.due_date&&(()=>{let s=null;const t=n.due_date,a=t.match(/(\d{4})[\/-]?(\d{2})[\/-]?(\d{2})/);if(a){const[,r,o,f]=a;s=new Date(Number(r),Number(o)-1,Number(f))}else isNaN(Date.parse(t))||(s=new Date(t));if(s){const r=s.toLocaleString("en-US",{weekday:"short"}),o=s.toLocaleString("en-US",{month:"short"}),f=s.getDate(),z=x=>x===1||x===21||x===31?"st":x===2||x===22?"nd":x===3||x===23?"rd":"th";return e.jsxs("div",{className:"text-xs text-uconn-muted whitespace-nowrap",children:["Due ",r," ",o," ",f,z(f)]})}return null})()]}),u&&e.jsxs("div",{className:"mt-3",children:[e.jsx("h3",{className:"text-sm font-semibold mb-1",children:"Manage Owners"}),e.jsx(Z,{people:h,selectedIds:b,onAdd:B,onRemove:$})]})]}),e.jsx(K,{value:R}),e.jsx("div",{className:"text-xs text-uconn-muted text-center",children:w>0?`${_}/${w} complete`:"No tasks yet"}),e.jsxs("section",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold",children:"Tasks"}),e.jsxs("label",{className:"flex items-center gap-2 select-none cursor-pointer group",children:[e.jsx("span",{className:"text-xs font-medium text-uconn-muted",children:"Hide completed"}),e.jsxs("span",{className:"relative inline-block w-10 h-6 align-middle select-none",children:[e.jsx("input",{type:"checkbox",checked:O,onChange:s=>H(s.target.checked),className:"peer absolute w-10 h-6 opacity-0 cursor-pointer z-10"}),e.jsx("span",{className:"block w-10 h-6 rounded-full transition bg-uconn-surface border border-uconn-border peer-checked:bg-brand-teal/70"}),e.jsx("span",{className:"absolute left-1 top-1 w-4 h-4 rounded-full bg-uconn-muted transition-all duration-200 peer-checked:translate-x-4 peer-checked:bg-brand-teal shadow"})]})]})]}),e.jsx("ul",{className:u?"flex flex-wrap gap-4":"space-y-2",children:(O?p.filter(s=>s.status!=="Complete"):p).map(s=>{const t=s.status==="Complete"?"bg-green-500":s.status==="In Progress"?"bg-yellow-400":"bg-red-500",a=h.find(r=>r.id===s.assignee_id);return e.jsxs("li",{className:"relative flex flex-col justify-between gap-3 rounded bg-uconn-surface border border-uconn-border p-3 pr-10 flex-1 min-w-[260px] md:w-[calc(50%-1rem)] xl:w-[calc(33.333%-1rem)]",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-medium text-sm truncate",title:s.description,children:s.description}),e.jsxs("div",{className:"text-[10px] text-uconn-muted flex gap-2 items-center mt-0.5",children:[e.jsx("span",{children:s.status}),e.jsx("span",{children:"·"}),e.jsx("span",{children:a?`@${a.name}`:"Unassigned"})]})]}),u&&e.jsxs("div",{className:"flex flex-col items-end gap-2 text-xs",children:[e.jsxs("select",{className:"px-2 py-1 rounded bg-uconn-surface/60 border border-uconn-border text-xs text-uconn-text dark-select",value:s.assignee_id||"",onChange:r=>M(s,r.target.value),children:[e.jsx("option",{value:"",children:"Unassigned"}),h.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]}),e.jsxs("div",{className:"flex gap-1 flex-wrap",children:[e.jsx("button",{onClick:()=>C(s,"Todo"),className:"px-2 py-1 rounded border text-[11px] font-medium border-red-500/60 text-red-300 bg-red-500/10 hover:bg-red-500/20 transition",children:"Todo"}),e.jsx("button",{onClick:()=>C(s,"In Progress"),className:"px-2 py-1 rounded border text-[11px] font-medium border-yellow-400/60 text-yellow-300 bg-yellow-400/10 hover:bg-yellow-400/20 transition whitespace-nowrap",children:"In Progress"}),e.jsx("button",{onClick:()=>C(s,"Complete"),className:"px-2 py-1 rounded border text-[11px] font-medium border-green-500/60 text-green-300 bg-green-500/10 hover:bg-green-500/20 transition",children:"Complete"}),e.jsx("button",{onClick:()=>F(s),className:"px-2 py-1 rounded border text-[11px] font-medium border-red-500 text-red-300 bg-red-500/10 hover:bg-red-500/20 transition",children:"Delete"})]})]}),e.jsx("span",{className:`absolute top-1/2 -translate-y-1/2 right-3 w-3.5 h-3.5 rounded-full ${t} shadow`,"aria-hidden":!0})]},s.id)})}),u&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Add Task"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx("input",{className:"px-3 py-2 rounded",placeholder:"Description",value:k,onChange:s=>S(s.target.value)}),e.jsxs("select",{className:"px-3 py-2 rounded dark-select",value:I,onChange:s=>T(s.target.value),children:[e.jsx("option",{children:"Todo"}),e.jsx("option",{children:"In Progress"}),e.jsx("option",{children:"Complete"})]}),e.jsxs("select",{className:"px-3 py-2 rounded dark-select",value:D,onChange:s=>A(s.target.value),children:[e.jsx("option",{value:"",children:"Assign to…"}),h.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx("button",{onClick:q,className:"px-3 py-2 rounded bg-white/10 border border-white/20",children:"Add"})]})]})]})]})}):e.jsx("div",{className:"text-sm",children:"Loading…"})}export{ne as default};
