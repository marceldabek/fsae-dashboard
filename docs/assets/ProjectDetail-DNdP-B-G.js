const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DnDrctQO.js","assets/vendor-react-pWhzumim.js","assets/vendor-9xdiniD5.js","assets/vendor-react-router-vBeDBGet.js","assets/vendor-firebase-DtYdhfHX.js","assets/index-BWiJueAe.css"])))=>i.map(i=>d[i]);
import{u as V,c as G,A as J,_ as K,f as L,e as W,g as R,h as X,i as U,j as Y}from"./index-DnDrctQO.js";import{r as d,j as e}from"./vendor-react-pWhzumim.js";import{P as Z}from"./ProgressBar-B8WOlXHs.js";import{a as ee}from"./vendor-react-router-vBeDBGet.js";import"./vendor-firebase-DtYdhfHX.js";import"./vendor-9xdiniD5.js";function se({people:i,selectedIds:a,onAdd:v,onRemove:y}){const[m,x]=d.useState(""),g=d.useMemo(()=>{const o=m.toLowerCase();return i.filter(h=>h.name.toLowerCase().includes(o)||(h.skills||[]).join(" ").toLowerCase().includes(o))},[i,m]),p=new Set(a);return e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{className:"px-3 py-2 rounded bg-white text-black text-sm w-full",placeholder:"Search by name or skill…",value:m,onChange:o=>x(o.target.value)}),e.jsxs("ul",{className:"max-h-56 overflow-auto rounded border border-white/10 divide-y divide-white/10",children:[g.map(o=>{var f;const h=p.has(o.id);return e.jsxs("li",{className:"p-2 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:o.name}),e.jsx("div",{className:"text-xs text-uconn-muted",children:(f=o.skills)==null?void 0:f.join(", ")})]}),h?e.jsx("button",{onClick:()=>y(o.id),className:"text-xs px-2 py-1 rounded border border-red-400 text-red-300",children:"Remove"}):e.jsx("button",{onClick:()=>v(o.id),className:"text-xs px-2 py-1 rounded border",children:"Add"})]},o.id)}),g.length===0&&e.jsx("li",{className:"p-2 text-xs text-uconn-muted",children:"No matches"})]})]})}function ie(){const{id:i}=ee(),[a,v]=d.useState(null),[y,m]=d.useState([]),[x,g]=d.useState([]),[p,o]=d.useState([]),[h]=V(),f=G(),w=(f==null?void 0:f.uid)===J,[b,k]=d.useState([]);d.useEffect(()=>{(async()=>{const[s,t]=await Promise.all([(await K(async()=>{const{fetchProjects:n}=await import("./index-DnDrctQO.js").then(c=>c.t);return{fetchProjects:n}},__vite__mapDeps([0,1,2,3,4,5]))).fetchProjects(),L()]),r=s.find(n=>n.id===i)||null;v(r||null),g(t);const l=(r==null?void 0:r.owner_ids)||[];k(l),m(l.map(n=>t.find(c=>c.id===n)).filter(Boolean)||[])})()},[i]);async function _(){if(!a)return;const s=await L();m(b.map(t=>s.find(r=>r.id===t)).filter(Boolean))}async function j(){i&&o(await W(i))}d.useEffect(()=>{j()},[i]);const N=p.length,S=p.filter(s=>s.status==="Complete").length,B=N>0?S/N*100:0,[C,D]=d.useState(""),[A,I]=d.useState("");async function $(s){if(!a||b.includes(s))return;const t=[...b,s];k(t),await R(a.id,t),await _()}async function q(s){if(!a)return;const t=b.filter(r=>r!==s);k(t),await R(a.id,t),await _()}const[T,E]=d.useState("In Progress");async function M(){!i||!C.trim()||(await X({project_id:i,description:C.trim(),status:T,assignee_id:A||void 0}),D(""),E("In Progress"),I(""),await j())}async function P(s,t){await U(s.id,{status:t}),await j()}async function F(s,t){await U(s.id,{assignee_id:t||void 0}),await j()}async function H(s){await Y(s.id),await j()}const[O,z]=d.useState(!1);return a?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:a.name}),a.subsystem&&e.jsx("div",{className:"text-xs font-semibold text-brand-teal/80 mt-1 uppercase tracking-wide",children:a.subsystem})]}),a.design_link&&e.jsx("a",{className:"inline-flex items-center h-9 px-4 rounded bg-brand-blue/40 hover:bg-brand-blue/60 transition text-sm font-medium",href:a.design_link,target:"_blank",rel:"noreferrer",children:"Design Docs"})]}),e.jsxs("div",{className:"text-sm text-uconn-muted",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"min-w-0",children:["Owners: ",y.map(s=>s.name).join(", ")||"—"]}),a.due_date&&(()=>{let s=null;const t=a.due_date,r=t.match(/(\d{4})[\/-]?(\d{2})[\/-]?(\d{2})/);if(r){const[,l,n,c]=r;s=new Date(Number(l),Number(n)-1,Number(c))}else isNaN(Date.parse(t))||(s=new Date(t));if(s){const l=s.toLocaleString("en-US",{weekday:"short"}),n=s.toLocaleString("en-US",{month:"short"}),c=s.getDate(),Q=u=>u===1||u===21||u===31?"st":u===2||u===22?"nd":u===3||u===23?"rd":"th";return e.jsxs("div",{className:"text-xs text-uconn-muted whitespace-nowrap",children:["Due ",l," ",n," ",c,Q(c)]})}return null})()]}),w&&e.jsxs("div",{className:"mt-3",children:[e.jsx("h3",{className:"text-sm font-semibold mb-1",children:"Manage Owners"}),e.jsx(se,{people:x,selectedIds:b,onAdd:$,onRemove:q})]})]}),e.jsx(Z,{value:B}),e.jsx("div",{className:"text-xs text-uconn-muted text-center",children:N>0?`${S}/${N} complete`:"No tasks yet"}),e.jsxs("section",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold",children:"Tasks"}),e.jsxs("label",{className:"flex items-center gap-2 select-none cursor-pointer group",children:[e.jsx("span",{className:"text-xs font-medium text-uconn-muted",children:"Hide completed"}),e.jsxs("span",{className:"relative inline-block w-10 h-6 align-middle select-none",children:[e.jsx("input",{type:"checkbox",checked:O,onChange:s=>z(s.target.checked),className:"peer absolute w-10 h-6 opacity-0 cursor-pointer z-10"}),e.jsx("span",{className:"block w-10 h-6 rounded-full transition bg-uconn-surface border border-uconn-border peer-checked:bg-brand-teal/70"}),e.jsx("span",{className:"absolute left-1 top-1 w-4 h-4 rounded-full bg-uconn-muted transition-all duration-200 peer-checked:translate-x-4 peer-checked:bg-brand-teal shadow"})]})]})]}),e.jsx("ul",{className:w?"flex flex-wrap gap-4":"space-y-2",children:(O?p.filter(s=>s.status!=="Complete"):p).map(s=>{const t=s.status==="Complete"?"bg-green-500":s.status==="In Progress"?"bg-yellow-400":"bg-red-500",r=x.find(n=>n.id===s.assignee_id),l=s.ranked_points??(s.status==="Complete"?35:10);return e.jsxs("li",{className:"relative flex flex-col justify-between gap-3 rounded bg-uconn-surface border border-uconn-border p-3 pr-10 flex-1 min-w-[260px] md:w-[calc(50%-1rem)] xl:w-[calc(33.333%-1rem)]",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-medium text-sm truncate",title:s.description,children:s.description}),e.jsxs("div",{className:"text-[10px] text-uconn-muted flex gap-2 items-center mt-0.5",children:[e.jsx("span",{children:s.status}),e.jsx("span",{children:"·"}),e.jsx("span",{children:r?`@${r.name}`:"Unassigned"})]})]}),h&&e.jsxs("span",{className:"absolute top-2 right-3 text-[11px] text-uconn-muted font-semibold",children:["+",l]}),w&&e.jsxs("div",{className:"flex flex-col items-end gap-2 text-xs",children:[e.jsxs("select",{className:"px-2 py-1 rounded bg-uconn-surface/60 border border-uconn-border text-xs text-uconn-text dark-select",value:s.assignee_id||"",onChange:n=>F(s,n.target.value),children:[e.jsx("option",{value:"",children:"Unassigned"}),x.map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))]}),e.jsxs("div",{className:"flex gap-1 flex-wrap",children:[e.jsx("button",{onClick:()=>P(s,"Todo"),className:"px-2 py-1 rounded border text-[11px] font-medium border-red-500/60 text-red-300 bg-red-500/10 hover:bg-red-500/20 transition",children:"Todo"}),e.jsx("button",{onClick:()=>P(s,"In Progress"),className:"px-2 py-1 rounded border text-[11px] font-medium border-yellow-400/60 text-yellow-300 bg-yellow-400/10 hover:bg-yellow-400/20 transition whitespace-nowrap",children:"In Progress"}),e.jsx("button",{onClick:()=>P(s,"Complete"),className:"px-2 py-1 rounded border text-[11px] font-medium border-green-500/60 text-green-300 bg-green-500/10 hover:bg-green-500/20 transition",children:"Complete"}),e.jsx("button",{onClick:()=>H(s),className:"px-2 py-1 rounded border text-[11px] font-medium border-red-500 text-red-300 bg-red-500/10 hover:bg-red-500/20 transition",children:"Delete"})]})]}),e.jsx("span",{className:`absolute top-1/2 -translate-y-1/2 right-3 w-3.5 h-3.5 rounded-full ${t} shadow`,"aria-hidden":!0})]},s.id)})}),w&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Add Task"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx("input",{className:"px-3 py-2 rounded",placeholder:"Description",value:C,onChange:s=>D(s.target.value)}),e.jsxs("select",{className:"px-3 py-2 rounded dark-select",value:T,onChange:s=>E(s.target.value),children:[e.jsx("option",{children:"Todo"}),e.jsx("option",{children:"In Progress"}),e.jsx("option",{children:"Complete"})]}),e.jsxs("select",{className:"px-3 py-2 rounded dark-select",value:A,onChange:s=>I(s.target.value),children:[e.jsx("option",{value:"",children:"Assign to…"}),x.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx("button",{onClick:M,className:"px-3 py-2 rounded bg-white/10 border border-white/20",children:"Add"})]})]})]})]})}):e.jsx("div",{className:"text-sm",children:"Loading…"})}export{ie as default};
