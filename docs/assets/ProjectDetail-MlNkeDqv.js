const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BuVp9-lB.js","assets/index-BY5EOaRI.css"])))=>i.map(i=>d[i]);
import{e as X,r as i,u as Z,d as ee,i as se,_ as te,f as R,j as e,k as ne,l as N,m as re,n as U,o as ae,p as ie}from"./index-BuVp9-lB.js";import{P as le}from"./ProgressBar-q7e5dY02.js";function ce(){const{id:d}=X(),[r,k]=i.useState(null),[$,y]=i.useState([]),[h,B]=i.useState([]),[p,F]=i.useState([]),[H]=Z(),f=ee(),c=se((f==null?void 0:f.uid)||null),[m,j]=i.useState([]),[C,M]=i.useState(!1),[g,z]=i.useState("");i.useEffect(()=>{(async()=>{const[s,n]=await Promise.all([(await te(async()=>{const{fetchProjects:l}=await import("./index-BuVp9-lB.js").then(t=>t.G);return{fetchProjects:l}},__vite__mapDeps([0,1]))).fetchProjects(),R()]),a=s.find(l=>l.id===d)||null;k(a||null),B(n);const o=(a==null?void 0:a.owner_ids)||[];j(o),y(o.map(l=>n.find(t=>t.id===l)).filter(Boolean)||[])})()},[d]);async function P(){if(!r)return;const s=await R();y(m.map(n=>s.find(a=>a.id===n)).filter(Boolean))}async function x(){d&&F(await re(d))}i.useEffect(()=>{x()},[d]);const b=p.length,_=p.filter(s=>s.status==="Complete").length,G=b>0?_/b*100:0,[w,S]=i.useState(""),[A,D]=i.useState(""),[T,O]=i.useState("");async function V(s){if(!r||m.includes(s))return;const n=[...m,s];j(n),await U(r.id,n),await P()}async function Y(s){if(!r)return;const n=m.filter(a=>a!==s);j(n),await U(r.id,n),await P()}const[I,E]=i.useState("In Progress");async function q(){!d||!w.trim()||(await ae({project_id:d,description:w.trim(),status:I,assignee_id:A||void 0,ranked_points:T||void 0}),S(""),E("In Progress"),D(""),O(""),await x())}async function v(s,n){await N(s.id,{status:n}),await x()}async function J(s,n){await N(s.id,{assignee_id:n||void 0}),await x()}async function K(s){await ie(s.id),await x()}const[L,Q]=i.useState(!1);return r?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:r.name}),r.subsystem&&e.jsx("div",{className:"text-xs font-semibold text-brand-teal/80 mt-1 uppercase tracking-wide",children:r.subsystem})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-stretch sm:items-center",children:[r.design_link&&e.jsx("a",{className:"inline-flex items-center h-9 px-4 rounded bg-brand-blue/40 hover:bg-brand-blue/60 transition text-sm font-medium",href:r.design_link,target:"_blank",rel:"noreferrer",children:"Design Docs"}),c&&!r.archived&&e.jsx("button",{onClick:async()=>{r&&confirm("Archive this project? You can re-enable by editing in Firestore.")&&(await ne(r.id),k(s=>s&&{...s,archived:!0}))},className:"inline-flex items-center h-9 px-4 rounded bg-red-500/20 hover:bg-red-500/30 text-red-200 border border-red-500/40 text-sm font-medium",children:"Archive Project"}),c&&r.archived&&e.jsx("span",{className:"inline-flex items-center h-9 px-3 rounded border border-yellow-400/40 bg-yellow-400/10 text-xs text-yellow-300 font-semibold uppercase tracking-wide",children:"Archived"})]})]}),e.jsxs("div",{className:"text-sm text-uconn-muted",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"min-w-0",children:["Owners: ",$.map(s=>s.name).join(", ")||"—"]}),r.due_date&&(()=>{let s=null;const n=r.due_date,a=n.match(/(\d{4})[\/-]?(\d{2})[\/-]?(\d{2})/);if(a){const[,o,l,t]=a;s=new Date(Number(o),Number(l)-1,Number(t))}else isNaN(Date.parse(n))||(s=new Date(n));if(s){const o=s.toLocaleString("en-US",{weekday:"short"}),l=s.toLocaleString("en-US",{month:"short"}),t=s.getDate(),W=u=>u===1||u===21||u===31?"st":u===2||u===22?"nd":u===3||u===23?"rd":"th";return e.jsxs("div",{className:"text-xs text-uconn-muted whitespace-nowrap",children:["Due ",o," ",l," ",t,W(t)]})}return null})()]}),c&&e.jsxs("div",{className:"mt-3 relative",children:[e.jsxs("h3",{className:"text-sm font-semibold mb-1 flex items-center gap-2",children:["Manage Owners",e.jsx("button",{onClick:()=>M(s=>!s),className:"ml-auto text-[11px] px-2 py-1 rounded bg-white/10 border border-white/15 hover:bg-white/15",children:C?"Close":"Add/Remove"})]}),C&&e.jsxs("div",{className:"absolute z-20 mt-1 w-full rounded-lg border border-white/15 bg-black/70 backdrop-blur-sm p-2 space-y-2",children:[e.jsx("input",{value:g,onChange:s=>z(s.target.value),className:"w-full px-2 py-1 rounded bg-white/10 text-sm mb-1",placeholder:"Search people…"}),e.jsxs("ul",{className:"space-y-1 text-sm",children:[h.filter(s=>s.name.toLowerCase().includes(g.toLowerCase())||(s.skills||[]).join(" ").toLowerCase().includes(g.toLowerCase())).slice(0,5).map(s=>{const n=m.includes(s.id);return e.jsxs("li",{className:"flex items-center gap-2 justify-between px-2 py-1 rounded hover:bg-white/5",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"truncate text-sm font-medium",children:s.name}),s.skills&&s.skills.length>0&&e.jsx("div",{className:"text-[10px] text-uconn-muted truncate",children:s.skills.join(", ")})]}),e.jsx("button",{onClick:()=>n?Y(s.id):V(s.id),className:`px-2 py-1 rounded text-[11px] border ${n?"bg-brand-teal/20 border-brand-teal/40 text-brand-teal":"bg-white/10 border-white/20 hover:bg-white/15"}`,children:n?"Remove":"Add"})]},s.id)}),h.length===0&&e.jsx("li",{className:"text-xs text-uconn-muted px-2 py-1",children:"No people"})]})]})]})]}),e.jsx(le,{value:G}),e.jsx("div",{className:"text-xs text-uconn-muted text-center",children:b>0?`${_}/${b} complete`:"No tasks yet"}),e.jsxs("section",{className:"space-y-2",children:[c&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Add Task"}),e.jsxs("div",{className:"flex flex-col sm:flex-row flex-wrap gap-2",children:[e.jsx("input",{className:"px-3 py-2 rounded",placeholder:"Description",value:w,onChange:s=>S(s.target.value)}),e.jsxs("select",{className:"px-3 py-2 rounded dark-select",value:I,onChange:s=>E(s.target.value),children:[e.jsx("option",{children:"Todo"}),e.jsx("option",{children:"In Progress"}),e.jsx("option",{children:"Complete"})]}),e.jsxs("select",{className:"px-3 py-2 rounded dark-select",value:T,onChange:s=>O(s.target.value?Number(s.target.value):""),children:[e.jsx("option",{value:"",children:"Points (by estimated hours)"}),e.jsx("option",{value:"1",children:"1 pt ~ 0.5 hr"}),e.jsx("option",{value:"3",children:"3 pts ~ 1 hr"}),e.jsx("option",{value:"10",children:"10 pts ~ 3 hrs"}),e.jsx("option",{value:"6",children:"6 pts ~ 2 hrs"}),e.jsx("option",{value:"15",children:"15 pts ~ 5 hrs"}),e.jsx("option",{value:"40",children:"40 pts ~ 10 hrs"}),e.jsx("option",{value:"65",children:"65 pts ~ 15 hrs"}),e.jsx("option",{value:"98",children:"98 pts ~ 20 hrs"}),e.jsx("option",{value:"150",children:"150 pts ~ 25 hrs"}),e.jsx("option",{value:"200",children:"200 pts ~ 30 hrs"})]}),e.jsxs("select",{className:"px-3 py-2 rounded dark-select",value:A,onChange:s=>D(s.target.value),children:[e.jsx("option",{value:"",children:"Assign to…"}),h.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx("button",{onClick:q,className:"px-3 py-2 rounded bg-white/10 border border-white/20",children:"Add"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold",children:"Tasks"}),e.jsxs("label",{className:"flex items-center gap-2 select-none cursor-pointer group",children:[e.jsx("span",{className:"text-xs font-medium text-uconn-muted",children:"Hide completed"}),e.jsxs("span",{className:"relative inline-block w-10 h-6 align-middle select-none",children:[e.jsx("input",{type:"checkbox",checked:L,onChange:s=>Q(s.target.checked),className:"peer absolute w-10 h-6 opacity-0 cursor-pointer z-10"}),e.jsx("span",{className:"block w-10 h-6 rounded-full transition bg-uconn-surface border border-uconn-border peer-checked:bg-brand-teal/70"}),e.jsx("span",{className:"absolute left-1 top-1 w-4 h-4 rounded-full bg-uconn-muted transition-all duration-200 peer-checked:translate-x-4 peer-checked:bg-brand-teal shadow"})]})]})]}),e.jsx("ul",{className:c?"flex flex-wrap gap-3":"space-y-2",children:(L?p.filter(s=>s.status!=="Complete"):p).map(s=>{const n=s.status==="Complete"?"bg-green-500":s.status==="In Progress"?"bg-yellow-400":"bg-red-500",a=h.find(t=>t.id===s.assignee_id),o=s.ranked_points??(s.status==="Complete"?35:10),l=t=>t===1?.5:t===3?1:t===10?3:t===6?2:t===15?5:t===40?10:t===65?15:t===98?20:t===150?25:t===200?30:Math.max(0,Math.round(t/4));return e.jsxs("li",{className:"relative flex flex-col justify-between gap-3 rounded bg-uconn-surface border border-uconn-border p-3 pr-10 flex-1 min-w-[280px] md:w-[calc(50%-0.75rem)] xl:w-[calc(33.333%-0.75rem)]",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-medium text-sm truncate",title:s.description,children:s.description}),e.jsxs("div",{className:"text-[10px] text-uconn-muted flex gap-2 items-center mt-0.5",children:[e.jsx("span",{children:s.status}),e.jsx("span",{children:"·"}),e.jsx("span",{children:a?`@${a.name}`:"Unassigned"})]})]}),H&&e.jsxs("span",{className:"absolute top-2 right-3 text-[11px] text-uconn-muted font-semibold",children:["+",o," · ",l(o),"h"]}),c&&e.jsxs("div",{className:"flex flex-col items-end gap-2 text-xs",children:[e.jsxs("select",{className:"px-2 py-1 rounded bg-uconn-surface/60 border border-uconn-border text-xs text-uconn-text dark-select",value:s.assignee_id||"",onChange:t=>J(s,t.target.value),children:[e.jsx("option",{value:"",children:"Unassigned"}),h.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsxs("div",{className:"flex gap-1.5 flex-wrap justify-end",children:[e.jsxs("button",{onClick:()=>v(s,"Todo"),className:"inline-flex items-center gap-1 px-2.5 h-7 rounded border text-[11px] font-medium border-white/15 bg-white/5 hover:bg-white/10 transition",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-red-400"})," Todo"]}),e.jsxs("button",{onClick:()=>v(s,"In Progress"),className:"inline-flex items-center gap-1 px-2.5 h-7 rounded border text-[11px] font-medium border-white/15 bg-white/5 hover:bg-white/10 transition whitespace-nowrap",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-yellow-300"})," In Progress"]}),e.jsxs("button",{onClick:()=>v(s,"Complete"),className:"inline-flex items-center gap-1 px-2.5 h-7 rounded border text-[11px] font-medium border-white/15 bg-white/5 hover:bg-white/10 transition",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-green-400"})," Complete"]}),c&&e.jsxs("select",{className:"px-2 py-1 rounded bg-uconn-surface/60 border border-uconn-border text-xs text-uconn-text dark-select",value:s.ranked_points||"",onChange:t=>N(s.id,{ranked_points:t.target.value?Number(t.target.value):void 0}).then(x),children:[e.jsx("option",{value:"",children:"Points…"}),e.jsx("option",{value:"1",children:"1 pt ~ 0.5 hr"}),e.jsx("option",{value:"3",children:"3 pts ~ 1 hr"}),e.jsx("option",{value:"10",children:"10 pts ~ 3 hrs"}),e.jsx("option",{value:"6",children:"6 pts ~ 2 hrs"}),e.jsx("option",{value:"15",children:"15 pts ~ 5 hrs"}),e.jsx("option",{value:"40",children:"40 pts ~ 10 hrs"}),e.jsx("option",{value:"65",children:"65 pts ~ 15 hrs"}),e.jsx("option",{value:"98",children:"98 pts ~ 20 hrs"}),e.jsx("option",{value:"150",children:"150 pts ~ 25 hrs"}),e.jsx("option",{value:"200",children:"200 pts ~ 30 hrs"})]}),e.jsx("button",{onClick:()=>K(s),className:"inline-flex items-center gap-1 px-2.5 h-7 rounded border text-[11px] font-medium border-red-500/60 text-red-200 bg-red-500/10 hover:bg-red-500/20 transition",children:"Delete"})]})]}),e.jsx("span",{className:`absolute top-1/2 -translate-y-1/2 right-3 w-3.5 h-3.5 rounded-full ${n} shadow`,"aria-hidden":!0})]},s.id)})})]})]})}):e.jsx("div",{className:"text-sm",children:"Loading…"})}export{ce as default};
