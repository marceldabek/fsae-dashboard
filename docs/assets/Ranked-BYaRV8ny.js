import{r as c,u as V,H as $,f as E,b as C,z as G,c as _,I as X,j as e}from"./index-B-YBCRUe.js";const j=["Diamond","Platinum","Gold","Silver","Bronze"];function Z(u){const p="/fsae-dashboard/",f=u.toLowerCase();return`${p}icons/rank-${f}.png`}function oe(){const[u,p]=c.useState([]),[f,y]=c.useState([]),[a,v]=c.useState(null),[D,M]=c.useState([]),[ee,te]=c.useState(!1),[P]=V(),[N,L]=c.useState(Date.now());c.useEffect(()=>{(async()=>{await $();const[o,r,n,d]=await Promise.all([E(),C(),G(),_()]);p(o),y(r),v(n),M(d)})();const t=setInterval(()=>L(Date.now()),1e3),s=setInterval(async()=>{try{await $();const[o,r,n,d]=await Promise.all([E(),C(),G(),_()]);p(o),y(r),v(n),M(d)}catch{}},2*60*1e3);return()=>{clearInterval(s),clearInterval(t)}},[]);const b=c.useMemo(()=>a?u.filter(t=>!!t.ranked_opt_in):[],[u,a]),x=c.useMemo(()=>a?X(b,f,a,D):new Map,[b,f,D,a]),S=c.useMemo(()=>{const t={Bronze:[],Silver:[],Gold:[],Platinum:[],Diamond:[]};for(const s of b)t[s.rank||"Bronze"].push(s);return t},[b]);function O(t){const s=new Date(t),r=(7-s.getDay())%7,n=new Date(s.getFullYear(),s.getMonth(),s.getDate()+r,12,0,0,0);return n.getTime()<=t&&n.setDate(n.getDate()+7),n.getTime()}const A=O(N),k=Math.max(0,A-N),J=Math.floor(k/864e5),H=Math.floor(k%864e5/36e5),F=Math.floor(k%36e5/6e4),K=`${J}d ${H}h ${F}m`,l=Math.max((t=>{const s=new Date(t);return s.setHours(0,0,0,0),s.getTime()})(N),(a==null?void 0:a.last_reset_at)??0),I=c.useMemo(()=>{const t={Bronze:[],Silver:[],Gold:[],Platinum:[],Diamond:[]};for(const s of j){const o=(S[s]||[]).slice().sort((r,n)=>(x.get(n.id)||0)-(x.get(r.id)||0));t[s]=o}return t},[S,x]),[R,U]=c.useState(()=>{try{const t={ts:l,indices:{Bronze:{},Silver:{},Gold:{},Platinum:{},Diamond:{}}};for(const s of j){const o=`ranked:baseline:${s}`,r=localStorage.getItem(o);if(r){const n=JSON.parse(r);n&&n.ts===l&&(t.indices[s]=n.indices||{})}}return t}catch{return{ts:l,indices:{Bronze:{},Silver:{},Gold:{},Platinum:{},Diamond:{}}}}});return c.useEffect(()=>{const t={ts:l,indices:{Bronze:{},Silver:{},Gold:{},Platinum:{},Diamond:{}}};let s=!1;for(const o of j){const r=`ranked:baseline:${o}`;let n;try{const d=localStorage.getItem(r);if(d){const i=JSON.parse(d);i.ts===l&&(n=i.indices)}}catch{}if(!n){n={},(I[o]||[]).forEach((i,g)=>{n[i.id]=g});try{localStorage.setItem(r,JSON.stringify({ts:l,indices:n}))}catch{}s=!0}t.indices[o]=n||{}}(s||R.ts!==l)&&U(t)},[l,I]),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Ranked"}),e.jsx("div",{className:"ml-auto flex items-center gap-3",children:a===null?e.jsx("div",{className:"text-xs text-white/80 rounded border border-white/10 bg-white/5 px-2 py-1",children:"Loading…"}):a!=null&&a.enabled&&P?e.jsxs("div",{className:"text-xs text-white/90 rounded-full border border-white/10 bg-white/5 px-3 py-1 shadow-sm",children:["Week ends in ",e.jsx("span",{className:"font-semibold",children:K})]}):e.jsx("div",{className:"text-xs text-red-300",children:"Ranked mode is disabled"})})]}),e.jsx("div",{className:"mb-3 text-[12px] text-uconn-muted",children:"Legend: green left border = promotion zone, red left border = demotion zone. Change Today: ▲ moved up, ▼ moved down."}),!(a!=null&&a.enabled)||!P?null:e.jsx("div",{className:"grid lg:grid-cols-2 gap-4",children:j.map(t=>{var g,z;const s=(S[t]||[]).slice().sort((h,m)=>(x.get(m.id)||0)-(x.get(h.id)||0)),o=t.toLowerCase(),r=((g=a.promotion_pct)==null?void 0:g[o])??0,n=((z=a.demotion_pct)==null?void 0:z[o])??0,d=Math.floor(r/100*s.length),i=Math.floor(n/100*s.length);return e.jsxs("div",{className:"form-section p-0",children:[e.jsxs("div",{className:"px-3 py-2 flex items-center gap-2 border-b border-white/10 bg-white/5",children:[e.jsx("img",{alt:t,src:Z(t),className:"h-6 w-6 object-contain"}),e.jsx("h2",{className:"font-semibold",children:t}),e.jsxs("span",{className:"ml-auto text-xs text-uconn-muted",children:[s.length," in pool"]})]}),e.jsxs("table",{className:"w-full text-[13px] sm:text-sm",children:[e.jsx("thead",{className:"text-xs text-uconn-muted border-b border-white/10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-2 py-2 w-6",children:"#"}),e.jsx("th",{className:"text-left px-2 py-2",children:"Name"}),e.jsx("th",{className:"text-right px-2 py-2 w-12",children:"Pts"}),e.jsx("th",{className:"text-right px-2 py-2 w-12",children:"Δ"})]})}),e.jsxs("tbody",{children:[s.map((h,m)=>{var T;const W=m<d,Y=m>=Math.max(0,s.length-i)&&i>0,q="px-2 py-2 align-middle",Q=`pl-2 border-l-4 whitespace-nowrap truncate max-w-[9.5rem] overflow-hidden ${W?"border-green-400":Y?"border-red-400":"border-transparent"}`,B=(T=R.indices[t])==null?void 0:T[h.id],w=(typeof B=="number"?B:m)-m;return e.jsxs("tr",{className:"border-b border-white/5",children:[e.jsx("td",{className:"px-2 py-1.5 align-middle",children:m+1}),e.jsx("td",{className:q,children:e.jsx("div",{className:Q,children:h.name})}),e.jsx("td",{className:"px-2 py-1.5 align-middle text-right tabular-nums",children:x.get(h.id)||0}),e.jsx("td",{className:"px-2 py-1.5 align-middle text-right tabular-nums",children:w===0?e.jsx("span",{className:"text-uconn-muted",children:"0"}):e.jsxs("span",{className:w>0?"text-green-400":"text-red-400",children:[w>0?"▲":"▼",Math.abs(w)]})})]},h.id)}),s.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-3 py-4 text-center text-xs text-uconn-muted",children:"No participants"})})]})]})]},t)})})]})}export{oe as default};
