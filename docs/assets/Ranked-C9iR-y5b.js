import{r as a,u as q,y as v,f as M,b as _,q as P,j as e}from"./index-B7LHv9gh.js";const H=["Diamond","Platinum","Gold","Silver","Bronze"];function K(d){return`/icons/rank-${d.toLowerCase()}.svg`}function Q(){const[d,x]=a.useState([]),[u,f]=a.useState([]),[n,g]=a.useState(null),[O,W]=a.useState(!1),[b]=q(),[j,R]=a.useState(Date.now());a.useEffect(()=>{(async()=>{await v();const[r,o,c]=await Promise.all([M(),_(),P()]);x(r),f(o),g(c)})();const t=setInterval(()=>R(Date.now()),1e3),s=setInterval(async()=>{try{await v();const[r,o,c]=await Promise.all([M(),_(),P()]);x(r),f(o),g(c)}catch{}},2*60*1e3);return()=>{clearInterval(s),clearInterval(t)}},[]);const m=a.useMemo(()=>n?d.filter(t=>!!t.ranked_opt_in):[],[d,n]),h=a.useMemo(()=>{if(!n)return new Map;const t=new Map;for(const s of m)t.set(s.id,0);for(const s of u){if(!s.assignee_id||!t.has(s.assignee_id))continue;const r=s.ranked_points??(s.status==="Complete"?35:10);t.set(s.assignee_id,(t.get(s.assignee_id)||0)+r)}return t},[m,u,n]),C=a.useMemo(()=>{const t={Bronze:[],Silver:[],Gold:[],Platinum:[],Diamond:[]};for(const s of m)t[s.rank||"Bronze"].push(s);return t},[m]);if(!n)return e.jsx("div",{children:"Loadingâ€¦"});const N=n.last_reset_at||0,I=t=>t-t%(60*60*1e3),D=(N>0?N:I(j))+60*60*1e3,p=Math.max(0,D-j),w=Math.floor(p/36e5),E=Math.floor(p%36e5/6e4),$=Math.floor(p%6e4/1e3),A=`${w?String(w).padStart(2,"0")+":":""}${String(E).padStart(2,"0")}:${String($).padStart(2,"0")}`;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Ranked"}),e.jsx("div",{className:"ml-auto flex items-center gap-3",children:n.enabled&&b?e.jsxs("div",{className:"text-xs text-white/80 rounded border border-white/10 bg-white/5 px-2 py-1",children:["Week ends in ",A,e.jsx("span",{className:"ml-2 text-uconn-muted",children:"(testing: hourly)"})]}):e.jsx("div",{className:"text-xs text-red-300",children:"Ranked mode is disabled"})})]}),!n.enabled||!b?null:e.jsx("div",{className:"grid lg:grid-cols-2 gap-4",children:H.map(t=>{var k,S;const s=(C[t]||[]).slice().sort((i,l)=>(h.get(l.id)||0)-(h.get(i.id)||0)),r=t.toLowerCase(),o=((k=n.promotion_pct)==null?void 0:k[r])??0,c=((S=n.demotion_pct)==null?void 0:S[r])??0,B=Math.floor(o/100*s.length),y=Math.floor(c/100*s.length);return e.jsxs("div",{className:"form-section p-0 overflow-hidden",children:[e.jsxs("div",{className:"px-3 py-2 flex items-center gap-2 border-b border-white/10 bg-white/5",children:[e.jsx("img",{alt:t,src:K(t),className:"h-6 w-6"}),e.jsx("h2",{className:"font-semibold",children:t}),e.jsxs("span",{className:"ml-auto text-xs text-uconn-muted",children:[s.length," in pool"]})]}),e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"text-xs text-uconn-muted border-b border-white/10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-3 py-2 w-8",children:"#"}),e.jsx("th",{className:"text-left px-2 py-2",children:"Name"}),e.jsx("th",{className:"text-right px-3 py-2 w-24",children:"Pts"})]})}),e.jsxs("tbody",{children:[s.map((i,l)=>{const L=l<B,T=l>=Math.max(0,s.length-y)&&y>0,z="px-2 py-2 align-middle",G=`pl-2 border-l-4 ${L?"border-green-400":T?"border-red-400":"border-transparent"}`;return e.jsxs("tr",{className:"border-b border-white/5",children:[e.jsx("td",{className:"px-3 py-2 align-middle",children:l+1}),e.jsx("td",{className:z,children:e.jsx("div",{className:G,children:i.name})}),e.jsx("td",{className:"px-3 py-2 align-middle text-right",children:h.get(i.id)||0})]},i.id)}),s.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-3 py-4 text-center text-xs text-uconn-muted",children:"No participants"})})]})]})]},t)})})]})}export{Q as default};
