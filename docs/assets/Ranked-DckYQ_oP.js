import{r,u as J,K as D,f as P,b as I,q as R,c as B,M as Q,N as $,O as z,P as C,j as e}from"./index-BpYg3kJk.js";const E=["Diamond","Platinum","Gold","Silver","Bronze"];function V(m){const h="/fsae-dashboard/",p=m.toLowerCase();return`${h}icons/rank-${p}.png`}function se(){const[m,h]=r.useState([]),[p,g]=r.useState([]),[c,N]=r.useState(null),[y,k]=r.useState([]),[X,Z]=r.useState(!1),[v]=J(),[S,L]=r.useState(Date.now()),[T,u]=r.useState(null);r.useEffect(()=>{(async()=>{await D();const[n,o,a,x]=await Promise.all([P(),I(),R(),B()]);h(n),g(o),N(a),k(x)})();const t=setInterval(()=>L(Date.now()),1e3),s=setInterval(async()=>{try{await D();const[n,o,a,x]=await Promise.all([P(),I(),R(),B()]);h(n),g(o),N(a),k(x)}catch{}},120*1e3);return()=>{clearInterval(s),clearInterval(t)}},[]);const f=r.useMemo(()=>c?m.filter(t=>!!t.ranked_opt_in):[],[m,c]),l=r.useMemo(()=>c?Q(f,p,c,y):new Map,[f,p,y,c]),j=r.useMemo(()=>{const t={Bronze:[],Silver:[],Gold:[],Platinum:[],Diamond:[]};for(const s of f)t[s.rank||"Bronze"].push(s);return t},[f]);function _(t){const s=new Date(t),o=(7-s.getDay())%7,a=new Date(s.getFullYear(),s.getMonth(),s.getDate()+o,12,0,0,0);return a.getTime()<=t&&a.setDate(a.getDate()+7),a.getTime()}const A=_(S),w=Math.max(0,A-S),G=Math.floor(w/864e5),K=Math.floor(w%864e5/36e5),O=Math.floor(w%36e5/6e4),q=`${G}d ${K}h ${O}m`;r.useEffect(()=>{let t=!1;(async()=>{try{const n=await $(z(C,"ranked","baseline_today"));t||(n.exists()?u(n.data()):u(null))}catch{u(null)}})();const s=setInterval(async()=>{try{const n=await $(z(C,"ranked","baseline_today"));t||n.exists()&&u(n.data())}catch{}},60*1e3);return()=>{t=!0,clearInterval(s)}},[]),r.useMemo(()=>{const t={Bronze:[],Silver:[],Gold:[],Platinum:[],Diamond:[]};for(const s of E){const n=(j[s]||[]).slice().sort((o,a)=>(l.get(a.id)||0)-(l.get(o.id)||0));t[s]=n}return t},[j,l]);function F(t,s,n){const o=T?.tiers?.[t];if(!o)return n;const a=o.indexOf(s);return a===-1?n:a}return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Ranked"}),e.jsx("div",{className:"ml-auto flex items-center gap-3",children:c===null?e.jsx("div",{className:"text-xs text-white/80 rounded border border-white/10 bg-white/5 px-2 py-1",children:"Loading…"}):c?.enabled&&v?e.jsxs("div",{className:"text-xs text-white/90 rounded-full border border-white/10 bg-white/5 px-3 py-1 shadow-sm",children:["Week ends in ",e.jsx("span",{className:"font-semibold",children:q})]}):e.jsx("div",{className:"text-xs text-red-300",children:"Ranked mode is disabled"})})]}),e.jsx("div",{className:"mb-3 text-xs text-muted uppercase tracking-caps",children:"Legend: green left border = promotion zone, red left border = demotion zone. Change Today: ▲ moved up, ▼ moved down."}),!c?.enabled||!v?null:e.jsx("div",{className:"grid lg:grid-cols-2 gap-4",children:E.map(t=>{const s=(j[t]||[]).slice().sort((i,d)=>(l.get(d.id)||0)-(l.get(i.id)||0)),n=t.toLowerCase(),o=c.promotion_pct?.[n]??0,a=c.demotion_pct?.[n]??0,x=Math.floor(o/100*s.length),M=Math.floor(a/100*s.length);return e.jsxs("div",{className:"form-section p-0",children:[e.jsxs("div",{className:"px-3 py-2 flex items-center gap-2 border-b border-white/10 bg-white/5",children:[e.jsx("img",{alt:t,src:V(t),className:"h-6 w-6 object-contain"}),e.jsx("h2",{className:"font-semibold",children:t}),e.jsxs("span",{className:"ml-auto text-xs text-muted uppercase tracking-caps",children:[s.length," in pool"]})]}),e.jsxs("table",{className:"w-full text-[13px] sm:text-sm",children:[e.jsx("thead",{className:"text-xs text-muted uppercase tracking-caps border-b border-border/60",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-2 py-2 w-6",children:"#"}),e.jsx("th",{className:"text-left px-2 py-2",children:"Name"}),e.jsx("th",{className:"text-right px-2 py-2 w-12",children:"Pts"}),e.jsx("th",{className:"text-right px-2 py-2 w-12",children:"Δ"})]})}),e.jsxs("tbody",{children:[s.map((i,d)=>{const U=d<x,W=d>=Math.max(0,s.length-M)&&M>0,Y="px-2 py-2 align-middle",H=`pl-2 border-l-4 whitespace-nowrap truncate max-w-[9.5rem] overflow-hidden ${U?"border-green-400":W?"border-red-400":"border-transparent"}`,b=F(t,i.id,d)-d;return e.jsxs("tr",{className:"border-b border-white/5",children:[e.jsx("td",{className:"px-2 py-1.5 align-middle",children:d+1}),e.jsx("td",{className:Y,children:e.jsx("div",{className:H,children:i.name})}),e.jsx("td",{className:"px-2 py-1.5 align-middle text-right tabular-nums",children:l.get(i.id)||0}),e.jsx("td",{className:"px-2 py-1.5 align-middle text-right tabular-nums",children:b===0?e.jsx("span",{className:"text-muted",children:"0"}):e.jsxs("span",{className:b>0?"text-green-400":"text-red-400",children:[b>0?"▲":"▼",Math.abs(b)]})})]},i.id)}),s.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-3 py-4 text-center text-xs text-muted",children:"No participants"})})]})]})]},t)})})]})}export{se as default};
