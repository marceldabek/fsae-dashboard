import{r as c,u as V,C as T,f as C,b as $,t as E,A as G,j as s}from"./index-DrAM74WJ.js";const w=["Diamond","Platinum","Gold","Silver","Bronze"];function X(u){const f="/fsae-dashboard/",x=u.toLowerCase();return`${f}icons/rank-${x}.${x==="bronze"||x==="silver"?"png":"svg"}`}function ae(){const[u,f]=c.useState([]),[x,y]=c.useState([]),[o,k]=c.useState(null),[D,M]=c.useState([]),[Z,ee]=c.useState(!1),[_]=V(),[N,A]=c.useState(Date.now());c.useEffect(()=>{(async()=>{await T();const[a,r,n,i]=await Promise.all([C(),$(),E(),G()]);f(a),y(r),k(n),M(i)})();const t=setInterval(()=>A(Date.now()),1e3),e=setInterval(async()=>{try{await T();const[a,r,n,i]=await Promise.all([C(),$(),E(),G()]);f(a),y(r),k(n),M(i)}catch{}},2*60*1e3);return()=>{clearInterval(e),clearInterval(t)}},[]);const g=c.useMemo(()=>o?u.filter(t=>!!t.ranked_opt_in):[],[u,o]),h=c.useMemo(()=>{if(!o)return new Map;const t=new Map;for(const e of g)t.set(e.id,0);for(const e of x){if(!e.assignee_id||!t.has(e.assignee_id))continue;const a=e.ranked_points??(e.status==="Complete"?35:10);t.set(e.assignee_id,(t.get(e.assignee_id)||0)+a)}for(const e of D){if(!e.person_id||!t.has(e.person_id))continue;const a=Math.max(0,Number(e.points||0));a&&t.set(e.person_id,(t.get(e.person_id)||0)+a)}return t},[g,x,D,o]),S=c.useMemo(()=>{const t={Bronze:[],Silver:[],Gold:[],Platinum:[],Diamond:[]};for(const e of g)t[e.rank||"Bronze"].push(e);return t},[g]);function L(t){const e=new Date(t),r=(7-e.getDay())%7,n=new Date(e.getFullYear(),e.getMonth(),e.getDate()+r,12,0,0,0);return n.getTime()<=t&&n.setDate(n.getDate()+7),n.getTime()}const O=L(N),v=Math.max(0,O-N),J=Math.floor(v/864e5),F=Math.floor(v%864e5/36e5),H=Math.floor(v%36e5/6e4),K=`${J}d ${F}h ${H}m`,d=Math.max((t=>{const e=new Date(t);return e.setHours(0,0,0,0),e.getTime()})(N),(o==null?void 0:o.last_reset_at)??0),P=c.useMemo(()=>{const t={Bronze:[],Silver:[],Gold:[],Platinum:[],Diamond:[]};for(const e of w){const a=(S[e]||[]).slice().sort((r,n)=>(h.get(n.id)||0)-(h.get(r.id)||0));t[e]=a}return t},[S,h]),[I,U]=c.useState(()=>{try{const t={ts:d,indices:{Bronze:{},Silver:{},Gold:{},Platinum:{},Diamond:{}}};for(const e of w){const a=`ranked:baseline:${e}`,r=localStorage.getItem(a);if(r){const n=JSON.parse(r);n&&n.ts===d&&(t.indices[e]=n.indices||{})}}return t}catch{return{ts:d,indices:{Bronze:{},Silver:{},Gold:{},Platinum:{},Diamond:{}}}}});return c.useEffect(()=>{const t={ts:d,indices:{Bronze:{},Silver:{},Gold:{},Platinum:{},Diamond:{}}};let e=!1;for(const a of w){const r=`ranked:baseline:${a}`;let n;try{const i=localStorage.getItem(r);if(i){const l=JSON.parse(i);l.ts===d&&(n=l.indices)}}catch{}if(!n){n={},(P[a]||[]).forEach((l,b)=>{n[l.id]=b});try{localStorage.setItem(r,JSON.stringify({ts:d,indices:n}))}catch{}e=!0}t.indices[a]=n||{}}(e||I.ts!==d)&&U(t)},[d,P]),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h1",{className:"text-2xl font-semibold",children:"Ranked"}),s.jsx("div",{className:"ml-auto flex items-center gap-3",children:o===null?s.jsx("div",{className:"text-xs text-white/80 rounded border border-white/10 bg-white/5 px-2 py-1",children:"Loading…"}):o!=null&&o.enabled&&_?s.jsxs("div",{className:"text-xs text-white/90 rounded-full border border-white/10 bg-white/5 px-3 py-1 shadow-sm",children:["Week ends in ",s.jsx("span",{className:"font-semibold",children:K})]}):s.jsx("div",{className:"text-xs text-red-300",children:"Ranked mode is disabled"})})]}),s.jsx("div",{className:"mb-3 text-[12px] text-uconn-muted",children:"Legend: green left border = promotion zone, red left border = demotion zone. Change Today: ▲ moved up, ▼ moved down."}),!(o!=null&&o.enabled)||!_?null:s.jsx("div",{className:"grid lg:grid-cols-2 gap-4",children:w.map(t=>{var b,z;const e=(S[t]||[]).slice().sort((p,m)=>(h.get(m.id)||0)-(h.get(p.id)||0)),a=t.toLowerCase(),r=((b=o.promotion_pct)==null?void 0:b[a])??0,n=((z=o.demotion_pct)==null?void 0:z[a])??0,i=Math.floor(r/100*e.length),l=Math.floor(n/100*e.length);return s.jsxs("div",{className:"form-section p-0 overflow-hidden",children:[s.jsxs("div",{className:"px-3 py-2 flex items-center gap-2 border-b border-white/10 bg-white/5",children:[s.jsx("img",{alt:t,src:X(t),className:"h-6 w-6 object-contain"}),s.jsx("h2",{className:"font-semibold",children:t}),s.jsxs("span",{className:"ml-auto text-xs text-uconn-muted",children:[e.length," in pool"]})]}),s.jsxs("table",{className:"w-full text-sm",children:[s.jsx("thead",{className:"text-xs text-uconn-muted border-b border-white/10",children:s.jsxs("tr",{children:[s.jsx("th",{className:"text-left px-3 py-2 w-8",children:"#"}),s.jsx("th",{className:"text-left px-2 py-2",children:"Name"}),s.jsx("th",{className:"text-right px-3 py-2 w-24",children:"Pts"}),s.jsx("th",{className:"text-right px-3 py-2 w-28",children:"Change Today"})]})}),s.jsxs("tbody",{children:[e.map((p,m)=>{var R;const W=m<i,Y=m>=Math.max(0,e.length-l)&&l>0,q="px-2 py-2 align-middle",Q=`pl-2 border-l-4 ${W?"border-green-400":Y?"border-red-400":"border-transparent"}`,B=(R=I.indices[t])==null?void 0:R[p.id],j=(typeof B=="number"?B:m)-m;return s.jsxs("tr",{className:"border-b border-white/5",children:[s.jsx("td",{className:"px-3 py-2 align-middle",children:m+1}),s.jsx("td",{className:q,children:s.jsx("div",{className:Q,children:p.name})}),s.jsx("td",{className:"px-3 py-2 align-middle text-right",children:h.get(p.id)||0}),s.jsx("td",{className:"px-3 py-2 align-middle text-right",children:j===0?s.jsx("span",{className:"text-uconn-muted",children:"– 0"}):s.jsxs("span",{className:j>0?"text-green-400":"text-red-400",children:[j>0?"▲":"▼"," ",Math.abs(j)]})})]},p.id)}),e.length===0&&s.jsx("tr",{children:s.jsx("td",{colSpan:4,className:"px-3 py-4 text-center text-xs text-uconn-muted",children:"No participants"})})]})]})]},t)})})]})}export{ae as default};
