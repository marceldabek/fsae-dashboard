import{r as c,f as W,a as R,b as H,c as Y,j as e,B as E}from"./index-BuVp9-lB.js";import{g as X,A as G,X as S,Y as D,f as J,R as C,L as N,C as M,T as v,a as A,b as $}from"./LineChart-CBJf6ng6.js";var q=X({chartName:"AreaChart",GraphicalChild:G,axisComponents:[{axisType:"xAxis",AxisComp:S},{axisType:"yAxis",AxisComp:D}],formatAxisMap:J});function ee(){const[u,p]=c.useState([]),[d,h]=c.useState([]),[l,g]=c.useState([]),[y,L]=c.useState([]),[m,_]=c.useState(!0);c.useEffect(()=>{let t=!0;return(async()=>{try{const[o,s,a,r]=await Promise.all([W(),R(),H(),Y()]);if(!t)return;p(o),h(s),g(a),L(r)}finally{t&&_(!1)}})(),()=>{t=!1}},[]);const j=c.useMemo(()=>{const t={Todo:0,"In Progress":0,Complete:0};for(const o of l)t[o.status]++;return{totalTasks:l.length,byStatus:t,totalPeople:u.length,totalProjects:d.length}},[u.length,d.length,l]),I=t=>t===1?.5:t===3?1:t===10?3:t===6?2:t===15?5:t===40?10:t===65?15:t===98?20:t===150?25:t===200?30:Math.max(0,Math.round(t/4)),K=c.useMemo(()=>{let t=0;for(const o of l)o.status!=="Complete"&&(!o.assignee_id||o.assignee_id==="")&&(typeof o.ranked_points=="number"?t+=I(o.ranked_points):t+=2);return Math.round(t)},[l]),z=c.useMemo(()=>{const t=new Map;for(const o of l){const s=o.completed_at??0;if(!s)continue;const a=new Date(s),r=a.getUTCFullYear(),i=new Date(Date.UTC(r,0,1)),x=Math.floor((a.getTime()-i.getTime())/864e5),T=Math.floor((x+i.getUTCDay())/7)+1,n=`${r}-W${String(T).padStart(2,"0")}`;t.set(n,(t.get(n)||0)+1)}return Array.from(t.entries()).map(([o,s])=>({week:o,completed:s})).sort((o,s)=>o.week.localeCompare(s.week))},[l]),O=c.useMemo(()=>{const t=new Date,o=[];for(let a=13;a>=0;a--){const r=new Date(t);r.setDate(t.getDate()-a);const i=r.toISOString().slice(0,10);o.push({day:i,completed:0})}const s=new Map(o.map((a,r)=>[a.day,r]));for(const a of l){if(!a.completed_at)continue;const r=new Date(a.completed_at).toISOString().slice(0,10),i=s.get(r);i!==void 0&&(o[i].completed+=1)}return o},[l]),B=c.useMemo(()=>{const t=new Map,o=new Map(d.map(s=>[s.id,s]));for(const s of l){const a=o.get(s.project_id),r=(a==null?void 0:a.subsystem)||"Unassigned",i=t.get(r)||{todo:0,progress:0,done:0};s.status==="Complete"?i.done+=1:s.status==="In Progress"?i.progress+=1:i.todo+=1,t.set(r,i)}return Array.from(t.entries()).map(([s,a])=>{const r=a.todo+a.progress+a.done,i=x=>r?Math.round(x/r*100):0;return{subsystem:s,total:r,todo:a.todo,progress:a.progress,done:a.done,todoPct:i(a.todo),progressPct:i(a.progress),donePct:i(a.done)}}).sort((s,a)=>s.subsystem.localeCompare(a.subsystem))},[d,l]);c.useMemo(()=>{const t=new Map;for(const s of l)s.status==="Complete"&&s.assignee_id&&t.set(s.assignee_id,(t.get(s.assignee_id)||0)+1);return u.map(s=>({name:s.name,completed:t.get(s.id)||0})).sort((s,a)=>a.completed-s.completed).slice(0,10)},[u,l]),c.useMemo(()=>{const t=new Map;for(const s of d)t.set(s.id,{total:0,done:0,name:s.name});for(const s of l){const a=t.get(s.project_id);a&&(a.total+=1,s.status==="Complete"&&(a.done+=1))}return Array.from(t.entries()).map(([s,a])=>({project:a.name,percent:a.total?Math.round(a.done/a.total*100):0})).sort((s,a)=>a.percent-s.percent).slice(0,10)},[d,l]);const U=c.useMemo(()=>{const o=new Date,s=[];for(let n=29;n>=0;n--){const f=new Date(o);f.setDate(o.getDate()-n),s.push(f.toISOString().slice(0,10))}const a=new Map(s.map((n,f)=>[n,f])),r=new Map(d.map(n=>[n.id,n])),i=new Set,x={};for(const n of s)x[n]={};for(const n of l){if(n.status!=="Complete"||!n.completed_at)continue;const f=new Date(n.completed_at).toISOString().slice(0,10);if(!a.has(f))continue;const b=r.get(n.project_id),P=(b==null?void 0:b.subsystem)||"Unassigned";i.add(P);const F=typeof n.ranked_points=="number"?I(n.ranked_points):2;x[f][P]=(x[f][P]||0)+F}const T=Array.from(i.values()).sort();return s.map(n=>{const f={day:n};for(const b of T)f[b]=x[n][b]||0;return f})},[d,l]);return m?e.jsx("div",{className:"text-sm text-uconn-muted",children:"Loading stats…"}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Stats"}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-3",children:[e.jsx(w,{label:"Projects",value:j.totalProjects}),e.jsx(w,{label:"People",value:j.totalPeople}),e.jsx(w,{label:"Tasks",value:j.totalTasks}),e.jsx(w,{label:"Tasks Done",value:j.byStatus.Complete}),e.jsx(w,{label:"Unassigned Work",value:`${K} ${K===1?"hour":"hours"}`})]}),e.jsx(k,{title:"Tasks completed past 14 days",children:e.jsx("div",{className:"h-56",children:e.jsx(C,{width:"100%",height:"100%",children:e.jsxs(N,{data:O,margin:{left:8,right:8,top:8,bottom:8},children:[e.jsx(M,{strokeDasharray:"3 3",stroke:"#1f2937"}),e.jsx(S,{dataKey:"day",tick:{fill:"#9ca3af",fontSize:12},interval:1,angle:-30,textAnchor:"end",height:60,tickFormatter:t=>{const[o,s,a]=t.split("-").map(Number);return`${s}/${a}`}}),e.jsx(D,{allowDecimals:!1,tick:{fill:"#9ca3af",fontSize:12}}),e.jsx(v,{contentStyle:{background:"#0b1220",border:"1px solid #273042"}}),e.jsx(A,{type:"monotone",dataKey:"completed",stroke:"#34d399",strokeWidth:2,dot:!1})]})})})}),e.jsx(k,{title:"Completions per week",children:e.jsx("div",{className:"h-56",children:e.jsx(C,{width:"100%",height:"100%",children:e.jsxs(N,{data:z,margin:{left:8,right:8,top:8,bottom:8},children:[e.jsx(M,{strokeDasharray:"3 3",stroke:"#1f2937"}),e.jsx(S,{dataKey:"week",hide:z.length>20,tick:{fill:"#9ca3af",fontSize:12}}),e.jsx(D,{allowDecimals:!1,tick:{fill:"#9ca3af",fontSize:12}}),e.jsx(v,{contentStyle:{background:"#0b1220",border:"1px solid #273042"}}),e.jsx($,{}),e.jsx(A,{type:"monotone",dataKey:"completed",stroke:"#34d399",strokeWidth:2,dot:!1})]})})})}),e.jsx(k,{title:"Subsystem status (task counts)",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-xs text-uconn-muted flex flex-wrap items-center gap-3",children:[e.jsx("span",{className:"font-medium text-white/80",children:"Legend (tasks):"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded-sm bg-[#34d399] inline-block"})," ",e.jsx("span",{children:"Complete"})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded-sm bg-[#facc15] inline-block"})," ",e.jsx("span",{children:"In Progress"})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded-sm bg-[#64748b] inline-block"})," ",e.jsx("span",{children:"Todo"})]}),e.jsx("span",{className:"text-[10px] text-uconn-muted/70 ml-auto md:ml-4",children:"Left→Right: Complete · In Progress · Todo"})]}),e.jsxs("ul",{className:"space-y-2",children:[B.map(t=>e.jsxs("li",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-32 md:w-40 text-sm truncate",children:t.subsystem}),e.jsxs("div",{className:"flex-1 h-3 rounded bg-white/10 overflow-hidden flex",children:[e.jsx("div",{className:"h-full",style:{flexGrow:t.done,flexBasis:0,background:"#34d399"}}),e.jsx("div",{className:"h-full",style:{flexGrow:t.progress,flexBasis:0,background:"#facc15"}}),e.jsx("div",{className:"h-full",style:{flexGrow:t.todo,flexBasis:0,background:"#64748b"}})]}),e.jsxs("div",{className:"hidden md:block w-28 text-right text-xs text-uconn-muted",children:[t.done,"/",t.total," done"]})]},t.subsystem)),B.length===0&&e.jsx("li",{className:"text-sm text-uconn-muted",children:"No subsystem data"})]})]})}),e.jsx(k,{title:"Attendance (last 10 meetings)",children:e.jsx("div",{className:"h-48",children:e.jsx(Q,{attendance:y})})}),e.jsx(k,{title:"Daily hours by subsystem (last 30 days)",children:e.jsx("div",{className:"h-72",children:e.jsx(C,{width:"100%",height:"100%",children:e.jsxs(N,{data:U,margin:{left:8,right:8,top:8,bottom:8},children:[e.jsx(M,{strokeDasharray:"3 3",stroke:"#1f2937"}),e.jsx(S,{dataKey:"day",interval:2,tick:{fill:"#9ca3af",fontSize:11},angle:-30,textAnchor:"end",height:60,tickFormatter:t=>{const[o,s,a]=t.split("-");return`${s}/${a}`}}),e.jsx(D,{allowDecimals:!1,tick:{fill:"#9ca3af",fontSize:12},label:{value:"Hours",angle:-90,position:"insideLeft",fill:"#9ca3af",fontSize:12}}),e.jsx(v,{contentStyle:{background:"#0b1220",border:"1px solid #273042"}}),e.jsx($,{}),Array.from(new Set(d.map(t=>t.subsystem||"Unassigned")).values()).sort().map((t,o)=>e.jsx(A,{type:"monotone",dataKey:t,stroke:E(o),strokeWidth:2,dot:!1},t))]})})})})]})}function k({title:u,children:p}){return e.jsxs("section",{className:"rounded-lg border border-uconn-border bg-black/10 p-4",children:[e.jsx("h2",{className:"text-lg font-medium mb-3",children:u}),p]})}function w({label:u,value:p}){return e.jsxs("div",{className:"rounded-md border border-uconn-border bg-black/20 p-3 h-full flex flex-col justify-between",children:[e.jsx("div",{className:"text-xs text-uconn-muted uppercase tracking-wide",children:u}),e.jsx("div",{className:"text-2xl font-semibold text-center leading-tight",children:p})]})}function Q({attendance:u}){const p=new Set([2,4,6]),d=new Date,h=[],l=m=>m.toISOString().slice(0,10),g=new Date(d.getFullYear(),d.getMonth(),d.getDate());for(;h.length<10;)p.has(g.getDay())&&h.push(l(g)),g.setDate(g.getDate()-1);const y=new Map(h.map(m=>[m,0]));for(const m of u)y.has(m.date)&&y.set(m.date,(y.get(m.date)||0)+1);const L=[...h].reverse().map(m=>{const j=new Date(m+"T00:00:00").toLocaleDateString(void 0,{weekday:"short",month:"numeric",day:"numeric"});return{date:m,label:j,attendees:y.get(m)||0}});return e.jsx(C,{width:"100%",height:"100%",children:e.jsxs(N,{data:L,margin:{top:6,right:10,left:4,bottom:4},children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"attLast10Line",x1:"0",y1:"0",x2:"1",y2:"0",children:[e.jsx("stop",{offset:"0%",stopColor:"#64C7C9"}),e.jsx("stop",{offset:"100%",stopColor:"#98D7D8"})]}),e.jsxs("linearGradient",{id:"attLast10Fill",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"#64C7C9",stopOpacity:.35}),e.jsx("stop",{offset:"100%",stopColor:"#98D7D8",stopOpacity:.05})]})]}),e.jsx(M,{strokeDasharray:"3 3",stroke:"#1f2937"}),e.jsx(S,{dataKey:"label",tick:{fill:"#9ca3af",fontSize:12},axisLine:!1,tickLine:!1}),e.jsx(D,{allowDecimals:!1,tick:{fill:"#9ca3af",fontSize:12},axisLine:!1,tickLine:!1,width:28}),e.jsx(v,{contentStyle:{background:"#0b1220",border:"1px solid #273042",borderRadius:8}}),e.jsx(q,{width:0,height:0}),e.jsx(G,{type:"monotone",dataKey:"attendees",stroke:"none",fill:"url(#attLast10Fill)"}),e.jsx(A,{type:"monotone",dataKey:"attendees",stroke:"url(#attLast10Line)",strokeWidth:3,dot:{r:3,stroke:"#98D7D8"},activeDot:{r:5}})]})})}export{ee as default};
