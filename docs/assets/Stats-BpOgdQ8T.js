import{r as c,f as X,a as Z,b as J,c as V,G as q,j as e}from"./index-CMjZw2V-.js";import{g as Q,A as W,X as g,Y as y,f as ee,R as C,L as w,C as S,T as N,a as v,b as z}from"./LineChart-CoxORmyU.js";var te=Q({chartName:"AreaChart",GraphicalChild:W,axisComponents:[{axisType:"xAxis",AxisComp:g},{axisType:"yAxis",AxisComp:y}],formatAxisMap:ee});function ne(){const[f,u]=c.useState([]),[m,j]=c.useState([]),[l,b]=c.useState([]),[k,L]=c.useState([]),[d,A]=c.useState([]),[T,E]=c.useState(!0);c.useEffect(()=>{let t=!0;return(async()=>{try{const[o,s,a,n,r]=await Promise.all([X(),Z(),J(),V(),q(30).catch(()=>[])]);if(!t)return;u(o),j(s),b(a),L(n),A(r)}finally{t&&E(!1)}})(),()=>{t=!1}},[]);const M=c.useMemo(()=>{const t=new Map(m.map(s=>[s.id,s])),o={Todo:0,"In Progress":0,Complete:0};for(const s of l){const a=t.get(s.project_id);a&&a.archived||o[s.status]++}return{totalTasks:l.length,byStatus:o,totalPeople:f.length,totalProjects:m.length}},[f.length,m.length,l]),K=t=>t===1?.5:t===3?1:t===10?3:t===6?2:t===15?5:t===40?10:t===65?15:t===98?20:t===150?25:t===200?30:Math.max(0,Math.round(t/4)),$=c.useMemo(()=>{let t=0;for(const o of l)o.status!=="Complete"&&(!o.assignee_id||o.assignee_id==="")&&(typeof o.ranked_points=="number"?t+=K(o.ranked_points):t+=2);return Math.round(t)},[l]),R=c.useMemo(()=>{const t=new Map;for(const o of l){const s=o.completed_at??0;if(!s)continue;const a=new Date(s),n=a.getUTCFullYear(),r=new Date(Date.UTC(n,0,1)),x=Math.floor((a.getTime()-r.getTime())/864e5),F=Math.floor((x+r.getUTCDay())/7)+1,i=`${n}-W${String(F).padStart(2,"0")}`;t.set(i,(t.get(i)||0)+1)}return Array.from(t.entries()).map(([o,s])=>({week:o,completed:s})).sort((o,s)=>o.week.localeCompare(s.week))},[l]),B=c.useMemo(()=>{const t=new Date,o=[];for(let a=13;a>=0;a--){const n=new Date(t);n.setDate(t.getDate()-a);const r=n.toISOString().slice(0,10);o.push({day:r,completed:0})}const s=new Map(o.map((a,n)=>[a.day,n]));for(const a of l){if(!a.completed_at)continue;const n=new Date(a.completed_at).toISOString().slice(0,10),r=s.get(n);r!==void 0&&(o[r].completed+=1)}return o},[l]),U=c.useMemo(()=>{const t=B.findIndex(o=>o.completed>0);return t>2?B.slice(t-1):B},[B]),O=c.useMemo(()=>{const t=new Map,o=new Map(m.map(s=>[s.id,s]));for(const s of l){const a=o.get(s.project_id);if(a&&a.archived)continue;const n=a?.subsystem||"Unassigned",r=t.get(n)||{todo:0,progress:0,done:0};s.status==="Complete"?r.done+=1:s.status==="In Progress"?r.progress+=1:r.todo+=1,t.set(n,r)}return Array.from(t.entries()).map(([s,a])=>{const n=a.todo+a.progress+a.done,r=x=>n?Math.round(x/n*100):0;return{subsystem:s,total:n,todo:a.todo,progress:a.progress,done:a.done,todoPct:r(a.todo),progressPct:r(a.progress),donePct:r(a.done)}}).sort((s,a)=>s.subsystem.localeCompare(a.subsystem))},[m,l]);c.useMemo(()=>{const t=new Map;for(const s of l)s.status==="Complete"&&s.assignee_id&&t.set(s.assignee_id,(t.get(s.assignee_id)||0)+1);return f.map(s=>({name:s.name,completed:t.get(s.id)||0})).sort((s,a)=>a.completed-s.completed).slice(0,10)},[f,l]),c.useMemo(()=>{const t=new Map;for(const s of m)t.set(s.id,{total:0,done:0,name:s.name});for(const s of l){const a=t.get(s.project_id);a&&(a.total+=1,s.status==="Complete"&&(a.done+=1))}return Array.from(t.entries()).map(([s,a])=>({project:a.name,percent:a.total?Math.round(a.done/a.total*100):0})).sort((s,a)=>a.percent-s.percent).slice(0,10)},[m,l]);const P=c.useMemo(()=>{const o=new Date,s=[];for(let i=29;i>=0;i--){const p=new Date(o);p.setDate(o.getDate()-i),s.push(p.toISOString().slice(0,10))}const a=new Map(s.map((i,p)=>[i,p])),n=new Map(m.map(i=>[i.id,i])),r=new Set,x={};for(const i of s)x[i]={};for(const i of l){if(i.status!=="Complete"||!i.completed_at)continue;const p=new Date(i.completed_at).toISOString().slice(0,10);if(!a.has(p))continue;const I=n.get(i.project_id)?.subsystem||"Unassigned";r.add(I);const Y=typeof i.ranked_points=="number"?K(i.ranked_points):2;x[p][I]=(x[p][I]||0)+Y}const F=Array.from(r.values()).sort();return s.map(i=>{const p={day:i};for(const _ of F)p[_]=x[i][_]||0;return p})},[m,l]),G=c.useMemo(()=>{const t=P;if(!t.length)return[];const o=Object.keys(t[0]).filter(n=>n!=="day"),s=.3,a={};return t.map(n=>{const r={day:n.day};return o.forEach(x=>r[x]=a[x]=a[x]==null?n[x]:s*n[x]+(1-s)*a[x]),r})},[P]),H=c.useMemo(()=>{const t=d.findIndex(o=>(o.visits||0)>0);return t>2?d.slice(t-1):d},[d]);return T?e.jsx("div",{className:"text-sm text-muted",children:"Loading stats…"}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold uppercase tracking-caps",children:"Stats"}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-3",children:[e.jsx(D,{label:"Projects",value:M.totalProjects}),e.jsx(D,{label:"People",value:M.totalPeople}),e.jsx(D,{label:"Tasks",value:M.totalTasks}),e.jsx(D,{label:"Tasks Done",value:M.byStatus.Complete}),e.jsx(D,{label:"Unassigned Work",value:`${$} ${$===1?"hour":"hours"}`}),e.jsx(D,{label:"Visits Today",value:d.find(t=>t.date===new Date().toISOString().slice(0,10))?.visits??0})]}),e.jsx(h,{title:"Tasks completed",subtitle:"Past 14 days",children:e.jsx("div",{className:"h-56",children:e.jsx(C,{width:"100%",height:"100%",children:e.jsxs(w,{data:U,margin:{top:6,right:10,left:4,bottom:4},children:[e.jsx(S,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.10)"}),e.jsx(g,{dataKey:"day",tick:{fill:"#BDC0C3",fontSize:11},minTickGap:12,angle:-30,textAnchor:"end",height:54,tickFormatter:t=>{const[o,s,a]=t.split("-").map(Number);return`${s}/${a}`}}),e.jsx(y,{allowDecimals:!1,tick:{fill:"#BDC0C3",fontSize:11},domain:[0,"dataMax + 1"],width:28}),e.jsx(N,{contentStyle:{background:"#0F1B3A",border:"1px solid rgba(255,255,255,0.10)",borderRadius:8}}),e.jsx(v,{type:"monotone",dataKey:"completed",stroke:"#34D399",strokeWidth:2,dot:!1})]})})})}),e.jsx(h,{title:"Completions per week",children:e.jsx("div",{className:"h-56",children:e.jsx(C,{width:"100%",height:"100%",children:e.jsxs(w,{data:R,margin:{left:8,right:8,top:8,bottom:8},children:[e.jsx(S,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.10)"}),e.jsx(g,{dataKey:"week",hide:R.length>20,tick:{fill:"#BDC0C3",fontSize:11}}),e.jsx(y,{allowDecimals:!1,tick:{fill:"#BDC0C3",fontSize:11}}),e.jsx(N,{contentStyle:{background:"#0F1B3A",border:"1px solid rgba(255,255,255,0.10)",borderRadius:8}}),e.jsx(z,{}),e.jsx(v,{type:"monotone",dataKey:"completed",stroke:"#64C7C9",strokeWidth:2,dot:!1})]})})})}),e.jsx(h,{title:"Subsystem status",subtitle:"Task counts",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-xs text-muted flex flex-wrap items-center gap-3 uppercase tracking-caps",children:[e.jsx("span",{className:"font-semibold text-white",children:"Legend"}),e.jsxs("span",{className:"flex items-center gap-1 normal-case",children:[e.jsx("span",{className:"w-3 h-3 rounded-sm bg-success inline-block"})," ",e.jsx("span",{className:"text-[11px]",children:"Complete"})]}),e.jsxs("span",{className:"flex items-center gap-1 normal-case",children:[e.jsx("span",{className:"w-3 h-3 rounded-sm bg-warning inline-block"})," ",e.jsx("span",{className:"text-[11px]",children:"In Progress"})]}),e.jsxs("span",{className:"flex items-center gap-1 normal-case",children:[e.jsx("span",{className:"w-3 h-3 rounded-sm bg-muted/40 inline-block"})," ",e.jsx("span",{className:"text-[11px]",children:"Todo"})]}),e.jsx("span",{className:"text-[11px] text-muted/70 ml-auto md:ml-4 normal-case font-normal tracking-normal",children:"Left→Right: Complete · In Progress · Todo"})]}),e.jsxs("ul",{className:"space-y-2",children:[O.map(t=>e.jsxs("li",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-32 md:w-40 text-sm truncate",children:t.subsystem}),e.jsxs("div",{className:"flex-1 h-3 rounded bg-overlay-6 overflow-hidden flex",children:[e.jsx("div",{className:"h-full",style:{flexGrow:t.done,flexBasis:0,background:"#34D399"}}),e.jsx("div",{className:"h-full",style:{flexGrow:t.progress,flexBasis:0,background:"#FACC15"}}),e.jsx("div",{className:"h-full",style:{flexGrow:t.todo,flexBasis:0,background:"rgba(255,255,255,0.25)"}})]}),e.jsxs("div",{className:"hidden md:block w-28 text-right text-xs text-muted",children:[t.done,"/",t.total," done"]})]},t.subsystem)),O.length===0&&e.jsx("li",{className:"text-sm text-muted",children:"No subsystem data"})]})]})}),e.jsx(h,{title:"Attendance",subtitle:"Last 10 meetings",children:e.jsx("div",{className:"h-48",children:e.jsx(se,{attendance:k})})}),e.jsx(h,{title:"Daily hours by subsystem",subtitle:"Last 30 days",children:e.jsx("div",{className:"h-72",children:e.jsx(C,{width:"100%",height:"100%",children:e.jsxs(w,{data:P,margin:{left:8,right:8,top:8,bottom:8},children:[e.jsx(S,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.10)"}),e.jsx(g,{dataKey:"day",interval:2,tick:{fill:"#BDC0C3",fontSize:11},angle:-30,textAnchor:"end",height:60,tickFormatter:t=>{const[o,s,a]=t.split("-");return`${s}/${a}`}}),e.jsx(y,{allowDecimals:!1,tick:{fill:"#BDC0C3",fontSize:11},label:{value:"Hours",angle:-90,position:"insideLeft",fill:"#BDC0C3",fontSize:11}}),e.jsx(N,{contentStyle:{background:"#0F1B3A",border:"1px solid rgba(255,255,255,0.10)",borderRadius:8}}),e.jsx(z,{}),Array.from(new Set(m.map(t=>t.subsystem||"Unassigned")).values()).sort().map((t,o)=>{const s=["#64C7C9","#98D7D8","#34D399","#FACC15","#3BA7A9","#2E7D7F"];return e.jsx(v,{type:"monotone",dataKey:t,stroke:s[o%s.length],strokeWidth:2,dot:!1},t)})]})})})}),e.jsxs(h,{title:"Daily hours by subsystem",subtitle:"Smoothed (α=0.3)",children:[e.jsx("div",{className:"h-72",children:e.jsx(C,{width:"100%",height:"100%",children:e.jsxs(w,{data:G,margin:{left:8,right:8,top:8,bottom:8},children:[e.jsx(S,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.10)"}),e.jsx(g,{dataKey:"day",interval:2,tick:{fill:"#BDC0C3",fontSize:11},angle:-30,textAnchor:"end",height:60,tickFormatter:t=>{const[o,s,a]=t.split("-");return`${s}/${a}`}}),e.jsx(y,{allowDecimals:!1,tick:{fill:"#BDC0C3",fontSize:11},label:{value:"Smoothed Hours",angle:-90,position:"insideLeft",fill:"#BDC0C3",fontSize:11}}),e.jsx(N,{contentStyle:{background:"#0F1B3A",border:"1px solid rgba(255,255,255,0.10)",borderRadius:8}}),e.jsx(z,{}),Object.keys(G[0]||{}).filter(t=>t!=="day").map((t,o)=>{const s=["#64C7C9","#98D7D8","#34D399","#FACC15","#3BA7A9","#2E7D7F"];return e.jsx(v,{type:"monotone",dataKey:t,stroke:s[o%s.length],strokeWidth:2,dot:!1},t)})]})})}),e.jsx("p",{className:"mt-2 text-tick text-muted",children:"Exponential smoothing (α=0.3) dampens spikes from large task completions while keeping trends clear. Raw totals (previous chart) remain the authoritative sum."})]}),e.jsx(h,{title:"Daily visits",subtitle:"Last 30 days",children:e.jsx("div",{className:"h-56",children:e.jsx(C,{width:"100%",height:"100%",children:e.jsxs(w,{data:H,margin:{top:6,right:10,left:4,bottom:4},children:[e.jsx(S,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.10)"}),e.jsx(g,{dataKey:"date",interval:3,tick:{fill:"#BDC0C3",fontSize:11},angle:-30,textAnchor:"end",height:54,tickFormatter:t=>{const[o,s,a]=t.split("-");return`${s}/${a}`}}),e.jsx(y,{allowDecimals:!1,tick:{fill:"#BDC0C3",fontSize:11},width:28}),e.jsx(N,{contentStyle:{background:"#0F1B3A",border:"1px solid rgba(255,255,255,0.10)",borderRadius:8}}),e.jsx(v,{type:"monotone",dataKey:"visits",stroke:"#98D7D8",strokeWidth:2,dot:!1})]})})})})]})}function h({title:f,subtitle:u,children:m}){return e.jsxs("section",{className:"rounded-lg border border-border bg-overlay-6 p-4",children:[e.jsx("h2",{className:"text-base sm:text-lg font-semibold uppercase tracking-caps mb-1",children:f}),u&&e.jsx("div",{className:"text-[11px] sm:text-xs text-muted mb-3 -mt-1",children:u}),!u&&e.jsx("div",{className:"mb-3"}),m]})}function D({label:f,value:u}){return e.jsxs("div",{className:"rounded-md border border-border bg-overlay-6 p-3 h-full flex flex-col justify-between",children:[e.jsx("div",{className:"text-[11px] sm:text-xs text-muted uppercase tracking-caps font-semibold",children:f}),e.jsx("div",{className:"text-lg sm:text-2xl font-bold text-center leading-tight",children:u})]})}function se({attendance:f}){const u=new Set([2,4,6]),m=new Date,j=[],l=d=>d.toISOString().slice(0,10),b=new Date(m.getFullYear(),m.getMonth(),m.getDate());for(;j.length<10;)u.has(b.getDay())&&j.push(l(b)),b.setDate(b.getDate()-1);const k=new Map(j.map(d=>[d,0]));for(const d of f)k.has(d.date)&&k.set(d.date,(k.get(d.date)||0)+1);const L=[...j].reverse().map(d=>{const A=new Date(d+"T00:00:00"),T=`${A.getMonth()+1}/${A.getDate()}`;return{date:d,label:T,attendees:k.get(d)||0}});return e.jsx(C,{width:"100%",height:"100%",children:e.jsxs(w,{data:L,margin:{top:6,right:10,left:4,bottom:4},children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"attLast10Line",x1:"0",y1:"0",x2:"1",y2:"0",children:[e.jsx("stop",{offset:"0%",stopColor:"#64C7C9"}),e.jsx("stop",{offset:"100%",stopColor:"#98D7D8"})]}),e.jsxs("linearGradient",{id:"attLast10Fill",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"#64C7C9",stopOpacity:.35}),e.jsx("stop",{offset:"100%",stopColor:"#98D7D8",stopOpacity:.05})]})]}),e.jsx(S,{strokeDasharray:"3 3",stroke:"#1f2937"}),e.jsx(g,{dataKey:"label",tick:{fill:"#9ca3af",fontSize:12},axisLine:!1,tickLine:!1}),e.jsx(y,{allowDecimals:!1,tick:{fill:"#9ca3af",fontSize:12},axisLine:!1,tickLine:!1,width:28}),e.jsx(N,{contentStyle:{background:"#0b1220",border:"1px solid #273042",borderRadius:8}}),e.jsx(te,{width:0,height:0}),e.jsx(W,{type:"monotone",dataKey:"attendees",stroke:"none",fill:"url(#attLast10Fill)"}),e.jsx(v,{type:"monotone",dataKey:"attendees",stroke:"url(#attLast10Line)",strokeWidth:3,dot:{r:3,stroke:"#98D7D8"},activeDot:{r:5}})]})})}export{ne as default};
