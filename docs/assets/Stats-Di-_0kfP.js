import{r as c,f as X,a as J,b as V,c as q,D as Q,j as e,E as R}from"./index-B-YBCRUe.js";import{g as Z,A as U,X as y,Y as g,f as ee,R as D,L as N,C as v,T as C,a as A,b as K}from"./LineChart-CASGGAIb.js";var te=Z({chartName:"AreaChart",GraphicalChild:U,axisComponents:[{axisType:"xAxis",AxisComp:y},{axisType:"yAxis",AxisComp:g}],formatAxisMap:ee});function ne(){var G;const[h,u]=c.useState([]),[f,j]=c.useState([]),[l,b]=c.useState([]),[k,L]=c.useState([]),[m,I]=c.useState([]),[T,E]=c.useState(!0);c.useEffect(()=>{let t=!0;return(async()=>{try{const[o,s,a,n,r]=await Promise.all([X(),J(),V(),q(),Q(30).catch(()=>[])]);if(!t)return;u(o),j(s),b(a),L(n),I(r)}finally{t&&E(!1)}})(),()=>{t=!1}},[]);const M=c.useMemo(()=>{const t={Todo:0,"In Progress":0,Complete:0};for(const o of l)t[o.status]++;return{totalTasks:l.length,byStatus:t,totalPeople:h.length,totalProjects:f.length}},[h.length,f.length,l]),$=t=>t===1?.5:t===3?1:t===10?3:t===6?2:t===15?5:t===40?10:t===65?15:t===98?20:t===150?25:t===200?30:Math.max(0,Math.round(t/4)),O=c.useMemo(()=>{let t=0;for(const o of l)o.status!=="Complete"&&(!o.assignee_id||o.assignee_id==="")&&(typeof o.ranked_points=="number"?t+=$(o.ranked_points):t+=2);return Math.round(t)},[l]),B=c.useMemo(()=>{const t=new Map;for(const o of l){const s=o.completed_at??0;if(!s)continue;const a=new Date(s),n=a.getUTCFullYear(),r=new Date(Date.UTC(n,0,1)),d=Math.floor((a.getTime()-r.getTime())/864e5),_=Math.floor((d+r.getUTCDay())/7)+1,i=`${n}-W${String(_).padStart(2,"0")}`;t.set(i,(t.get(i)||0)+1)}return Array.from(t.entries()).map(([o,s])=>({week:o,completed:s})).sort((o,s)=>o.week.localeCompare(s.week))},[l]),H=c.useMemo(()=>{const t=new Date,o=[];for(let a=13;a>=0;a--){const n=new Date(t);n.setDate(t.getDate()-a);const r=n.toISOString().slice(0,10);o.push({day:r,completed:0})}const s=new Map(o.map((a,n)=>[a.day,n]));for(const a of l){if(!a.completed_at)continue;const n=new Date(a.completed_at).toISOString().slice(0,10),r=s.get(n);r!==void 0&&(o[r].completed+=1)}return o},[l]),F=c.useMemo(()=>{const t=new Map,o=new Map(f.map(s=>[s.id,s]));for(const s of l){const a=o.get(s.project_id),n=(a==null?void 0:a.subsystem)||"Unassigned",r=t.get(n)||{todo:0,progress:0,done:0};s.status==="Complete"?r.done+=1:s.status==="In Progress"?r.progress+=1:r.todo+=1,t.set(n,r)}return Array.from(t.entries()).map(([s,a])=>{const n=a.todo+a.progress+a.done,r=d=>n?Math.round(d/n*100):0;return{subsystem:s,total:n,todo:a.todo,progress:a.progress,done:a.done,todoPct:r(a.todo),progressPct:r(a.progress),donePct:r(a.done)}}).sort((s,a)=>s.subsystem.localeCompare(a.subsystem))},[f,l]);c.useMemo(()=>{const t=new Map;for(const s of l)s.status==="Complete"&&s.assignee_id&&t.set(s.assignee_id,(t.get(s.assignee_id)||0)+1);return h.map(s=>({name:s.name,completed:t.get(s.id)||0})).sort((s,a)=>a.completed-s.completed).slice(0,10)},[h,l]),c.useMemo(()=>{const t=new Map;for(const s of f)t.set(s.id,{total:0,done:0,name:s.name});for(const s of l){const a=t.get(s.project_id);a&&(a.total+=1,s.status==="Complete"&&(a.done+=1))}return Array.from(t.entries()).map(([s,a])=>({project:a.name,percent:a.total?Math.round(a.done/a.total*100):0})).sort((s,a)=>a.percent-s.percent).slice(0,10)},[f,l]);const P=c.useMemo(()=>{const o=new Date,s=[];for(let i=29;i>=0;i--){const x=new Date(o);x.setDate(o.getDate()-i),s.push(x.toISOString().slice(0,10))}const a=new Map(s.map((i,x)=>[i,x])),n=new Map(f.map(i=>[i.id,i])),r=new Set,d={};for(const i of s)d[i]={};for(const i of l){if(i.status!=="Complete"||!i.completed_at)continue;const x=new Date(i.completed_at).toISOString().slice(0,10);if(!a.has(x))continue;const w=n.get(i.project_id),z=(w==null?void 0:w.subsystem)||"Unassigned";r.add(z);const Y=typeof i.ranked_points=="number"?$(i.ranked_points):2;d[x][z]=(d[x][z]||0)+Y}const _=Array.from(r.values()).sort();return s.map(i=>{const x={day:i};for(const w of _)x[w]=d[i][w]||0;return x})},[f,l]),W=c.useMemo(()=>{const t=P;if(!t.length)return[];const o=Object.keys(t[0]).filter(n=>n!=="day"),s=.3,a={};return t.map(n=>{const r={day:n.day};return o.forEach(d=>r[d]=a[d]=a[d]==null?n[d]:s*n[d]+(1-s)*a[d]),r})},[P]);return T?e.jsx("div",{className:"text-sm text-uconn-muted",children:"Loading stats…"}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Stats"}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-3",children:[e.jsx(S,{label:"Projects",value:M.totalProjects}),e.jsx(S,{label:"People",value:M.totalPeople}),e.jsx(S,{label:"Tasks",value:M.totalTasks}),e.jsx(S,{label:"Tasks Done",value:M.byStatus.Complete}),e.jsx(S,{label:"Unassigned Work",value:`${O} ${O===1?"hour":"hours"}`}),e.jsx(S,{label:"Visits Today",value:((G=m.find(t=>t.date===new Date().toISOString().slice(0,10)))==null?void 0:G.visits)??0})]}),e.jsx(p,{title:"Tasks completed past 14 days",children:e.jsx("div",{className:"h-56",children:e.jsx(D,{width:"100%",height:"100%",children:e.jsxs(N,{data:H,margin:{left:8,right:8,top:8,bottom:8},children:[e.jsx(v,{strokeDasharray:"3 3",stroke:"#1f2937"}),e.jsx(y,{dataKey:"day",tick:{fill:"#9ca3af",fontSize:12},interval:1,angle:-30,textAnchor:"end",height:60,tickFormatter:t=>{const[o,s,a]=t.split("-").map(Number);return`${s}/${a}`}}),e.jsx(g,{allowDecimals:!1,tick:{fill:"#9ca3af",fontSize:12}}),e.jsx(C,{contentStyle:{background:"#0b1220",border:"1px solid #273042"}}),e.jsx(A,{type:"monotone",dataKey:"completed",stroke:"#34d399",strokeWidth:2,dot:!1})]})})})}),e.jsx(p,{title:"Completions per week",children:e.jsx("div",{className:"h-56",children:e.jsx(D,{width:"100%",height:"100%",children:e.jsxs(N,{data:B,margin:{left:8,right:8,top:8,bottom:8},children:[e.jsx(v,{strokeDasharray:"3 3",stroke:"#1f2937"}),e.jsx(y,{dataKey:"week",hide:B.length>20,tick:{fill:"#9ca3af",fontSize:12}}),e.jsx(g,{allowDecimals:!1,tick:{fill:"#9ca3af",fontSize:12}}),e.jsx(C,{contentStyle:{background:"#0b1220",border:"1px solid #273042"}}),e.jsx(K,{}),e.jsx(A,{type:"monotone",dataKey:"completed",stroke:"#34d399",strokeWidth:2,dot:!1})]})})})}),e.jsx(p,{title:"Subsystem status (task counts)",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-xs text-uconn-muted flex flex-wrap items-center gap-3",children:[e.jsx("span",{className:"font-medium text-white/80",children:"Legend (tasks):"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded-sm bg-[#34d399] inline-block"})," ",e.jsx("span",{children:"Complete"})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded-sm bg-[#facc15] inline-block"})," ",e.jsx("span",{children:"In Progress"})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded-sm bg-[#64748b] inline-block"})," ",e.jsx("span",{children:"Todo"})]}),e.jsx("span",{className:"text-[10px] text-uconn-muted/70 ml-auto md:ml-4",children:"Left→Right: Complete · In Progress · Todo"})]}),e.jsxs("ul",{className:"space-y-2",children:[F.map(t=>e.jsxs("li",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-32 md:w-40 text-sm truncate",children:t.subsystem}),e.jsxs("div",{className:"flex-1 h-3 rounded bg-white/10 overflow-hidden flex",children:[e.jsx("div",{className:"h-full",style:{flexGrow:t.done,flexBasis:0,background:"#34d399"}}),e.jsx("div",{className:"h-full",style:{flexGrow:t.progress,flexBasis:0,background:"#facc15"}}),e.jsx("div",{className:"h-full",style:{flexGrow:t.todo,flexBasis:0,background:"#64748b"}})]}),e.jsxs("div",{className:"hidden md:block w-28 text-right text-xs text-uconn-muted",children:[t.done,"/",t.total," done"]})]},t.subsystem)),F.length===0&&e.jsx("li",{className:"text-sm text-uconn-muted",children:"No subsystem data"})]})]})}),e.jsx(p,{title:"Attendance (last 10 meetings)",children:e.jsx("div",{className:"h-48",children:e.jsx(se,{attendance:k})})}),e.jsx(p,{title:"Daily hours by subsystem (last 30 days)",children:e.jsx("div",{className:"h-72",children:e.jsx(D,{width:"100%",height:"100%",children:e.jsxs(N,{data:P,margin:{left:8,right:8,top:8,bottom:8},children:[e.jsx(v,{strokeDasharray:"3 3",stroke:"#1f2937"}),e.jsx(y,{dataKey:"day",interval:2,tick:{fill:"#9ca3af",fontSize:11},angle:-30,textAnchor:"end",height:60,tickFormatter:t=>{const[o,s,a]=t.split("-");return`${s}/${a}`}}),e.jsx(g,{allowDecimals:!1,tick:{fill:"#9ca3af",fontSize:12},label:{value:"Hours",angle:-90,position:"insideLeft",fill:"#9ca3af",fontSize:12}}),e.jsx(C,{contentStyle:{background:"#0b1220",border:"1px solid #273042"}}),e.jsx(K,{}),Array.from(new Set(f.map(t=>t.subsystem||"Unassigned")).values()).sort().map((t,o)=>e.jsx(A,{type:"monotone",dataKey:t,stroke:R(o),strokeWidth:2,dot:!1},t))]})})})}),e.jsxs(p,{title:"Daily hours by subsystem (smoothed)",children:[e.jsx("div",{className:"h-72",children:e.jsx(D,{width:"100%",height:"100%",children:e.jsxs(N,{data:W,margin:{left:8,right:8,top:8,bottom:8},children:[e.jsx(v,{strokeDasharray:"3 3",stroke:"#1f2937"}),e.jsx(y,{dataKey:"day",interval:2,tick:{fill:"#9ca3af",fontSize:11},angle:-30,textAnchor:"end",height:60,tickFormatter:t=>{const[o,s,a]=t.split("-");return`${s}/${a}`}}),e.jsx(g,{allowDecimals:!1,tick:{fill:"#9ca3af",fontSize:12},label:{value:"Smoothed Hours",angle:-90,position:"insideLeft",fill:"#9ca3af",fontSize:12}}),e.jsx(C,{contentStyle:{background:"#0b1220",border:"1px solid #273042"}}),e.jsx(K,{}),Object.keys(W[0]||{}).filter(t=>t!=="day").map((t,o)=>e.jsx(A,{type:"monotone",dataKey:t,stroke:R(o),strokeWidth:2,dot:!1},t))]})})}),e.jsx("p",{className:"mt-2 text-[11px] text-uconn-muted",children:"Exponential smoothing (α=0.3) dampens spikes from large task completions while keeping trends clear. Raw totals (previous chart) remain the authoritative sum."})]}),e.jsx(p,{title:"Daily visits (last 30 days)",children:e.jsx("div",{className:"h-56",children:e.jsx(D,{width:"100%",height:"100%",children:e.jsxs(N,{data:m,margin:{left:8,right:8,top:8,bottom:8},children:[e.jsx(v,{strokeDasharray:"3 3",stroke:"#1f2937"}),e.jsx(y,{dataKey:"date",interval:3,tick:{fill:"#9ca3af",fontSize:11},angle:-30,textAnchor:"end",height:60,tickFormatter:t=>{const[o,s,a]=t.split("-");return`${s}/${a}`}}),e.jsx(g,{allowDecimals:!1,tick:{fill:"#9ca3af",fontSize:12}}),e.jsx(C,{contentStyle:{background:"#0b1220",border:"1px solid #273042"}}),e.jsx(A,{type:"monotone",dataKey:"visits",stroke:"#60a5fa",strokeWidth:2,dot:!1})]})})})})]})}function p({title:h,children:u}){return e.jsxs("section",{className:"rounded-lg border border-uconn-border bg-black/10 p-4",children:[e.jsx("h2",{className:"text-lg font-medium mb-3",children:h}),u]})}function S({label:h,value:u}){return e.jsxs("div",{className:"rounded-md border border-uconn-border bg-black/20 p-3 h-full flex flex-col justify-between",children:[e.jsx("div",{className:"text-xs text-uconn-muted uppercase tracking-wide",children:h}),e.jsx("div",{className:"text-2xl font-semibold text-center leading-tight",children:u})]})}function se({attendance:h}){const u=new Set([2,4,6]),f=new Date,j=[],l=m=>m.toISOString().slice(0,10),b=new Date(f.getFullYear(),f.getMonth(),f.getDate());for(;j.length<10;)u.has(b.getDay())&&j.push(l(b)),b.setDate(b.getDate()-1);const k=new Map(j.map(m=>[m,0]));for(const m of h)k.has(m.date)&&k.set(m.date,(k.get(m.date)||0)+1);const L=[...j].reverse().map(m=>{const T=new Date(m+"T00:00:00").toLocaleDateString(void 0,{weekday:"short",month:"numeric",day:"numeric"});return{date:m,label:T,attendees:k.get(m)||0}});return e.jsx(D,{width:"100%",height:"100%",children:e.jsxs(N,{data:L,margin:{top:6,right:10,left:4,bottom:4},children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"attLast10Line",x1:"0",y1:"0",x2:"1",y2:"0",children:[e.jsx("stop",{offset:"0%",stopColor:"#64C7C9"}),e.jsx("stop",{offset:"100%",stopColor:"#98D7D8"})]}),e.jsxs("linearGradient",{id:"attLast10Fill",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"#64C7C9",stopOpacity:.35}),e.jsx("stop",{offset:"100%",stopColor:"#98D7D8",stopOpacity:.05})]})]}),e.jsx(v,{strokeDasharray:"3 3",stroke:"#1f2937"}),e.jsx(y,{dataKey:"label",tick:{fill:"#9ca3af",fontSize:12},axisLine:!1,tickLine:!1}),e.jsx(g,{allowDecimals:!1,tick:{fill:"#9ca3af",fontSize:12},axisLine:!1,tickLine:!1,width:28}),e.jsx(C,{contentStyle:{background:"#0b1220",border:"1px solid #273042",borderRadius:8}}),e.jsx(te,{width:0,height:0}),e.jsx(U,{type:"monotone",dataKey:"attendees",stroke:"none",fill:"url(#attLast10Fill)"}),e.jsx(A,{type:"monotone",dataKey:"attendees",stroke:"url(#attLast10Line)",strokeWidth:3,dot:{r:3,stroke:"#98D7D8"},activeDot:{r:5}})]})})}export{ne as default};
