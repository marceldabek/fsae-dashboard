import{r as l,j as e}from"./vendor-react-pWhzumim.js";import{f as z,a as K,b as L}from"./index-DnDrctQO.js";import{R as u,L as N,C as j,X as g,Y as y,T as b,l as v,n as $,B,q as U}from"./vendor-9xdiniD5.js";import"./vendor-react-router-vBeDBGet.js";import"./vendor-firebase-DtYdhfHX.js";function F(){const[i,m]=l.useState([]),[d,D]=l.useState([]),[n,C]=l.useState([]),[M,T]=l.useState(!0);l.useEffect(()=>{let o=!0;return(async()=>{try{const[a,t,s]=await Promise.all([z(),K(),L()]);if(!o)return;m(a),D(t),C(s)}finally{o&&T(!1)}})(),()=>{o=!1}},[]);const p=l.useMemo(()=>{const o={Todo:0,"In Progress":0,Complete:0};for(const a of n)o[a.status]++;return{totalTasks:n.length,byStatus:o,totalPeople:i.length,totalProjects:d.length}},[i.length,d.length,n]),k=l.useMemo(()=>{const o=new Map;for(const a of n){const t=a.completed_at??0;if(!t)continue;const s=new Date(t),r=s.getUTCFullYear(),c=new Date(Date.UTC(r,0,1)),S=Math.floor((s.getTime()-c.getTime())/864e5),P=Math.floor((S+c.getUTCDay())/7)+1,f=`${r}-W${String(P).padStart(2,"0")}`;o.set(f,(o.get(f)||0)+1)}return Array.from(o.entries()).map(([a,t])=>({week:a,completed:t})).sort((a,t)=>a.week.localeCompare(t.week))},[n]),_=l.useMemo(()=>{const o=new Date,a=[];for(let s=13;s>=0;s--){const r=new Date(o);r.setDate(o.getDate()-s);const c=r.toISOString().slice(0,10);a.push({day:c,completed:0})}const t=new Map(a.map((s,r)=>[s.day,r]));for(const s of n){if(!s.completed_at)continue;const r=new Date(s.completed_at).toISOString().slice(0,10),c=t.get(r);c!==void 0&&(a[c].completed+=1)}return a},[n]),w=l.useMemo(()=>{const o=new Map,a=new Map;for(const t of n){const s=a.get(t.project_id)||[];s.push(t),a.set(t.project_id,s)}for(const t of d){const s=t.subsystem||"Unassigned",r=o.get(s)||{totalProjects:0,doneProjects:0};r.totalProjects+=1;const c=a.get(t.id)||[];c.length>0&&c.every(f=>f.status==="Complete")&&(r.doneProjects+=1),o.set(s,r)}return Array.from(o.entries()).map(([t,s])=>({name:t,total:s.totalProjects,done:s.doneProjects,percent:s.totalProjects?Math.round(s.doneProjects/s.totalProjects*100):0})).sort((t,s)=>t.name.localeCompare(s.name))},[d,n]),A=l.useMemo(()=>{const o=new Map;for(const t of n)t.status==="Complete"&&t.assignee_id&&o.set(t.assignee_id,(o.get(t.assignee_id)||0)+1);return i.map(t=>({name:t.name,completed:o.get(t.id)||0})).sort((t,s)=>s.completed-t.completed).slice(0,10)},[i,n]);return l.useMemo(()=>{const o=new Map;for(const t of d)o.set(t.id,{total:0,done:0,name:t.name});for(const t of n){const s=o.get(t.project_id);s&&(s.total+=1,t.status==="Complete"&&(s.done+=1))}return Array.from(o.entries()).map(([t,s])=>({project:s.name,percent:s.total?Math.round(s.done/s.total*100):0})).sort((t,s)=>s.percent-t.percent).slice(0,10)},[d,n]),M?e.jsx("div",{className:"text-sm text-uconn-muted",children:"Loading statsâ€¦"}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Stats"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsx(x,{label:"Projects",value:p.totalProjects}),e.jsx(x,{label:"People",value:p.totalPeople}),e.jsx(x,{label:"Tasks",value:p.totalTasks}),e.jsx(x,{label:"Done",value:p.byStatus.Complete})]}),e.jsx(h,{title:"Tasks completed past 14 days",children:e.jsx("div",{className:"h-56",children:e.jsx(u,{width:"100%",height:"100%",children:e.jsxs(N,{data:_,margin:{left:8,right:8,top:8,bottom:8},children:[e.jsx(j,{strokeDasharray:"3 3",stroke:"#1f2937"}),e.jsx(g,{dataKey:"day",tick:{fill:"#9ca3af",fontSize:12},interval:1,angle:-30,textAnchor:"end",height:60,tickFormatter:o=>{const[a,t,s]=o.split("-").map(Number);return`${t}/${s}`}}),e.jsx(y,{allowDecimals:!1,tick:{fill:"#9ca3af",fontSize:12}}),e.jsx(b,{contentStyle:{background:"#0b1220",border:"1px solid #273042"}}),e.jsx(v,{type:"monotone",dataKey:"completed",stroke:"#34d399",strokeWidth:2,dot:!1})]})})})}),e.jsx(h,{title:"Completions per week",children:e.jsx("div",{className:"h-56",children:e.jsx(u,{width:"100%",height:"100%",children:e.jsxs(N,{data:k,margin:{left:8,right:8,top:8,bottom:8},children:[e.jsx(j,{strokeDasharray:"3 3",stroke:"#1f2937"}),e.jsx(g,{dataKey:"week",hide:k.length>20,tick:{fill:"#9ca3af",fontSize:12}}),e.jsx(y,{allowDecimals:!1,tick:{fill:"#9ca3af",fontSize:12}}),e.jsx(b,{contentStyle:{background:"#0b1220",border:"1px solid #273042"}}),e.jsx($,{}),e.jsx(v,{type:"monotone",dataKey:"completed",stroke:"#34d399",strokeWidth:2,dot:!1})]})})})}),e.jsx(h,{title:"Top contributors (completed tasks)",children:e.jsx("div",{className:"h-64",children:e.jsx(u,{width:"100%",height:"100%",children:e.jsxs(B,{data:A,margin:{left:8,right:8,top:8,bottom:8},children:[e.jsx(j,{strokeDasharray:"3 3",stroke:"#1f2937"}),e.jsx(g,{dataKey:"name",tick:{fill:"#9ca3af",fontSize:12},interval:0,angle:-30,textAnchor:"end",height:60}),e.jsx(y,{allowDecimals:!1,tick:{fill:"#9ca3af",fontSize:12}}),e.jsx(b,{contentStyle:{background:"#0b1220",border:"1px solid #273042"}}),e.jsx(U,{dataKey:"completed",fill:"#60a5fa"})]})})})}),e.jsx(h,{title:"Subsystem progress",children:e.jsxs("div",{className:"space-y-2",children:[w.map(o=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-36 text-xs text-uconn-muted",children:o.name}),e.jsx("div",{className:"flex-1 h-3 bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-brand-teal/60",style:{width:`${o.percent}%`}})}),e.jsxs("div",{className:"w-28 text-right text-xs",children:[o.done,"/",o.total," (",o.percent,"%)"]})]},o.name)),w.length===0&&e.jsx("div",{className:"text-xs text-uconn-muted",children:"No subsystems"})]})})]})}function h({title:i,children:m}){return e.jsxs("section",{className:"rounded-lg border border-uconn-border bg-black/10 p-4",children:[e.jsx("h2",{className:"text-lg font-medium mb-3",children:i}),m]})}function x({label:i,value:m}){return e.jsxs("div",{className:"rounded-md border border-uconn-border bg-black/20 p-3",children:[e.jsx("div",{className:"text-xs text-uconn-muted uppercase",children:i}),e.jsx("div",{className:"text-2xl font-semibold",children:m})]})}export{F as default};
