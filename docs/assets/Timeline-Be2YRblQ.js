import{r as s,j as o,a as An,h as On,K as Le,M as Fn,A as pt,v as xt,N as gt,O as Ln}from"./index-DOVok7Jw.js";import{i as Yn}from"./Edit03-Dt6w5hRD.js";import{a as Be,P as Gn}from"./ProjectCreateModal-CDrAZWwy.js";import{h as We,i as et,j as St,u as Un,P as de,k as F,l as Ce,m as It,n as Bn,o as Ke,p as Rt,R as Kn,A as Xn,q as Hn,r as zn,s as Vn,t as qn,v as Jn,w as Zn,F as Qn,x as Wn,C as eo,y as to,z as no,B as fe,E as oo}from"./modal-Da3X0Utv.js";import{u as ro,d as vt}from"./discordMapping-KLSwrPOk.js";import"./card-DPHmeWF8.js";import"./clsx-B-dksMZM.js";const kt=({size:e=24,color:t="currentColor",...n})=>s.createElement("svg",{viewBox:"0 0 24 24",width:e,height:e,stroke:t,strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",...n},s.createElement("path",{d:"M9 17H7A5 5 0 0 1 7 7h2m6 10h2a5 5 0 0 0 0-10h-2m-8 5h10"}));kt.displayName="Link02";const Nt=({size:e=24,color:t="currentColor",...n})=>s.createElement("svg",{viewBox:"0 0 24 24",width:e,height:e,stroke:t,strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",...n},s.createElement("path",{d:"M9 3h6M3 6h18m-2 0-.701 10.52c-.105 1.578-.158 2.367-.499 2.965a3 3 0 0 1-1.298 1.215c-.62.3-1.41.3-2.993.3h-3.018c-1.582 0-2.373 0-2.993-.3A3 3 0 0 1 6.2 19.485c-.34-.598-.394-1.387-.499-2.966L5 6m5 4.5v5m4-5v5"}));Nt.displayName="Trash03";/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const so=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],ao=We("chevron-right",so);/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const co=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],io=We("circle",co);/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lo=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],uo=We("info",lo);function fo(e,t,n={}){const r=Math.max(0,n.r??8),a=n.padding??8,i=e.x+e.w,m=e.y+e.h/2,u=t.x,d=t.y+t.h/2,f=i<=u,l=u-i,h=3*a;let p;if(f){const c=Math.max(e.y+e.h,t.y+t.h)+a;p=typeof n.shelf=="number"?n.shelf:c,n.reserveShelfY&&(p=n.reserveShelfY(c,c+200,i,u))}else{const c=Math.min(e.y,t.y)-a;p=typeof n.shelf=="number"?n.shelf:c,n.reserveShelfY&&(p=n.reserveShelfY(c-200,c,t.x,i))}if(n.boxes&&n.boxes.length){const c=n.boxes,y=f?1:-1;let g=0;for(;g<50&&c.some(C=>p>C.y-.5&&p<C.y+C.h+.5);)p+=y*8,g++}function M(c){if(c.length===0)return"";const y=[`M ${c[0].x} ${c[0].y}`];for(let C=1;C<c.length;C++){const R=c[C-1],v=c[C],k=c[C+1];if(!k){y.push(`L ${v.x} ${v.y}`);continue}const P=v.x-R.x,L=v.y-R.y,j=k.x-v.x,b=k.y-v.y;if(!(Math.abs(P)<.001&&Math.abs(b)<.001&&j!==0&&L!==0||Math.abs(L)<.001&&Math.abs(j)<.001&&b!==0&&P!==0)||r===0){y.push(`L ${v.x} ${v.y}`);continue}const U=Math.sign(P),z=Math.sign(L),V=Math.sign(j),w=Math.sign(b),E={x:v.x-U*r-0,y:v.y-z*r-0},T={x:v.x+V*r+0,y:v.y+w*r+0};y.push(`L ${E.x} ${E.y}`),y.push(`Q ${v.x} ${v.y} ${T.x} ${T.y}`),c[C]=T}const g=c[c.length-1];return y.push(`L ${g.x} ${g.y}`),y.join(" ")}if(f){if(Math.abs(m-d)<.5&&n.boxes&&n.boxes.length&&!n.boxes.some(g=>{if(g===e||g===t)return!1;const C=g.x,R=g.x+g.w,v=C<u&&R>i,k=m>=g.y-.5&&m<=g.y+g.h+.5;return v&&k}))return`M ${i} ${m} L ${u} ${d}`;if(l>0&&l<h){const y={x:i,y:m},g={x:u,y:d},C=(y.x+g.x)/2,R={x:C,y:y.y},v={x:C,y:g.y};return`M ${y.x} ${y.y} C ${R.x} ${R.y} ${v.x} ${v.y} ${g.x} ${g.y}`}const c=[{x:i,y:m},{x:i+a,y:m},{x:i+a,y:p},{x:u-a,y:p},{x:u-a,y:d},{x:u,y:d}];return M(c)}else{const c=i-u;if(c>0&&c<h){const g={x:e.x,y:m},C={x:t.x,y:d},R=Math.min(e.y,t.y)-a-12,v={x:g.x-a*.6,y:R},k={x:C.x+a*.6,y:R};return`M ${g.x} ${g.y} C ${v.x} ${v.y} ${k.x} ${k.y} ${C.x} ${C.y}`}const y=[{x:e.x,y:m},{x:e.x-a,y:m},{x:e.x-a,y:p},{x:t.x-a,y:p},{x:t.x-a,y:d},{x:t.x,y:d}];return M(y)}}class mo{step;tracks=[];constructor(t=12){this.step=t}reset(){this.tracks=[]}reserve(t,n,r,a){if(a<r){const d=r;r=a,a=d}const i=[...this.tracks].sort((d,f)=>Math.abs(d.y-t)-Math.abs(f.y-t));for(const d of i)if(!(d.y<t||d.y>n)&&!d.spans.some(f=>!(a<=f[0]||r>=f[1])))return d.spans.push([r,a]),d.y;const u=this.tracks.length?Math.max(t,Math.min(n,t+this.tracks.length*this.step)):t;return this.tracks.push({y:u,spans:[[r,a]]}),u}}function ho({initialScale:e=1/(1e3*60*60*24),minScale:t=.2,maxScale:n=24,viewportWidth:r,timeWindow:a,wheelZoomNoCtrl:i=!1,initialSpanDays:m,initialCenterTime:u}){const[d,f]=s.useState(e),[l,h]=s.useState(0),p=s.useRef(null),M=s.useRef(),c=s.useRef(null),y=s.useCallback((w,E)=>{const{start:T,end:D}=a,K=D-T,B=r/K,S=Math.max(t,B);let q=Math.min(n,Math.max(S,w));const J=-(K*q)+r,me=Math.min(0,Math.max(J,E));return{s:q,tr:me}},[a,r,t,n]),g=()=>{const{start:w,end:E}=a,K=-((E-w)*d)+r;return Math.abs(l-K)<.5},C=()=>Math.abs(l)<.5,R=s.useCallback(w=>(w-a.start)*d+l,[d,l,a.start]),v=s.useCallback(w=>(w-l)/d+a.start,[d,l,a.start]),k=s.useCallback(w=>{if(i?!0:w.ctrlKey){w.cancelable&&w.preventDefault();const T=w.clientX,D=v(T),K=-w.deltaY,B=Math.exp(K*.0015);let S=d*B;S=Math.min(n,Math.max(t,S));let q=T-(D-a.start)*S;const{s:$,tr:J}=y(S,q);f($),h(J)}else{const T=w.deltaY!==0?w.deltaY:w.deltaX;if(T){if(w.cancelable&&w.preventDefault(),T<0&&C()||T>0&&g())return;const{tr:D}=y(d,l-T);h(D)}}},[d,l,y,v,a.start,n,t,i]),P=s.useCallback(w=>{w.button===0&&(p.current={x:w.clientX,tStart:Date.now(),transStart:l})},[l]),L=s.useCallback(w=>{if(!p.current)return;const E=w.clientX-p.current.x,T=p.current.transStart+E;M.current&&cancelAnimationFrame(M.current),M.current=requestAnimationFrame(()=>{if(T>0&&C())return;const{tr:D}=y(d,T);g()&&D<l||h(D)})},[y,d,l]),j=s.useCallback(w=>{p.current=null},[]);function b(w,E){const T=w.clientX-E.clientX,D=w.clientY-E.clientY;return Math.hypot(T,D)}const Y=s.useCallback(w=>{if(w.touches.length!==2)return;const[E,T]=[w.touches[0],w.touches[1]],D=b(E,T),K=(E.clientX+T.clientX)/2,B=v(K);c.current={id1:E.identifier,id2:T.identifier,startDist:D,startScale:d,midX:K,midT:B}},[d,v]),U=s.useCallback(w=>{if(!c.current)return;const E=c.current,T=Array.from(w.touches).find(J=>J.identifier===E.id1),D=Array.from(w.touches).find(J=>J.identifier===E.id2);if(!T||!D)return;const K=b(T,D);let B=E.startScale*(K/E.startDist);B=Math.min(n,Math.max(t,B));let S=E.midX-(E.midT-a.start)*B;const{s:q,tr:$}=y(B,S);f(q),h($)},[y,n,t,a.start]),z=s.useCallback(w=>{c.current=null},[]);s.useEffect(()=>()=>{M.current&&cancelAnimationFrame(M.current)},[]);const V=s.useRef(!1);return s.useEffect(()=>{if(V.current||r<=0)return;const w=a.end-a.start,E=r/w;{const T=m*864e5;let D=r/T;D=Math.min(n,Math.max(E,D));const K=typeof u=="number"?u:(a.start+a.end)/2;let S=r/2-(K-a.start)*D;const{tr:q,s:$}=y(D,S);f($),h(q)}V.current=!0},[m,u,r,y,a.start,a.end,n,d,l]),s.useEffect(()=>{const{s:w,tr:E}=y(d,l);w!==d&&f(w),E!==l&&h(E)},[d,l,y]),{scale:d,translate:l,toX:R,toT:v,onWheel:k,onPointerDown:P,onPointerMove:L,onPointerUp:j,onTouchPinchStart:Y,onTouchPinchMove:U,onTouchPinchEnd:z}}function po(e,t){const n=s.useRef(null),r=s.useRef(null),a=s.useRef(null);return n.current&&n.current.key===e?n.current.value:((!r.current||r.current.key!==e)&&(r.current={key:e,value:t()},a.current==null&&(a.current=requestAnimationFrame(()=>{r.current&&(n.current=r.current,r.current=null),a.current=null}))),r.current.value)}const xo=({name:e,dueDate:t,color:n,rect:r,selected:a,milestone:i,elevate:m,scale:u,hideDate:d,onClick:f,onDoubleClick:l,onMouseDown:h,onMouseUp:p,onMouseLeave:M})=>{let c="full";typeof u=="number"&&(u<.5?c="dot":u<.8?c="mini":u<1.2&&(c="compact"));const y=e.split(/\s+/).filter(Boolean).map(R=>R[0]).slice(0,3).join("").toUpperCase(),g=`${e} - due ${t.toLocaleDateString(void 0,{month:"numeric",day:"numeric"})}`,C=`project-block absolute rounded shadow-sm overflow-hidden text-black dark:text-white transition-transform ${a?"project-block--selected":""}`;return o.jsxs("div",{role:"button",onClick:f,onDoubleClick:l,onMouseDown:h,onMouseUp:p,onMouseLeave:M,className:C+(c!=="dot"?" hover:scale-[1.02]":""),style:{left:r.x,top:r.y,width:r.w,height:r.h,background:n,zIndex:m?50:10,touchAction:"none"},title:g,children:[c!=="dot"&&!d&&o.jsxs("div",{className:"absolute top-0.5 right-1 text-[9px] font-semibold leading-none text-black/80 dark:text-white/90 select-none",children:[t.getMonth()+1,"/",t.getDate()]}),o.jsxs("div",{className:"absolute inset-0 flex items-center justify-center px-1.5 text-center",children:[c==="dot"&&o.jsx("div",{className:"text-[9px] font-semibold leading-none select-none",children:y}),c!=="dot"&&(()=>{const R=r.h;if(R>=40)return o.jsx("div",{className:"w-full text-[11px] leading-tight font-medium select-none break-words overflow-hidden",style:{display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical"},children:e});if(R===32){const k=e.length>24?e.slice(0,24):e;return o.jsx("div",{className:"w-full text-[10px] leading-none font-medium select-none whitespace-nowrap overflow-hidden",children:k})}const v=e.length>14?e.slice(0,14):e;return o.jsx("div",{className:"w-full text-[10px] leading-none font-medium select-none whitespace-nowrap overflow-hidden",children:v})})()]}),i&&c!=="dot"&&o.jsxs("div",{className:"absolute -top-5 left-1/2 -translate-x-1/2 text-[10px] bg-black text-white px-1.5 py-[2px] rounded",children:[t.getMonth()+1,"/",t.getDate()]})]})};var qe="rovingFocusGroup.onEntryFocus",go={bubbles:!1,cancelable:!0},_e="RovingFocusGroup",[Je,_t,vo]=St(_e),[yo,Et]=et(_e,[vo]),[bo,Mo]=yo(_e),Pt=s.forwardRef((e,t)=>o.jsx(Je.Provider,{scope:e.__scopeRovingFocusGroup,children:o.jsx(Je.Slot,{scope:e.__scopeRovingFocusGroup,children:o.jsx(wo,{...e,ref:t})})}));Pt.displayName=_e;var wo=s.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:n,orientation:r,loop:a=!1,dir:i,currentTabStopId:m,defaultCurrentTabStopId:u,onCurrentTabStopIdChange:d,onEntryFocus:f,preventScrollOnEntryFocus:l=!1,...h}=e,p=s.useRef(null),M=Ce(t,p),c=It(i),[y,g]=Bn({prop:m,defaultProp:u??null,onChange:d,caller:_e}),[C,R]=s.useState(!1),v=Ke(f),k=_t(n),P=s.useRef(!1),[L,j]=s.useState(0);return s.useEffect(()=>{const b=p.current;if(b)return b.addEventListener(qe,v),()=>b.removeEventListener(qe,v)},[v]),o.jsx(bo,{scope:n,orientation:r,dir:c,loop:a,currentTabStopId:y,onItemFocus:s.useCallback(b=>g(b),[g]),onItemShiftTab:s.useCallback(()=>R(!0),[]),onFocusableItemAdd:s.useCallback(()=>j(b=>b+1),[]),onFocusableItemRemove:s.useCallback(()=>j(b=>b-1),[]),children:o.jsx(de.div,{tabIndex:C||L===0?-1:0,"data-orientation":r,...h,ref:M,style:{outline:"none",...e.style},onMouseDown:F(e.onMouseDown,()=>{P.current=!0}),onFocus:F(e.onFocus,b=>{const Y=!P.current;if(b.target===b.currentTarget&&Y&&!C){const U=new CustomEvent(qe,go);if(b.currentTarget.dispatchEvent(U),!U.defaultPrevented){const z=k().filter(D=>D.focusable),V=z.find(D=>D.active),w=z.find(D=>D.id===y),T=[V,w,...z].filter(Boolean).map(D=>D.ref.current);$t(T,l)}}P.current=!1}),onBlur:F(e.onBlur,()=>R(!1))})})}),Tt="RovingFocusGroupItem",Dt=s.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:n,focusable:r=!0,active:a=!1,tabStopId:i,children:m,...u}=e,d=Un(),f=i||d,l=Mo(Tt,n),h=l.currentTabStopId===f,p=_t(n),{onFocusableItemAdd:M,onFocusableItemRemove:c,currentTabStopId:y}=l;return s.useEffect(()=>{if(r)return M(),()=>c()},[r,M,c]),o.jsx(Je.ItemSlot,{scope:n,id:f,focusable:r,active:a,children:o.jsx(de.span,{tabIndex:h?0:-1,"data-orientation":l.orientation,...u,ref:t,onMouseDown:F(e.onMouseDown,g=>{r?l.onItemFocus(f):g.preventDefault()}),onFocus:F(e.onFocus,()=>l.onItemFocus(f)),onKeyDown:F(e.onKeyDown,g=>{if(g.key==="Tab"&&g.shiftKey){l.onItemShiftTab();return}if(g.target!==g.currentTarget)return;const C=So(g,l.orientation,l.dir);if(C!==void 0){if(g.metaKey||g.ctrlKey||g.altKey||g.shiftKey)return;g.preventDefault();let v=p().filter(k=>k.focusable).map(k=>k.ref.current);if(C==="last")v.reverse();else if(C==="prev"||C==="next"){C==="prev"&&v.reverse();const k=v.indexOf(g.currentTarget);v=l.loop?Io(v,k+1):v.slice(k+1)}setTimeout(()=>$t(v))}}),children:typeof m=="function"?m({isCurrentTabStop:h,hasTabStop:y!=null}):m})})});Dt.displayName=Tt;var Co={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function jo(e,t){return t!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function So(e,t,n){const r=jo(e.key,n);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(r))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(r)))return Co[r]}function $t(e,t=!1){const n=document.activeElement;for(const r of e)if(r===n||(r.focus({preventScroll:t}),document.activeElement!==n))return}function Io(e,t){return e.map((n,r)=>e[(t+r)%e.length])}var Ro=Pt,ko=Dt,Ze=["Enter"," "],No=["ArrowDown","PageUp","Home"],At=["ArrowUp","PageDown","End"],_o=[...No,...At],Eo={ltr:[...Ze,"ArrowRight"],rtl:[...Ze,"ArrowLeft"]},Po={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Ee="Menu",[ke,To,Do]=St(Ee),[ge,Ot]=et(Ee,[Do,Rt,Et]),Xe=Rt(),Ft=Et(),[$o,ve]=ge(Ee),[Ao,Pe]=ge(Ee),Lt=e=>{const{__scopeMenu:t,open:n=!1,children:r,dir:a,onOpenChange:i,modal:m=!0}=e,u=Xe(t),[d,f]=s.useState(null),l=s.useRef(!1),h=Ke(i),p=It(a);return s.useEffect(()=>{const M=()=>{l.current=!0,document.addEventListener("pointerdown",c,{capture:!0,once:!0}),document.addEventListener("pointermove",c,{capture:!0,once:!0})},c=()=>l.current=!1;return document.addEventListener("keydown",M,{capture:!0}),()=>{document.removeEventListener("keydown",M,{capture:!0}),document.removeEventListener("pointerdown",c,{capture:!0}),document.removeEventListener("pointermove",c,{capture:!0})}},[]),o.jsx(Kn,{...u,children:o.jsx($o,{scope:t,open:n,onOpenChange:h,content:d,onContentChange:f,children:o.jsx(Ao,{scope:t,onClose:s.useCallback(()=>h(!1),[h]),isUsingKeyboardRef:l,dir:p,modal:m,children:r})})})};Lt.displayName=Ee;var Oo="MenuAnchor",tt=s.forwardRef((e,t)=>{const{__scopeMenu:n,...r}=e,a=Xe(n);return o.jsx(Xn,{...a,...r,ref:t})});tt.displayName=Oo;var nt="MenuPortal",[Fo,Yt]=ge(nt,{forceMount:void 0}),Gt=e=>{const{__scopeMenu:t,forceMount:n,children:r,container:a}=e,i=ve(nt,t);return o.jsx(Fo,{scope:t,forceMount:n,children:o.jsx(Be,{present:n||i.open,children:o.jsx(Hn,{asChild:!0,container:a,children:r})})})};Gt.displayName=nt;var ae="MenuContent",[Lo,ot]=ge(ae),Ut=s.forwardRef((e,t)=>{const n=Yt(ae,e.__scopeMenu),{forceMount:r=n.forceMount,...a}=e,i=ve(ae,e.__scopeMenu),m=Pe(ae,e.__scopeMenu);return o.jsx(ke.Provider,{scope:e.__scopeMenu,children:o.jsx(Be,{present:r||i.open,children:o.jsx(ke.Slot,{scope:e.__scopeMenu,children:m.modal?o.jsx(Yo,{...a,ref:t}):o.jsx(Go,{...a,ref:t})})})})}),Yo=s.forwardRef((e,t)=>{const n=ve(ae,e.__scopeMenu),r=s.useRef(null),a=Ce(t,r);return s.useEffect(()=>{const i=r.current;if(i)return zn(i)},[]),o.jsx(rt,{...e,ref:a,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:F(e.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)})}),Go=s.forwardRef((e,t)=>{const n=ve(ae,e.__scopeMenu);return o.jsx(rt,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)})}),Uo=Zn("MenuContent.ScrollLock"),rt=s.forwardRef((e,t)=>{const{__scopeMenu:n,loop:r=!1,trapFocus:a,onOpenAutoFocus:i,onCloseAutoFocus:m,disableOutsidePointerEvents:u,onEntryFocus:d,onEscapeKeyDown:f,onPointerDownOutside:l,onFocusOutside:h,onInteractOutside:p,onDismiss:M,disableOutsideScroll:c,...y}=e,g=ve(ae,n),C=Pe(ae,n),R=Xe(n),v=Ft(n),k=To(n),[P,L]=s.useState(null),j=s.useRef(null),b=Ce(t,j,g.onContentChange),Y=s.useRef(0),U=s.useRef(""),z=s.useRef(0),V=s.useRef(null),w=s.useRef("right"),E=s.useRef(0),T=c?Jn:s.Fragment,D=c?{as:Uo,allowPinchZoom:!0}:void 0,K=S=>{const q=U.current+S,$=k().filter(Q=>!Q.disabled),J=document.activeElement,oe=$.find(Q=>Q.ref.current===J)?.textValue,me=$.map(Q=>Q.textValue),he=er(me,q,oe),ce=$.find(Q=>Q.textValue===he)?.ref.current;(function Q(Te){U.current=Te,window.clearTimeout(Y.current),Te!==""&&(Y.current=window.setTimeout(()=>Q(""),1e3))})(q),ce&&setTimeout(()=>ce.focus())};s.useEffect(()=>()=>window.clearTimeout(Y.current),[]),qn();const B=s.useCallback(S=>w.current===V.current?.side&&nr(S,V.current?.area),[]);return o.jsx(Lo,{scope:n,searchRef:U,onItemEnter:s.useCallback(S=>{B(S)&&S.preventDefault()},[B]),onItemLeave:s.useCallback(S=>{B(S)||(j.current?.focus(),L(null))},[B]),onTriggerLeave:s.useCallback(S=>{B(S)&&S.preventDefault()},[B]),pointerGraceTimerRef:z,onPointerGraceIntentChange:s.useCallback(S=>{V.current=S},[]),children:o.jsx(T,{...D,children:o.jsx(Qn,{asChild:!0,trapped:a,onMountAutoFocus:F(i,S=>{S.preventDefault(),j.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:m,children:o.jsx(Wn,{asChild:!0,disableOutsidePointerEvents:u,onEscapeKeyDown:f,onPointerDownOutside:l,onFocusOutside:h,onInteractOutside:p,onDismiss:M,children:o.jsx(Ro,{asChild:!0,...v,dir:C.dir,orientation:"vertical",loop:r,currentTabStopId:P,onCurrentTabStopIdChange:L,onEntryFocus:F(d,S=>{C.isUsingKeyboardRef.current||S.preventDefault()}),preventScrollOnEntryFocus:!0,children:o.jsx(eo,{role:"menu","aria-orientation":"vertical","data-state":rn(g.open),"data-radix-menu-content":"",dir:C.dir,...R,...y,ref:b,style:{outline:"none",...y.style},onKeyDown:F(y.onKeyDown,S=>{const $=S.target.closest("[data-radix-menu-content]")===S.currentTarget,J=S.ctrlKey||S.altKey||S.metaKey,oe=S.key.length===1;$&&(S.key==="Tab"&&S.preventDefault(),!J&&oe&&K(S.key));const me=j.current;if(S.target!==me||!_o.includes(S.key))return;S.preventDefault();const ce=k().filter(Q=>!Q.disabled).map(Q=>Q.ref.current);At.includes(S.key)&&ce.reverse(),Qo(ce)}),onBlur:F(e.onBlur,S=>{S.currentTarget.contains(S.target)||(window.clearTimeout(Y.current),U.current="")}),onPointerMove:F(e.onPointerMove,Ne(S=>{const q=S.target,$=E.current!==S.clientX;if(S.currentTarget.contains(q)&&$){const J=S.clientX>E.current?"right":"left";w.current=J,E.current=S.clientX}}))})})})})})})});Ut.displayName=ae;var Bo="MenuGroup",st=s.forwardRef((e,t)=>{const{__scopeMenu:n,...r}=e;return o.jsx(de.div,{role:"group",...r,ref:t})});st.displayName=Bo;var Ko="MenuLabel",Bt=s.forwardRef((e,t)=>{const{__scopeMenu:n,...r}=e;return o.jsx(de.div,{...r,ref:t})});Bt.displayName=Ko;var Ye="MenuItem",yt="menu.itemSelect",He=s.forwardRef((e,t)=>{const{disabled:n=!1,onSelect:r,...a}=e,i=s.useRef(null),m=Pe(Ye,e.__scopeMenu),u=ot(Ye,e.__scopeMenu),d=Ce(t,i),f=s.useRef(!1),l=()=>{const h=i.current;if(!n&&h){const p=new CustomEvent(yt,{bubbles:!0,cancelable:!0});h.addEventListener(yt,M=>r?.(M),{once:!0}),Vn(h,p),p.defaultPrevented?f.current=!1:m.onClose()}};return o.jsx(Kt,{...a,ref:d,disabled:n,onClick:F(e.onClick,l),onPointerDown:h=>{e.onPointerDown?.(h),f.current=!0},onPointerUp:F(e.onPointerUp,h=>{f.current||h.currentTarget?.click()}),onKeyDown:F(e.onKeyDown,h=>{const p=u.searchRef.current!=="";n||p&&h.key===" "||Ze.includes(h.key)&&(h.currentTarget.click(),h.preventDefault())})})});He.displayName=Ye;var Kt=s.forwardRef((e,t)=>{const{__scopeMenu:n,disabled:r=!1,textValue:a,...i}=e,m=ot(Ye,n),u=Ft(n),d=s.useRef(null),f=Ce(t,d),[l,h]=s.useState(!1),[p,M]=s.useState("");return s.useEffect(()=>{const c=d.current;c&&M((c.textContent??"").trim())},[i.children]),o.jsx(ke.ItemSlot,{scope:n,disabled:r,textValue:a??p,children:o.jsx(ko,{asChild:!0,...u,focusable:!r,children:o.jsx(de.div,{role:"menuitem","data-highlighted":l?"":void 0,"aria-disabled":r||void 0,"data-disabled":r?"":void 0,...i,ref:f,onPointerMove:F(e.onPointerMove,Ne(c=>{r?m.onItemLeave(c):(m.onItemEnter(c),c.defaultPrevented||c.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:F(e.onPointerLeave,Ne(c=>m.onItemLeave(c))),onFocus:F(e.onFocus,()=>h(!0)),onBlur:F(e.onBlur,()=>h(!1))})})})}),Xo="MenuCheckboxItem",Xt=s.forwardRef((e,t)=>{const{checked:n=!1,onCheckedChange:r,...a}=e;return o.jsx(Jt,{scope:e.__scopeMenu,checked:n,children:o.jsx(He,{role:"menuitemcheckbox","aria-checked":Ge(n)?"mixed":n,...a,ref:t,"data-state":ct(n),onSelect:F(a.onSelect,()=>r?.(Ge(n)?!0:!n),{checkForDefaultPrevented:!1})})})});Xt.displayName=Xo;var Ht="MenuRadioGroup",[Ho,zo]=ge(Ht,{value:void 0,onValueChange:()=>{}}),zt=s.forwardRef((e,t)=>{const{value:n,onValueChange:r,...a}=e,i=Ke(r);return o.jsx(Ho,{scope:e.__scopeMenu,value:n,onValueChange:i,children:o.jsx(st,{...a,ref:t})})});zt.displayName=Ht;var Vt="MenuRadioItem",qt=s.forwardRef((e,t)=>{const{value:n,...r}=e,a=zo(Vt,e.__scopeMenu),i=n===a.value;return o.jsx(Jt,{scope:e.__scopeMenu,checked:i,children:o.jsx(He,{role:"menuitemradio","aria-checked":i,...r,ref:t,"data-state":ct(i),onSelect:F(r.onSelect,()=>a.onValueChange?.(n),{checkForDefaultPrevented:!1})})})});qt.displayName=Vt;var at="MenuItemIndicator",[Jt,Vo]=ge(at,{checked:!1}),Zt=s.forwardRef((e,t)=>{const{__scopeMenu:n,forceMount:r,...a}=e,i=Vo(at,n);return o.jsx(Be,{present:r||Ge(i.checked)||i.checked===!0,children:o.jsx(de.span,{...a,ref:t,"data-state":ct(i.checked)})})});Zt.displayName=at;var qo="MenuSeparator",Qt=s.forwardRef((e,t)=>{const{__scopeMenu:n,...r}=e;return o.jsx(de.div,{role:"separator","aria-orientation":"horizontal",...r,ref:t})});Qt.displayName=qo;var Jo="MenuArrow",Wt=s.forwardRef((e,t)=>{const{__scopeMenu:n,...r}=e,a=Xe(n);return o.jsx(to,{...a,...r,ref:t})});Wt.displayName=Jo;var Zo="MenuSub",[ss,en]=ge(Zo),Ie="MenuSubTrigger",tn=s.forwardRef((e,t)=>{const n=ve(Ie,e.__scopeMenu),r=Pe(Ie,e.__scopeMenu),a=en(Ie,e.__scopeMenu),i=ot(Ie,e.__scopeMenu),m=s.useRef(null),{pointerGraceTimerRef:u,onPointerGraceIntentChange:d}=i,f={__scopeMenu:e.__scopeMenu},l=s.useCallback(()=>{m.current&&window.clearTimeout(m.current),m.current=null},[]);return s.useEffect(()=>l,[l]),s.useEffect(()=>{const h=u.current;return()=>{window.clearTimeout(h),d(null)}},[u,d]),o.jsx(tt,{asChild:!0,...f,children:o.jsx(Kt,{id:a.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":a.contentId,"data-state":rn(n.open),...e,ref:no(t,a.onTriggerChange),onClick:h=>{e.onClick?.(h),!(e.disabled||h.defaultPrevented)&&(h.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:F(e.onPointerMove,Ne(h=>{i.onItemEnter(h),!h.defaultPrevented&&!e.disabled&&!n.open&&!m.current&&(i.onPointerGraceIntentChange(null),m.current=window.setTimeout(()=>{n.onOpenChange(!0),l()},100))})),onPointerLeave:F(e.onPointerLeave,Ne(h=>{l();const p=n.content?.getBoundingClientRect();if(p){const M=n.content?.dataset.side,c=M==="right",y=c?-5:5,g=p[c?"left":"right"],C=p[c?"right":"left"];i.onPointerGraceIntentChange({area:[{x:h.clientX+y,y:h.clientY},{x:g,y:p.top},{x:C,y:p.top},{x:C,y:p.bottom},{x:g,y:p.bottom}],side:M}),window.clearTimeout(u.current),u.current=window.setTimeout(()=>i.onPointerGraceIntentChange(null),300)}else{if(i.onTriggerLeave(h),h.defaultPrevented)return;i.onPointerGraceIntentChange(null)}})),onKeyDown:F(e.onKeyDown,h=>{const p=i.searchRef.current!=="";e.disabled||p&&h.key===" "||Eo[r.dir].includes(h.key)&&(n.onOpenChange(!0),n.content?.focus(),h.preventDefault())})})})});tn.displayName=Ie;var nn="MenuSubContent",on=s.forwardRef((e,t)=>{const n=Yt(ae,e.__scopeMenu),{forceMount:r=n.forceMount,...a}=e,i=ve(ae,e.__scopeMenu),m=Pe(ae,e.__scopeMenu),u=en(nn,e.__scopeMenu),d=s.useRef(null),f=Ce(t,d);return o.jsx(ke.Provider,{scope:e.__scopeMenu,children:o.jsx(Be,{present:r||i.open,children:o.jsx(ke.Slot,{scope:e.__scopeMenu,children:o.jsx(rt,{id:u.contentId,"aria-labelledby":u.triggerId,...a,ref:f,align:"start",side:m.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:l=>{m.isUsingKeyboardRef.current&&d.current?.focus(),l.preventDefault()},onCloseAutoFocus:l=>l.preventDefault(),onFocusOutside:F(e.onFocusOutside,l=>{l.target!==u.trigger&&i.onOpenChange(!1)}),onEscapeKeyDown:F(e.onEscapeKeyDown,l=>{m.onClose(),l.preventDefault()}),onKeyDown:F(e.onKeyDown,l=>{const h=l.currentTarget.contains(l.target),p=Po[m.dir].includes(l.key);h&&p&&(i.onOpenChange(!1),u.trigger?.focus(),l.preventDefault())})})})})})});on.displayName=nn;function rn(e){return e?"open":"closed"}function Ge(e){return e==="indeterminate"}function ct(e){return Ge(e)?"indeterminate":e?"checked":"unchecked"}function Qo(e){const t=document.activeElement;for(const n of e)if(n===t||(n.focus(),document.activeElement!==t))return}function Wo(e,t){return e.map((n,r)=>e[(t+r)%e.length])}function er(e,t,n){const a=t.length>1&&Array.from(t).every(f=>f===t[0])?t[0]:t,i=n?e.indexOf(n):-1;let m=Wo(e,Math.max(i,0));a.length===1&&(m=m.filter(f=>f!==n));const d=m.find(f=>f.toLowerCase().startsWith(a.toLowerCase()));return d!==n?d:void 0}function tr(e,t){const{x:n,y:r}=e;let a=!1;for(let i=0,m=t.length-1;i<t.length;m=i++){const u=t[i],d=t[m],f=u.x,l=u.y,h=d.x,p=d.y;l>r!=p>r&&n<(h-f)*(r-l)/(p-l)+f&&(a=!a)}return a}function nr(e,t){if(!t)return!1;const n={x:e.clientX,y:e.clientY};return tr(n,t)}function Ne(e){return t=>t.pointerType==="mouse"?e(t):void 0}var or=Lt,rr=tt,sr=Gt,ar=Ut,cr=st,ir=Bt,lr=He,ur=Xt,dr=zt,fr=qt,mr=Zt,hr=Qt,pr=Wt,xr=tn,gr=on,it="ContextMenu",[vr,as]=et(it,[Ot]),te=Ot(),[yr,sn]=vr(it),an=e=>{const{__scopeContextMenu:t,children:n,onOpenChange:r,dir:a,modal:i=!0}=e,[m,u]=s.useState(!1),d=te(t),f=Ke(r),l=s.useCallback(h=>{u(h),f(h)},[f]);return o.jsx(yr,{scope:t,open:m,onOpenChange:l,modal:i,children:o.jsx(or,{...d,dir:a,open:m,onOpenChange:l,modal:i,children:n})})};an.displayName=it;var cn="ContextMenuTrigger",ln=s.forwardRef((e,t)=>{const{__scopeContextMenu:n,disabled:r=!1,...a}=e,i=sn(cn,n),m=te(n),u=s.useRef({x:0,y:0}),d=s.useRef({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...u.current})}),f=s.useRef(0),l=s.useCallback(()=>window.clearTimeout(f.current),[]),h=p=>{u.current={x:p.clientX,y:p.clientY},i.onOpenChange(!0)};return s.useEffect(()=>l,[l]),s.useEffect(()=>void(r&&l()),[r,l]),o.jsxs(o.Fragment,{children:[o.jsx(rr,{...m,virtualRef:d}),o.jsx(de.span,{"data-state":i.open?"open":"closed","data-disabled":r?"":void 0,...a,ref:t,style:{WebkitTouchCallout:"none",...e.style},onContextMenu:r?e.onContextMenu:F(e.onContextMenu,p=>{l(),h(p),p.preventDefault()}),onPointerDown:r?e.onPointerDown:F(e.onPointerDown,Oe(p=>{l(),f.current=window.setTimeout(()=>h(p),700)})),onPointerMove:r?e.onPointerMove:F(e.onPointerMove,Oe(l)),onPointerCancel:r?e.onPointerCancel:F(e.onPointerCancel,Oe(l)),onPointerUp:r?e.onPointerUp:F(e.onPointerUp,Oe(l))})]})});ln.displayName=cn;var br="ContextMenuPortal",un=e=>{const{__scopeContextMenu:t,...n}=e,r=te(t);return o.jsx(sr,{...r,...n})};un.displayName=br;var dn="ContextMenuContent",fn=s.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,a=sn(dn,n),i=te(n),m=s.useRef(!1);return o.jsx(ar,{...i,...r,ref:t,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:u=>{e.onCloseAutoFocus?.(u),!u.defaultPrevented&&m.current&&u.preventDefault(),m.current=!1},onInteractOutside:u=>{e.onInteractOutside?.(u),!u.defaultPrevented&&!a.modal&&(m.current=!0)},style:{...e.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});fn.displayName=dn;var Mr="ContextMenuGroup",wr=s.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,a=te(n);return o.jsx(cr,{...a,...r,ref:t})});wr.displayName=Mr;var Cr="ContextMenuLabel",mn=s.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,a=te(n);return o.jsx(ir,{...a,...r,ref:t})});mn.displayName=Cr;var jr="ContextMenuItem",hn=s.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,a=te(n);return o.jsx(lr,{...a,...r,ref:t})});hn.displayName=jr;var Sr="ContextMenuCheckboxItem",pn=s.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,a=te(n);return o.jsx(ur,{...a,...r,ref:t})});pn.displayName=Sr;var Ir="ContextMenuRadioGroup",Rr=s.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,a=te(n);return o.jsx(dr,{...a,...r,ref:t})});Rr.displayName=Ir;var kr="ContextMenuRadioItem",xn=s.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,a=te(n);return o.jsx(fr,{...a,...r,ref:t})});xn.displayName=kr;var Nr="ContextMenuItemIndicator",gn=s.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,a=te(n);return o.jsx(mr,{...a,...r,ref:t})});gn.displayName=Nr;var _r="ContextMenuSeparator",vn=s.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,a=te(n);return o.jsx(hr,{...a,...r,ref:t})});vn.displayName=_r;var Er="ContextMenuArrow",Pr=s.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,a=te(n);return o.jsx(pr,{...a,...r,ref:t})});Pr.displayName=Er;var Tr="ContextMenuSubTrigger",yn=s.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,a=te(n);return o.jsx(xr,{...a,...r,ref:t})});yn.displayName=Tr;var Dr="ContextMenuSubContent",bn=s.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,a=te(n);return o.jsx(gr,{...a,...r,ref:t,style:{...e.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});bn.displayName=Dr;function Oe(e){return t=>t.pointerType!=="mouse"?e(t):void 0}var $r=an,Ar=ln,Or=un,Mn=fn,wn=mn,Cn=hn,jn=pn,Sn=xn,In=gn,Rn=vn,kn=yn,Nn=bn;const bt=$r,Mt=Ar,Fr=s.forwardRef(({className:e,inset:t,children:n,...r},a)=>o.jsxs(kn,{ref:a,className:fe("flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",t&&"pl-8",e),...r,children:[n,o.jsx(ao,{className:"ml-auto h-4 w-4"})]}));Fr.displayName=kn.displayName;const Lr=s.forwardRef(({className:e,...t},n)=>o.jsx(Nn,{ref:n,className:fe("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg cursor-default data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]",e),...t}));Lr.displayName=Nn.displayName;const Qe=s.forwardRef(({className:e,...t},n)=>o.jsx(Or,{children:o.jsx(Mn,{ref:n,className:fe("z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]",e),...t})}));Qe.displayName=Mn.displayName;const Re=s.forwardRef(({className:e,inset:t,...n},r)=>o.jsx(Cn,{ref:r,className:fe("relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",e),...n}));Re.displayName=Cn.displayName;const Yr=s.forwardRef(({className:e,children:t,checked:n,...r},a)=>o.jsxs(jn,{ref:a,className:fe("relative flex cursor-pointer select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:n,...r,children:[o.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:o.jsx(In,{children:o.jsx(oo,{className:"h-4 w-4"})})}),t]}));Yr.displayName=jn.displayName;const Gr=s.forwardRef(({className:e,children:t,...n},r)=>o.jsxs(Sn,{ref:r,className:fe("relative flex cursor-pointer select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...n,children:[o.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:o.jsx(In,{children:o.jsx(io,{className:"h-4 w-4 fill-current"})})}),t]}));Gr.displayName=Sn.displayName;const Ur=s.forwardRef(({className:e,inset:t,...n},r)=>o.jsx(wn,{ref:r,className:fe("px-2 py-1.5 text-sm font-semibold text-foreground",t&&"pl-8",e),...n}));Ur.displayName=wn.displayName;const _n=s.forwardRef(({className:e,...t},n)=>o.jsx(Rn,{ref:n,className:fe("-mx-1 my-1 h-px bg-border",e),...t}));_n.displayName=Rn.displayName;const Ue=["January","February","March","April","May","June","July","August","September","October","November","December"];function wt(e,t){return new Date(e,t+1,0).getDate()}function ue(e){const t=new Date(e);if(isNaN(+t))throw new Error("Invalid date: "+e);return t}function Br(e=new Date){const t=e.getFullYear(),n=e.getMonth()>=7?t:t-1,r=new Date(n,7,1),a=[];for(let i=7;i<=11;i++){const m=new Date(n,i,1);a.push({idx:a.length,year:m.getFullYear(),month:m.getMonth(),name:Ue[i].toUpperCase().slice(0,3),start:m,days:wt(m.getFullYear(),m.getMonth())})}for(let i=0;i<=5;i++){const m=new Date(n+1,i,1);a.push({idx:a.length,year:m.getFullYear(),month:m.getMonth(),name:Ue[i].toUpperCase().slice(0,3),start:m,days:wt(m.getFullYear(),m.getMonth())})}return{start:r,months:a}}const Fe={done:"#34D399",wip:"hsl(var(--accent))",blocked:"#BDC0C3"};function Ct(e){const t=e||[];return t.length?t.every(n=>n.status==="Complete"):!1}function jt(e){if(!e)return null;const t=new Date(e);return isNaN(+t)?null:t.toISOString()}function Kr(){const[e,t]=s.useState(null),[n,r]=s.useState(null),[a,i]=s.useState(!0),[m,u]=s.useState(null),[d,f]=s.useState(null),{members:l}=ro();s.useEffect(()=>{let M=!0;return(async()=>{try{const[c,y,g]=await Promise.all([pt(),xt(),gt()]);if(!M)return;f(vt(l));const C=new Map;for(const b of y){const Y=C.get(b.project_id)||[];Y.push(b),C.set(b.project_id,Y)}const R=g.filter(b=>!!b.from_id&&!!b.to_id).map(b=>({id:b.id,fromId:b.from_id,toId:b.to_id})),v=new Set,k=[];for(const b of R){const Y=`${b.fromId}|${b.toId}`;v.has(Y)||(v.add(Y),k.push(b))}const P=new Map;k.forEach(b=>{P.has(b.toId)||P.set(b.toId,[]),P.get(b.toId).push(b.fromId)});const L=new Set;for(const b of c)b.archived||Ct(C.get(b.id))&&L.add(b.id);const j=c.filter(b=>!b.archived).map(b=>{const Y=jt(b.due_date);if(!Y)return null;const U=L.has(b.id);let z;return U?z="done":z=(P.get(b.id)||[]).some(E=>!L.has(E))?"blocked":"wip",{id:b.id,name:b.name,dueDate:Y,status:z}}).filter(Boolean);t(j),r(k)}catch(c){if(!M)return;u(c?.message||"Failed to load timeline")}finally{M&&i(!1)}})(),()=>{M=!1}},[l]);async function h(M,c){if(M!==c)try{const y=await Ln({from_id:M,to_id:c});r(g=>{const C=g||[];return C.some(R=>R.fromId===M&&R.toId===c)?C:[...C,{id:y,fromId:M,toId:c}]})}catch{}}async function p(){try{i(!0);const[M,c,y]=await Promise.all([pt(),xt(),gt()]);f(vt(l));const g=new Map;for(const j of c){const b=g.get(j.project_id)||[];b.push(j),g.set(j.project_id,b)}const C=y.filter(j=>!!j.from_id&&!!j.to_id).map(j=>({id:j.id,fromId:j.from_id,toId:j.to_id})),R=new Set,v=[];for(const j of C){const b=`${j.fromId}|${j.toId}`;R.has(b)||(R.add(b),v.push(j))}const k=new Map;v.forEach(j=>{k.has(j.toId)||k.set(j.toId,[]),k.get(j.toId).push(j.fromId)});const P=new Set;for(const j of M)j.archived||Ct(g.get(j.id))&&P.add(j.id);const L=M.filter(j=>!j.archived).map(j=>{const b=jt(j.due_date);if(!b)return null;const Y=P.has(j.id);let U;return Y?U="done":U=(k.get(j.id)||[]).some(w=>!P.has(w))?"blocked":"wip",{id:j.id,name:j.name,dueDate:b,status:U}}).filter(Boolean);t(L),r(v)}finally{i(!1)}}return{projects:e,setProjects:t,dependencies:n,setDependencies:r,loading:a,error:m,createDependency:h,people:d,refreshAll:p}}function Xr(e,t,n){const{monthWidth:r,rowHeight:a,block:i,headerH:m}=n;if(!e)return{items:new Map,containerH:m+a*8};const u=new Map,d={};e.forEach(h=>{const p=ue(h.dueDate),M=t.findIndex(P=>p.getFullYear()===P.year&&p.getMonth()===P.month);if(M===-1)return;const c=p.getDate();d[M]||(d[M]={});const y=d[M][c]!==void 0?d[M][c]:0;d[M][c]=y+1;const g=t[M],C=r/g.days,v=r*M+C*(c-1)+Math.max(0,(C-i.w)/2),k=m+y*a;u.set(h.id,{id:h.id,x:v,y:k,w:i.w,h:i.h,monthIdx:M})});let f=1;Object.values(d).forEach(h=>{Object.values(h).forEach(p=>{p>f&&(f=Math.max(f,p))})});const l=m+Math.max(3,f)*n.rowHeight+160;return{items:u,containerH:l}}function Hr(e,t){const{months:n}=Br(),r=s.useMemo(()=>Xr(e,n,t),[e,n,t.monthWidth,t.rowHeight,t.block.w,t.block.h,t.headerH]);return{months:n,layout:r}}function zr({items:e,dependencies:t,highlightId:n,monthWidth:r,months:a}){const i=r*a.length;let m=0;e.forEach(c=>{m=Math.max(m,c.y+c.h)});const u=s.useMemo(()=>new mo(12),[e]),d=s.useMemo(()=>Array.from(e.values()).map(c=>({x:c.x,y:c.y,w:c.w,h:c.h})),[e]),f=s.useRef(new Map),l=t.filter(c=>e.has(c.fromId)&&e.has(c.toId)),h=l.map(c=>{const y=e.get(c.fromId),g=e.get(c.toId);return`${c.id}:${y.x},${y.y},${y.w},${y.h}|${g.x},${g.y},${g.w},${g.h}`}).join(";")+`|hi:${n||""}`,p=po(h,()=>{const c=[],y=new Set;if(n)for(const g of l)(g.fromId===n||g.toId===n)&&y.add(g.id||`${g.fromId}->${g.toId}`);for(const g of l){const C=g.id||`${g.fromId}->${g.toId}`,R=e.get(g.fromId),v=e.get(g.toId),k=`${g.fromId}->${g.toId}|${R.x},${R.y},${R.w},${R.h}|${v.x},${v.y},${v.w},${v.h}`,P=f.current.get(C);let L;P&&P.key===k?L=P.d:(L=fo(R,v,{padding:8,boxes:d,reserveShelfY:(Y,U,z,V)=>u.reserve(Y,U,z,V)}),f.current.set(C,{key:k,d:L}));const j=!!n&&y.has(C),b=R.x+R.w>v.x;c.push({id:C,d:L,active:j,back:b})}return c}),M=m+220;return o.jsx("svg",{width:i,height:M,className:"absolute left-0 top-0 pointer-events-none z-0",children:p.map(c=>{const y=`edge ${c.active?"edge--focus edge--active-blue":""} ${c.back?"edge--back":""}`;return o.jsx("path",{d:c.d,className:y,strokeOpacity:c.active?1:.18},c.id)})})}function Vr({months:e,zoom:t,timeWindow:n}){const r=t.scale*864e5,a=r>=30,i=!a&&r>=8,m=!i&&!a,u=[];if(m)e.forEach(f=>{const l=new Date(f.year,f.month,1).getTime(),h=new Date(f.year,f.month+1,1).getTime(),p=l+(h-l)/2;u.push({x:t.toX(p),label:Ue[f.month].slice(0,3).toUpperCase(),key:`mo-${f.idx}`,className:"text-[11px] font-semibold"})});else if(i){const f=new Date(n.start);f.setHours(0,0,0,0);const h=(f.getDay()+6)%7;f.setDate(f.getDate()-h);for(let p=f.getTime();p<n.end;p+=7*864e5){const M=new Date(p),c=`${M.getMonth()+1}/${M.getDate()}`;u.push({x:t.toX(p),label:c,key:`wk-${c}`,className:"text-[10px]"})}}else if(a){const f=new Set,l=new Date(n.start);for(l.setHours(0,0,0,0);l.getTime()<=n.end;){const h=l.getTime(),p=l.toISOString().slice(0,10);f.has(p)||(f.add(p),u.push({x:t.toX(h),label:String(l.getDate()),key:`d-${p}`,className:"text-[10px]"})),l.setDate(l.getDate()+1)}}let d=null;if(a){const f=t.toT(window.innerWidth/2),l=new Date(f);d=`${Ue[l.getMonth()].toUpperCase()} ${l.getFullYear()}`}return o.jsx("div",{className:"sticky top-0 z-10 bg-card/80 dark:bg-surface/80 backdrop-blur border-b border-border h-10 select-none flex items-center",children:o.jsxs("div",{className:"relative w-full h-full",children:[u.map(f=>o.jsx("div",{className:`absolute top-1/2 -translate-y-1/2 px-1 text-mutedToken-foreground ${f.className||""}`,style:{left:f.x,transform:"translate(-50%, -50%)"},children:f.label},f.key)),d&&o.jsx("div",{className:"absolute left-2 top-1/2 -translate-y-1/2 text-[11px] font-semibold text-foreground/80 pointer-events-none",children:d})]})})}function qr(){return o.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-[11px] text-mutedToken-foreground leading-snug",children:[o.jsxs("span",{className:"inline-flex items-center gap-1",children:[o.jsx("span",{className:"w-2.5 h-2.5 rounded-sm",style:{background:Fe.done}})," done"]}),o.jsxs("span",{className:"inline-flex items-center gap-1",children:[o.jsx("span",{className:"w-2.5 h-2.5 rounded-sm",style:{background:Fe.wip}})," active"]}),o.jsxs("span",{className:"inline-flex items-center gap-1",children:[o.jsx("span",{className:"w-2.5 h-2.5 rounded-sm",style:{background:Fe.blocked}})," blocked"]}),o.jsxs("span",{className:"inline-flex items-center gap-1",children:[o.jsx("span",{className:"w-2.5 h-2.5 rounded-sm",style:{background:"rgb(var(--overlay-10))"}})," deps"]}),o.jsxs("span",{className:"inline-flex items-center gap-1",children:[o.jsx("span",{className:"w-2.5 h-2.5 rounded-sm",style:{background:"hsl(var(--accent))"}})," highlight"]})]})}function Jr({canEdit:e}){const[t,n]=s.useState(!1);return o.jsxs("div",{className:"relative inline-flex items-center group",onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1),children:[o.jsx("div",{className:"p-1 rounded group-hover:bg-surface/60","aria-label":"Info",children:o.jsx(uo,{size:16,className:"text-mutedToken-foreground"})}),t&&o.jsxs("div",{className:"absolute top-full left-0 mt-2 w-64 rounded-md border border-border bg-card dark:bg-surface shadow-2xl p-3 z-50 animate-in fade-in zoom-in-95",children:[o.jsx("div",{className:"text-xs font-semibold mb-2",children:"Legend"}),o.jsx(qr,{}),o.jsx("div",{className:"h-px my-2 bg-border"}),o.jsxs("div",{className:"text-[11px] leading-snug text-mutedToken-foreground space-y-1",children:[o.jsx("div",{children:"Click a project: highlight edges"}),o.jsx("div",{children:"Double-click a project: open details"}),e&&o.jsx("div",{children:"Edit → Link: create dependency"})]})]})]})}const we="__ARMED__";function cs(){const{role:e}=An(),t=e==="admin"||e==="lead",{projects:n,setProjects:r,dependencies:a,setDependencies:i,loading:m,error:u,createDependency:d,people:f,refreshAll:l}=Kr(),[h,p]=s.useState(""),M=x=>{p(x),window.setTimeout(()=>p(""),2500)},[c,y]=s.useState(!1),[g,C]=s.useState(null),[R,v]=s.useState(null),[k,P]=s.useState(null),[L,j]=s.useState(!1),b=L?"Linking...":"Link",Y=640,U=74,z={w:96,h:56},V=56,{months:w,layout:E}=Hr(n,{monthWidth:Y,rowHeight:U,block:z,headerH:V}),T=s.useMemo(()=>w[0].start.getTime(),[w]),D=s.useMemo(()=>new Date(w[w.length-1].year,w[w.length-1].month+1,1).getTime(),[w]),K=s.useMemo(()=>({start:T,end:D}),[T,D]),B=typeof window<"u"?window.innerWidth:1280,q=Date.now()+15*864e5,$=ho({viewportWidth:B,timeWindow:K,initialScale:1/864e5,minScale:1/(30*864e5),maxScale:8/36e5,wheelZoomNoCtrl:!0,initialSpanDays:32,initialCenterTime:q}),J=(K.end-K.start)*$.scale,oe=s.useMemo(()=>new Map((n||[]).map(x=>[x.id,x])),[n]),me=new Date,he=$.scale*36e5,ce=he>=6?"Day":he>=.25?"Week":he>=.02?"Month":"Year",[Q,Te]=s.useState(ce);s.useEffect(()=>{Te(ce)},[ce]);const[De,lt]=s.useState(null),$e=s.useRef(null),En=s.useRef(null),ye=s.useRef(!1),ut=s.useRef(null);s.useEffect(()=>{const x=$e.current,_=En.current;if(!x||!_)return;const I=()=>{ye.current||(ye.current=!0,_.scrollLeft=x.scrollLeft,ye.current=!1)},O=()=>{ye.current||(ye.current=!0,x.scrollLeft=_.scrollLeft,ye.current=!1)};return x.addEventListener("scroll",I,{passive:!0}),_.addEventListener("scroll",O,{passive:!0}),()=>{x.removeEventListener("scroll",I),_.removeEventListener("scroll",O)}},[J]);async function Pn(x){if(L&&t){if(k&&k!==we&&x!==k){const _=oe.get(k),I=oe.get(x);if(!_||!I){P(we);return}const O=ue(_.dueDate),X=ue(I.dueDate),H=`${O.getFullYear()}-${String(O.getMonth()+1).padStart(2,"0")}-${String(O.getDate()).padStart(2,"0")}`,se=`${X.getFullYear()}-${String(X.getMonth()+1).padStart(2,"0")}-${String(X.getDate()).padStart(2,"0")}`;if(H===se){M("Links must move forward (different dates)."),P(we),v(x);return}const ne=O<X?_:I,le=O<X?I:_,pe=ne.id,A=le.id,N=ne.name,Z=le.name,W=a||[],ee=W.find(re=>re.fromId===pe&&re.toId===A),G=W.find(re=>re.fromId===A&&re.toId===pe);if(ee){try{ee.id&&await Le(ee.id)}catch{}i?.(re=>(re||[]).filter(xe=>!(xe.fromId===pe&&xe.toId===A))),M(`Unlinked ${N} — ${Z}`)}else{if(G){try{G.id&&await Le(G.id)}catch{}i?.(re=>(re||[]).filter(xe=>!(xe.fromId===A&&xe.toId===pe)))}await d(pe,A),M(`Linked ${N} → ${Z}`),j(!1),P(null),v(x);return}v(x),P(we);return}if(k===we){P(x),v(x);return}if(!k){P(x),v(x);return}if(k===x){v(x);return}}v(_=>_===x?null:x)}function Tn(x){window.location.assign(`/project/${x}`)}const Ae=s.useRef(null),be=s.useRef(!1),ie=s.useRef(null),[je,Se]=s.useState(null),ze=s.useRef(!1),Me=s.useRef(!1);function Ve(){Ae.current&&(window.clearTimeout(Ae.current),Ae.current=null)}function dt(x){const _=x.getFullYear(),I=String(x.getMonth()+1).padStart(2,"0"),O=String(x.getDate()).padStart(2,"0");return`${_}-${I}-${O}`}function ft(x){const _=$e.current;if(!_)return new Date(ue(ie.current.startIso));const I=_.getBoundingClientRect(),O=x-I.left,X=$.toT(O),H=new Date(X);return new Date(H.getFullYear(),H.getMonth(),H.getDate())}function Dn(x,_){if(!t||L)return;x.stopPropagation(),Ve();const I=oe.get(_);if(!I)return;const O=I.dueDate;be.current=!1,ie.current={id:_,startClientX:x.clientX,startIso:O},Ae.current=window.setTimeout(()=>{be.current=!0,Se({id:_,iso:O}),Me.current=!0,window.addEventListener("mousemove",ht),window.addEventListener("mouseup",$n,{once:!0}),document.body.style.userSelect="none",document.body.style.cursor="ew-resize"},350)}function mt(){be.current||(Ve(),ie.current=null)}function ht(x){if(!be.current||!ie.current)return;const _=ft(x.clientX),I=new Date(Date.UTC(_.getFullYear(),_.getMonth(),_.getDate())).toISOString();Se(O=>O&&O.id===ie.current.id?{id:O.id,iso:I}:{id:ie.current.id,iso:I})}async function $n(x){Ve();const _=be.current&&!!ie.current;be.current=!1,Me.current=!1;const I=ie.current;if(ie.current=null,document.body.style.userSelect="",document.body.style.cursor="",window.removeEventListener("mousemove",ht),!I){Se(null);return}if(!_){Se(null);return}ze.current=!0,window.setTimeout(()=>{ze.current=!1},250);const O=oe.get(I.id);if(Se(null),!O)return;const X=ft(x.clientX),H=dt(ue(O.dueDate)),se=dt(X);if(se!==H)try{await Fn(I.id,{due_date:se}),r?.(ne=>ne&&ne.map(le=>le.id===I.id?{...le,dueDate:new Date(Date.UTC(X.getFullYear(),X.getMonth(),X.getDate())).toISOString()}:le)),M(`Due date moved to ${se}`),setTimeout(()=>{l().catch(()=>{})},50)}catch{M("Failed to update due date")}}return u?o.jsxs("div",{className:"p-6 text-danger",children:["Failed to load timeline. ",String(u)]}):o.jsxs("div",{className:"w-full h-screen overflow-hidden flex flex-col bg-background relative",children:[o.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b border-border bg-card dark:bg-surface sticky top-0 z-40",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsxs("h1",{className:"text-lg font-semibold flex items-center gap-2",children:["Timeline",o.jsx(Jr,{canEdit:t})]}),o.jsx("span",{className:"inline-block rounded bg-foreground/10 dark:bg-white/10 px-2 py-1 text-[11px] font-medium text-foreground/70 dark:text-white/70","aria-label":"Current zoom granularity",children:Q},Q)]}),o.jsxs("div",{className:"flex items-center gap-2",children:[t&&o.jsx(Zr,{projects:n||[],dependencies:a||[],onDeleted:x=>i?.(_=>(_||[]).filter(I=>I.id&&I.id===x?!1:`${I.fromId}|${I.toId}`!==x))}),t&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"mx-2 w-px h-6 bg-border"}),o.jsx("button",{className:"px-3 py-1.5 rounded border text-sm border-accent/40 bg-accent/15 text-accent hover:bg-accent/25",onClick:()=>y(!0),"aria-label":"Create project",title:"Create project",children:"+ Project"}),o.jsx("div",{className:"mx-2 w-px h-6 bg-border"}),o.jsx("button",{className:L?"px-3 py-1.5 rounded border text-sm border-border bg-[hsl(var(--accent))] text-white":"px-3 py-1.5 rounded border text-sm border-border bg-card dark:bg-surface",onClick:()=>{L?(j(!1),P(null)):(j(!0),P(we))},children:b})]})]})]}),o.jsx("div",{className:"flex-1 flex flex-col",children:o.jsx("div",{ref:$e,className:"relative overflow-hidden flex-1",onWheel:x=>{Me.current||$.onWheel(x.nativeEvent)},onPointerDown:x=>{Me.current||$.onPointerDown(x.nativeEvent)},onPointerMove:x=>{Me.current||$.onPointerMove(x.nativeEvent)},onPointerUp:x=>{Me.current||$.onPointerUp(x.nativeEvent)},onTouchStart:x=>{x.touches.length===2&&$.onTouchPinchStart(x.nativeEvent)},onTouchMove:x=>{x.touches.length===2&&$.onTouchPinchMove(x.nativeEvent)},onTouchEnd:x=>{x.touches.length<2&&$.onTouchPinchEnd(x.nativeEvent)},children:o.jsxs(bt,{onOpenChange:x=>{x||lt(null)},children:[o.jsx(Mt,{asChild:!0,children:o.jsxs("div",{className:"relative",style:{width:J,height:E.containerH,minHeight:"100vh"},onContextMenu:x=>{try{const _=$e.current;if(!_)return;const I=_.getBoundingClientRect(),O=x.clientX-I.left,X=$.toT(O),H=new Date(X),se=new Date(H.getFullYear(),H.getMonth(),H.getDate());lt(se)}catch{}},children:[o.jsx(Vr,{months:w,zoom:$,timeWindow:K}),w.map((x,_)=>{const I=new Date(x.year,x.month,1).getTime(),O=$.toX(I);return o.jsx("div",{className:"absolute top-0 bottom-0 border-r border-border/40",style:{left:O,width:0}},_)}),(()=>{const x=w[w.length-1],_=new Date(x.year,x.month+1,1).getTime(),I=$.toX(_);return o.jsx("div",{className:"absolute top-0 bottom-0 pointer-events-none",style:{left:I,width:0},children:o.jsx("div",{className:"absolute top-0 bottom-0 w-[3px] bg-gradient-to-b from-red-500/70 via-red-500 to-red-500/70 rounded-sm"})})})(),(()=>{const x=me.getTime(),_=$.toX(x);return _<-50||_>J+50?null:o.jsx("div",{className:"absolute top-0 bottom-0 pointer-events-none",style:{left:_,width:0},children:o.jsx("div",{className:"absolute top-0 bottom-0 border-r",style:{borderColor:"#E11D48"}})})})(),(()=>{const x=$.scale*864e5,_=B/x,I=_>=60,O=_>=120,X=(()=>{try{const A=E.items.values().next();return A&&A.value?A.value.y:V}catch{return V}})(),H=[],se=10,ne=[];if((n||[]).forEach(A=>{const N=E.items.get(A.id);if(!N)return;const Z=ue(je?.id===A.id?je.iso:A.dueDate),W=$.toX(Z.getTime());let ee;x<.5?ee=16:x<.8?ee=24:x<1.2?ee=36:x<2.5?ee=48:x<5?ee=60:x<10?ee=76:ee=96;const G=O?14:I?32:N.h,re=I?X+4:N.y;ne.push({id:A.id,xStart:W-ee/2,w:ee,h:G,baseY:re,due:Z})}),ne.sort((A,N)=>A.xStart-N.xStart||A.id.localeCompare(N.id)),I){const A=se;ne.forEach(N=>{let Z=X+4;for(;;){const W=H.filter(G=>N.xStart+N.w<=G.x||G.x+G.w<=N.xStart?!1:!(Z+N.h<=G.y||G.y+G.h<=Z));if(W.length===0)break;Z=Math.max(...W.map(G=>G.y+G.h))+A}H.push({id:N.id,x:N.xStart,y:Z,w:N.w,h:N.h})})}else{const A=se;ne.forEach(N=>{let Z=N.baseY;for(;;){const W=H.filter(G=>N.xStart+N.w<=G.x||G.x+G.w<=N.xStart?!1:!(Z+N.h<=G.y||G.y+G.h<=Z));if(W.length===0)break;Z=Math.max(...W.map(G=>G.y+G.h))+A}H.push({id:N.id,x:N.xStart,y:Z,w:N.w,h:N.h})})}const le=new Map;H.forEach(A=>le.set(A.id,{id:A.id,x:A.x,y:A.y,w:A.w,h:A.h,monthIdx:0})),ut.current={map:le,farOut:O,shrink:I};const pe=Math.min(2,Math.max(0,he/.25));return H.map(A=>{const N=oe.get(A.id),Z=ue(je?.id===N.id?je.iso:N.dueDate);return o.jsxs(bt,{children:[o.jsx(Mt,{asChild:!0,children:o.jsx("div",{children:o.jsx(xo,{name:N.name,dueDate:Z,color:Fe[N.status],rect:{x:A.x,y:A.y,w:A.w,h:A.h},selected:R===N.id,milestone:N.milestone,elevate:R===N.id||je?.id===N.id,hideDate:I,onClick:()=>{ze.current||Pn(N.id)},onDoubleClick:()=>Tn(N.id),onMouseDown:W=>Dn(W,N.id),onMouseUp:mt,onMouseLeave:mt,scale:pe})})}),o.jsxs(Qe,{className:"w-52 bg-card dark:bg-surface border border-border/60 shadow-xl",children:[o.jsxs(Re,{onClick:()=>{y(!0),v(N.id)},children:[o.jsx(Yn,{className:"w-4 h-4 mr-2 opacity-80"})," Edit…"]}),o.jsxs(Re,{onClick:()=>{const W=oe.get(N.id)?.design_url;W&&window.open(W,"_blank")},disabled:!oe.get(N.id)?.design_url,children:[o.jsx(kt,{className:"w-4 h-4 mr-2 opacity-80"})," Open Design Link"]}),o.jsx(_n,{}),o.jsxs(Re,{className:"text-danger focus:text-danger hover:text-danger",onClick:async()=>{if(confirm("Delete project?"))try{await On(N.id),l(),M("Deleted")}catch{M("Delete failed")}},children:[o.jsx(Nt,{className:"w-4 h-4 mr-2"})," Delete"]})]})]},N.id)})})(),(()=>{const x=ut.current?.map;return x?o.jsx(zr,{items:x,dependencies:a||[],highlightId:R,monthWidth:Y,months:w}):null})(),$.scale*864e5>=.7?null:w.map(I=>{const O=new Date(I.year,I.month,1).getTime(),X=new Date(I.year,I.month+1,1).getTime(),H=(n||[]).filter(se=>{const ne=ue(se.dueDate).getTime();return ne>=O&&ne<X}).length;return{m:I,count:H,x:$.toX(O+(X-O)/2)}}).filter(I=>I.count>0).map(I=>o.jsx("div",{className:"absolute -top-2 text-[10px] font-semibold text-mutedToken-foreground pointer-events-none",style:{left:I.x,transform:"translateX(-50%)"},children:I.count},I.m.idx))]})}),o.jsx(Qe,{className:"w-56 bg-card dark:bg-surface border border-border/60 shadow-xl",children:o.jsxs(Re,{onClick:()=>{C(De||null),y(!0)},children:["+ Create project",De?` on ${De.getMonth()+1}/${De.getDate()}`:""]})})]})})}),m&&o.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-mutedToken-foreground pointer-events-none",children:"Loading timeline..."}),h&&o.jsx("div",{className:"fixed bottom-4 right-4 z-[100] px-3 py-2 rounded shadow-lg bg-accent/90 text-white text-sm border border-accent",children:h}),o.jsx(Gn,{open:!!c&&!!f,onClose:()=>{y(!1),C(null)},people:f||[],projectToEdit:R?oe.get(R):null,initialDate:R?null:g,onCreated:async()=>{await l(),M("Project saved")}})]})}function Zr({projects:e,dependencies:t,onDeleted:n}){const[r,a]=s.useState(!1),i=s.useMemo(()=>new Map(e.map(u=>[u.id,u])),[e]),m=[...t].map((u,d)=>({idx:d,id:u.id||`${u.fromId}|${u.toId}`,from:i.get(u.fromId)?.name||u.fromId,to:i.get(u.toId)?.name||u.toId})).sort((u,d)=>u.from.localeCompare(d.from)||u.to.localeCompare(d.to));return o.jsxs("div",{className:"relative inline-block",children:[o.jsx("button",{className:"px-3 py-1.5 rounded border text-sm border-border bg-card dark:bg-surface",onClick:()=>a(u=>!u),"aria-expanded":r,"aria-haspopup":!0,children:"Deps"}),r&&o.jsxs("div",{className:"absolute right-0 mt-1 w-[560px] max-h-[420px] overflow-auto rounded-md border border-border bg-card dark:bg-surface shadow-2xl z-50",children:[o.jsx("div",{className:"px-3 py-2 text-xs text-mutedToken-foreground border-b border-border sticky top-0 bg-card dark:bg-surface",children:"Dependencies"}),o.jsxs("ul",{className:"p-3 space-y-1",children:[m.length===0&&o.jsx("li",{className:"text-xs text-mutedToken-foreground px-2 py-1",children:"No dependencies yet."}),m.map(u=>o.jsxs("li",{className:"grid grid-cols-[1fr_auto_1fr_auto] items-center gap-2 text-xs px-2 py-1 rounded hover:bg-surface/70",children:[o.jsx("span",{className:"truncate",title:`${u.from}`,children:u.from}),o.jsx("span",{className:"text-center w-16 shrink-0",children:"→"}),o.jsx("span",{className:"truncate",title:`${u.to}`,children:u.to}),o.jsx("button",{className:"px-2 py-0.5 rounded border text-[11px] border-border bg-card dark:bg-surface hover:bg-card/70 justify-self-end",onClick:async()=>{try{if(u.id.includes("|")){const d=t.find(f=>`${f.fromId}|${f.toId}`===u.id);d?.id&&await Le(d.id),n(d?.id||u.id)}else await Le(u.id),n(u.id)}catch{}},children:"Delete"})]},u.id))]})]})]})}export{Br as academicYearWindow,Xr as computeYearLayout,cs as default};
