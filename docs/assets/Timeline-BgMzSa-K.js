import{r as f,q as Ue,j as t,J as Xe,O as ye,A as Ve,a as Te,b as _e,d as Pe,f as Re,P as Je}from"./index-BzkRah2L.js";import{P as Ge}from"./ProjectCreateModal-ChG1jfwH.js";import"./PersonSelectPopover-Cu5U2p55.js";/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=s=>s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Ze=s=>s.replace(/^([A-Z])|[\s-_]+(\w)/g,(r,u,g)=>g?g.toUpperCase():u.toLowerCase()),Ye=s=>{const r=Ze(s);return r.charAt(0).toUpperCase()+r.slice(1)},Oe=(...s)=>s.filter((r,u,g)=>!!r&&r.trim()!==""&&g.indexOf(r)===u).join(" ").trim(),qe=s=>{for(const r in s)if(r.startsWith("aria-")||r==="role"||r==="title")return!0};/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Qe={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=f.forwardRef(({color:s="currentColor",size:r=24,strokeWidth:u=2,absoluteStrokeWidth:g,className:I="",children:p,iconNode:w,...c},v)=>f.createElement("svg",{ref:v,...Qe,width:r,height:r,stroke:s,strokeWidth:g?Number(u)*24/Number(r):u,className:Oe("lucide",I),...!p&&!qe(c)&&{"aria-hidden":"true"},...c},[...w.map(([M,F])=>f.createElement(M,F)),...Array.isArray(p)?p:[p]]));/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=(s,r)=>{const u=f.forwardRef(({className:g,...I},p)=>f.createElement(et,{ref:p,iconNode:r,className:Oe(`lucide-${Ke(Ye(s))}`,`lucide-${s}`,g),...I}));return u.displayName=Ye(s),u};/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],ot=tt("info",nt),Me=["January","February","March","April","May","June","July","August","September","October","November","December"],st=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];function Be(s,r){return new Date(s,r+1,0).getDate()}function ke(s){return`${s.getMonth()+1}/${s.getDate()}`}function B(s){const r=new Date(s);if(isNaN(+r))throw new Error("Invalid date: "+s);return r}function rt(s=new Date){const r=s.getFullYear(),g=s.getMonth()>=7?r:r-1,I=new Date(g,7,1),p=[];for(let w=7;w<=11;w++){const c=new Date(g,w,1);p.push({idx:p.length,year:c.getFullYear(),month:c.getMonth(),name:Me[c.getMonth()].toUpperCase().slice(0,3),start:c,days:Be(c.getFullYear(),c.getMonth())})}for(let w=0;w<=5;w++){const c=new Date(g+1,w,1);p.push({idx:p.length,year:c.getFullYear(),month:c.getMonth(),name:Me[c.getMonth()].toUpperCase().slice(0,3),start:c,days:Be(c.getFullYear(),c.getMonth())})}return{start:I,months:p}}const be={done:"#34D399",wip:"hsl(var(--accent))",blocked:"#BDC0C3"};function Fe(s){const r=s||[];return r.length?r.every(u=>u.status==="Complete"):!1}function He(s){if(!s)return null;const r=new Date(s);return isNaN(+r)?null:r.toISOString()}function at(){const[s,r]=f.useState(null),[u,g]=f.useState(null),[I,p]=f.useState(!0),[w,c]=f.useState(null),[v,M]=f.useState(null);f.useEffect(()=>{let y=!0;return(async()=>{try{const[x,L,P,h]=await Promise.all([Te(),_e(),Pe(),Re()]);if(!y)return;M(h);const $=new Map;for(const a of L){const m=$.get(a.project_id)||[];m.push(a),$.set(a.project_id,m)}const T=P.filter(a=>!!a.from_id&&!!a.to_id).map(a=>({id:a.id,fromId:a.from_id,toId:a.to_id})),S=new Set,D=[];for(const a of T){const m=`${a.fromId}|${a.toId}`;S.has(m)||(S.add(m),D.push(a))}const k=new Map;D.forEach(a=>{k.has(a.toId)||k.set(a.toId,[]),k.get(a.toId).push(a.fromId)});const Y=new Set;for(const a of x)a.archived||Fe($.get(a.id))&&Y.add(a.id);const n=x.filter(a=>!a.archived).map(a=>{const m=He(a.due_date);if(!m)return null;const E=Y.has(a.id);let _;return E?_="done":_=(k.get(a.id)||[]).some(X=>!Y.has(X))?"blocked":"wip",{id:a.id,name:a.name,dueDate:m,status:_}}).filter(Boolean);r(n),g(D)}catch(x){if(!y)return;c(x?.message||"Failed to load timeline")}finally{y&&p(!1)}})(),()=>{y=!1}},[]);async function F(y,x){if(y!==x)try{const L=await Je({from_id:y,to_id:x});g(P=>{const h=P||[];return h.some($=>$.fromId===y&&$.toId===x)?h:[...h,{id:L,fromId:y,toId:x}]})}catch{}}async function N(){try{p(!0);const[y,x,L,P]=await Promise.all([Te(),_e(),Pe(),Re()]);M(P);const h=new Map;for(const n of x){const a=h.get(n.project_id)||[];a.push(n),h.set(n.project_id,a)}const $=L.filter(n=>!!n.from_id&&!!n.to_id).map(n=>({id:n.id,fromId:n.from_id,toId:n.to_id})),T=new Set,S=[];for(const n of $){const a=`${n.fromId}|${n.toId}`;T.has(a)||(T.add(a),S.push(n))}const D=new Map;S.forEach(n=>{D.has(n.toId)||D.set(n.toId,[]),D.get(n.toId).push(n.fromId)});const k=new Set;for(const n of y)n.archived||Fe(h.get(n.id))&&k.add(n.id);const Y=y.filter(n=>!n.archived).map(n=>{const a=He(n.due_date);if(!a)return null;const m=k.has(n.id);let E;return m?E="done":E=(D.get(n.id)||[]).some(b=>!k.has(b))?"blocked":"wip",{id:n.id,name:n.name,dueDate:a,status:E}}).filter(Boolean);r(Y),g(S)}finally{p(!1)}}return{projects:s,setProjects:r,dependencies:u,setDependencies:g,loading:I,error:w,createDependency:F,people:v,refreshAll:N}}function ct(s,r,u){const{monthWidth:g,rowHeight:I,block:p,headerH:w}=u;if(!s)return{items:new Map,containerH:w+I*8};const c=new Map,v={};s.forEach(N=>{const y=B(N.dueDate),x=r.findIndex(k=>y.getFullYear()===k.year&&y.getMonth()===k.month);if(x===-1)return;const L=y.getDate();v[x]||(v[x]={});const P=v[x][L]!==void 0?v[x][L]:0;v[x][L]=P+1;const h=r[x],$=g/h.days,S=g*x+$*(L-1)+Math.max(0,($-p.w)/2),D=w+P*I;c.set(N.id,{id:N.id,x:S,y:D,w:p.w,h:p.h,monthIdx:x})});let M=1;Object.values(v).forEach(N=>{Object.values(N).forEach(y=>{y>M&&(M=Math.max(M,y))})});const F=w+Math.max(3,M)*u.rowHeight+160;return{items:c,containerH:F}}function dt(s,r){const{months:u}=rt(),g=f.useMemo(()=>ct(s,u,r),[s,u,r.monthWidth,r.rowHeight,r.block.w,r.block.h,r.headerH]);return{months:u,layout:g}}function We({items:s,dependencies:r,highlightId:u,monthWidth:g,months:I}){const p=g*I.length;let w=0;s.forEach(n=>{w=Math.max(w,n.y+n.h)});const c=w+12,v=r.filter(n=>s.has(n.fromId)&&s.has(n.toId)),M=[];s.forEach(n=>M.push(n.y+n.h)),M.sort((n,a)=>n-a);const F=M.filter((n,a,m)=>a===0||n!==m[a-1]),N=n=>`${n.fromId}|${n.toId}`,y=new Map,x=new Map;v.forEach(n=>{s.get(n.fromId),s.get(n.toId),y.has(n.fromId)||y.set(n.fromId,[]),x.has(n.toId)||x.set(n.toId,[]),y.get(n.fromId).push(n),x.get(n.toId).push(n)}),y.forEach(n=>n.sort((a,m)=>s.get(a.toId).x-s.get(m.toId).x||a.toId.localeCompare(m.toId))),x.forEach(n=>n.sort((a,m)=>s.get(a.fromId).x-s.get(m.fromId).x||a.fromId.localeCompare(m.fromId)));const L=new Map,P=new Map,h=new Map,$=new Map;y.forEach((n,a)=>{P.set(a,n.length),n.forEach((m,E)=>L.set(N(m),E))}),x.forEach((n,a)=>{$.set(a,n.length),n.forEach((m,E)=>h.set(N(m),E))});const T=14,S=14,D=v.map((n,a)=>{const m=s.get(n.fromId),E=s.get(n.toId),_=m.x+m.w,Q=E.x,b=N(n),X=P.get(n.fromId)||1,ee=L.get(b)||0,me=$.get(n.toId)||1,te=h.get(b)||0,G=(ee-(X-1)/2)*T,ae=(te-(me-1)/2)*T,ne=m.y+(ee+1)/(X+1)*m.h,A=E.y+(te+1)/(me+1)*E.h;let O=_+S+G;const K=Q-S-ae,fe=Math.min(O,K),we=Math.max(O,K);let oe=Math.max(m.y+m.h,E.y+E.h);s.forEach(z=>{const Z=z.x;z.x+z.w<fe||Z>we||(oe=Math.max(oe,z.y+z.h))});const C=oe+8,ce=(X-ee)*18;O=Math.min(O+ce,K-16);const de=K<=O+2,xe=C>Math.max(ne,A)+6||de?`M ${_} ${ne} H ${O} V ${C} H ${K} V ${A} H ${Q}`:`M ${_} ${ne} H ${K} V ${A} H ${Q}`,se=!!(u&&(n.fromId===u||n.toId===u));return t.jsx("path",{d:xe,stroke:se?"hsl(var(--accent))":"rgb(var(--overlay-10))",strokeWidth:se?3:2.5,fill:"none",strokeLinecap:"round",strokeLinejoin:"round",opacity:se?1:.9},a)}),k=F.map(n=>n+8),Y=Math.max(c+24,(k[k.length-1]||c)+24);return t.jsx("svg",{width:p,height:Y,className:"absolute left-0 top-0 pointer-events-none z-0",children:D})}function it({months:s,monthWidth:r,onPickMonth:u}){return t.jsx("div",{className:"sticky top-0 z-10 bg-card/80 dark:bg-surface/80 backdrop-blur border-b border-border",children:t.jsx("div",{className:"relative",style:{width:r*s.length},children:s.map((g,I)=>t.jsx("div",{className:"inline-flex items-center justify-center font-medium text-sm uppercase tracking-wide text-mutedToken-foreground hover:bg-surface/60 cursor-pointer select-none",style:{width:r,height:36},onClick:()=>{u&&u(I)},children:g.name},I))})})}function lt(){return t.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-[11px] text-mutedToken-foreground leading-snug",children:[t.jsxs("span",{className:"inline-flex items-center gap-1",children:[t.jsx("span",{className:"w-2.5 h-2.5 rounded-sm",style:{background:be.done}})," done"]}),t.jsxs("span",{className:"inline-flex items-center gap-1",children:[t.jsx("span",{className:"w-2.5 h-2.5 rounded-sm",style:{background:be.wip}})," active"]}),t.jsxs("span",{className:"inline-flex items-center gap-1",children:[t.jsx("span",{className:"w-2.5 h-2.5 rounded-sm",style:{background:be.blocked}})," blocked"]}),t.jsxs("span",{className:"inline-flex items-center gap-1",children:[t.jsx("span",{className:"w-2.5 h-2.5 rounded-sm",style:{background:"rgb(var(--overlay-10))"}})," deps"]}),t.jsxs("span",{className:"inline-flex items-center gap-1",children:[t.jsx("span",{className:"w-2.5 h-2.5 rounded-sm",style:{background:"hsl(var(--accent))"}})," highlight"]})]})}function ut({canEdit:s}){const[r,u]=f.useState(!1);return t.jsxs("div",{className:"relative inline-flex items-center group",onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),children:[t.jsx("div",{className:"p-1 rounded group-hover:bg-surface/60","aria-label":"Info",children:t.jsx(ot,{size:16,className:"text-mutedToken-foreground"})}),r&&t.jsxs("div",{className:"absolute top-full left-0 mt-2 w-64 rounded-md border border-border bg-card dark:bg-surface shadow-2xl p-3 z-50 animate-in fade-in zoom-in-95",children:[t.jsx("div",{className:"text-xs font-semibold mb-2",children:"Legend"}),t.jsx(lt,{}),t.jsx("div",{className:"h-px my-2 bg-border"}),t.jsxs("div",{className:"text-[11px] leading-snug text-mutedToken-foreground space-y-1",children:[t.jsx("div",{children:"Click a project: highlight edges"}),t.jsx("div",{children:"Double-click a project: open details"}),s&&t.jsx("div",{children:"Edit → Link: create dependency"})]})]})]})}function Ae({p:s,rect:r,selected:u,onClick:g,onDoubleClick:I,onMouseDown:p,onMouseUp:w,onMouseLeave:c,displayDueDateIso:v,elevate:M}){const F=be[s.status],N=B(v||s.dueDate);return t.jsxs("div",{role:"button",onClick:g,onDoubleClick:I,onMouseDown:p,onMouseUp:w,onMouseLeave:c,className:`absolute rounded shadow-sm border border-black/50 dark:border-white/40 overflow-hidden text-black dark:text-white hover:scale-[1.02] transition-transform ${u?"ring-2 ring-[hsl(var(--accent))]":""}`,style:{left:r.x,top:r.y,width:r.w,height:r.h,background:F,zIndex:M?50:10},title:`${s.name} - due ${ke(N)}`,children:[t.jsx("div",{className:"absolute top-0.5 right-1 text-[9px] font-semibold leading-none text-black/80 dark:text-white/90 select-none",children:ke(N)}),t.jsx("div",{className:"absolute inset-0 grid place-items-center px-1.5 pt-3 pb-1.5 text-center",children:t.jsx("div",{className:"text-[11px] leading-tight break-words",style:{display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",overflow:"hidden"},children:s.name})}),s.milestone&&t.jsx("div",{className:"absolute -top-5 left-1/2 -translate-x-1/2 text-[10px] bg-black text-white px-1.5 py-[2px] rounded",children:ke(N)})]})}const re="__ARMED__";function gt(){const{role:s}=Ue(),r=s==="admin"||s==="lead",{projects:u,setProjects:g,dependencies:I,setDependencies:p,loading:w,error:c,createDependency:v,people:M,refreshAll:F}=at(),[N,y]=f.useState(""),x=e=>{y(e),window.setTimeout(()=>y(""),2500)},[L,P]=f.useState(!1),[h,$]=f.useState({kind:"year"}),[T,S]=f.useState(null),[D,k]=f.useState(null),[Y,n]=f.useState(!1),a=Y?"Linking...":"Link",m=640,E=74,_={w:104,h:56},Q=56,{months:b,layout:X}=dt(u,{monthWidth:m,rowHeight:E,block:_,headerH:Q}),ee=m*b.length,me=e=>`${Me[b[e].month]} ${b[e].year}`,te=f.useMemo(()=>new Map((u||[]).map(e=>[e.id,e])),[u]),G=new Date,ae=f.useRef(null),ne=f.useRef(null),A=f.useRef(!1);f.useEffect(()=>{const e=ae.current,o=ne.current;if(!e||!o)return;const d=()=>{A.current||(A.current=!0,o.scrollLeft=e.scrollLeft,A.current=!1)},i=()=>{A.current||(A.current=!0,e.scrollLeft=o.scrollLeft,A.current=!1)};return e.addEventListener("scroll",d,{passive:!0}),o.addEventListener("scroll",i,{passive:!0}),()=>{e.removeEventListener("scroll",d),o.removeEventListener("scroll",i)}},[h,ee]);const[O,K]=f.useState(0),fe=f.useRef(null),we=h.kind==="month"?b[h.monthIdx].days:0,oe=56,C=h.kind==="month"&&O?Math.max(oe,Math.floor(O/we)):oe,ce=h.kind==="month"?C*b[h.monthIdx].days:0,de=f.useMemo(()=>{if(!u||h.kind!=="month")return[];const e=b[h.monthIdx];return u.filter(o=>{const d=B(o.dueDate);return d.getFullYear()===e.year&&d.getMonth()===e.month}).sort((o,d)=>B(o.dueDate).getDate()-B(d.dueDate).getDate()||o.id.localeCompare(d.id))},[u,h,b]),V=f.useMemo(()=>{if(h.kind!=="month")return new Map;const e=new Map,o={};return de.forEach(d=>{const i=B(d.dueDate).getDate(),l=o[i]!==void 0?o[i]:0;o[i]=l+1;const j=(i-1)*C+(C-_.w)/2,R=70+l*60;e.set(d.id,{id:d.id,x:j,y:R,w:_.w,h:_.h,monthIdx:h.monthIdx})}),e},[h,de,C,_.w,_.h]);async function xe(e){if(Y&&r){if(D&&D!==re&&e!==D){const o=te.get(D),d=te.get(e);if(!o||!d){k(re);return}const i=B(o.dueDate),l=B(d.dueDate),j=`${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}-${String(i.getDate()).padStart(2,"0")}`,R=`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}-${String(l.getDate()).padStart(2,"0")}`;if(j===R){x("Links must move forward (different dates)."),k(re),S(e);return}const U=i<l?o:d,q=i<l?d:o,le=U.id,ue=q.id,$e=U.name,Ee=q.name,Le=I||[],je=Le.find(J=>J.fromId===le&&J.toId===ue),Ie=Le.find(J=>J.fromId===ue&&J.toId===le);if(je){try{je.id&&await ye(je.id)}catch{}p?.(J=>(J||[]).filter(he=>!(he.fromId===le&&he.toId===ue))),x(`Unlinked ${$e} — ${Ee}`)}else{if(Ie){try{Ie.id&&await ye(Ie.id)}catch{}p?.(J=>(J||[]).filter(he=>!(he.fromId===ue&&he.toId===le)))}await v(le,ue),x(`Linked ${$e} → ${Ee}`)}S(e),k(re);return}if(D===re){k(e),S(e);return}if(!D){k(e),S(e);return}if(D===e){S(e);return}}S(o=>o===e?null:e)}function se(e){window.location.assign(`/project/${e}`)}const z=f.useRef(null),Z=f.useRef(!1),H=f.useRef(null),[W,ie]=f.useState(null),ge=f.useRef(!1);function ve(){z.current&&(window.clearTimeout(z.current),z.current=null)}function De(e){const o=e.getFullYear(),d=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return`${o}-${d}-${i}`}function Ne(e){if(h.kind==="year"){const o=ae.current;if(!o)return new Date(B(H.current.startIso));const d=o.getBoundingClientRect(),i=e-d.left+o.scrollLeft,l=Math.max(0,Math.min(b.length-1,Math.floor(i/m))),j=b[l],R=i-l*m,U=m/j.days,q=Math.max(0,Math.min(j.days-1,Math.round(R/U)));return new Date(j.year,j.month,q+1)}else{const o=fe.current,d=h.monthIdx,i=b[d];if(!o)return new Date(i.year,i.month,new Date(B(H.current.startIso)).getDate());const l=o.getBoundingClientRect(),j=e-l.left+o.scrollLeft,R=Math.max(0,Math.min(i.days-1,Math.round(j/C)));return new Date(i.year,i.month,R+1)}}function Se(e,o){if(!r||Y)return;ve();const d=te.get(o);if(!d)return;const i=d.dueDate;Z.current=!1,H.current={id:o,startClientX:e.clientX,startIso:i},z.current=window.setTimeout(()=>{Z.current=!0,ie({id:o,iso:i}),window.addEventListener("mousemove",Ce),window.addEventListener("mouseup",ze,{once:!0}),document.body.style.userSelect="none",document.body.style.cursor="ew-resize"},350)}function pe(){Z.current||(ve(),H.current=null)}function Ce(e){if(!Z.current||!H.current)return;const o=Ne(e.clientX),d=new Date(Date.UTC(o.getFullYear(),o.getMonth(),o.getDate())).toISOString();ie(i=>i&&i.id===H.current.id?{id:i.id,iso:d}:{id:H.current.id,iso:d})}async function ze(e){ve();const o=Z.current&&!!H.current;Z.current=!1;const d=H.current;if(H.current=null,document.body.style.userSelect="",document.body.style.cursor="",window.removeEventListener("mousemove",Ce),!d){ie(null);return}if(!o){ie(null);return}ge.current=!0,window.setTimeout(()=>{ge.current=!1},250);const i=te.get(d.id);if(ie(null),!i)return;const l=Ne(e.clientX),j=De(B(i.dueDate)),R=De(l);if(R!==j)try{await Ve(d.id,{due_date:R}),g?.(U=>U&&U.map(q=>q.id===d.id?{...q,dueDate:new Date(Date.UTC(l.getFullYear(),l.getMonth(),l.getDate())).toISOString()}:q)),x(`Due date moved to ${R}`),setTimeout(()=>{F().catch(()=>{})},50)}catch{x("Failed to update due date")}}return c?t.jsxs("div",{className:"p-6 text-danger",children:["Failed to load timeline. ",String(c)]}):t.jsxs("div",{className:"w-full min-h-screen flex flex-col bg-background",children:[t.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b border-border bg-card dark:bg-surface sticky top-0 z-40",children:[t.jsx("div",{className:"flex items-center gap-3",children:t.jsxs("h1",{className:"text-lg font-semibold flex items-center gap-1",children:[h.kind==="month"?me(h.monthIdx):"Timeline",t.jsx(ut,{canEdit:r})]})}),t.jsxs("div",{className:"flex items-center gap-2",children:[h.kind==="month"&&t.jsx("button",{className:"px-3 py-1.5 rounded border text-sm border-border bg-card dark:bg-surface",onClick:()=>$({kind:"year"}),children:"Back to Year View"}),r&&t.jsx(ht,{projects:u||[],dependencies:I||[],onDeleted:e=>p?.(o=>(o||[]).filter(d=>d.id&&d.id===e?!1:`${d.fromId}|${d.toId}`!==e))}),r&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"mx-2 w-px h-6 bg-border"}),t.jsx("button",{className:"px-3 py-1.5 rounded border text-sm border-accent/40 bg-accent/15 text-accent hover:bg-accent/25",onClick:()=>P(!0),"aria-label":"Create project",title:"Create project",children:"+ Project"}),t.jsx("div",{className:"mx-2 w-px h-6 bg-border"}),t.jsx("button",{className:Y?"px-3 py-1.5 rounded border text-sm border-border bg-[hsl(var(--accent))] text-white":"px-3 py-1.5 rounded border text-sm border-border bg-card dark:bg-surface",onClick:()=>{Y?(n(!1),k(null)):(n(!0),k(re))},children:a})]})]})]}),h.kind==="year"&&t.jsxs("div",{className:"flex-1 flex flex-col",children:[t.jsx("div",{ref:ae,className:"relative overflow-x-auto overflow-y-hidden flex-1",children:t.jsxs("div",{className:"relative",style:{width:ee,height:X.containerH,minHeight:"100vh"},children:[t.jsx(it,{months:b,monthWidth:m,onPickMonth:e=>$({kind:"month",monthIdx:e})}),b.map((e,o)=>t.jsx("div",{className:"absolute border-r border-border",style:{left:o*m,top:0,height:"100vh",width:0}},o)),(()=>{const e=b.findIndex(l=>l.year===G.getFullYear()&&l.month===G.getMonth());if(e===-1)return null;const o=b[e],d=m/o.days,i=e*m+(G.getDate()-1)*d+d/2;return t.jsx("div",{className:"absolute top-0 bottom-0",style:{left:i,width:0},children:t.jsx("div",{className:"absolute top-0 bottom-0 border-r",style:{borderColor:"#E11D48"}})})})(),(u||[]).map(e=>{let o=X.items.get(e.id);if(!o)return null;if(W?.id===e.id)try{const d=B(W.iso),i=b.findIndex(l=>d.getFullYear()===l.year&&d.getMonth()===l.month);if(i!==-1){const l=b[i],j=m/l.days,U=m*i+j*(d.getDate()-1)+Math.max(0,(j-o.w)/2);o={...o,x:U}}}catch{}return t.jsx(Ae,{p:e,rect:o,selected:T===e.id,onClick:()=>{ge.current||xe(e.id)},onDoubleClick:()=>se(e.id),onMouseDown:d=>Se(d,e.id),onMouseUp:pe,onMouseLeave:pe,displayDueDateIso:W?.id===e.id?W.iso:void 0,elevate:T===e.id||W?.id===e.id},e.id)}),t.jsx(We,{items:X.items,dependencies:I||[],highlightId:T,monthWidth:m,months:b})]})}),t.jsx("div",{className:"border-t border-border",children:t.jsx("div",{ref:ne,className:"overflow-x-auto overflow-y-hidden h-4",style:{scrollbarGutter:"stable both-edges"},children:t.jsx("div",{style:{width:ee,height:1}})})})]}),h.kind==="month"&&t.jsx("div",{className:"relative overflow-x-auto overflow-y-hidden flex-1",ref:e=>{if(!e)return;fe.current=e,new ResizeObserver(d=>{for(const i of d){const l=Math.floor(i.contentRect.width);l&&l!==O&&K(l)}}).observe(e)},children:t.jsxs("div",{className:"relative",style:{width:ce,height:520},children:[Array.from({length:b[h.monthIdx].days}).map((e,o)=>{const i=new Date(b[h.monthIdx].year,b[h.monthIdx].month,o+1).getDay(),l=st[i],j=i===2||i===4||i===6;return t.jsxs(Xe.Fragment,{children:[t.jsx("div",{className:"absolute top-0 bottom-0"+(j?" bg-accent/5":""),style:{left:o*C,width:C,zIndex:0,pointerEvents:"none"}}),t.jsx("div",{className:"absolute top-0 bottom-0 border-r border-border/40",style:{left:o*C,width:C,zIndex:0,pointerEvents:"none"}}),t.jsx("div",{className:"absolute top-0 bottom-0",style:{left:o*C,width:C,zIndex:0,pointerEvents:"none"},children:t.jsxs("div",{className:"sticky top-8 text-[10px] leading-tight text-center",children:[t.jsx("div",{className:"font-medium text-foreground/80",children:o+1}),t.jsx("div",{className:"uppercase tracking-wide "+(j?"text-accent":"text-mutedToken-foreground"),children:l})]})})]},o)}),(()=>{const e=b[h.monthIdx];if(G.getFullYear()!==e.year||G.getMonth()!==e.month)return null;const o=(G.getDate()-1)*C+C/2;return t.jsx("div",{className:"absolute top-0 bottom-0",style:{left:o,width:0},children:t.jsx("div",{className:"absolute top-0 bottom-0 border-r",style:{borderColor:"#E11D48"}})})})(),de.map(e=>{let o=V.get(e.id);if(!o)return null;if(W?.id===e.id)try{const l=(B(W.iso).getDate()-1)*C+(C-o.w)/2;o={...o,x:l}}catch{}return t.jsx(Ae,{p:e,rect:o,selected:T===e.id,onClick:()=>{ge.current||xe(e.id)},onDoubleClick:()=>se(e.id),onMouseDown:d=>Se(d,e.id),onMouseUp:pe,onMouseLeave:pe,displayDueDateIso:W?.id===e.id?W.iso:void 0,elevate:T===e.id||W?.id===e.id},e.id)}),(()=>{const e=new Map(V);b[h.monthIdx];const o=0,d=ce,i=(I||[]).filter(l=>{const j=V.has(l.fromId),R=V.has(l.toId);return j||R});return i.forEach(l=>{if(!e.has(l.fromId)&&V.has(l.toId)){const j=V.get(l.toId);e.set(l.fromId,{id:l.fromId,x:o,y:j.y,w:0,h:j.h,monthIdx:h.monthIdx})}if(!e.has(l.toId)&&V.has(l.fromId)){const j=V.get(l.fromId);e.set(l.toId,{id:l.toId,x:d,y:j.y,w:0,h:j.h,monthIdx:h.monthIdx})}}),t.jsx(We,{items:e,dependencies:i,highlightId:T,monthWidth:ce,months:b.slice(h.monthIdx,h.monthIdx+1)})})()]})}),w&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-mutedToken-foreground",children:"Loading timeline..."}),N&&t.jsx("div",{className:"fixed bottom-4 right-4 z-[100] px-3 py-2 rounded shadow-lg bg-accent/90 text-white text-sm border border-accent",children:N}),t.jsx(Ge,{open:!!L&&!!M,onClose:()=>P(!1),people:M||[],onCreated:async()=>{await F(),x("Project created")}})]})}function ht({projects:s,dependencies:r,onDeleted:u}){const[g,I]=f.useState(!1),p=f.useMemo(()=>new Map(s.map(c=>[c.id,c])),[s]),w=[...r].map((c,v)=>({idx:v,id:c.id||`${c.fromId}|${c.toId}`,from:p.get(c.fromId)?.name||c.fromId,to:p.get(c.toId)?.name||c.toId})).sort((c,v)=>c.from.localeCompare(v.from)||c.to.localeCompare(v.to));return t.jsxs("div",{className:"relative inline-block",children:[t.jsx("button",{className:"px-3 py-1.5 rounded border text-sm border-border bg-card dark:bg-surface",onClick:()=>I(c=>!c),"aria-expanded":g,"aria-haspopup":!0,children:"Deps"}),g&&t.jsxs("div",{className:"absolute right-0 mt-1 w-[560px] max-h-[420px] overflow-auto rounded-md border border-border bg-card dark:bg-surface shadow-2xl z-50",children:[t.jsx("div",{className:"px-3 py-2 text-xs text-mutedToken-foreground border-b border-border sticky top-0 bg-card dark:bg-surface",children:"Dependencies"}),t.jsxs("ul",{className:"p-3 space-y-1",children:[w.length===0&&t.jsx("li",{className:"text-xs text-mutedToken-foreground px-2 py-1",children:"No dependencies yet."}),w.map(c=>t.jsxs("li",{className:"grid grid-cols-[1fr_auto_1fr_auto] items-center gap-2 text-xs px-2 py-1 rounded hover:bg-surface/70",children:[t.jsx("span",{className:"truncate",title:`${c.from}`,children:c.from}),t.jsx("span",{className:"text-center w-16 shrink-0",children:"→"}),t.jsx("span",{className:"truncate",title:`${c.to}`,children:c.to}),t.jsx("button",{className:"px-2 py-0.5 rounded border text-[11px] border-border bg-card dark:bg-surface hover:bg-card/70 justify-self-end",onClick:async()=>{try{if(c.id.includes("|")){const v=r.find(M=>`${M.fromId}|${M.toId}`===c.id);v?.id&&await ye(v.id),u(v?.id||c.id)}else await ye(c.id),u(c.id)}catch{}},children:"Delete"})]},c.id))]})]})]})}export{rt as academicYearWindow,ct as computeYearLayout,gt as default};
