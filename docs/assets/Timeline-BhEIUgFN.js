import{a as ze,r as x,j as t,A as Ae,B as ye,C as Ue,D as Te,w as _e,E as Pe,F as Xe}from"./index-D3k_KiqT.js";import{P as Ve}from"./ProjectCreateModal-DopDwCOW.js";import{u as Ge,d as Ye}from"./discordMapping-Bzt9QeEn.js";import{g as Je}from"./modal-nQA6oMK7.js";import"./card-mTLGtmKA.js";import"./clsx-B-dksMZM.js";/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],qe=Je("info",Ke),Me=["January","February","March","April","May","June","July","August","September","October","November","December"],Qe=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];function Re(a,i){return new Date(a,i+1,0).getDate()}function ke(a){return`${a.getMonth()+1}/${a.getDate()}`}function B(a){const i=new Date(a);if(isNaN(+i))throw new Error("Invalid date: "+a);return i}function Ze(a=new Date){const i=a.getFullYear(),b=a.getMonth()>=7?i:i-1,k=new Date(b,7,1),y=[];for(let w=7;w<=11;w++){const c=new Date(b,w,1);y.push({idx:y.length,year:c.getFullYear(),month:c.getMonth(),name:Me[c.getMonth()].toUpperCase().slice(0,3),start:c,days:Re(c.getFullYear(),c.getMonth())})}for(let w=0;w<=5;w++){const c=new Date(b+1,w,1);y.push({idx:y.length,year:c.getFullYear(),month:c.getMonth(),name:Me[c.getMonth()].toUpperCase().slice(0,3),start:c,days:Re(c.getFullYear(),c.getMonth())})}return{start:k,months:y}}const be={done:"#34D399",wip:"hsl(var(--accent))",blocked:"#BDC0C3"};function Be(a){const i=a||[];return i.length?i.every(m=>m.status==="Complete"):!1}function Fe(a){if(!a)return null;const i=new Date(a);return isNaN(+i)?null:i.toISOString()}function et(){const[a,i]=x.useState(null),[m,b]=x.useState(null),[k,y]=x.useState(!0),[w,c]=x.useState(null),[v,D]=x.useState(null),{members:F}=Ge();x.useEffect(()=>{let f=!0;return(async()=>{try{const[I,_,h]=await Promise.all([Te(),_e(),Pe()]);if(!f)return;D(Ye(F));const S=new Map;for(const s of _){const u=S.get(s.project_id)||[];u.push(s),S.set(s.project_id,u)}const C=h.filter(s=>!!s.from_id&&!!s.to_id).map(s=>({id:s.id,fromId:s.from_id,toId:s.to_id})),$=new Set,M=[];for(const s of C){const u=`${s.fromId}|${s.toId}`;$.has(u)||($.add(u),M.push(s))}const j=new Map;M.forEach(s=>{j.has(s.toId)||j.set(s.toId,[]),j.get(s.toId).push(s.fromId)});const R=new Set;for(const s of I)s.archived||Be(S.get(s.id))&&R.add(s.id);const n=I.filter(s=>!s.archived).map(s=>{const u=Fe(s.due_date);if(!u)return null;const T=R.has(s.id);let P;return T?P="done":P=(j.get(s.id)||[]).some(X=>!R.has(X))?"blocked":"wip",{id:s.id,name:s.name,dueDate:u,status:P}}).filter(Boolean);i(n),b(M)}catch(I){if(!f)return;c(I?.message||"Failed to load timeline")}finally{f&&y(!1)}})(),()=>{f=!1}},[F]);async function N(f,I){if(f!==I)try{const _=await Xe({from_id:f,to_id:I});b(h=>{const S=h||[];return S.some(C=>C.fromId===f&&C.toId===I)?S:[...S,{id:_,fromId:f,toId:I}]})}catch{}}async function L(){try{y(!0);const[f,I,_]=await Promise.all([Te(),_e(),Pe()]);D(Ye(F));const h=new Map;for(const n of I){const s=h.get(n.project_id)||[];s.push(n),h.set(n.project_id,s)}const S=_.filter(n=>!!n.from_id&&!!n.to_id).map(n=>({id:n.id,fromId:n.from_id,toId:n.to_id})),C=new Set,$=[];for(const n of S){const s=`${n.fromId}|${n.toId}`;C.has(s)||(C.add(s),$.push(n))}const M=new Map;$.forEach(n=>{M.has(n.toId)||M.set(n.toId,[]),M.get(n.toId).push(n.fromId)});const j=new Set;for(const n of f)n.archived||Be(h.get(n.id))&&j.add(n.id);const R=f.filter(n=>!n.archived).map(n=>{const s=Fe(n.due_date);if(!s)return null;const u=j.has(n.id);let T;return u?T="done":T=(M.get(n.id)||[]).some(g=>!j.has(g))?"blocked":"wip",{id:n.id,name:n.name,dueDate:s,status:T}}).filter(Boolean);i(R),b($)}finally{y(!1)}}return{projects:a,setProjects:i,dependencies:m,setDependencies:b,loading:k,error:w,createDependency:N,people:v,refreshAll:L}}function tt(a,i,m){const{monthWidth:b,rowHeight:k,block:y,headerH:w}=m;if(!a)return{items:new Map,containerH:w+k*8};const c=new Map,v={};a.forEach(N=>{const L=B(N.dueDate),f=i.findIndex(j=>L.getFullYear()===j.year&&L.getMonth()===j.month);if(f===-1)return;const I=L.getDate();v[f]||(v[f]={});const _=v[f][I]!==void 0?v[f][I]:0;v[f][I]=_+1;const h=i[f],S=b/h.days,$=b*f+S*(I-1)+Math.max(0,(S-y.w)/2),M=w+_*k;c.set(N.id,{id:N.id,x:$,y:M,w:y.w,h:y.h,monthIdx:f})});let D=1;Object.values(v).forEach(N=>{Object.values(N).forEach(L=>{L>D&&(D=Math.max(D,L))})});const F=w+Math.max(3,D)*m.rowHeight+160;return{items:c,containerH:F}}function nt(a,i){const{months:m}=Ze(),b=x.useMemo(()=>tt(a,m,i),[a,m,i.monthWidth,i.rowHeight,i.block.w,i.block.h,i.headerH]);return{months:m,layout:b}}function He({items:a,dependencies:i,highlightId:m,monthWidth:b,months:k}){const y=b*k.length;let w=0;a.forEach(n=>{w=Math.max(w,n.y+n.h)});const c=w+12,v=i.filter(n=>a.has(n.fromId)&&a.has(n.toId)),D=[];a.forEach(n=>D.push(n.y+n.h)),D.sort((n,s)=>n-s);const F=D.filter((n,s,u)=>s===0||n!==u[s-1]),N=n=>`${n.fromId}|${n.toId}`,L=new Map,f=new Map;v.forEach(n=>{a.get(n.fromId),a.get(n.toId),L.has(n.fromId)||L.set(n.fromId,[]),f.has(n.toId)||f.set(n.toId,[]),L.get(n.fromId).push(n),f.get(n.toId).push(n)}),L.forEach(n=>n.sort((s,u)=>a.get(s.toId).x-a.get(u.toId).x||s.toId.localeCompare(u.toId))),f.forEach(n=>n.sort((s,u)=>a.get(s.fromId).x-a.get(u.fromId).x||s.fromId.localeCompare(u.fromId)));const I=new Map,_=new Map,h=new Map,S=new Map;L.forEach((n,s)=>{_.set(s,n.length),n.forEach((u,T)=>I.set(N(u),T))}),f.forEach((n,s)=>{S.set(s,n.length),n.forEach((u,T)=>h.set(N(u),T))});const C=14,$=14,M=v.map((n,s)=>{const u=a.get(n.fromId),T=a.get(n.toId),P=u.x+u.w,Z=T.x,g=N(n),X=_.get(n.fromId)||1,ee=I.get(g)||0,me=S.get(n.toId)||1,te=h.get(g)||0,J=(ee-(X-1)/2)*C,ae=(te-(me-1)/2)*C,ne=u.y+(ee+1)/(X+1)*u.h,O=T.y+(te+1)/(me+1)*T.h;let z=P+$+J;const K=Z-$-ae,fe=Math.min(z,K),we=Math.max(z,K);let oe=Math.max(u.y+u.h,T.y+T.h);a.forEach(A=>{const q=A.x;A.x+A.w<fe||q>we||(oe=Math.max(oe,A.y+A.h))});const E=oe+8,ce=(X-ee)*18;z=Math.min(z+ce,K-16);const de=K<=z+2,xe=E>Math.max(ne,O)+6||de?`M ${P} ${ne} H ${z} V ${E} H ${K} V ${O} H ${Z}`:`M ${P} ${ne} H ${K} V ${O} H ${Z}`,se=!!(m&&(n.fromId===m||n.toId===m));return t.jsx("path",{d:xe,stroke:se?"hsl(var(--accent))":"rgb(var(--overlay-10))",strokeWidth:se?3:2.5,fill:"none",strokeLinecap:"round",strokeLinejoin:"round",opacity:se?1:.9},s)}),j=F.map(n=>n+8),R=Math.max(c+24,(j[j.length-1]||c)+24);return t.jsx("svg",{width:y,height:R,className:"absolute left-0 top-0 pointer-events-none z-0",children:M})}function ot({months:a,monthWidth:i,onPickMonth:m}){return t.jsx("div",{className:"sticky top-0 z-10 bg-card/80 dark:bg-surface/80 backdrop-blur border-b border-border",children:t.jsx("div",{className:"relative",style:{width:i*a.length},children:a.map((b,k)=>t.jsx("div",{className:"inline-flex items-center justify-center font-medium text-sm uppercase tracking-wide text-mutedToken-foreground hover:bg-surface/60 cursor-pointer select-none",style:{width:i,height:36},onClick:()=>{m&&m(k)},children:b.name},k))})})}function st(){return t.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-[11px] text-mutedToken-foreground leading-snug",children:[t.jsxs("span",{className:"inline-flex items-center gap-1",children:[t.jsx("span",{className:"w-2.5 h-2.5 rounded-sm",style:{background:be.done}})," done"]}),t.jsxs("span",{className:"inline-flex items-center gap-1",children:[t.jsx("span",{className:"w-2.5 h-2.5 rounded-sm",style:{background:be.wip}})," active"]}),t.jsxs("span",{className:"inline-flex items-center gap-1",children:[t.jsx("span",{className:"w-2.5 h-2.5 rounded-sm",style:{background:be.blocked}})," blocked"]}),t.jsxs("span",{className:"inline-flex items-center gap-1",children:[t.jsx("span",{className:"w-2.5 h-2.5 rounded-sm",style:{background:"rgb(var(--overlay-10))"}})," deps"]}),t.jsxs("span",{className:"inline-flex items-center gap-1",children:[t.jsx("span",{className:"w-2.5 h-2.5 rounded-sm",style:{background:"hsl(var(--accent))"}})," highlight"]})]})}function rt({canEdit:a}){const[i,m]=x.useState(!1);return t.jsxs("div",{className:"relative inline-flex items-center group",onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),children:[t.jsx("div",{className:"p-1 rounded group-hover:bg-surface/60","aria-label":"Info",children:t.jsx(qe,{size:16,className:"text-mutedToken-foreground"})}),i&&t.jsxs("div",{className:"absolute top-full left-0 mt-2 w-64 rounded-md border border-border bg-card dark:bg-surface shadow-2xl p-3 z-50 animate-in fade-in zoom-in-95",children:[t.jsx("div",{className:"text-xs font-semibold mb-2",children:"Legend"}),t.jsx(st,{}),t.jsx("div",{className:"h-px my-2 bg-border"}),t.jsxs("div",{className:"text-[11px] leading-snug text-mutedToken-foreground space-y-1",children:[t.jsx("div",{children:"Click a project: highlight edges"}),t.jsx("div",{children:"Double-click a project: open details"}),a&&t.jsx("div",{children:"Edit â†’ Link: create dependency"})]})]})]})}function We({p:a,rect:i,selected:m,onClick:b,onDoubleClick:k,onMouseDown:y,onMouseUp:w,onMouseLeave:c,displayDueDateIso:v,elevate:D}){const F=be[a.status],N=B(v||a.dueDate);return t.jsxs("div",{role:"button",onClick:b,onDoubleClick:k,onMouseDown:y,onMouseUp:w,onMouseLeave:c,className:`absolute rounded shadow-sm border border-black/50 dark:border-white/40 overflow-hidden text-black dark:text-white hover:scale-[1.02] transition-transform ${m?"ring-2 ring-[hsl(var(--accent))]":""}`,style:{left:i.x,top:i.y,width:i.w,height:i.h,background:F,zIndex:D?50:10},title:`${a.name} - due ${ke(N)}`,children:[t.jsx("div",{className:"absolute top-0.5 right-1 text-[9px] font-semibold leading-none text-black/80 dark:text-white/90 select-none",children:ke(N)}),t.jsx("div",{className:"absolute inset-0 grid place-items-center px-1.5 pt-3 pb-1.5 text-center",children:t.jsx("div",{className:"text-[11px] leading-tight break-words",style:{display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",overflow:"hidden"},children:a.name})}),a.milestone&&t.jsx("div",{className:"absolute -top-5 left-1/2 -translate-x-1/2 text-[10px] bg-black text-white px-1.5 py-[2px] rounded",children:ke(N)})]})}const re="__ARMED__";function mt(){const{role:a}=ze(),i=a==="admin"||a==="lead",{projects:m,setProjects:b,dependencies:k,setDependencies:y,loading:w,error:c,createDependency:v,people:D,refreshAll:F}=et(),[N,L]=x.useState(""),f=e=>{L(e),window.setTimeout(()=>L(""),2500)},[I,_]=x.useState(!1),[h,S]=x.useState({kind:"year"}),[C,$]=x.useState(null),[M,j]=x.useState(null),[R,n]=x.useState(!1),s=R?"Linking...":"Link",u=640,T=74,P={w:104,h:56},Z=56,{months:g,layout:X}=nt(m,{monthWidth:u,rowHeight:T,block:P,headerH:Z}),ee=u*g.length,me=e=>`${Me[g[e].month]} ${g[e].year}`,te=x.useMemo(()=>new Map((m||[]).map(e=>[e.id,e])),[m]),J=new Date,ae=x.useRef(null),ne=x.useRef(null),O=x.useRef(!1);x.useEffect(()=>{const e=ae.current,o=ne.current;if(!e||!o)return;const r=()=>{O.current||(O.current=!0,o.scrollLeft=e.scrollLeft,O.current=!1)},d=()=>{O.current||(O.current=!0,e.scrollLeft=o.scrollLeft,O.current=!1)};return e.addEventListener("scroll",r,{passive:!0}),o.addEventListener("scroll",d,{passive:!0}),()=>{e.removeEventListener("scroll",r),o.removeEventListener("scroll",d)}},[h,ee]);const[z,K]=x.useState(0),fe=x.useRef(null),we=h.kind==="month"?g[h.monthIdx].days:0,oe=56,E=h.kind==="month"&&z?Math.max(oe,Math.floor(z/we)):oe,ce=h.kind==="month"?E*g[h.monthIdx].days:0,de=x.useMemo(()=>{if(!m||h.kind!=="month")return[];const e=g[h.monthIdx];return m.filter(o=>{const r=B(o.dueDate);return r.getFullYear()===e.year&&r.getMonth()===e.month}).sort((o,r)=>B(o.dueDate).getDate()-B(r.dueDate).getDate()||o.id.localeCompare(r.id))},[m,h,g]),V=x.useMemo(()=>{if(h.kind!=="month")return new Map;const e=new Map,o={};return de.forEach(r=>{const d=B(r.dueDate).getDate(),l=o[d]!==void 0?o[d]:0;o[d]=l+1;const p=(d-1)*E+(E-P.w)/2,Y=70+l*60;e.set(r.id,{id:r.id,x:p,y:Y,w:P.w,h:P.h,monthIdx:h.monthIdx})}),e},[h,de,E,P.w,P.h]);async function xe(e){if(R&&i){if(M&&M!==re&&e!==M){const o=te.get(M),r=te.get(e);if(!o||!r){j(re);return}const d=B(o.dueDate),l=B(r.dueDate),p=`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`,Y=`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}-${String(l.getDate()).padStart(2,"0")}`;if(p===Y){f("Links must move forward (different dates)."),j(re),$(e);return}const U=d<l?o:r,Q=d<l?r:o,le=U.id,ue=Q.id,$e=U.name,Ee=Q.name,Le=k||[],je=Le.find(G=>G.fromId===le&&G.toId===ue),Ie=Le.find(G=>G.fromId===ue&&G.toId===le);if(je){try{je.id&&await ye(je.id)}catch{}y?.(G=>(G||[]).filter(he=>!(he.fromId===le&&he.toId===ue))),f(`Unlinked ${$e} â€” ${Ee}`)}else{if(Ie){try{Ie.id&&await ye(Ie.id)}catch{}y?.(G=>(G||[]).filter(he=>!(he.fromId===ue&&he.toId===le)))}await v(le,ue),f(`Linked ${$e} â†’ ${Ee}`)}$(e),j(re);return}if(M===re){j(e),$(e);return}if(!M){j(e),$(e);return}if(M===e){$(e);return}}$(o=>o===e?null:e)}function se(e){window.location.assign(`/project/${e}`)}const A=x.useRef(null),q=x.useRef(!1),H=x.useRef(null),[W,ie]=x.useState(null),ge=x.useRef(!1);function ve(){A.current&&(window.clearTimeout(A.current),A.current=null)}function De(e){const o=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),d=String(e.getDate()).padStart(2,"0");return`${o}-${r}-${d}`}function Ne(e){if(h.kind==="year"){const o=ae.current;if(!o)return new Date(B(H.current.startIso));const r=o.getBoundingClientRect(),d=e-r.left+o.scrollLeft,l=Math.max(0,Math.min(g.length-1,Math.floor(d/u))),p=g[l],Y=d-l*u,U=u/p.days,Q=Math.max(0,Math.min(p.days-1,Math.round(Y/U)));return new Date(p.year,p.month,Q+1)}else{const o=fe.current,r=h.monthIdx,d=g[r];if(!o)return new Date(d.year,d.month,new Date(B(H.current.startIso)).getDate());const l=o.getBoundingClientRect(),p=e-l.left+o.scrollLeft,Y=Math.max(0,Math.min(d.days-1,Math.round(p/E)));return new Date(d.year,d.month,Y+1)}}function Se(e,o){if(!i||R)return;ve();const r=te.get(o);if(!r)return;const d=r.dueDate;q.current=!1,H.current={id:o,startClientX:e.clientX,startIso:d},A.current=window.setTimeout(()=>{q.current=!0,ie({id:o,iso:d}),window.addEventListener("mousemove",Ce),window.addEventListener("mouseup",Oe,{once:!0}),document.body.style.userSelect="none",document.body.style.cursor="ew-resize"},350)}function pe(){q.current||(ve(),H.current=null)}function Ce(e){if(!q.current||!H.current)return;const o=Ne(e.clientX),r=new Date(Date.UTC(o.getFullYear(),o.getMonth(),o.getDate())).toISOString();ie(d=>d&&d.id===H.current.id?{id:d.id,iso:r}:{id:H.current.id,iso:r})}async function Oe(e){ve();const o=q.current&&!!H.current;q.current=!1;const r=H.current;if(H.current=null,document.body.style.userSelect="",document.body.style.cursor="",window.removeEventListener("mousemove",Ce),!r){ie(null);return}if(!o){ie(null);return}ge.current=!0,window.setTimeout(()=>{ge.current=!1},250);const d=te.get(r.id);if(ie(null),!d)return;const l=Ne(e.clientX),p=De(B(d.dueDate)),Y=De(l);if(Y!==p)try{await Ue(r.id,{due_date:Y}),b?.(U=>U&&U.map(Q=>Q.id===r.id?{...Q,dueDate:new Date(Date.UTC(l.getFullYear(),l.getMonth(),l.getDate())).toISOString()}:Q)),f(`Due date moved to ${Y}`),setTimeout(()=>{F().catch(()=>{})},50)}catch{f("Failed to update due date")}}return c?t.jsxs("div",{className:"p-6 text-danger",children:["Failed to load timeline. ",String(c)]}):t.jsxs("div",{className:"w-full min-h-screen flex flex-col bg-background",children:[t.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b border-border bg-card dark:bg-surface sticky top-0 z-40",children:[t.jsx("div",{className:"flex items-center gap-3",children:t.jsxs("h1",{className:"text-lg font-semibold flex items-center gap-1",children:[h.kind==="month"?me(h.monthIdx):"Timeline",t.jsx(rt,{canEdit:i})]})}),t.jsxs("div",{className:"flex items-center gap-2",children:[h.kind==="month"&&t.jsx("button",{className:"px-3 py-1.5 rounded border text-sm border-border bg-card dark:bg-surface",onClick:()=>S({kind:"year"}),children:"Back to Year View"}),i&&t.jsx(at,{projects:m||[],dependencies:k||[],onDeleted:e=>y?.(o=>(o||[]).filter(r=>r.id&&r.id===e?!1:`${r.fromId}|${r.toId}`!==e))}),i&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"mx-2 w-px h-6 bg-border"}),t.jsx("button",{className:"px-3 py-1.5 rounded border text-sm border-accent/40 bg-accent/15 text-accent hover:bg-accent/25",onClick:()=>_(!0),"aria-label":"Create project",title:"Create project",children:"+ Project"}),t.jsx("div",{className:"mx-2 w-px h-6 bg-border"}),t.jsx("button",{className:R?"px-3 py-1.5 rounded border text-sm border-border bg-[hsl(var(--accent))] text-white":"px-3 py-1.5 rounded border text-sm border-border bg-card dark:bg-surface",onClick:()=>{R?(n(!1),j(null)):(n(!0),j(re))},children:s})]})]})]}),h.kind==="year"&&t.jsxs("div",{className:"flex-1 flex flex-col",children:[t.jsx("div",{ref:ae,className:"relative overflow-x-auto overflow-y-hidden flex-1",children:t.jsxs("div",{className:"relative",style:{width:ee,height:X.containerH,minHeight:"100vh"},children:[t.jsx(ot,{months:g,monthWidth:u,onPickMonth:e=>S({kind:"month",monthIdx:e})}),g.map((e,o)=>t.jsx("div",{className:"absolute border-r border-border",style:{left:o*u,top:0,height:"100vh",width:0}},o)),(()=>{const e=g.findIndex(l=>l.year===J.getFullYear()&&l.month===J.getMonth());if(e===-1)return null;const o=g[e],r=u/o.days,d=e*u+(J.getDate()-1)*r+r/2;return t.jsx("div",{className:"absolute top-0 bottom-0",style:{left:d,width:0},children:t.jsx("div",{className:"absolute top-0 bottom-0 border-r",style:{borderColor:"#E11D48"}})})})(),(m||[]).map(e=>{let o=X.items.get(e.id);if(!o)return null;if(W?.id===e.id)try{const r=B(W.iso),d=g.findIndex(l=>r.getFullYear()===l.year&&r.getMonth()===l.month);if(d!==-1){const l=g[d],p=u/l.days,U=u*d+p*(r.getDate()-1)+Math.max(0,(p-o.w)/2);o={...o,x:U}}}catch{}return t.jsx(We,{p:e,rect:o,selected:C===e.id,onClick:()=>{ge.current||xe(e.id)},onDoubleClick:()=>se(e.id),onMouseDown:r=>Se(r,e.id),onMouseUp:pe,onMouseLeave:pe,displayDueDateIso:W?.id===e.id?W.iso:void 0,elevate:C===e.id||W?.id===e.id},e.id)}),t.jsx(He,{items:X.items,dependencies:k||[],highlightId:C,monthWidth:u,months:g})]})}),t.jsx("div",{className:"border-t border-border",children:t.jsx("div",{ref:ne,className:"overflow-x-auto overflow-y-hidden h-4",style:{scrollbarGutter:"stable both-edges"},children:t.jsx("div",{style:{width:ee,height:1}})})})]}),h.kind==="month"&&t.jsx("div",{className:"relative overflow-x-auto overflow-y-hidden flex-1",ref:e=>{if(!e)return;fe.current=e,new ResizeObserver(r=>{for(const d of r){const l=Math.floor(d.contentRect.width);l&&l!==z&&K(l)}}).observe(e)},children:t.jsxs("div",{className:"relative",style:{width:ce,height:520},children:[Array.from({length:g[h.monthIdx].days}).map((e,o)=>{const d=new Date(g[h.monthIdx].year,g[h.monthIdx].month,o+1).getDay(),l=Qe[d],p=d===2||d===4||d===6;return t.jsxs(Ae.Fragment,{children:[t.jsx("div",{className:"absolute top-0 bottom-0"+(p?" bg-accent/5":""),style:{left:o*E,width:E,zIndex:0,pointerEvents:"none"}}),t.jsx("div",{className:"absolute top-0 bottom-0 border-r border-border/40",style:{left:o*E,width:E,zIndex:0,pointerEvents:"none"}}),t.jsx("div",{className:"absolute top-0 bottom-0",style:{left:o*E,width:E,zIndex:0,pointerEvents:"none"},children:t.jsxs("div",{className:"sticky top-8 text-[10px] leading-tight text-center",children:[t.jsx("div",{className:"font-medium text-foreground/80",children:o+1}),t.jsx("div",{className:"uppercase tracking-wide "+(p?"text-accent":"text-mutedToken-foreground"),children:l})]})})]},o)}),(()=>{const e=g[h.monthIdx];if(J.getFullYear()!==e.year||J.getMonth()!==e.month)return null;const o=(J.getDate()-1)*E+E/2;return t.jsx("div",{className:"absolute top-0 bottom-0",style:{left:o,width:0},children:t.jsx("div",{className:"absolute top-0 bottom-0 border-r",style:{borderColor:"#E11D48"}})})})(),de.map(e=>{let o=V.get(e.id);if(!o)return null;if(W?.id===e.id)try{const l=(B(W.iso).getDate()-1)*E+(E-o.w)/2;o={...o,x:l}}catch{}return t.jsx(We,{p:e,rect:o,selected:C===e.id,onClick:()=>{ge.current||xe(e.id)},onDoubleClick:()=>se(e.id),onMouseDown:r=>Se(r,e.id),onMouseUp:pe,onMouseLeave:pe,displayDueDateIso:W?.id===e.id?W.iso:void 0,elevate:C===e.id||W?.id===e.id},e.id)}),(()=>{const e=new Map(V);g[h.monthIdx];const o=0,r=ce,d=(k||[]).filter(l=>{const p=V.has(l.fromId),Y=V.has(l.toId);return p||Y});return d.forEach(l=>{if(!e.has(l.fromId)&&V.has(l.toId)){const p=V.get(l.toId);e.set(l.fromId,{id:l.fromId,x:o,y:p.y,w:0,h:p.h,monthIdx:h.monthIdx})}if(!e.has(l.toId)&&V.has(l.fromId)){const p=V.get(l.fromId);e.set(l.toId,{id:l.toId,x:r,y:p.y,w:0,h:p.h,monthIdx:h.monthIdx})}}),t.jsx(He,{items:e,dependencies:d,highlightId:C,monthWidth:ce,months:g.slice(h.monthIdx,h.monthIdx+1)})})()]})}),w&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-mutedToken-foreground",children:"Loading timeline..."}),N&&t.jsx("div",{className:"fixed bottom-4 right-4 z-[100] px-3 py-2 rounded shadow-lg bg-accent/90 text-white text-sm border border-accent",children:N}),t.jsx(Ve,{open:!!I&&!!D,onClose:()=>_(!1),people:D||[],onCreated:async()=>{await F(),f("Project created")}})]})}function at({projects:a,dependencies:i,onDeleted:m}){const[b,k]=x.useState(!1),y=x.useMemo(()=>new Map(a.map(c=>[c.id,c])),[a]),w=[...i].map((c,v)=>({idx:v,id:c.id||`${c.fromId}|${c.toId}`,from:y.get(c.fromId)?.name||c.fromId,to:y.get(c.toId)?.name||c.toId})).sort((c,v)=>c.from.localeCompare(v.from)||c.to.localeCompare(v.to));return t.jsxs("div",{className:"relative inline-block",children:[t.jsx("button",{className:"px-3 py-1.5 rounded border text-sm border-border bg-card dark:bg-surface",onClick:()=>k(c=>!c),"aria-expanded":b,"aria-haspopup":!0,children:"Deps"}),b&&t.jsxs("div",{className:"absolute right-0 mt-1 w-[560px] max-h-[420px] overflow-auto rounded-md border border-border bg-card dark:bg-surface shadow-2xl z-50",children:[t.jsx("div",{className:"px-3 py-2 text-xs text-mutedToken-foreground border-b border-border sticky top-0 bg-card dark:bg-surface",children:"Dependencies"}),t.jsxs("ul",{className:"p-3 space-y-1",children:[w.length===0&&t.jsx("li",{className:"text-xs text-mutedToken-foreground px-2 py-1",children:"No dependencies yet."}),w.map(c=>t.jsxs("li",{className:"grid grid-cols-[1fr_auto_1fr_auto] items-center gap-2 text-xs px-2 py-1 rounded hover:bg-surface/70",children:[t.jsx("span",{className:"truncate",title:`${c.from}`,children:c.from}),t.jsx("span",{className:"text-center w-16 shrink-0",children:"â†’"}),t.jsx("span",{className:"truncate",title:`${c.to}`,children:c.to}),t.jsx("button",{className:"px-2 py-0.5 rounded border text-[11px] border-border bg-card dark:bg-surface hover:bg-card/70 justify-self-end",onClick:async()=>{try{if(c.id.includes("|")){const v=i.find(D=>`${D.fromId}|${D.toId}`===c.id);v?.id&&await ye(v.id),m(v?.id||c.id)}else await ye(c.id),m(c.id)}catch{}},children:"Delete"})]},c.id))]})]})]})}export{Ze as academicYearWindow,tt as computeYearLayout,mt as default};
