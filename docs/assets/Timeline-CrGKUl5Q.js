import{r as b,q as ye,j as e,J as we,O as ae,a as de,b as ie,d as le,f as he,P as je}from"./index-Dc-RWuvD.js";import{P as ve}from"./ProjectCreateModal-9jaqoS3w.js";import"./PersonSelectPopover-QnI2PRvl.js";/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Ie=n=>n.replace(/^([A-Z])|[\s-_]+(\w)/g,(r,d,l)=>l?l.toUpperCase():d.toLowerCase()),ue=n=>{const r=Ie(n);return r.charAt(0).toUpperCase()+r.slice(1)},be=(...n)=>n.filter((r,d,l)=>!!r&&r.trim()!==""&&l.indexOf(r)===d).join(" ").trim(),Ne=n=>{for(const r in n)if(r.startsWith("aria-")||r==="role"||r==="title")return!0};/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Me={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=b.forwardRef(({color:n="currentColor",size:r=24,strokeWidth:d=2,absoluteStrokeWidth:l,className:k="",children:f,iconNode:x,...a},y)=>b.createElement("svg",{ref:y,...Me,width:r,height:r,stroke:n,strokeWidth:l?Number(d)*24/Number(r):d,className:be("lucide",k),...!f&&!Ne(a)&&{"aria-hidden":"true"},...a},[...x.map(([D,T])=>b.createElement(D,T)),...Array.isArray(f)?f:[f]]));/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=(n,r)=>{const d=b.forwardRef(({className:l,...k},f)=>b.createElement(De,{ref:f,iconNode:r,className:be(`lucide-${ke(ue(n))}`,`lucide-${n}`,l),...k}));return d.displayName=ue(n),d};/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],$e=Ce("info",Ee),ce=["January","February","March","April","May","June","July","August","September","October","November","December"],Se=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];function me(n,r){return new Date(n,r+1,0).getDate()}function re(n){return`${n.getMonth()+1}/${n.getDate()}`}function X(n){const r=new Date(n);if(isNaN(+r))throw new Error("Invalid date: "+n);return r}function Le(n=new Date){const r=n.getFullYear(),l=n.getMonth()>=7?r:r-1,k=new Date(l,7,1),f=[];for(let x=7;x<=11;x++){const a=new Date(l,x,1);f.push({idx:f.length,year:a.getFullYear(),month:a.getMonth(),name:ce[a.getMonth()].toUpperCase().slice(0,3),start:a,days:me(a.getFullYear(),a.getMonth())})}for(let x=0;x<=5;x++){const a=new Date(l+1,x,1);f.push({idx:f.length,year:a.getFullYear(),month:a.getMonth(),name:ce[a.getMonth()].toUpperCase().slice(0,3),start:a,days:me(a.getFullYear(),a.getMonth())})}return{start:k,months:f}}const oe={done:"#34D399",wip:"hsl(var(--accent))",blocked:"#BDC0C3"};function fe(n){const r=n||[];return r.length?r.every(d=>d.status==="Complete"):!1}function xe(n){if(!n)return null;const r=new Date(n);return isNaN(+r)?null:r.toISOString()}function _e(){const[n,r]=b.useState(null),[d,l]=b.useState(null),[k,f]=b.useState(!0),[x,a]=b.useState(null),[y,D]=b.useState(null);b.useEffect(()=>{let p=!0;return(async()=>{try{const[g,E,i,$]=await Promise.all([de(),ie(),le(),he()]);if(!p)return;D($);const N=new Map;for(const s of E){const u=N.get(s.project_id)||[];u.push(s),N.set(s.project_id,u)}const _=i.filter(s=>!!s.from_id&&!!s.to_id).map(s=>({id:s.id,fromId:s.from_id,toId:s.to_id})),v=new Set,C=[];for(const s of _){const u=`${s.fromId}|${s.toId}`;v.has(u)||(v.add(u),C.push(s))}const M=new Map;C.forEach(s=>{M.has(s.toId)||M.set(s.toId,[]),M.get(s.toId).push(s.fromId)});const B=new Set;for(const s of g)s.archived||fe(N.get(s.id))&&B.add(s.id);const t=g.filter(s=>!s.archived).map(s=>{const u=xe(s.due_date);if(!u)return null;const I=B.has(s.id);let H;return I?H="done":H=(M.get(s.id)||[]).some(F=>!B.has(F))?"blocked":"wip",{id:s.id,name:s.name,dueDate:u,status:H}}).filter(Boolean);r(t),l(C)}catch(g){if(!p)return;a(g?.message||"Failed to load timeline")}finally{p&&f(!1)}})(),()=>{p=!1}},[]);async function T(p,g){if(p!==g)try{const E=await je({from_id:p,to_id:g});l(i=>{const $=i||[];return $.some(N=>N.fromId===p&&N.toId===g)?$:[...$,{id:E,fromId:p,toId:g}]})}catch{}}async function L(){try{f(!0);const[p,g,E,i]=await Promise.all([de(),ie(),le(),he()]);D(i);const $=new Map;for(const t of g){const s=$.get(t.project_id)||[];s.push(t),$.set(t.project_id,s)}const N=E.filter(t=>!!t.from_id&&!!t.to_id).map(t=>({id:t.id,fromId:t.from_id,toId:t.to_id})),_=new Set,v=[];for(const t of N){const s=`${t.fromId}|${t.toId}`;_.has(s)||(_.add(s),v.push(t))}const C=new Map;v.forEach(t=>{C.has(t.toId)||C.set(t.toId,[]),C.get(t.toId).push(t.fromId)});const M=new Set;for(const t of p)t.archived||fe($.get(t.id))&&M.add(t.id);const B=p.filter(t=>!t.archived).map(t=>{const s=xe(t.due_date);if(!s)return null;const u=M.has(t.id);let I;return u?I="done":I=(C.get(t.id)||[]).some(W=>!M.has(W))?"blocked":"wip",{id:t.id,name:t.name,dueDate:s,status:I}}).filter(Boolean);r(B),l(v)}finally{f(!1)}}return{projects:n,dependencies:d,setDependencies:l,loading:k,error:x,createDependency:T,people:y,refreshAll:L}}function Pe(n,r,d){const{monthWidth:l,rowHeight:k,block:f,headerH:x}=d;if(!n)return{items:new Map,containerH:x+k*8};const a=new Map,y={};n.forEach(L=>{const p=X(L.dueDate),g=r.findIndex(M=>p.getFullYear()===M.year&&p.getMonth()===M.month);if(g===-1)return;const E=p.getDate();y[g]||(y[g]={});const i=y[g][E]!==void 0?y[g][E]:0;y[g][E]=i+1;const $=r[g],N=l/$.days,v=l*g+N*(E-1)+Math.max(0,(N-f.w)/2),C=x+i*k;a.set(L.id,{id:L.id,x:v,y:C,w:f.w,h:f.h,monthIdx:g})});let D=1;Object.values(y).forEach(L=>{Object.values(L).forEach(p=>{p>D&&(D=Math.max(D,p))})});const T=x+Math.max(3,D)*d.rowHeight+160;return{items:a,containerH:T}}function Te(n,r){const{months:d}=Le(),l=b.useMemo(()=>Pe(n,d,r),[n,d,r.monthWidth,r.rowHeight,r.block.w,r.block.h,r.headerH]);return{months:d,layout:l}}function pe({items:n,dependencies:r,highlightId:d,monthWidth:l,months:k}){const f=l*k.length;let x=0;n.forEach(t=>{x=Math.max(x,t.y+t.h)});const a=x+12,y=r.filter(t=>n.has(t.fromId)&&n.has(t.toId)),D=[];n.forEach(t=>D.push(t.y+t.h)),D.sort((t,s)=>t-s);const T=D.filter((t,s,u)=>s===0||t!==u[s-1]),L=t=>`${t.fromId}|${t.toId}`,p=new Map,g=new Map;y.forEach(t=>{n.get(t.fromId),n.get(t.toId),p.has(t.fromId)||p.set(t.fromId,[]),g.has(t.toId)||g.set(t.toId,[]),p.get(t.fromId).push(t),g.get(t.toId).push(t)}),p.forEach(t=>t.sort((s,u)=>n.get(s.toId).x-n.get(u.toId).x||s.toId.localeCompare(u.toId))),g.forEach(t=>t.sort((s,u)=>n.get(s.fromId).x-n.get(u.fromId).x||s.fromId.localeCompare(u.fromId)));const E=new Map,i=new Map,$=new Map,N=new Map;p.forEach((t,s)=>{i.set(s,t.length),t.forEach((u,I)=>E.set(L(u),I))}),g.forEach((t,s)=>{N.set(s,t.length),t.forEach((u,I)=>$.set(L(u),I))});const _=14,v=14,C=y.map((t,s)=>{const u=n.get(t.fromId),I=n.get(t.toId),H=u.x+u.w,j=I.x,W=L(t),F=i.get(t.fromId)||1,K=E.get(W)||0,Z=N.get(t.toId)||1,Y=$.get(W)||0,q=(K-(F-1)/2)*_,G=(Y-(Z-1)/2)*_,R=u.y+(K+1)/(F+1)*u.h,U=I.y+(Y+1)/(Z+1)*I.h;let O=H+v+q;const z=j-v-G,Q=Math.min(O,z),P=Math.max(O,z);let V=Math.max(u.y+u.h,I.y+I.h);n.forEach(h=>{const w=h.x;h.x+h.w<Q||w>P||(V=Math.max(V,h.y+h.h))});const J=V+8,A=(F-K)*18;O=Math.min(O+A,z-16);const ee=z<=O+2,o=J>Math.max(R,U)+6||ee?`M ${H} ${R} H ${O} V ${J} H ${z} V ${U} H ${j}`:`M ${H} ${R} H ${z} V ${U} H ${j}`,c=!!(d&&(t.fromId===d||t.toId===d));return e.jsx("path",{d:o,stroke:c?"hsl(var(--accent))":"rgb(var(--overlay-10))",strokeWidth:c?3:2.5,fill:"none",strokeLinecap:"round",strokeLinejoin:"round",opacity:c?1:.9},s)}),M=T.map(t=>t+8),B=Math.max(a+24,(M[M.length-1]||a)+24);return e.jsx("svg",{width:f,height:B,className:"absolute left-0 top-0 pointer-events-none z-0",children:C})}function Be({months:n,monthWidth:r,onPickMonth:d}){return e.jsx("div",{className:"sticky top-0 z-10 bg-card/80 dark:bg-surface/80 backdrop-blur border-b border-border",children:e.jsx("div",{className:"relative",style:{width:r*n.length},children:n.map((l,k)=>e.jsx("div",{className:"inline-flex items-center justify-center font-medium text-sm uppercase tracking-wide text-mutedToken-foreground hover:bg-surface/60 cursor-pointer select-none",style:{width:r,height:36},onClick:()=>{d&&d(k)},children:l.name},k))})})}function He(){return e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-[11px] text-mutedToken-foreground leading-snug",children:[e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-sm",style:{background:oe.done}})," done"]}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-sm",style:{background:oe.wip}})," active"]}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-sm",style:{background:oe.blocked}})," blocked"]}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-sm",style:{background:"rgb(var(--overlay-10))"}})," deps"]}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-sm",style:{background:"hsl(var(--accent))"}})," highlight"]})]})}function Re({canEdit:n}){const[r,d]=b.useState(!1);return e.jsxs("div",{className:"relative inline-flex items-center group",onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),children:[e.jsx("div",{className:"p-1 rounded group-hover:bg-surface/60","aria-label":"Info",children:e.jsx($e,{size:16,className:"text-mutedToken-foreground"})}),r&&e.jsxs("div",{className:"absolute top-full left-0 mt-2 w-64 rounded-md border border-border bg-card dark:bg-surface shadow-2xl p-3 z-50 animate-in fade-in zoom-in-95",children:[e.jsx("div",{className:"text-xs font-semibold mb-2",children:"Legend"}),e.jsx(He,{}),e.jsx("div",{className:"h-px my-2 bg-border"}),e.jsxs("div",{className:"text-[11px] leading-snug text-mutedToken-foreground space-y-1",children:[e.jsx("div",{children:"Click a project: highlight edges"}),e.jsx("div",{children:"Double-click a project: open details"}),n&&e.jsx("div",{children:"Edit → Link: create dependency"})]})]})]})}function ge({p:n,rect:r,selected:d,onClick:l,onDoubleClick:k}){const f=oe[n.status],x=X(n.dueDate);return e.jsxs("div",{role:"button",onClick:l,onDoubleClick:k,className:`absolute z-10 rounded shadow-sm border border-black/50 dark:border-white/40 overflow-hidden text-black dark:text-white hover:scale-[1.02] transition-transform ${d?"ring-2 ring-[hsl(var(--accent))]":""}`,style:{left:r.x,top:r.y,width:r.w,height:r.h,background:f},title:`${n.name} - due ${re(x)}`,children:[e.jsx("div",{className:"absolute top-0.5 right-1 text-[9px] font-semibold leading-none text-black/80 dark:text-white/90 select-none",children:re(x)}),e.jsx("div",{className:"absolute inset-0 grid place-items-center px-1.5 pt-3 pb-1.5 text-center",children:e.jsx("div",{className:"text-[11px] leading-tight break-words",style:{display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",overflow:"hidden"},children:n.name})}),n.milestone&&e.jsx("div",{className:"absolute -top-5 left-1/2 -translate-x-1/2 text-[10px] bg-black text-white px-1.5 py-[2px] rounded",children:re(x)})]})}const te="__ARMED__";function Oe(){const{role:n}=ye(),r=n==="admin"||n==="lead",{projects:d,dependencies:l,setDependencies:k,loading:f,error:x,createDependency:a,people:y,refreshAll:D}=_e(),[T,L]=b.useState(""),p=o=>{L(o),window.setTimeout(()=>L(""),2500)},[g,E]=b.useState(!1),[i,$]=b.useState({kind:"year"}),[N,_]=b.useState(null),[v,C]=b.useState(null),[M,B]=b.useState(!1),t=M?"Linking...":"Link",s=640,u=74,I={w:104,h:56},H=56,{months:j,layout:W}=Te(d,{monthWidth:s,rowHeight:u,block:I,headerH:H}),F=s*j.length,K=o=>`${ce[j[o].month]} ${j[o].year}`,Z=b.useMemo(()=>new Map((d||[]).map(o=>[o.id,o])),[d]),Y=new Date,q=b.useRef(null),G=b.useRef(null),R=b.useRef(!1);b.useEffect(()=>{const o=q.current,c=G.current;if(!o||!c)return;const h=()=>{R.current||(R.current=!0,c.scrollLeft=o.scrollLeft,R.current=!1)},w=()=>{R.current||(R.current=!0,o.scrollLeft=c.scrollLeft,R.current=!1)};return o.addEventListener("scroll",h,{passive:!0}),c.addEventListener("scroll",w,{passive:!0}),()=>{o.removeEventListener("scroll",h),c.removeEventListener("scroll",w)}},[i,F]);const[U,O]=b.useState(0),z=i.kind==="month"?j[i.monthIdx].days:0,Q=56,P=i.kind==="month"&&U?Math.max(Q,Math.floor(U/z)):Q,V=i.kind==="month"?P*j[i.monthIdx].days:0,J=b.useMemo(()=>{if(!d||i.kind!=="month")return[];const o=j[i.monthIdx];return d.filter(c=>{const h=X(c.dueDate);return h.getFullYear()===o.year&&h.getMonth()===o.month}).sort((c,h)=>X(c.dueDate).getDate()-X(h.dueDate).getDate()||c.id.localeCompare(h.id))},[d,i,j]),A=b.useMemo(()=>{if(i.kind!=="month")return new Map;const o=new Map,c={};return J.forEach(h=>{const w=X(h.dueDate).getDate(),m=c[w]!==void 0?c[w]:0;c[w]=m+1;const S=(w-1)*P+(P-I.w)/2,se=70+m*60;o.set(h.id,{id:h.id,x:S,y:se,w:I.w,h:I.h,monthIdx:i.monthIdx})}),o},[i,J,P,I.w,I.h]);async function ee(o){if(M&&r){if(v&&v!==te&&o!==v){const c=Z.get(v)?.name||v,h=Z.get(o)?.name||o,w=(l||[]).find(m=>m.fromId===v&&m.toId===o);if(w){try{w.id&&await ae(w.id)}catch{}k?.(m=>(m||[]).filter(S=>!(S.fromId===v&&S.toId===o))),p(`Unlinked ${c} — ${h}`)}else await a(v,o),p(`Linked ${c} → ${h}`);_(o),C(te);return}if(v===te){C(o),_(o);return}if(!v){C(o),_(o);return}if(v===o){_(o);return}}_(c=>c===o?null:o)}function ne(o){window.location.assign(`/project/${o}`)}return x?e.jsxs("div",{className:"p-6 text-danger",children:["Failed to load timeline. ",String(x)]}):e.jsxs("div",{className:"w-full min-h-screen flex flex-col bg-background",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b border-border bg-card dark:bg-surface sticky top-0 z-40",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("h1",{className:"text-lg font-semibold flex items-center gap-1",children:[i.kind==="month"?K(i.monthIdx):"Timeline",e.jsx(Re,{canEdit:r})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[i.kind==="month"&&e.jsx("button",{className:"px-3 py-1.5 rounded border text-sm border-border bg-card dark:bg-surface",onClick:()=>$({kind:"year"}),children:"Back to Year View"}),r&&e.jsx(Ae,{projects:d||[],dependencies:l||[],onDeleted:o=>k?.(c=>(c||[]).filter(h=>h.id&&h.id===o?!1:`${h.fromId}|${h.toId}`!==o))}),r&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mx-2 w-px h-6 bg-border"}),e.jsx("button",{className:"px-3 py-1.5 rounded border text-sm border-accent/40 bg-accent/15 text-accent hover:bg-accent/25",onClick:()=>E(!0),"aria-label":"Create project",title:"Create project",children:"+ Project"}),e.jsx("div",{className:"mx-2 w-px h-6 bg-border"}),e.jsx("button",{className:M?"px-3 py-1.5 rounded border text-sm border-border bg-[hsl(var(--accent))] text-white":"px-3 py-1.5 rounded border text-sm border-border bg-card dark:bg-surface",onClick:()=>{M?(B(!1),C(null)):(B(!0),C(te))},children:t})]})]})]}),i.kind==="year"&&e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("div",{ref:q,className:"relative overflow-x-auto overflow-y-hidden flex-1",children:e.jsxs("div",{className:"relative",style:{width:F,height:W.containerH,minHeight:"100vh"},children:[e.jsx(Be,{months:j,monthWidth:s,onPickMonth:o=>$({kind:"month",monthIdx:o})}),j.map((o,c)=>e.jsx("div",{className:"absolute border-r border-border",style:{left:c*s,top:0,height:"100vh",width:0}},c)),(()=>{const o=j.findIndex(m=>m.year===Y.getFullYear()&&m.month===Y.getMonth());if(o===-1)return null;const c=j[o],h=s/c.days,w=o*s+(Y.getDate()-1)*h+h/2;return e.jsx("div",{className:"absolute top-0 bottom-0",style:{left:w,width:0},children:e.jsx("div",{className:"absolute top-0 bottom-0 border-r",style:{borderColor:"#E11D48"}})})})(),(d||[]).map(o=>{const c=W.items.get(o.id);return c?e.jsx(ge,{p:o,rect:c,selected:N===o.id,onClick:()=>ee(o.id),onDoubleClick:()=>ne(o.id)},o.id):null}),e.jsx(pe,{items:W.items,dependencies:l||[],highlightId:N,monthWidth:s,months:j})]})}),e.jsx("div",{className:"border-t border-border",children:e.jsx("div",{ref:G,className:"overflow-x-auto overflow-y-hidden h-4",style:{scrollbarGutter:"stable both-edges"},children:e.jsx("div",{style:{width:F,height:1}})})})]}),i.kind==="month"&&e.jsx("div",{className:"relative overflow-x-auto overflow-y-hidden flex-1",ref:o=>{if(!o)return;new ResizeObserver(h=>{for(const w of h){const m=Math.floor(w.contentRect.width);m&&m!==U&&O(m)}}).observe(o)},children:e.jsxs("div",{className:"relative",style:{width:V,height:520},children:[Array.from({length:j[i.monthIdx].days}).map((o,c)=>{const w=new Date(j[i.monthIdx].year,j[i.monthIdx].month,c+1).getDay(),m=Se[w],S=w===2||w===4||w===6;return e.jsxs(we.Fragment,{children:[e.jsx("div",{className:"absolute top-0 bottom-0"+(S?" bg-accent/5":""),style:{left:c*P,width:P,zIndex:0,pointerEvents:"none"}}),e.jsx("div",{className:"absolute top-0 bottom-0 border-r border-border/40",style:{left:c*P,width:P,zIndex:0,pointerEvents:"none"}}),e.jsx("div",{className:"absolute top-0 bottom-0",style:{left:c*P,width:P,zIndex:0,pointerEvents:"none"},children:e.jsxs("div",{className:"sticky top-8 text-[10px] leading-tight text-center",children:[e.jsx("div",{className:"font-medium text-foreground/80",children:c+1}),e.jsx("div",{className:"uppercase tracking-wide "+(S?"text-accent":"text-mutedToken-foreground"),children:m})]})})]},c)}),(()=>{const o=j[i.monthIdx];if(Y.getFullYear()!==o.year||Y.getMonth()!==o.month)return null;const c=(Y.getDate()-1)*P+P/2;return e.jsx("div",{className:"absolute top-0 bottom-0",style:{left:c,width:0},children:e.jsx("div",{className:"absolute top-0 bottom-0 border-r",style:{borderColor:"#E11D48"}})})})(),J.map(o=>{const c=A.get(o.id);return c?e.jsx(ge,{p:o,rect:c,selected:N===o.id,onClick:()=>ee(o.id),onDoubleClick:()=>ne(o.id)},o.id):null}),(()=>{const o=new Map(A);j[i.monthIdx];const c=0,h=V,w=(l||[]).filter(m=>{const S=A.has(m.fromId),se=A.has(m.toId);return S||se});return w.forEach(m=>{if(!o.has(m.fromId)&&A.has(m.toId)){const S=A.get(m.toId);o.set(m.fromId,{id:m.fromId,x:c,y:S.y,w:0,h:S.h,monthIdx:i.monthIdx})}if(!o.has(m.toId)&&A.has(m.fromId)){const S=A.get(m.fromId);o.set(m.toId,{id:m.toId,x:h,y:S.y,w:0,h:S.h,monthIdx:i.monthIdx})}}),e.jsx(pe,{items:o,dependencies:w,highlightId:N,monthWidth:V,months:j.slice(i.monthIdx,i.monthIdx+1)})})()]})}),f&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-mutedToken-foreground",children:"Loading timeline..."}),T&&e.jsx("div",{className:"fixed bottom-4 right-4 z-[100] px-3 py-2 rounded shadow-lg bg-accent/90 text-white text-sm border border-accent",children:T}),e.jsx(ve,{open:!!g&&!!y,onClose:()=>E(!1),people:y||[],onCreated:async()=>{await D(),p("Project created")}})]})}function Ae({projects:n,dependencies:r,onDeleted:d}){const[l,k]=b.useState(!1),f=b.useMemo(()=>new Map(n.map(a=>[a.id,a])),[n]),x=[...r].map((a,y)=>({idx:y,id:a.id||`${a.fromId}|${a.toId}`,from:f.get(a.fromId)?.name||a.fromId,to:f.get(a.toId)?.name||a.toId})).sort((a,y)=>a.from.localeCompare(y.from)||a.to.localeCompare(y.to));return e.jsxs("div",{className:"relative inline-block",children:[e.jsx("button",{className:"px-3 py-1.5 rounded border text-sm border-border bg-card dark:bg-surface",onClick:()=>k(a=>!a),"aria-expanded":l,"aria-haspopup":!0,children:"Deps"}),l&&e.jsxs("div",{className:"absolute right-0 mt-1 w-[560px] max-h-[420px] overflow-auto rounded-md border border-border bg-card dark:bg-surface shadow-2xl z-50",children:[e.jsx("div",{className:"px-3 py-2 text-xs text-mutedToken-foreground border-b border-border sticky top-0 bg-card dark:bg-surface",children:"Dependencies"}),e.jsxs("ul",{className:"p-3 space-y-1",children:[x.length===0&&e.jsx("li",{className:"text-xs text-mutedToken-foreground px-2 py-1",children:"No dependencies yet."}),x.map(a=>e.jsxs("li",{className:"grid grid-cols-[1fr_auto_1fr_auto] items-center gap-2 text-xs px-2 py-1 rounded hover:bg-surface/70",children:[e.jsx("span",{className:"truncate",title:`${a.from}`,children:a.from}),e.jsx("span",{className:"text-center w-16 shrink-0",children:"→"}),e.jsx("span",{className:"truncate",title:`${a.to}`,children:a.to}),e.jsx("button",{className:"px-2 py-0.5 rounded border text-[11px] border-border bg-card dark:bg-surface hover:bg-card/70 justify-self-end",onClick:async()=>{try{if(a.id.includes("|")){const y=r.find(D=>`${D.fromId}|${D.toId}`===a.id);y?.id&&await ae(y.id),d(y?.id||a.id)}else await ae(a.id),d(a.id)}catch{}},children:"Delete"})]},a.id))]})]})]})}export{Le as academicYearWindow,Pe as computeYearLayout,Oe as default};
