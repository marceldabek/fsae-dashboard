import{r as s,j as r,g as Ln,p as Fn,Z as Ye,M as Un,a as xt,b as gt,d as vt,$ as Yn}from"./index-DMjV8ZZ2.js";import{i as Gn}from"./Edit03-CtQOnhRU.js";import{P as Bn}from"./ProjectCreateModal-Cj94r3cO.js";import{al as et,am as ge,an as yt,ao as tt,ap as It,aq as Kn,ar as de,as as L,at as Rt,au as Xn,av as Xe,aw as _t,ax as Hn,ay as zn,az as Vn,aA as Jn,aB as Zn,aC as qn,aD as Wn,aE as Qn,aF as eo,aG as to,aH as no,aI as oo,aJ as ro,c as fe,aK as so}from"./modal-Bee9i2Th.js";import{u as ao,d as bt}from"./discordMapping-DeWlSqv_.js";import"./card-BB1rXeM0.js";import"./clsx-B-dksMZM.js";const kt=({size:e=24,color:t="currentColor",...n})=>s.createElement("svg",{viewBox:"0 0 24 24",width:e,height:e,stroke:t,strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",...n},s.createElement("path",{d:"M9 17H7A5 5 0 0 1 7 7h2m6 10h2a5 5 0 0 0 0-10h-2m-8 5h10"}));kt.displayName="Link02";const Tt=({size:e=24,color:t="currentColor",...n})=>s.createElement("svg",{viewBox:"0 0 24 24",width:e,height:e,stroke:t,strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",...n},s.createElement("path",{d:"M9 3h6M3 6h18m-2 0-.701 10.52c-.105 1.578-.158 2.367-.499 2.965a3 3 0 0 1-1.298 1.215c-.62.3-1.41.3-2.993.3h-3.018c-1.582 0-2.373 0-2.993-.3A3 3 0 0 1 6.2 19.485c-.34-.598-.394-1.387-.499-2.966L5 6m5 4.5v5m4-5v5"}));Tt.displayName="Trash03";/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const co=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],io=et("chevron-right",co);/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uo=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],lo=et("circle",uo);/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fo=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],mo=et("info",fo);function ho(e,t,n={}){const o=Math.max(0,n.r??8),a=n.padding??8,c=e.x+e.w,m=e.y+e.h/2,l=t.x,f=t.y+t.h/2,d=c<=l,i=l-c,h=3*a;let p;if(d){const u=Math.max(e.y+e.h,t.y+t.h)+a;p=typeof n.shelf=="number"?n.shelf:u,n.reserveShelfY&&(p=n.reserveShelfY(u,u+200,c,l))}else{const u=Math.min(e.y,t.y)-a;p=typeof n.shelf=="number"?n.shelf:u,n.reserveShelfY&&(p=n.reserveShelfY(u-200,u,t.x,c))}if(n.boxes&&n.boxes.length){const u=n.boxes,y=d?1:-1;let x=0;for(;x<50&&u.some(C=>p>C.y-.5&&p<C.y+C.h+.5);)p+=y*8,x++}function v(u){if(u.length===0)return"";const y=[`M ${u[0].x} ${u[0].y}`];for(let C=1;C<u.length;C++){const I=u[C-1],b=u[C],R=u[C+1];if(!R){y.push(`L ${b.x} ${b.y}`);continue}const E=b.x-I.x,F=b.y-I.y,N=R.x-b.x,M=R.y-b.y;if(!(Math.abs(E)<.001&&Math.abs(M)<.001&&N!==0&&F!==0||Math.abs(F)<.001&&Math.abs(N)<.001&&M!==0&&E!==0)||o===0){y.push(`L ${b.x} ${b.y}`);continue}const G=Math.sign(E),z=Math.sign(F),V=Math.sign(N),w=Math.sign(M),T={x:b.x-G*o-0,y:b.y-z*o-0},P={x:b.x+V*o+0,y:b.y+w*o+0};y.push(`L ${T.x} ${T.y}`),y.push(`Q ${b.x} ${b.y} ${P.x} ${P.y}`),u[C]=P}const x=u[u.length-1];return y.push(`L ${x.x} ${x.y}`),y.join(" ")}if(d){if(Math.abs(m-f)<.5&&n.boxes&&n.boxes.length&&!n.boxes.some(x=>{if(x===e||x===t)return!1;const C=x.x,I=x.x+x.w,b=C<l&&I>c,R=m>=x.y-.5&&m<=x.y+x.h+.5;return b&&R}))return`M ${c} ${m} L ${l} ${f}`;if(i>0&&i<h){const y={x:c,y:m},x={x:l,y:f},C=(y.x+x.x)/2,I={x:C,y:y.y},b={x:C,y:x.y};return`M ${y.x} ${y.y} C ${I.x} ${I.y} ${b.x} ${b.y} ${x.x} ${x.y}`}const u=[{x:c,y:m},{x:c+a,y:m},{x:c+a,y:p},{x:l-a,y:p},{x:l-a,y:f},{x:l,y:f}];return v(u)}else{const u=c-l;if(u>0&&u<h){const x={x:e.x,y:m},C={x:t.x,y:f},I=Math.min(e.y,t.y)-a-12,b={x:x.x-a*.6,y:I},R={x:C.x+a*.6,y:I};return`M ${x.x} ${x.y} C ${b.x} ${b.y} ${R.x} ${R.y} ${C.x} ${C.y}`}const y=[{x:e.x,y:m},{x:e.x-a,y:m},{x:e.x-a,y:p},{x:t.x-a,y:p},{x:t.x-a,y:f},{x:t.x,y:f}];return v(y)}}class po{step;tracks=[];constructor(t=12){this.step=t}reset(){this.tracks=[]}reserve(t,n,o,a){if(a<o){const f=o;o=a,a=f}const c=[...this.tracks].sort((f,d)=>Math.abs(f.y-t)-Math.abs(d.y-t));for(const f of c)if(!(f.y<t||f.y>n)&&!f.spans.some(d=>!(a<=d[0]||o>=d[1])))return f.spans.push([o,a]),f.y;const l=this.tracks.length?Math.max(t,Math.min(n,t+this.tracks.length*this.step)):t;return this.tracks.push({y:l,spans:[[o,a]]}),l}}function xo({initialScale:e=1/(1e3*60*60*24),minScale:t=.2,maxScale:n=24,viewportWidth:o,timeWindow:a,wheelZoomNoCtrl:c=!1,initialSpanDays:m,initialCenterTime:l}){const[f,d]=s.useState(e),[i,h]=s.useState(0),p=s.useRef(null),v=s.useRef(),u=s.useRef(null),y=s.useCallback((w,T)=>{const{start:P,end:D}=a,K=D-P,B=o/K,S=Math.max(t,B);let J=Math.min(n,Math.max(S,w));const Z=-(K*J)+o,me=Math.min(0,Math.max(Z,T));return{s:J,tr:me}},[a,o,t,n]),x=()=>{const{start:w,end:T}=a,K=-((T-w)*f)+o;return Math.abs(i-K)<.5},C=()=>Math.abs(i)<.5,I=s.useCallback(w=>(w-a.start)*f+i,[f,i,a.start]),b=s.useCallback(w=>(w-i)/f+a.start,[f,i,a.start]),R=s.useCallback(w=>{if(c?!0:w.ctrlKey){w.cancelable&&w.preventDefault();const P=w.clientX,D=b(P),K=-w.deltaY,B=Math.exp(K*.0015);let S=f*B;S=Math.min(n,Math.max(t,S));let J=P-(D-a.start)*S;const{s:$,tr:Z}=y(S,J);d($),h(Z)}else{const P=w.deltaY!==0?w.deltaY:w.deltaX;if(P){if(w.cancelable&&w.preventDefault(),P<0&&C()||P>0&&x())return;const{tr:D}=y(f,i-P);h(D)}}},[f,i,y,b,a.start,n,t,c]),E=s.useCallback(w=>{w.button===0&&(p.current={x:w.clientX,tStart:Date.now(),transStart:i})},[i]),F=s.useCallback(w=>{if(!p.current)return;const T=w.clientX-p.current.x,P=p.current.transStart+T;v.current&&cancelAnimationFrame(v.current),v.current=requestAnimationFrame(()=>{if(P>0&&C())return;const{tr:D}=y(f,P);x()&&D<i||h(D)})},[y,f,i]),N=s.useCallback(w=>{p.current=null},[]);function M(w,T){const P=w.clientX-T.clientX,D=w.clientY-T.clientY;return Math.hypot(P,D)}const U=s.useCallback(w=>{if(w.touches.length!==2)return;const[T,P]=[w.touches[0],w.touches[1]],D=M(T,P),K=(T.clientX+P.clientX)/2,B=b(K);u.current={id1:T.identifier,id2:P.identifier,startDist:D,startScale:f,midX:K,midT:B}},[f,b]),G=s.useCallback(w=>{if(!u.current)return;const T=u.current,P=Array.from(w.touches).find(Z=>Z.identifier===T.id1),D=Array.from(w.touches).find(Z=>Z.identifier===T.id2);if(!P||!D)return;const K=M(P,D);let B=T.startScale*(K/T.startDist);B=Math.min(n,Math.max(t,B));let S=T.midX-(T.midT-a.start)*B;const{s:J,tr:$}=y(B,S);d(J),h($)},[y,n,t,a.start]),z=s.useCallback(w=>{u.current=null},[]);s.useEffect(()=>()=>{v.current&&cancelAnimationFrame(v.current)},[]);const V=s.useRef(!1);return s.useEffect(()=>{if(V.current||o<=0)return;const w=a.end-a.start,T=o/w;{const P=m*864e5;let D=o/P;D=Math.min(n,Math.max(T,D));const K=typeof l=="number"?l:(a.start+a.end)/2;let S=o/2-(K-a.start)*D;const{tr:J,s:$}=y(D,S);d($),h(J)}V.current=!0},[m,l,o,y,a.start,a.end,n,f,i]),s.useEffect(()=>{const{s:w,tr:T}=y(f,i);w!==f&&d(w),T!==i&&h(T)},[f,i,y]),{scale:f,translate:i,toX:I,toT:b,onWheel:R,onPointerDown:E,onPointerMove:F,onPointerUp:N,onTouchPinchStart:U,onTouchPinchMove:G,onTouchPinchEnd:z}}function go(e,t){const n=s.useRef(null),o=s.useRef(null),a=s.useRef(null);return n.current&&n.current.key===e?n.current.value:((!o.current||o.current.key!==e)&&(o.current={key:e,value:t()},a.current==null&&(a.current=requestAnimationFrame(()=>{o.current&&(n.current=o.current,o.current=null),a.current=null}))),o.current.value)}const vo=({name:e,dueDate:t,color:n,rect:o,selected:a,milestone:c,elevate:m,scale:l,hideDate:f,onClick:d,onDoubleClick:i,onMouseDown:h,onMouseUp:p,onMouseLeave:v})=>{let u="full";typeof l=="number"&&(l<.5?u="dot":l<.8?u="mini":l<1.2&&(u="compact"));const y=e.split(/\s+/).filter(Boolean).map(I=>I[0]).slice(0,3).join("").toUpperCase(),x=`${e} - due ${t.toLocaleDateString(void 0,{month:"numeric",day:"numeric"})}`,C=`project-block absolute rounded shadow-sm overflow-hidden text-black dark:text-white transition-transform ${a?"project-block--selected":""}`;return r.jsxs("div",{role:"button",onClick:d,onDoubleClick:i,onMouseDown:h,onMouseUp:p,onMouseLeave:v,className:C+(u!=="dot"?" hover:scale-[1.02]":""),style:{left:o.x,top:o.y,width:o.w,height:o.h,background:n,zIndex:m?50:10,touchAction:"none"},title:x,children:[u!=="dot"&&!f&&r.jsxs("div",{className:"absolute top-0.5 right-1 text-[9px] font-semibold leading-none text-black/80 dark:text-white/90 select-none",children:[t.getMonth()+1,"/",t.getDate()]}),r.jsxs("div",{className:"absolute inset-0 flex items-center justify-center px-1.5 text-center",children:[u==="dot"&&r.jsx("div",{className:"text-[9px] font-semibold leading-none select-none",children:y}),u!=="dot"&&(()=>{const I=o.h;if(I>=40)return r.jsx("div",{className:"w-full text-[11px] leading-tight font-medium select-none break-words overflow-hidden",style:{display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical"},children:e});if(I===32){const R=e.length>24?e.slice(0,24):e;return r.jsx("div",{className:"w-full text-[10px] leading-none font-medium select-none whitespace-nowrap overflow-hidden",children:R})}const b=e.length>14?e.slice(0,14):e;return r.jsx("div",{className:"w-full text-[10px] leading-none font-medium select-none whitespace-nowrap overflow-hidden",children:b})})()]}),c&&u!=="dot"&&r.jsxs("div",{className:"absolute -top-5 left-1/2 -translate-x-1/2 text-[10px] bg-black text-white px-1.5 py-[2px] rounded",children:[t.getMonth()+1,"/",t.getDate()]})]})};function yo(e,t){return s.useReducer((n,o)=>t[n][o]??n,e)}var ke=e=>{const{present:t,children:n}=e,o=bo(t),a=typeof n=="function"?n({present:o.isPresent}):s.Children.only(n),c=ge(o.ref,Mo(a));return typeof n=="function"||o.isPresent?s.cloneElement(a,{ref:c}):null};ke.displayName="Presence";function bo(e){const[t,n]=s.useState(),o=s.useRef(null),a=s.useRef(e),c=s.useRef("none"),m=e?"mounted":"unmounted",[l,f]=yo(m,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return s.useEffect(()=>{const d=Le(o.current);c.current=l==="mounted"?d:"none"},[l]),yt(()=>{const d=o.current,i=a.current;if(i!==e){const p=c.current,v=Le(d);e?f("MOUNT"):v==="none"||d?.display==="none"?f("UNMOUNT"):f(i&&p!==v?"ANIMATION_OUT":"UNMOUNT"),a.current=e}},[e,f]),yt(()=>{if(t){let d;const i=t.ownerDocument.defaultView??window,h=v=>{const y=Le(o.current).includes(CSS.escape(v.animationName));if(v.target===t&&y&&(f("ANIMATION_END"),!a.current)){const x=t.style.animationFillMode;t.style.animationFillMode="forwards",d=i.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=x)})}},p=v=>{v.target===t&&(c.current=Le(o.current))};return t.addEventListener("animationstart",p),t.addEventListener("animationcancel",h),t.addEventListener("animationend",h),()=>{i.clearTimeout(d),t.removeEventListener("animationstart",p),t.removeEventListener("animationcancel",h),t.removeEventListener("animationend",h)}}else f("ANIMATION_END")},[t,f]),{isPresent:["mounted","unmountSuspended"].includes(l),ref:s.useCallback(d=>{o.current=d?getComputedStyle(d):null,n(d)},[])}}function Le(e){return e?.animationName||"none"}function Mo(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var Ze="rovingFocusGroup.onEntryFocus",wo={bubbles:!1,cancelable:!0},Te="RovingFocusGroup",[qe,Et,Co]=It(Te),[No,Pt]=tt(Te,[Co]),[So,jo]=No(Te),Dt=s.forwardRef((e,t)=>r.jsx(qe.Provider,{scope:e.__scopeRovingFocusGroup,children:r.jsx(qe.Slot,{scope:e.__scopeRovingFocusGroup,children:r.jsx(Io,{...e,ref:t})})}));Dt.displayName=Te;var Io=s.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:n,orientation:o,loop:a=!1,dir:c,currentTabStopId:m,defaultCurrentTabStopId:l,onCurrentTabStopIdChange:f,onEntryFocus:d,preventScrollOnEntryFocus:i=!1,...h}=e,p=s.useRef(null),v=ge(t,p),u=Rt(c),[y,x]=Xn({prop:m,defaultProp:l??null,onChange:f,caller:Te}),[C,I]=s.useState(!1),b=Xe(d),R=Et(n),E=s.useRef(!1),[F,N]=s.useState(0);return s.useEffect(()=>{const M=p.current;if(M)return M.addEventListener(Ze,b),()=>M.removeEventListener(Ze,b)},[b]),r.jsx(So,{scope:n,orientation:o,dir:u,loop:a,currentTabStopId:y,onItemFocus:s.useCallback(M=>x(M),[x]),onItemShiftTab:s.useCallback(()=>I(!0),[]),onFocusableItemAdd:s.useCallback(()=>N(M=>M+1),[]),onFocusableItemRemove:s.useCallback(()=>N(M=>M-1),[]),children:r.jsx(de.div,{tabIndex:C||F===0?-1:0,"data-orientation":o,...h,ref:v,style:{outline:"none",...e.style},onMouseDown:L(e.onMouseDown,()=>{E.current=!0}),onFocus:L(e.onFocus,M=>{const U=!E.current;if(M.target===M.currentTarget&&U&&!C){const G=new CustomEvent(Ze,wo);if(M.currentTarget.dispatchEvent(G),!G.defaultPrevented){const z=R().filter(D=>D.focusable),V=z.find(D=>D.active),w=z.find(D=>D.id===y),P=[V,w,...z].filter(Boolean).map(D=>D.ref.current);Ot(P,i)}}E.current=!1}),onBlur:L(e.onBlur,()=>I(!1))})})}),$t="RovingFocusGroupItem",At=s.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:n,focusable:o=!0,active:a=!1,tabStopId:c,children:m,...l}=e,f=Kn(),d=c||f,i=jo($t,n),h=i.currentTabStopId===d,p=Et(n),{onFocusableItemAdd:v,onFocusableItemRemove:u,currentTabStopId:y}=i;return s.useEffect(()=>{if(o)return v(),()=>u()},[o,v,u]),r.jsx(qe.ItemSlot,{scope:n,id:d,focusable:o,active:a,children:r.jsx(de.span,{tabIndex:h?0:-1,"data-orientation":i.orientation,...l,ref:t,onMouseDown:L(e.onMouseDown,x=>{o?i.onItemFocus(d):x.preventDefault()}),onFocus:L(e.onFocus,()=>i.onItemFocus(d)),onKeyDown:L(e.onKeyDown,x=>{if(x.key==="Tab"&&x.shiftKey){i.onItemShiftTab();return}if(x.target!==x.currentTarget)return;const C=ko(x,i.orientation,i.dir);if(C!==void 0){if(x.metaKey||x.ctrlKey||x.altKey||x.shiftKey)return;x.preventDefault();let b=p().filter(R=>R.focusable).map(R=>R.ref.current);if(C==="last")b.reverse();else if(C==="prev"||C==="next"){C==="prev"&&b.reverse();const R=b.indexOf(x.currentTarget);b=i.loop?To(b,R+1):b.slice(R+1)}setTimeout(()=>Ot(b))}}),children:typeof m=="function"?m({isCurrentTabStop:h,hasTabStop:y!=null}):m})})});At.displayName=$t;var Ro={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function _o(e,t){return t!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function ko(e,t,n){const o=_o(e.key,n);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(o))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(o)))return Ro[o]}function Ot(e,t=!1){const n=document.activeElement;for(const o of e)if(o===n||(o.focus({preventScroll:t}),document.activeElement!==n))return}function To(e,t){return e.map((n,o)=>e[(t+o)%e.length])}var Eo=Dt,Po=At,We=["Enter"," "],Do=["ArrowDown","PageUp","Home"],Lt=["ArrowUp","PageDown","End"],$o=[...Do,...Lt],Ao={ltr:[...We,"ArrowRight"],rtl:[...We,"ArrowLeft"]},Oo={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Ee="Menu",[Re,Lo,Fo]=It(Ee),[ve,Ft]=tt(Ee,[Fo,_t,Pt]),He=_t(),Ut=Pt(),[Uo,ye]=ve(Ee),[Yo,Pe]=ve(Ee),Yt=e=>{const{__scopeMenu:t,open:n=!1,children:o,dir:a,onOpenChange:c,modal:m=!0}=e,l=He(t),[f,d]=s.useState(null),i=s.useRef(!1),h=Xe(c),p=Rt(a);return s.useEffect(()=>{const v=()=>{i.current=!0,document.addEventListener("pointerdown",u,{capture:!0,once:!0}),document.addEventListener("pointermove",u,{capture:!0,once:!0})},u=()=>i.current=!1;return document.addEventListener("keydown",v,{capture:!0}),()=>{document.removeEventListener("keydown",v,{capture:!0}),document.removeEventListener("pointerdown",u,{capture:!0}),document.removeEventListener("pointermove",u,{capture:!0})}},[]),r.jsx(Hn,{...l,children:r.jsx(Uo,{scope:t,open:n,onOpenChange:h,content:f,onContentChange:d,children:r.jsx(Yo,{scope:t,onClose:s.useCallback(()=>h(!1),[h]),isUsingKeyboardRef:i,dir:p,modal:m,children:o})})})};Yt.displayName=Ee;var Go="MenuAnchor",nt=s.forwardRef((e,t)=>{const{__scopeMenu:n,...o}=e,a=He(n);return r.jsx(zn,{...a,...o,ref:t})});nt.displayName=Go;var ot="MenuPortal",[Bo,Gt]=ve(ot,{forceMount:void 0}),Bt=e=>{const{__scopeMenu:t,forceMount:n,children:o,container:a}=e,c=ye(ot,t);return r.jsx(Bo,{scope:t,forceMount:n,children:r.jsx(ke,{present:n||c.open,children:r.jsx(Vn,{asChild:!0,container:a,children:o})})})};Bt.displayName=ot;var ae="MenuContent",[Ko,rt]=ve(ae),Kt=s.forwardRef((e,t)=>{const n=Gt(ae,e.__scopeMenu),{forceMount:o=n.forceMount,...a}=e,c=ye(ae,e.__scopeMenu),m=Pe(ae,e.__scopeMenu);return r.jsx(Re.Provider,{scope:e.__scopeMenu,children:r.jsx(ke,{present:o||c.open,children:r.jsx(Re.Slot,{scope:e.__scopeMenu,children:m.modal?r.jsx(Xo,{...a,ref:t}):r.jsx(Ho,{...a,ref:t})})})})}),Xo=s.forwardRef((e,t)=>{const n=ye(ae,e.__scopeMenu),o=s.useRef(null),a=ge(t,o);return s.useEffect(()=>{const c=o.current;if(c)return Jn(c)},[]),r.jsx(st,{...e,ref:a,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:L(e.onFocusOutside,c=>c.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)})}),Ho=s.forwardRef((e,t)=>{const n=ye(ae,e.__scopeMenu);return r.jsx(st,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)})}),zo=Qn("MenuContent.ScrollLock"),st=s.forwardRef((e,t)=>{const{__scopeMenu:n,loop:o=!1,trapFocus:a,onOpenAutoFocus:c,onCloseAutoFocus:m,disableOutsidePointerEvents:l,onEntryFocus:f,onEscapeKeyDown:d,onPointerDownOutside:i,onFocusOutside:h,onInteractOutside:p,onDismiss:v,disableOutsideScroll:u,...y}=e,x=ye(ae,n),C=Pe(ae,n),I=He(n),b=Ut(n),R=Lo(n),[E,F]=s.useState(null),N=s.useRef(null),M=ge(t,N,x.onContentChange),U=s.useRef(0),G=s.useRef(""),z=s.useRef(0),V=s.useRef(null),w=s.useRef("right"),T=s.useRef(0),P=u?Wn:s.Fragment,D=u?{as:zo,allowPinchZoom:!0}:void 0,K=S=>{const J=G.current+S,$=R().filter(W=>!W.disabled),Z=document.activeElement,oe=$.find(W=>W.ref.current===Z)?.textValue,me=$.map(W=>W.textValue),he=sr(me,J,oe),ce=$.find(W=>W.textValue===he)?.ref.current;(function W(De){G.current=De,window.clearTimeout(U.current),De!==""&&(U.current=window.setTimeout(()=>W(""),1e3))})(J),ce&&setTimeout(()=>ce.focus())};s.useEffect(()=>()=>window.clearTimeout(U.current),[]),qn();const B=s.useCallback(S=>w.current===V.current?.side&&cr(S,V.current?.area),[]);return r.jsx(Ko,{scope:n,searchRef:G,onItemEnter:s.useCallback(S=>{B(S)&&S.preventDefault()},[B]),onItemLeave:s.useCallback(S=>{B(S)||(N.current?.focus(),F(null))},[B]),onTriggerLeave:s.useCallback(S=>{B(S)&&S.preventDefault()},[B]),pointerGraceTimerRef:z,onPointerGraceIntentChange:s.useCallback(S=>{V.current=S},[]),children:r.jsx(P,{...D,children:r.jsx(eo,{asChild:!0,trapped:a,onMountAutoFocus:L(c,S=>{S.preventDefault(),N.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:m,children:r.jsx(to,{asChild:!0,disableOutsidePointerEvents:l,onEscapeKeyDown:d,onPointerDownOutside:i,onFocusOutside:h,onInteractOutside:p,onDismiss:v,children:r.jsx(Eo,{asChild:!0,...b,dir:C.dir,orientation:"vertical",loop:o,currentTabStopId:E,onCurrentTabStopIdChange:F,onEntryFocus:L(f,S=>{C.isUsingKeyboardRef.current||S.preventDefault()}),preventScrollOnEntryFocus:!0,children:r.jsx(no,{role:"menu","aria-orientation":"vertical","data-state":an(x.open),"data-radix-menu-content":"",dir:C.dir,...I,...y,ref:M,style:{outline:"none",...y.style},onKeyDown:L(y.onKeyDown,S=>{const $=S.target.closest("[data-radix-menu-content]")===S.currentTarget,Z=S.ctrlKey||S.altKey||S.metaKey,oe=S.key.length===1;$&&(S.key==="Tab"&&S.preventDefault(),!Z&&oe&&K(S.key));const me=N.current;if(S.target!==me||!$o.includes(S.key))return;S.preventDefault();const ce=R().filter(W=>!W.disabled).map(W=>W.ref.current);Lt.includes(S.key)&&ce.reverse(),or(ce)}),onBlur:L(e.onBlur,S=>{S.currentTarget.contains(S.target)||(window.clearTimeout(U.current),G.current="")}),onPointerMove:L(e.onPointerMove,_e(S=>{const J=S.target,$=T.current!==S.clientX;if(S.currentTarget.contains(J)&&$){const Z=S.clientX>T.current?"right":"left";w.current=Z,T.current=S.clientX}}))})})})})})})});Kt.displayName=ae;var Vo="MenuGroup",at=s.forwardRef((e,t)=>{const{__scopeMenu:n,...o}=e;return r.jsx(de.div,{role:"group",...o,ref:t})});at.displayName=Vo;var Jo="MenuLabel",Xt=s.forwardRef((e,t)=>{const{__scopeMenu:n,...o}=e;return r.jsx(de.div,{...o,ref:t})});Xt.displayName=Jo;var Ge="MenuItem",Mt="menu.itemSelect",ze=s.forwardRef((e,t)=>{const{disabled:n=!1,onSelect:o,...a}=e,c=s.useRef(null),m=Pe(Ge,e.__scopeMenu),l=rt(Ge,e.__scopeMenu),f=ge(t,c),d=s.useRef(!1),i=()=>{const h=c.current;if(!n&&h){const p=new CustomEvent(Mt,{bubbles:!0,cancelable:!0});h.addEventListener(Mt,v=>o?.(v),{once:!0}),Zn(h,p),p.defaultPrevented?d.current=!1:m.onClose()}};return r.jsx(Ht,{...a,ref:f,disabled:n,onClick:L(e.onClick,i),onPointerDown:h=>{e.onPointerDown?.(h),d.current=!0},onPointerUp:L(e.onPointerUp,h=>{d.current||h.currentTarget?.click()}),onKeyDown:L(e.onKeyDown,h=>{const p=l.searchRef.current!=="";n||p&&h.key===" "||We.includes(h.key)&&(h.currentTarget.click(),h.preventDefault())})})});ze.displayName=Ge;var Ht=s.forwardRef((e,t)=>{const{__scopeMenu:n,disabled:o=!1,textValue:a,...c}=e,m=rt(Ge,n),l=Ut(n),f=s.useRef(null),d=ge(t,f),[i,h]=s.useState(!1),[p,v]=s.useState("");return s.useEffect(()=>{const u=f.current;u&&v((u.textContent??"").trim())},[c.children]),r.jsx(Re.ItemSlot,{scope:n,disabled:o,textValue:a??p,children:r.jsx(Po,{asChild:!0,...l,focusable:!o,children:r.jsx(de.div,{role:"menuitem","data-highlighted":i?"":void 0,"aria-disabled":o||void 0,"data-disabled":o?"":void 0,...c,ref:d,onPointerMove:L(e.onPointerMove,_e(u=>{o?m.onItemLeave(u):(m.onItemEnter(u),u.defaultPrevented||u.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:L(e.onPointerLeave,_e(u=>m.onItemLeave(u))),onFocus:L(e.onFocus,()=>h(!0)),onBlur:L(e.onBlur,()=>h(!1))})})})}),Zo="MenuCheckboxItem",zt=s.forwardRef((e,t)=>{const{checked:n=!1,onCheckedChange:o,...a}=e;return r.jsx(Wt,{scope:e.__scopeMenu,checked:n,children:r.jsx(ze,{role:"menuitemcheckbox","aria-checked":Be(n)?"mixed":n,...a,ref:t,"data-state":it(n),onSelect:L(a.onSelect,()=>o?.(Be(n)?!0:!n),{checkForDefaultPrevented:!1})})})});zt.displayName=Zo;var Vt="MenuRadioGroup",[qo,Wo]=ve(Vt,{value:void 0,onValueChange:()=>{}}),Jt=s.forwardRef((e,t)=>{const{value:n,onValueChange:o,...a}=e,c=Xe(o);return r.jsx(qo,{scope:e.__scopeMenu,value:n,onValueChange:c,children:r.jsx(at,{...a,ref:t})})});Jt.displayName=Vt;var Zt="MenuRadioItem",qt=s.forwardRef((e,t)=>{const{value:n,...o}=e,a=Wo(Zt,e.__scopeMenu),c=n===a.value;return r.jsx(Wt,{scope:e.__scopeMenu,checked:c,children:r.jsx(ze,{role:"menuitemradio","aria-checked":c,...o,ref:t,"data-state":it(c),onSelect:L(o.onSelect,()=>a.onValueChange?.(n),{checkForDefaultPrevented:!1})})})});qt.displayName=Zt;var ct="MenuItemIndicator",[Wt,Qo]=ve(ct,{checked:!1}),Qt=s.forwardRef((e,t)=>{const{__scopeMenu:n,forceMount:o,...a}=e,c=Qo(ct,n);return r.jsx(ke,{present:o||Be(c.checked)||c.checked===!0,children:r.jsx(de.span,{...a,ref:t,"data-state":it(c.checked)})})});Qt.displayName=ct;var er="MenuSeparator",en=s.forwardRef((e,t)=>{const{__scopeMenu:n,...o}=e;return r.jsx(de.div,{role:"separator","aria-orientation":"horizontal",...o,ref:t})});en.displayName=er;var tr="MenuArrow",tn=s.forwardRef((e,t)=>{const{__scopeMenu:n,...o}=e,a=He(n);return r.jsx(oo,{...a,...o,ref:t})});tn.displayName=tr;var nr="MenuSub",[ls,nn]=ve(nr),je="MenuSubTrigger",on=s.forwardRef((e,t)=>{const n=ye(je,e.__scopeMenu),o=Pe(je,e.__scopeMenu),a=nn(je,e.__scopeMenu),c=rt(je,e.__scopeMenu),m=s.useRef(null),{pointerGraceTimerRef:l,onPointerGraceIntentChange:f}=c,d={__scopeMenu:e.__scopeMenu},i=s.useCallback(()=>{m.current&&window.clearTimeout(m.current),m.current=null},[]);return s.useEffect(()=>i,[i]),s.useEffect(()=>{const h=l.current;return()=>{window.clearTimeout(h),f(null)}},[l,f]),r.jsx(nt,{asChild:!0,...d,children:r.jsx(Ht,{id:a.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":a.contentId,"data-state":an(n.open),...e,ref:ro(t,a.onTriggerChange),onClick:h=>{e.onClick?.(h),!(e.disabled||h.defaultPrevented)&&(h.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:L(e.onPointerMove,_e(h=>{c.onItemEnter(h),!h.defaultPrevented&&!e.disabled&&!n.open&&!m.current&&(c.onPointerGraceIntentChange(null),m.current=window.setTimeout(()=>{n.onOpenChange(!0),i()},100))})),onPointerLeave:L(e.onPointerLeave,_e(h=>{i();const p=n.content?.getBoundingClientRect();if(p){const v=n.content?.dataset.side,u=v==="right",y=u?-5:5,x=p[u?"left":"right"],C=p[u?"right":"left"];c.onPointerGraceIntentChange({area:[{x:h.clientX+y,y:h.clientY},{x,y:p.top},{x:C,y:p.top},{x:C,y:p.bottom},{x,y:p.bottom}],side:v}),window.clearTimeout(l.current),l.current=window.setTimeout(()=>c.onPointerGraceIntentChange(null),300)}else{if(c.onTriggerLeave(h),h.defaultPrevented)return;c.onPointerGraceIntentChange(null)}})),onKeyDown:L(e.onKeyDown,h=>{const p=c.searchRef.current!=="";e.disabled||p&&h.key===" "||Ao[o.dir].includes(h.key)&&(n.onOpenChange(!0),n.content?.focus(),h.preventDefault())})})})});on.displayName=je;var rn="MenuSubContent",sn=s.forwardRef((e,t)=>{const n=Gt(ae,e.__scopeMenu),{forceMount:o=n.forceMount,...a}=e,c=ye(ae,e.__scopeMenu),m=Pe(ae,e.__scopeMenu),l=nn(rn,e.__scopeMenu),f=s.useRef(null),d=ge(t,f);return r.jsx(Re.Provider,{scope:e.__scopeMenu,children:r.jsx(ke,{present:o||c.open,children:r.jsx(Re.Slot,{scope:e.__scopeMenu,children:r.jsx(st,{id:l.contentId,"aria-labelledby":l.triggerId,...a,ref:d,align:"start",side:m.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:i=>{m.isUsingKeyboardRef.current&&f.current?.focus(),i.preventDefault()},onCloseAutoFocus:i=>i.preventDefault(),onFocusOutside:L(e.onFocusOutside,i=>{i.target!==l.trigger&&c.onOpenChange(!1)}),onEscapeKeyDown:L(e.onEscapeKeyDown,i=>{m.onClose(),i.preventDefault()}),onKeyDown:L(e.onKeyDown,i=>{const h=i.currentTarget.contains(i.target),p=Oo[m.dir].includes(i.key);h&&p&&(c.onOpenChange(!1),l.trigger?.focus(),i.preventDefault())})})})})})});sn.displayName=rn;function an(e){return e?"open":"closed"}function Be(e){return e==="indeterminate"}function it(e){return Be(e)?"indeterminate":e?"checked":"unchecked"}function or(e){const t=document.activeElement;for(const n of e)if(n===t||(n.focus(),document.activeElement!==t))return}function rr(e,t){return e.map((n,o)=>e[(t+o)%e.length])}function sr(e,t,n){const a=t.length>1&&Array.from(t).every(d=>d===t[0])?t[0]:t,c=n?e.indexOf(n):-1;let m=rr(e,Math.max(c,0));a.length===1&&(m=m.filter(d=>d!==n));const f=m.find(d=>d.toLowerCase().startsWith(a.toLowerCase()));return f!==n?f:void 0}function ar(e,t){const{x:n,y:o}=e;let a=!1;for(let c=0,m=t.length-1;c<t.length;m=c++){const l=t[c],f=t[m],d=l.x,i=l.y,h=f.x,p=f.y;i>o!=p>o&&n<(h-d)*(o-i)/(p-i)+d&&(a=!a)}return a}function cr(e,t){if(!t)return!1;const n={x:e.clientX,y:e.clientY};return ar(n,t)}function _e(e){return t=>t.pointerType==="mouse"?e(t):void 0}var ir=Yt,ur=nt,lr=Bt,dr=Kt,fr=at,mr=Xt,hr=ze,pr=zt,xr=Jt,gr=qt,vr=Qt,yr=en,br=tn,Mr=on,wr=sn,ut="ContextMenu",[Cr,ds]=tt(ut,[Ft]),te=Ft(),[Nr,cn]=Cr(ut),un=e=>{const{__scopeContextMenu:t,children:n,onOpenChange:o,dir:a,modal:c=!0}=e,[m,l]=s.useState(!1),f=te(t),d=Xe(o),i=s.useCallback(h=>{l(h),d(h)},[d]);return r.jsx(Nr,{scope:t,open:m,onOpenChange:i,modal:c,children:r.jsx(ir,{...f,dir:a,open:m,onOpenChange:i,modal:c,children:n})})};un.displayName=ut;var ln="ContextMenuTrigger",dn=s.forwardRef((e,t)=>{const{__scopeContextMenu:n,disabled:o=!1,...a}=e,c=cn(ln,n),m=te(n),l=s.useRef({x:0,y:0}),f=s.useRef({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...l.current})}),d=s.useRef(0),i=s.useCallback(()=>window.clearTimeout(d.current),[]),h=p=>{l.current={x:p.clientX,y:p.clientY},c.onOpenChange(!0)};return s.useEffect(()=>i,[i]),s.useEffect(()=>void(o&&i()),[o,i]),r.jsxs(r.Fragment,{children:[r.jsx(ur,{...m,virtualRef:f}),r.jsx(de.span,{"data-state":c.open?"open":"closed","data-disabled":o?"":void 0,...a,ref:t,style:{WebkitTouchCallout:"none",...e.style},onContextMenu:o?e.onContextMenu:L(e.onContextMenu,p=>{i(),h(p),p.preventDefault()}),onPointerDown:o?e.onPointerDown:L(e.onPointerDown,Fe(p=>{i(),d.current=window.setTimeout(()=>h(p),700)})),onPointerMove:o?e.onPointerMove:L(e.onPointerMove,Fe(i)),onPointerCancel:o?e.onPointerCancel:L(e.onPointerCancel,Fe(i)),onPointerUp:o?e.onPointerUp:L(e.onPointerUp,Fe(i))})]})});dn.displayName=ln;var Sr="ContextMenuPortal",fn=e=>{const{__scopeContextMenu:t,...n}=e,o=te(t);return r.jsx(lr,{...o,...n})};fn.displayName=Sr;var mn="ContextMenuContent",hn=s.forwardRef((e,t)=>{const{__scopeContextMenu:n,...o}=e,a=cn(mn,n),c=te(n),m=s.useRef(!1);return r.jsx(dr,{...c,...o,ref:t,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:l=>{e.onCloseAutoFocus?.(l),!l.defaultPrevented&&m.current&&l.preventDefault(),m.current=!1},onInteractOutside:l=>{e.onInteractOutside?.(l),!l.defaultPrevented&&!a.modal&&(m.current=!0)},style:{...e.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});hn.displayName=mn;var jr="ContextMenuGroup",Ir=s.forwardRef((e,t)=>{const{__scopeContextMenu:n,...o}=e,a=te(n);return r.jsx(fr,{...a,...o,ref:t})});Ir.displayName=jr;var Rr="ContextMenuLabel",pn=s.forwardRef((e,t)=>{const{__scopeContextMenu:n,...o}=e,a=te(n);return r.jsx(mr,{...a,...o,ref:t})});pn.displayName=Rr;var _r="ContextMenuItem",xn=s.forwardRef((e,t)=>{const{__scopeContextMenu:n,...o}=e,a=te(n);return r.jsx(hr,{...a,...o,ref:t})});xn.displayName=_r;var kr="ContextMenuCheckboxItem",gn=s.forwardRef((e,t)=>{const{__scopeContextMenu:n,...o}=e,a=te(n);return r.jsx(pr,{...a,...o,ref:t})});gn.displayName=kr;var Tr="ContextMenuRadioGroup",Er=s.forwardRef((e,t)=>{const{__scopeContextMenu:n,...o}=e,a=te(n);return r.jsx(xr,{...a,...o,ref:t})});Er.displayName=Tr;var Pr="ContextMenuRadioItem",vn=s.forwardRef((e,t)=>{const{__scopeContextMenu:n,...o}=e,a=te(n);return r.jsx(gr,{...a,...o,ref:t})});vn.displayName=Pr;var Dr="ContextMenuItemIndicator",yn=s.forwardRef((e,t)=>{const{__scopeContextMenu:n,...o}=e,a=te(n);return r.jsx(vr,{...a,...o,ref:t})});yn.displayName=Dr;var $r="ContextMenuSeparator",bn=s.forwardRef((e,t)=>{const{__scopeContextMenu:n,...o}=e,a=te(n);return r.jsx(yr,{...a,...o,ref:t})});bn.displayName=$r;var Ar="ContextMenuArrow",Or=s.forwardRef((e,t)=>{const{__scopeContextMenu:n,...o}=e,a=te(n);return r.jsx(br,{...a,...o,ref:t})});Or.displayName=Ar;var Lr="ContextMenuSubTrigger",Mn=s.forwardRef((e,t)=>{const{__scopeContextMenu:n,...o}=e,a=te(n);return r.jsx(Mr,{...a,...o,ref:t})});Mn.displayName=Lr;var Fr="ContextMenuSubContent",wn=s.forwardRef((e,t)=>{const{__scopeContextMenu:n,...o}=e,a=te(n);return r.jsx(wr,{...a,...o,ref:t,style:{...e.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});wn.displayName=Fr;function Fe(e){return t=>t.pointerType!=="mouse"?e(t):void 0}var Ur=un,Yr=dn,Gr=fn,Cn=hn,Nn=pn,Sn=xn,jn=gn,In=vn,Rn=yn,_n=bn,kn=Mn,Tn=wn;const wt=Ur,Ct=Yr,Br=s.forwardRef(({className:e,inset:t,children:n,...o},a)=>r.jsxs(kn,{ref:a,className:fe("flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",t&&"pl-8",e),...o,children:[n,r.jsx(io,{className:"ml-auto h-4 w-4"})]}));Br.displayName=kn.displayName;const Kr=s.forwardRef(({className:e,...t},n)=>r.jsx(Tn,{ref:n,className:fe("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg cursor-default data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]",e),...t}));Kr.displayName=Tn.displayName;const Qe=s.forwardRef(({className:e,...t},n)=>r.jsx(Gr,{children:r.jsx(Cn,{ref:n,className:fe("z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]",e),...t})}));Qe.displayName=Cn.displayName;const Ie=s.forwardRef(({className:e,inset:t,...n},o)=>r.jsx(Sn,{ref:o,className:fe("relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",e),...n}));Ie.displayName=Sn.displayName;const Xr=s.forwardRef(({className:e,children:t,checked:n,...o},a)=>r.jsxs(jn,{ref:a,className:fe("relative flex cursor-pointer select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:n,...o,children:[r.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:r.jsx(Rn,{children:r.jsx(so,{className:"h-4 w-4"})})}),t]}));Xr.displayName=jn.displayName;const Hr=s.forwardRef(({className:e,children:t,...n},o)=>r.jsxs(In,{ref:o,className:fe("relative flex cursor-pointer select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...n,children:[r.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:r.jsx(Rn,{children:r.jsx(lo,{className:"h-4 w-4 fill-current"})})}),t]}));Hr.displayName=In.displayName;const zr=s.forwardRef(({className:e,inset:t,...n},o)=>r.jsx(Nn,{ref:o,className:fe("px-2 py-1.5 text-sm font-semibold text-foreground",t&&"pl-8",e),...n}));zr.displayName=Nn.displayName;const En=s.forwardRef(({className:e,...t},n)=>r.jsx(_n,{ref:n,className:fe("-mx-1 my-1 h-px bg-border",e),...t}));En.displayName=_n.displayName;const Ke=["January","February","March","April","May","June","July","August","September","October","November","December"];function Nt(e,t){return new Date(e,t+1,0).getDate()}function le(e){const t=new Date(e);if(isNaN(+t))throw new Error("Invalid date: "+e);return t}function Vr(e=new Date){const t=e.getFullYear(),n=e.getMonth()>=7?t:t-1,o=new Date(n,7,1),a=[];for(let c=7;c<=11;c++){const m=new Date(n,c,1);a.push({idx:a.length,year:m.getFullYear(),month:m.getMonth(),name:Ke[c].toUpperCase().slice(0,3),start:m,days:Nt(m.getFullYear(),m.getMonth())})}for(let c=0;c<=5;c++){const m=new Date(n+1,c,1);a.push({idx:a.length,year:m.getFullYear(),month:m.getMonth(),name:Ke[c].toUpperCase().slice(0,3),start:m,days:Nt(m.getFullYear(),m.getMonth())})}return{start:o,months:a}}const Ue={done:"#34D399",wip:"hsl(var(--accent))",blocked:"#BDC0C3"};function St(e){const t=e||[];return t.length?t.every(n=>n.status==="Complete"):!1}function jt(e){if(!e)return null;const t=new Date(e);return isNaN(+t)?null:t.toISOString()}function Jr(){const[e,t]=s.useState(null),[n,o]=s.useState(null),[a,c]=s.useState(!0),[m,l]=s.useState(null),[f,d]=s.useState(null),{members:i}=ao();s.useEffect(()=>{let v=!0;return(async()=>{try{const[u,y,x]=await Promise.all([xt(),gt(),vt()]);if(!v)return;d(bt(i));const C=new Map;for(const M of y){const U=C.get(M.project_id)||[];U.push(M),C.set(M.project_id,U)}const I=x.filter(M=>!!M.from_id&&!!M.to_id).map(M=>({id:M.id,fromId:M.from_id,toId:M.to_id})),b=new Set,R=[];for(const M of I){const U=`${M.fromId}|${M.toId}`;b.has(U)||(b.add(U),R.push(M))}const E=new Map;R.forEach(M=>{E.has(M.toId)||E.set(M.toId,[]),E.get(M.toId).push(M.fromId)});const F=new Set;for(const M of u)M.archived||St(C.get(M.id))&&F.add(M.id);const N=u.filter(M=>!M.archived).map(M=>{const U=jt(M.due_date);if(!U)return null;const G=F.has(M.id);let z;return G?z="done":z=(E.get(M.id)||[]).some(T=>!F.has(T))?"blocked":"wip",{id:M.id,name:M.name,dueDate:U,status:z}}).filter(Boolean);t(N),o(R)}catch(u){if(!v)return;l(u?.message||"Failed to load timeline")}finally{v&&c(!1)}})(),()=>{v=!1}},[i]);async function h(v,u){if(v!==u)try{const y=await Yn({from_id:v,to_id:u});o(x=>{const C=x||[];return C.some(I=>I.fromId===v&&I.toId===u)?C:[...C,{id:y,fromId:v,toId:u}]})}catch{}}async function p(){try{c(!0);const[v,u,y]=await Promise.all([xt(),gt(),vt()]);d(bt(i));const x=new Map;for(const N of u){const M=x.get(N.project_id)||[];M.push(N),x.set(N.project_id,M)}const C=y.filter(N=>!!N.from_id&&!!N.to_id).map(N=>({id:N.id,fromId:N.from_id,toId:N.to_id})),I=new Set,b=[];for(const N of C){const M=`${N.fromId}|${N.toId}`;I.has(M)||(I.add(M),b.push(N))}const R=new Map;b.forEach(N=>{R.has(N.toId)||R.set(N.toId,[]),R.get(N.toId).push(N.fromId)});const E=new Set;for(const N of v)N.archived||St(x.get(N.id))&&E.add(N.id);const F=v.filter(N=>!N.archived).map(N=>{const M=jt(N.due_date);if(!M)return null;const U=E.has(N.id);let G;return U?G="done":G=(R.get(N.id)||[]).some(w=>!E.has(w))?"blocked":"wip",{id:N.id,name:N.name,dueDate:M,status:G}}).filter(Boolean);t(F),o(b)}finally{c(!1)}}return{projects:e,setProjects:t,dependencies:n,setDependencies:o,loading:a,error:m,createDependency:h,people:f,refreshAll:p}}function Zr(e,t,n){const{monthWidth:o,rowHeight:a,block:c,headerH:m}=n;if(!e)return{items:new Map,containerH:m+a*8};const l=new Map,f={};e.forEach(h=>{const p=le(h.dueDate),v=t.findIndex(E=>p.getFullYear()===E.year&&p.getMonth()===E.month);if(v===-1)return;const u=p.getDate();f[v]||(f[v]={});const y=f[v][u]!==void 0?f[v][u]:0;f[v][u]=y+1;const x=t[v],C=o/x.days,b=o*v+C*(u-1)+Math.max(0,(C-c.w)/2),R=m+y*a;l.set(h.id,{id:h.id,x:b,y:R,w:c.w,h:c.h,monthIdx:v})});let d=1;Object.values(f).forEach(h=>{Object.values(h).forEach(p=>{p>d&&(d=Math.max(d,p))})});const i=m+Math.max(3,d)*n.rowHeight+160;return{items:l,containerH:i}}function qr(e,t){const{months:n}=Vr(),o=s.useMemo(()=>Zr(e,n,t),[e,n,t.monthWidth,t.rowHeight,t.block.w,t.block.h,t.headerH]);return{months:n,layout:o}}function Wr({items:e,dependencies:t,highlightId:n,monthWidth:o,months:a}){const c=o*a.length;let m=0;e.forEach(u=>{m=Math.max(m,u.y+u.h)});const l=s.useMemo(()=>new po(12),[e]),f=s.useMemo(()=>Array.from(e.values()).map(u=>({x:u.x,y:u.y,w:u.w,h:u.h})),[e]),d=s.useRef(new Map),i=t.filter(u=>e.has(u.fromId)&&e.has(u.toId)),h=i.map(u=>{const y=e.get(u.fromId),x=e.get(u.toId);return`${u.id}:${y.x},${y.y},${y.w},${y.h}|${x.x},${x.y},${x.w},${x.h}`}).join(";")+`|hi:${n||""}`,p=go(h,()=>{const u=[],y=new Set;if(n)for(const x of i)(x.fromId===n||x.toId===n)&&y.add(x.id||`${x.fromId}->${x.toId}`);for(const x of i){const C=x.id||`${x.fromId}->${x.toId}`,I=e.get(x.fromId),b=e.get(x.toId),R=`${x.fromId}->${x.toId}|${I.x},${I.y},${I.w},${I.h}|${b.x},${b.y},${b.w},${b.h}`,E=d.current.get(C);let F;E&&E.key===R?F=E.d:(F=ho(I,b,{padding:8,boxes:f,reserveShelfY:(U,G,z,V)=>l.reserve(U,G,z,V)}),d.current.set(C,{key:R,d:F}));const N=!!n&&y.has(C),M=I.x+I.w>b.x;u.push({id:C,d:F,active:N,back:M})}return u}),v=m+220;return r.jsx("svg",{width:c,height:v,className:"absolute left-0 top-0 pointer-events-none z-0",children:p.map(u=>{const y=`edge ${u.active?"edge--focus edge--active-blue":""} ${u.back?"edge--back":""}`;return r.jsx("path",{d:u.d,className:y,strokeOpacity:u.active?1:.18},u.id)})})}function Qr({months:e,zoom:t,timeWindow:n}){const o=t.scale*864e5,a=o>=30,c=!a&&o>=8,m=!c&&!a,l=[];if(m)e.forEach(d=>{const i=new Date(d.year,d.month,1).getTime(),h=new Date(d.year,d.month+1,1).getTime(),p=i+(h-i)/2;l.push({x:t.toX(p),label:Ke[d.month].slice(0,3).toUpperCase(),key:`mo-${d.idx}`,className:"text-[11px] font-semibold"})});else if(c){const d=new Date(n.start);d.setHours(0,0,0,0);const h=(d.getDay()+6)%7;d.setDate(d.getDate()-h);for(let p=d.getTime();p<n.end;p+=7*864e5){const v=new Date(p),u=`${v.getMonth()+1}/${v.getDate()}`;l.push({x:t.toX(p),label:u,key:`wk-${u}`,className:"text-[10px]"})}}else if(a){const d=new Set,i=new Date(n.start);for(i.setHours(0,0,0,0);i.getTime()<=n.end;){const h=i.getTime(),p=i.toISOString().slice(0,10);d.has(p)||(d.add(p),l.push({x:t.toX(h),label:String(i.getDate()),key:`d-${p}`,className:"text-[10px]"})),i.setDate(i.getDate()+1)}}let f=null;if(a){const d=t.toT(window.innerWidth/2),i=new Date(d);f=`${Ke[i.getMonth()].toUpperCase()} ${i.getFullYear()}`}return r.jsx("div",{className:"sticky top-0 z-10 bg-card/80 dark:bg-surface/80 backdrop-blur border-b border-border h-10 select-none flex items-center",children:r.jsxs("div",{className:"relative w-full h-full",children:[l.map(d=>r.jsx("div",{className:`absolute top-1/2 -translate-y-1/2 px-1 text-mutedToken-foreground ${d.className||""}`,style:{left:d.x,transform:"translate(-50%, -50%)"},children:d.label},d.key)),f&&r.jsx("div",{className:"absolute left-2 top-1/2 -translate-y-1/2 text-[11px] font-semibold text-foreground/80 pointer-events-none",children:f})]})})}function es(){return r.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-[11px] text-mutedToken-foreground leading-snug",children:[r.jsxs("span",{className:"inline-flex items-center gap-1",children:[r.jsx("span",{className:"w-2.5 h-2.5 rounded-sm",style:{background:Ue.done}})," done"]}),r.jsxs("span",{className:"inline-flex items-center gap-1",children:[r.jsx("span",{className:"w-2.5 h-2.5 rounded-sm",style:{background:Ue.wip}})," active"]}),r.jsxs("span",{className:"inline-flex items-center gap-1",children:[r.jsx("span",{className:"w-2.5 h-2.5 rounded-sm",style:{background:Ue.blocked}})," blocked"]}),r.jsxs("span",{className:"inline-flex items-center gap-1",children:[r.jsx("span",{className:"w-2.5 h-2.5 rounded-sm",style:{background:"rgb(var(--overlay-10))"}})," deps"]}),r.jsxs("span",{className:"inline-flex items-center gap-1",children:[r.jsx("span",{className:"w-2.5 h-2.5 rounded-sm",style:{background:"hsl(var(--accent))"}})," highlight"]})]})}function ts({canEdit:e}){const[t,n]=s.useState(!1);return r.jsxs("div",{className:"relative inline-flex items-center group",onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1),children:[r.jsx("div",{className:"p-1 rounded group-hover:bg-surface/60","aria-label":"Info",children:r.jsx(mo,{size:16,className:"text-mutedToken-foreground"})}),t&&r.jsxs("div",{className:"absolute top-full left-0 mt-2 w-64 rounded-md border border-border bg-card dark:bg-surface shadow-2xl p-3 z-50 animate-in fade-in zoom-in-95",children:[r.jsx("div",{className:"text-xs font-semibold mb-2",children:"Legend"}),r.jsx(es,{}),r.jsx("div",{className:"h-px my-2 bg-border"}),r.jsxs("div",{className:"text-[11px] leading-snug text-mutedToken-foreground space-y-1",children:[r.jsx("div",{children:"Click a project: highlight edges"}),r.jsx("div",{children:"Double-click a project: open details"}),e&&r.jsx("div",{children:"Edit → Link: create dependency"})]})]})]})}const Ce="__ARMED__";function fs(){const{role:e}=Ln(),t=e==="admin"||e==="lead",{projects:n,setProjects:o,dependencies:a,setDependencies:c,loading:m,error:l,createDependency:f,people:d,refreshAll:i}=Jr(),[h,p]=s.useState(""),v=g=>{p(g),window.setTimeout(()=>p(""),2500)},[u,y]=s.useState(!1),[x,C]=s.useState(null),[I,b]=s.useState(null),[R,E]=s.useState(null),[F,N]=s.useState(!1),M=F?"Linking...":"Link",U=640,G=74,z={w:96,h:56},V=56,{months:w,layout:T}=qr(n,{monthWidth:U,rowHeight:G,block:z,headerH:V}),P=s.useMemo(()=>w[0].start.getTime(),[w]),D=s.useMemo(()=>new Date(w[w.length-1].year,w[w.length-1].month+1,1).getTime(),[w]),K=s.useMemo(()=>({start:P,end:D}),[P,D]),B=typeof window<"u"?window.innerWidth:1280,J=Date.now()+15*864e5,$=xo({viewportWidth:B,timeWindow:K,initialScale:1/864e5,minScale:1/(30*864e5),maxScale:8/36e5,wheelZoomNoCtrl:!0,initialSpanDays:32,initialCenterTime:J}),Z=(K.end-K.start)*$.scale,oe=s.useMemo(()=>new Map((n||[]).map(g=>[g.id,g])),[n]),me=new Date,he=$.scale*36e5,ce=he>=6?"Day":he>=.25?"Week":he>=.02?"Month":"Year",[W,De]=s.useState(ce);s.useEffect(()=>{De(ce)},[ce]);const[$e,lt]=s.useState(null),Ae=s.useRef(null),Pn=s.useRef(null),be=s.useRef(!1),dt=s.useRef(null);s.useEffect(()=>{const g=Ae.current,k=Pn.current;if(!g||!k)return;const j=()=>{be.current||(be.current=!0,k.scrollLeft=g.scrollLeft,be.current=!1)},O=()=>{be.current||(be.current=!0,g.scrollLeft=k.scrollLeft,be.current=!1)};return g.addEventListener("scroll",j,{passive:!0}),k.addEventListener("scroll",O,{passive:!0}),()=>{g.removeEventListener("scroll",j),k.removeEventListener("scroll",O)}},[Z]);async function Dn(g){if(F&&t){if(R&&R!==Ce&&g!==R){const k=oe.get(R),j=oe.get(g);if(!k||!j){E(Ce);return}const O=le(k.dueDate),X=le(j.dueDate),H=`${O.getFullYear()}-${String(O.getMonth()+1).padStart(2,"0")}-${String(O.getDate()).padStart(2,"0")}`,se=`${X.getFullYear()}-${String(X.getMonth()+1).padStart(2,"0")}-${String(X.getDate()).padStart(2,"0")}`;if(H===se){v("Links must move forward (different dates)."),E(Ce),b(g);return}const ne=O<X?k:j,ue=O<X?j:k,pe=ne.id,A=ue.id,_=ne.name,q=ue.name,Q=a||[],ee=Q.find(re=>re.fromId===pe&&re.toId===A),Y=Q.find(re=>re.fromId===A&&re.toId===pe);if(ee){try{ee.id&&await Ye(ee.id)}catch{}c?.(re=>(re||[]).filter(xe=>!(xe.fromId===pe&&xe.toId===A))),v(`Unlinked ${_} — ${q}`)}else{if(Y){try{Y.id&&await Ye(Y.id)}catch{}c?.(re=>(re||[]).filter(xe=>!(xe.fromId===A&&xe.toId===pe)))}await f(pe,A),v(`Linked ${_} → ${q}`),N(!1),E(null),b(g);return}b(g),E(Ce);return}if(R===Ce){E(g),b(g);return}if(!R){E(g),b(g);return}if(R===g){b(g);return}}b(k=>k===g?null:g)}function $n(g){window.location.assign(`/project/${g}`)}const Oe=s.useRef(null),Me=s.useRef(!1),ie=s.useRef(null),[Ne,Se]=s.useState(null),Ve=s.useRef(!1),we=s.useRef(!1);function Je(){Oe.current&&(window.clearTimeout(Oe.current),Oe.current=null)}function ft(g){const k=g.getFullYear(),j=String(g.getMonth()+1).padStart(2,"0"),O=String(g.getDate()).padStart(2,"0");return`${k}-${j}-${O}`}function mt(g){const k=Ae.current;if(!k)return new Date(le(ie.current.startIso));const j=k.getBoundingClientRect(),O=g-j.left,X=$.toT(O),H=new Date(X);return new Date(H.getFullYear(),H.getMonth(),H.getDate())}function An(g,k){if(!t||F)return;g.stopPropagation(),Je();const j=oe.get(k);if(!j)return;const O=j.dueDate;Me.current=!1,ie.current={id:k,startClientX:g.clientX,startIso:O},Oe.current=window.setTimeout(()=>{Me.current=!0,Se({id:k,iso:O}),we.current=!0,window.addEventListener("mousemove",pt),window.addEventListener("mouseup",On,{once:!0}),document.body.style.userSelect="none",document.body.style.cursor="ew-resize"},350)}function ht(){Me.current||(Je(),ie.current=null)}function pt(g){if(!Me.current||!ie.current)return;const k=mt(g.clientX),j=new Date(Date.UTC(k.getFullYear(),k.getMonth(),k.getDate())).toISOString();Se(O=>O&&O.id===ie.current.id?{id:O.id,iso:j}:{id:ie.current.id,iso:j})}async function On(g){Je();const k=Me.current&&!!ie.current;Me.current=!1,we.current=!1;const j=ie.current;if(ie.current=null,document.body.style.userSelect="",document.body.style.cursor="",window.removeEventListener("mousemove",pt),!j){Se(null);return}if(!k){Se(null);return}Ve.current=!0,window.setTimeout(()=>{Ve.current=!1},250);const O=oe.get(j.id);if(Se(null),!O)return;const X=mt(g.clientX),H=ft(le(O.dueDate)),se=ft(X);if(se!==H)try{await Un(j.id,{due_date:se}),o?.(ne=>ne&&ne.map(ue=>ue.id===j.id?{...ue,dueDate:new Date(Date.UTC(X.getFullYear(),X.getMonth(),X.getDate())).toISOString()}:ue)),v(`Due date moved to ${se}`),setTimeout(()=>{i().catch(()=>{})},50)}catch{v("Failed to update due date")}}return l?r.jsxs("div",{className:"p-6 text-danger",children:["Failed to load timeline. ",String(l)]}):r.jsxs("div",{className:"w-full h-screen overflow-hidden flex flex-col bg-background relative",children:[r.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b border-border bg-card dark:bg-surface sticky top-0 z-40",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsxs("h1",{className:"text-lg font-semibold flex items-center gap-2",children:["Timeline",r.jsx(ts,{canEdit:t})]}),r.jsx("span",{className:"inline-block rounded bg-foreground/10 dark:bg-white/10 px-2 py-1 text-[11px] font-medium text-foreground/70 dark:text-white/70","aria-label":"Current zoom granularity",children:W},W)]}),r.jsxs("div",{className:"flex items-center gap-2",children:[t&&r.jsx(ns,{projects:n||[],dependencies:a||[],onDeleted:g=>c?.(k=>(k||[]).filter(j=>j.id&&j.id===g?!1:`${j.fromId}|${j.toId}`!==g))}),t&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"mx-2 w-px h-6 bg-border"}),r.jsx("button",{className:"px-3 py-1.5 rounded border text-sm border-accent/40 bg-accent/15 text-accent hover:bg-accent/25",onClick:()=>y(!0),"aria-label":"Create project",title:"Create project",children:"+ Project"}),r.jsx("div",{className:"mx-2 w-px h-6 bg-border"}),r.jsx("button",{className:F?"px-3 py-1.5 rounded border text-sm border-border bg-[hsl(var(--accent))] text-white":"px-3 py-1.5 rounded border text-sm border-border bg-card dark:bg-surface",onClick:()=>{F?(N(!1),E(null)):(N(!0),E(Ce))},children:M})]})]})]}),r.jsx("div",{className:"flex-1 flex flex-col",children:r.jsx("div",{ref:Ae,className:"relative overflow-hidden flex-1",onWheel:g=>{we.current||$.onWheel(g.nativeEvent)},onPointerDown:g=>{we.current||$.onPointerDown(g.nativeEvent)},onPointerMove:g=>{we.current||$.onPointerMove(g.nativeEvent)},onPointerUp:g=>{we.current||$.onPointerUp(g.nativeEvent)},onTouchStart:g=>{g.touches.length===2&&$.onTouchPinchStart(g.nativeEvent)},onTouchMove:g=>{g.touches.length===2&&$.onTouchPinchMove(g.nativeEvent)},onTouchEnd:g=>{g.touches.length<2&&$.onTouchPinchEnd(g.nativeEvent)},children:r.jsxs(wt,{onOpenChange:g=>{g||lt(null)},children:[r.jsx(Ct,{asChild:!0,children:r.jsxs("div",{className:"relative",style:{width:Z,height:T.containerH,minHeight:"100vh"},onContextMenu:g=>{try{const k=Ae.current;if(!k)return;const j=k.getBoundingClientRect(),O=g.clientX-j.left,X=$.toT(O),H=new Date(X),se=new Date(H.getFullYear(),H.getMonth(),H.getDate());lt(se)}catch{}},children:[r.jsx(Qr,{months:w,zoom:$,timeWindow:K}),w.map((g,k)=>{const j=new Date(g.year,g.month,1).getTime(),O=$.toX(j);return r.jsx("div",{className:"absolute top-0 bottom-0 border-r border-border/40",style:{left:O,width:0}},k)}),(()=>{const g=w[w.length-1],k=new Date(g.year,g.month+1,1).getTime(),j=$.toX(k);return r.jsx("div",{className:"absolute top-0 bottom-0 pointer-events-none",style:{left:j,width:0},children:r.jsx("div",{className:"absolute top-0 bottom-0 w-[3px] bg-gradient-to-b from-red-500/70 via-red-500 to-red-500/70 rounded-sm"})})})(),(()=>{const g=me.getTime(),k=$.toX(g);return k<-50||k>Z+50?null:r.jsx("div",{className:"absolute top-0 bottom-0 pointer-events-none",style:{left:k,width:0},children:r.jsx("div",{className:"absolute top-0 bottom-0 border-r",style:{borderColor:"#E11D48"}})})})(),(()=>{const g=$.scale*864e5,k=B/g,j=k>=60,O=k>=120,X=(()=>{try{const A=T.items.values().next();return A&&A.value?A.value.y:V}catch{return V}})(),H=[],se=10,ne=[];if((n||[]).forEach(A=>{const _=T.items.get(A.id);if(!_)return;const q=le(Ne?.id===A.id?Ne.iso:A.dueDate),Q=$.toX(q.getTime());let ee;g<.5?ee=16:g<.8?ee=24:g<1.2?ee=36:g<2.5?ee=48:g<5?ee=60:g<10?ee=76:ee=96;const Y=O?14:j?32:_.h,re=j?X+4:_.y;ne.push({id:A.id,xStart:Q-ee/2,w:ee,h:Y,baseY:re,due:q})}),ne.sort((A,_)=>A.xStart-_.xStart||A.id.localeCompare(_.id)),j){const A=se;ne.forEach(_=>{let q=X+4;for(;;){const Q=H.filter(Y=>_.xStart+_.w<=Y.x||Y.x+Y.w<=_.xStart?!1:!(q+_.h<=Y.y||Y.y+Y.h<=q));if(Q.length===0)break;q=Math.max(...Q.map(Y=>Y.y+Y.h))+A}H.push({id:_.id,x:_.xStart,y:q,w:_.w,h:_.h})})}else{const A=se;ne.forEach(_=>{let q=_.baseY;for(;;){const Q=H.filter(Y=>_.xStart+_.w<=Y.x||Y.x+Y.w<=_.xStart?!1:!(q+_.h<=Y.y||Y.y+Y.h<=q));if(Q.length===0)break;q=Math.max(...Q.map(Y=>Y.y+Y.h))+A}H.push({id:_.id,x:_.xStart,y:q,w:_.w,h:_.h})})}const ue=new Map;H.forEach(A=>ue.set(A.id,{id:A.id,x:A.x,y:A.y,w:A.w,h:A.h,monthIdx:0})),dt.current={map:ue,farOut:O,shrink:j};const pe=Math.min(2,Math.max(0,he/.25));return H.map(A=>{const _=oe.get(A.id),q=le(Ne?.id===_.id?Ne.iso:_.dueDate);return r.jsxs(wt,{children:[r.jsx(Ct,{asChild:!0,children:r.jsx("div",{children:r.jsx(vo,{name:_.name,dueDate:q,color:Ue[_.status],rect:{x:A.x,y:A.y,w:A.w,h:A.h},selected:I===_.id,milestone:_.milestone,elevate:I===_.id||Ne?.id===_.id,hideDate:j,onClick:()=>{Ve.current||Dn(_.id)},onDoubleClick:()=>$n(_.id),onMouseDown:Q=>An(Q,_.id),onMouseUp:ht,onMouseLeave:ht,scale:pe})})}),r.jsxs(Qe,{className:"w-52 bg-card dark:bg-surface border border-border/60 shadow-xl",children:[r.jsxs(Ie,{onClick:()=>{y(!0),b(_.id)},children:[r.jsx(Gn,{className:"w-4 h-4 mr-2 opacity-80"})," Edit…"]}),r.jsxs(Ie,{onClick:()=>{const Q=oe.get(_.id)?.design_url;Q&&window.open(Q,"_blank")},disabled:!oe.get(_.id)?.design_url,children:[r.jsx(kt,{className:"w-4 h-4 mr-2 opacity-80"})," Open Design Link"]}),r.jsx(En,{}),r.jsxs(Ie,{className:"text-danger focus:text-danger hover:text-danger",onClick:async()=>{if(confirm("Delete project?"))try{await Fn(_.id),i(),v("Deleted")}catch{v("Delete failed")}},children:[r.jsx(Tt,{className:"w-4 h-4 mr-2"})," Delete"]})]})]},_.id)})})(),(()=>{const g=dt.current?.map;return g?r.jsx(Wr,{items:g,dependencies:a||[],highlightId:I,monthWidth:U,months:w}):null})(),$.scale*864e5>=.7?null:w.map(j=>{const O=new Date(j.year,j.month,1).getTime(),X=new Date(j.year,j.month+1,1).getTime(),H=(n||[]).filter(se=>{const ne=le(se.dueDate).getTime();return ne>=O&&ne<X}).length;return{m:j,count:H,x:$.toX(O+(X-O)/2)}}).filter(j=>j.count>0).map(j=>r.jsx("div",{className:"absolute -top-2 text-[10px] font-semibold text-mutedToken-foreground pointer-events-none",style:{left:j.x,transform:"translateX(-50%)"},children:j.count},j.m.idx))]})}),r.jsx(Qe,{className:"w-56 bg-card dark:bg-surface border border-border/60 shadow-xl",children:r.jsxs(Ie,{onClick:()=>{C($e||null),y(!0)},children:["+ Create project",$e?` on ${$e.getMonth()+1}/${$e.getDate()}`:""]})})]})})}),m&&r.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-mutedToken-foreground pointer-events-none",children:"Loading timeline..."}),h&&r.jsx("div",{className:"fixed bottom-4 right-4 z-[100] px-3 py-2 rounded shadow-lg bg-accent/90 text-white text-sm border border-accent",children:h}),r.jsx(Bn,{open:!!u&&!!d,onClose:()=>{y(!1),C(null)},people:d||[],projectToEdit:I?oe.get(I):null,initialDate:I?null:x,onCreated:async()=>{await i(),v("Project saved")}})]})}function ns({projects:e,dependencies:t,onDeleted:n}){const[o,a]=s.useState(!1),c=s.useMemo(()=>new Map(e.map(l=>[l.id,l])),[e]),m=[...t].map((l,f)=>({idx:f,id:l.id||`${l.fromId}|${l.toId}`,from:c.get(l.fromId)?.name||l.fromId,to:c.get(l.toId)?.name||l.toId})).sort((l,f)=>l.from.localeCompare(f.from)||l.to.localeCompare(f.to));return r.jsxs("div",{className:"relative inline-block",children:[r.jsx("button",{className:"px-3 py-1.5 rounded border text-sm border-border bg-card dark:bg-surface",onClick:()=>a(l=>!l),"aria-expanded":o,"aria-haspopup":!0,children:"Deps"}),o&&r.jsxs("div",{className:"absolute right-0 mt-1 w-[560px] max-h-[420px] overflow-auto rounded-md border border-border bg-card dark:bg-surface shadow-2xl z-50",children:[r.jsx("div",{className:"px-3 py-2 text-xs text-mutedToken-foreground border-b border-border sticky top-0 bg-card dark:bg-surface",children:"Dependencies"}),r.jsxs("ul",{className:"p-3 space-y-1",children:[m.length===0&&r.jsx("li",{className:"text-xs text-mutedToken-foreground px-2 py-1",children:"No dependencies yet."}),m.map(l=>r.jsxs("li",{className:"grid grid-cols-[1fr_auto_1fr_auto] items-center gap-2 text-xs px-2 py-1 rounded hover:bg-surface/70",children:[r.jsx("span",{className:"truncate",title:`${l.from}`,children:l.from}),r.jsx("span",{className:"text-center w-16 shrink-0",children:"→"}),r.jsx("span",{className:"truncate",title:`${l.to}`,children:l.to}),r.jsx("button",{className:"px-2 py-0.5 rounded border text-[11px] border-border bg-card dark:bg-surface hover:bg-card/70 justify-self-end",onClick:async()=>{try{if(l.id.includes("|")){const f=t.find(d=>`${d.fromId}|${d.toId}`===l.id);f?.id&&await Ye(f.id),n(f?.id||l.id)}else await Ye(l.id),n(l.id)}catch{}},children:"Delete"})]},l.id))]})]})]})}export{Vr as academicYearWindow,Zr as computeYearLayout,fs as default};
